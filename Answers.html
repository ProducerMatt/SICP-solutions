<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-04-03 Mon 16:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A Journey Through SICP</title>
<meta name="author" content="ProducerMatt" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">A Journey Through SICP
<br />
<span class="subtitle">Notes, exercises and analyses of Abelson and Sussman</span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org45054f9">1. Introduction Notes</a>
<ul>
<li><a href="#org2349180">1.1. Text Foreword</a></li>
<li><a href="#org23767d9">1.2. Preface, 1e</a></li>
</ul>
</li>
<li><a href="#org3f78e6a">2. Chapter 1: Building Abstractions with Procedures</a>
<ul>
<li><a href="#org24e147c">2.1. 1.1: The Elements of Programming</a></li>
<li><a href="#org8040209">2.2. 1.1.1: Expressions</a></li>
<li><a href="#orge69ca42">2.3. 1.1.3: Evaluating Combinations</a></li>
<li><a href="#org5c2bbd7">2.4. 1.1.4: Compound Procedures</a></li>
<li><a href="#org0a8536b">2.5. 1.1.5: The Substitution Model for Procedure Application</a></li>
<li><a href="#org25ab50f">2.6. 1.1.6: Conditional Expressions and Predicates</a></li>
<li><a href="#org21da2f2">2.7. Exercise 1.1: Trying expressions</a>
<ul>
<li><a href="#org962b3a3">2.7.1. Question</a></li>
<li><a href="#orgb45a807">2.7.2. Answer</a></li>
</ul>
</li>
<li><a href="#org2184bf0">2.8. Exercise 1.2: Prefix form</a>
<ul>
<li><a href="#org4e82c70">2.8.1. Question</a></li>
<li><a href="#org1a1a941">2.8.2. Answer</a></li>
</ul>
</li>
<li><a href="#org14ca440">2.9. Exercise 1.3: Conditionals</a>
<ul>
<li><a href="#org68ee0e3">2.9.1. Question</a></li>
<li><a href="#org71f6a3d">2.9.2. Answer</a></li>
</ul>
</li>
<li><a href="#org8567449">2.10. Exercise 1.4: Compound expressions</a>
<ul>
<li><a href="#org75e839b">2.10.1. Question</a></li>
<li><a href="#org8065906">2.10.2. Answer</a></li>
</ul>
</li>
<li><a href="#org69bc97e">2.11. Exercise 1.5: Applicative vs normal-order evaluation</a>
<ul>
<li><a href="#org3adc1cf">2.11.1. Question</a></li>
<li><a href="#orgb9b2b1e">2.11.2. Answer</a></li>
</ul>
</li>
<li><a href="#org90821bd">2.12. 1.1.7: Example: Square Roots by Newton&rsquo;s Method</a></li>
<li><a href="#orge5a6dc1">2.13. 1.1.8: Procedures as Black-Box Abstractions</a></li>
<li><a href="#org2770b96">2.14. Exercise 1.6: Special form evaluation</a>
<ul>
<li><a href="#org1f207f5">2.14.1. Text code</a></li>
<li><a href="#org4a9bc9e">2.14.2. Question</a></li>
<li><a href="#orgbfb328e">2.14.3. Answer</a></li>
</ul>
</li>
<li><a href="#orgcba267b">2.15. Exercise 1.7: <code>sqrt</code> with small and large numbers</a>
<ul>
<li><a href="#org9246aba">2.15.1. Text</a></li>
<li><a href="#org551591b">2.15.2. Question</a></li>
<li><a href="#org4219390">2.15.3. Diary</a></li>
<li><a href="#org89df2ff">2.15.4. Answer</a></li>
</ul>
</li>
<li><a href="#org6b04a5b">2.16. Exercise 1.8: Cube roots</a>
<ul>
<li><a href="#org754cc13">2.16.1. Question</a></li>
<li><a href="#orgda5cd05">2.16.2. Diary</a></li>
<li><a href="#org7b48cfc">2.16.3. Answer</a></li>
</ul>
</li>
<li><a href="#org624eeef">2.17. 1.2: Procedures and the Processes They Generate</a></li>
<li><a href="#org90a8a9d">2.18. 1.2.1: Linear Recursion and Iteration</a></li>
<li><a href="#org04c75c8">2.19. Exercise 1.9: Peano counting and recursion</a>
<ul>
<li><a href="#org2b6941e">2.19.1. Question</a></li>
<li><a href="#org772c97b">2.19.2. Answer</a></li>
</ul>
</li>
<li><a href="#org22a6df7">2.20. Exercise 1.10: Ackermann&rsquo;s Function</a>
<ul>
<li><a href="#orga5da6a8">2.20.1. Question</a></li>
<li><a href="#org3e4c6ee">2.20.2. Answer</a></li>
</ul>
</li>
<li><a href="#org501c481">2.21. 1.2.2: Tree Recursion</a>
<ul>
<li><a href="#org7dc93e6">2.21.1. Example: Counting change</a></li>
</ul>
</li>
<li><a href="#org9b9c209">2.22. Exercise 1.11: More recursion vs iteration</a>
<ul>
<li><a href="#orgf5c2b29">2.22.1. Question</a></li>
<li><a href="#orgfc961e7">2.22.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgc55a1c1">2.23. Exercise 1.12: Pascal&rsquo;s Triangle</a>
<ul>
<li><a href="#orgffd3290">2.23.1. Question</a></li>
<li><a href="#orgbfd541c">2.23.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgced581a">2.24. Exercise 1.13: Proving Fibonacci approximation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></a>
<ul>
<li><a href="#orgdef0356">2.24.1. Question</a></li>
<li><a href="#orge8f526c">2.24.2. Answer</a></li>
</ul>
</li>
<li><a href="#org7b4b219">2.25. 1.2.3: Orders of Growth</a></li>
<li><a href="#org91b8bd6">2.26. Exercise 1.14: <code>count-change</code></a>
<ul>
<li><a href="#orgca9cb0a">2.26.1. Text</a></li>
<li><a href="#org4c6749f">2.26.2. Question A: Draw the tree</a></li>
<li><a href="#org22aa091">2.26.3. Answer</a></li>
<li><a href="#orgf4af2bf">2.26.4. Question B: Analyzing process growth</a></li>
<li><a href="#org7ede89e">2.26.5. Answer B</a></li>
</ul>
</li>
<li><a href="#org4fb13f8">2.27. Exercise 1.15: Sine approximation</a>
<ul>
<li><a href="#org1a7096a">2.27.1. Question A</a></li>
<li><a href="#orgc9757aa">2.27.2. Answer A</a></li>
<li><a href="#orgf2cfc13">2.27.3. Question B</a></li>
<li><a href="#orgf45a101">2.27.4. Answer B</a></li>
</ul>
</li>
<li><a href="#org593a2ac">2.28. Exercise 1.16: Making <code>fast-expt</code> iterative</a>
<ul>
<li><a href="#org6ff34dc">2.28.1. Text</a></li>
<li><a href="#orgfe932c9">2.28.2. Question</a></li>
<li><a href="#orgdb49195">2.28.3. Diary</a></li>
<li><a href="#org8a11bc5">2.28.4. Answer</a></li>
</ul>
</li>
<li><a href="#org5abb578">2.29. Exercise 1.17: Logarithmic multiplication (recursive)</a>
<ul>
<li><a href="#orgb32e9a2">2.29.1. Question</a></li>
<li><a href="#org16c6b7b">2.29.2. Answer</a></li>
</ul>
</li>
<li><a href="#org42a0e4e">2.30. Exercise 1.18: Logarithmic multiplication (iterative)</a>
<ul>
<li><a href="#org19daba7">2.30.1. Question</a></li>
<li><a href="#orge9ca56e">2.30.2. Diary</a></li>
<li><a href="#org3b6ddb0">2.30.3. Answer</a></li>
</ul>
</li>
<li><a href="#org22498a1">2.31. Exercise 1.19: Logarithmic fibonacci computing with \(T\)</a>
<ul>
<li><a href="#orgd0c497f">2.31.1. Question</a></li>
<li><a href="#orgbde4f52">2.31.2. Diary</a></li>
<li><a href="#orga8b1664">2.31.3. Answer</a></li>
</ul>
</li>
<li><a href="#org639f31c">2.32. 1.2.5: Greatest Common Divisor</a></li>
<li><a href="#orgaec22df">2.33. Exercise 1.20: Inefficiency of normal-order evaluation</a>
<ul>
<li><a href="#orgdffd104">2.33.1. Text</a></li>
<li><a href="#org67e27fc">2.33.2. Question</a></li>
<li><a href="#org75bdc33">2.33.3. Answer</a></li>
</ul>
</li>
<li><a href="#org0f87242">2.34. 1.2.6: Example: Testing for Primality</a></li>
<li><a href="#orgcbacc3a">2.35. Exercise 1.21</a>
<ul>
<li><a href="#orgd0dadfc">2.35.1. Text</a></li>
<li><a href="#orge878ba2">2.35.2. Question</a></li>
<li><a href="#org8a2d92e">2.35.3. Answer</a></li>
</ul>
</li>
<li><a href="#org447f37f">2.36. Exercise 1.22</a>
<ul>
<li><a href="#org7a87589">2.36.1. Question</a></li>
<li><a href="#orgd809196">2.36.2. Answer</a></li>
</ul>
</li>
<li><a href="#org829598e">2.37. Exercise 1.23</a>
<ul>
<li><a href="#orgda09c63">2.37.1. Question</a></li>
<li><a href="#org0e6e3cc">2.37.2. A Comedy of Error (just the one)</a></li>
<li><a href="#org4eb99eb">2.37.3. Answer</a></li>
</ul>
</li>
<li><a href="#orgfcca5ef">2.38. Exercise 1.24</a>
<ul>
<li><a href="#org0788ee6">2.38.1. Text</a></li>
<li><a href="#orga4424b5">2.38.2. Question</a></li>
<li><a href="#org0906e3c">2.38.3. Answer</a></li>
</ul>
</li>
<li><a href="#orgae7377a">2.39. Exercise 1.25</a>
<ul>
<li><a href="#org10e56b5">2.39.1. Question</a></li>
<li><a href="#orgfb73cd6">2.39.2. Answer</a></li>
</ul>
</li>
<li><a href="#org47d703a">2.40. Exercise 1.26</a>
<ul>
<li><a href="#org8e2720e">2.40.1. Question</a></li>
<li><a href="#org479f63d">2.40.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgd4ba6c3">2.41. Exercise 1.27</a>
<ul>
<li><a href="#orga752353">2.41.1. Question</a></li>
<li><a href="#orgf46b4b8">2.41.2. Answer</a></li>
</ul>
</li>
<li><a href="#org07cc73d">2.42. Exercise 1.28</a>
<ul>
<li><a href="#org6b13c95">2.42.1. Question</a></li>
<li><a href="#orge130868">2.42.2. Analysis</a></li>
<li><a href="#orga50d3bb">2.42.3. Answer</a></li>
</ul>
</li>
<li><a href="#org65b7714">2.43. 1.3: Formulating Abstractions with Higher-Order Procedures</a></li>
<li><a href="#org32d29c0">2.44. 1.3.1: Procedures as Arguments</a></li>
<li><a href="#org803dd39">2.45. Exercise 1.29</a>
<ul>
<li><a href="#orgc04aabb">2.45.1. Text</a></li>
<li><a href="#org99ab29d">2.45.2. Question</a></li>
<li><a href="#orgc5964ad">2.45.3. Answer</a></li>
</ul>
</li>
<li><a href="#orgd34cfc4">2.46. Exercise 1.30</a>
<ul>
<li><a href="#org76e977c">2.46.1. Question</a></li>
<li><a href="#org9c1d8a2">2.46.2. Answer</a></li>
</ul>
</li>
<li><a href="#org9721bd1">2.47. Exercise 1.31</a>
<ul>
<li><a href="#org1d90a1e">2.47.1. Question A.1</a></li>
<li><a href="#org53eccbe">2.47.2. Answer A.1</a></li>
<li><a href="#org87f1f84">2.47.3. Question A.2</a></li>
<li><a href="#orgacb66f9">2.47.4. Answer A.2</a></li>
<li><a href="#org61b476c">2.47.5. Question A.3</a></li>
<li><a href="#org247bca3">2.47.6. Answer A.3</a></li>
<li><a href="#org3e47c77">2.47.7. Question B</a></li>
<li><a href="#org39e4769">2.47.8. Answer B</a></li>
</ul>
</li>
<li><a href="#org776c49e">2.48. Exercise 1.32</a>
<ul>
<li><a href="#org146ce7c">2.48.1. Question A</a></li>
<li><a href="#org1a29ec7">2.48.2. Answer A</a></li>
<li><a href="#org881724f">2.48.3. Question B</a></li>
<li><a href="#orga02646e">2.48.4. Answer B</a></li>
</ul>
</li>
<li><a href="#org3ec0904">2.49. Exercise 1.33</a>
<ul>
<li><a href="#org0bb1264">2.49.1. Question A</a></li>
<li><a href="#orga9c4888">2.49.2. Answer A</a></li>
<li><a href="#orge0bc5de">2.49.3. Question B</a></li>
</ul>
</li>
<li><a href="#org57b46bd">2.50. 1.3.2: Constructing Procedures Using lambda</a></li>
<li><a href="#org1377418">2.51. Exercise 1.34</a>
<ul>
<li><a href="#org60ae614">2.51.1. Question</a></li>
<li><a href="#orgbac8b30">2.51.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgaff393d">2.52. 1.3.3 Procedures as General Methods</a></li>
<li><a href="#orgac4a446">2.53. Exercise 1.35</a>
<ul>
<li><a href="#org0d8fae9">2.53.1. Text</a></li>
<li><a href="#org21d508e">2.53.2. Question</a></li>
<li><a href="#org76a68ef">2.53.3. Answer</a></li>
</ul>
</li>
<li><a href="#org94c456e">2.54. Exercise 1.36</a>
<ul>
<li><a href="#org217f072">2.54.1. Question</a></li>
<li><a href="#orgaa413d9">2.54.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgaf6c0ec">2.55. Exercise 1.37</a>
<ul>
<li><a href="#org5e0c971">2.55.1. Question A</a></li>
<li><a href="#orgc583209">2.55.2. Answer A</a></li>
<li><a href="#org4987756">2.55.3. Question B</a></li>
<li><a href="#org20e4f7a">2.55.4. Answer B</a></li>
<li><a href="#orgea240fc">2.55.5. Question C</a></li>
<li><a href="#org08c0c37">2.55.6. Answer C</a></li>
</ul>
</li>
<li><a href="#orgd68f03d">2.56. Exercise 1.38</a>
<ul>
<li><a href="#org681a519">2.56.1. Question</a></li>
<li><a href="#org110ba83">2.56.2. Answer</a></li>
</ul>
</li>
<li><a href="#orge8fe424">2.57. Exercise 1.39</a>
<ul>
<li><a href="#org0c60289">2.57.1. Question</a></li>
<li><a href="#org4252fc3">2.57.2. Answer</a></li>
</ul>
</li>
<li><a href="#org9617225">2.58. 1.3.4 Procedures as Returned Values</a></li>
<li><a href="#org4ede1cf">2.59. Exercise 1.40</a>
<ul>
<li><a href="#org7a0a068">2.59.1. Text</a></li>
<li><a href="#org70b8d90">2.59.2. Question</a></li>
<li><a href="#org4a34990">2.59.3. Answer</a></li>
</ul>
</li>
<li><a href="#orgea07867">2.60. Exercise 1.41</a>
<ul>
<li><a href="#orgedb0ee0">2.60.1. Question</a></li>
<li><a href="#org66d16d0">2.60.2. Answer</a></li>
</ul>
</li>
<li><a href="#org2a8dcf2">2.61. Exercise 1.42</a>
<ul>
<li><a href="#orgb4da867">2.61.1. Question</a></li>
<li><a href="#orgb043a8a">2.61.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgd60ea52">2.62. Exercise 1.43</a>
<ul>
<li><a href="#org86ba4be">2.62.1. Question</a></li>
<li><a href="#orgb07985f">2.62.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgf94e7af">2.63. Exercise 1.44</a>
<ul>
<li><a href="#org19c6599">2.63.1. Question</a></li>
<li><a href="#orga790372">2.63.2. Answer</a></li>
</ul>
</li>
<li><a href="#org30c71dd">2.64. Exercise 1.45</a>
<ul>
<li><a href="#org6800a54">2.64.1. Question</a></li>
<li><a href="#org8e2bf2d">2.64.2. Answer</a></li>
</ul>
</li>
<li><a href="#orga9fd373">2.65. Exercise 1.46</a>
<ul>
<li><a href="#orgfdadfe2">2.65.1. Question</a></li>
<li><a href="#orge7358f3">2.65.2. Answer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb929002">3. Chapter 2: Building Abstractions with Data</a>
<ul>
<li><a href="#org672a852">3.1. 2.1.1: Example: Arithmetic Operations for Rational Numbers</a></li>
<li><a href="#org7725d27">3.2. Exercise 2.1</a>
<ul>
<li><a href="#orgc55d891">3.2.1. Text</a></li>
<li><a href="#org81ae6ec">3.2.2. Question</a></li>
<li><a href="#org723b8d4">3.2.3. Answer</a></li>
</ul>
</li>
<li><a href="#org3a93c8b">3.3. Exercise 2.2</a>
<ul>
<li><a href="#org601f529">3.3.1. Question</a></li>
<li><a href="#orgfb3bcc5">3.3.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgc4612f4">3.4. Exercise 2.3</a>
<ul>
<li><a href="#org4ac2020">3.4.1. Question</a></li>
<li><a href="#org831a79c">3.4.2. Answer 1</a></li>
<li><a href="#org2486979">3.4.3. Answer 2</a></li>
</ul>
</li>
<li><a href="#orgd56f180">3.5. 2.1.3: What Is Meant by Data?</a></li>
<li><a href="#org0a269c1">3.6. Exercise 2.4</a>
<ul>
<li><a href="#org0070f10">3.6.1. Question</a></li>
<li><a href="#orgade1f73">3.6.2. Answer</a></li>
</ul>
</li>
<li><a href="#org1155f55">3.7. Exercise 2.5&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></a>
<ul>
<li><a href="#org39c45df">3.7.1. Question</a></li>
<li><a href="#org8c5bfdf">3.7.2. Answer</a></li>
</ul>
</li>
<li><a href="#org23ba788">3.8. Exercise 2.6&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></a>
<ul>
<li><a href="#orgfe9891f">3.8.1. Question</a></li>
<li><a href="#orgad5859b">3.8.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgee5662b">3.9. Exercise 2.7</a>
<ul>
<li><a href="#orgce2504b">3.9.1. Text</a></li>
<li><a href="#orgeaba4a1">3.9.2. Question</a></li>
<li><a href="#orgdf65aa9">3.9.3. Answer</a></li>
</ul>
</li>
<li><a href="#org9234bf2">3.10. Exercise 2.8</a>
<ul>
<li><a href="#org8f55a53">3.10.1. Question</a></li>
<li><a href="#org3482fa6">3.10.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgb5f5b61">3.11. Exercise 2.9</a>
<ul>
<li><a href="#orgd26bbe8">3.11.1. Question</a></li>
<li><a href="#orgda77416">3.11.2. Answer</a></li>
</ul>
</li>
<li><a href="#org96aed24">3.12. Exercise 2.10</a>
<ul>
<li><a href="#org4ede5ae">3.12.1. Question</a></li>
<li><a href="#orgcf9fe5e">3.12.2. Answer</a></li>
</ul>
</li>
<li><a href="#org297ff2c">3.13. Exercise 2.11</a>
<ul>
<li><a href="#org3e62048">3.13.1. Question</a></li>
<li><a href="#orge118460">3.13.2. Answer</a></li>
</ul>
</li>
<li><a href="#org0889f3d">3.14. Exercise 2.12</a>
<ul>
<li><a href="#org93eb4c9">3.14.1. Question</a></li>
<li><a href="#orgac3f815">3.14.2. Answer</a></li>
</ul>
</li>
<li><a href="#org47e4163">3.15. Exercise 2.13&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></a>
<ul>
<li><a href="#orgf72f99e">3.15.1. Question</a></li>
<li><a href="#org4c297f3">3.15.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgc89532c">3.16. Exercise 2.14</a>
<ul>
<li><a href="#org9f679ec">3.16.1. Question</a></li>
<li><a href="#org323edf8">3.16.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgf9f2adb">3.17. Exercise 2.15</a>
<ul>
<li><a href="#orge83b3aa">3.17.1. Question</a></li>
<li><a href="#org4c24b43">3.17.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgc826d6f">3.18. Exercise 2.16&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></a>
<ul>
<li><a href="#org61981dc">3.18.1. Question</a></li>
<li><a href="#org5128d95">3.18.2. Answer</a></li>
</ul>
</li>
<li><a href="#org7db10a6">3.19. 2.2: Hierarchical Data and the Closure Property</a></li>
<li><a href="#org1f2ee87">3.20. 2.2.1: Representing Sequences</a></li>
<li><a href="#orgf34b509">3.21. Exercise 2.17</a>
<ul>
<li><a href="#org15d5362">3.21.1. Question</a></li>
<li><a href="#org93c46eb">3.21.2. Answer</a></li>
</ul>
</li>
<li><a href="#orga23ddde">3.22. Exercise 2.18</a>
<ul>
<li><a href="#orgca2a110">3.22.1. Question</a></li>
<li><a href="#org3c38eb3">3.22.2. Answer</a></li>
</ul>
</li>
<li><a href="#org83a54a9">3.23. Exercise 2.19</a>
<ul>
<li><a href="#org498572d">3.23.1. Question</a></li>
<li><a href="#org0de5034">3.23.2. Answer</a></li>
</ul>
</li>
<li><a href="#org6f5e284">3.24. Exercise 2.20</a>
<ul>
<li><a href="#orgde1b89e">3.24.1. Question</a></li>
<li><a href="#org716bdfd">3.24.2. Answer</a></li>
</ul>
</li>
<li><a href="#org285c80e">3.25. Exercise 2.21</a>
<ul>
<li><a href="#org30f1f4a">3.25.1. Question</a></li>
<li><a href="#org3da7d75">3.25.2. Answer</a></li>
</ul>
</li>
<li><a href="#orge844114">3.26. Exercise 2.22</a>
<ul>
<li><a href="#org5a0f6ae">3.26.1. Questions</a></li>
<li><a href="#org89b1e81">3.26.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgd686e56">3.27. Exercise 2.23</a>
<ul>
<li><a href="#orgbc911bf">3.27.1. Question</a></li>
<li><a href="#orgc80e93e">3.27.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgf400d86">3.28. Exercise 2.24</a>
<ul>
<li><a href="#orgae92e7d">3.28.1. Text Definitions</a></li>
<li><a href="#org432ed3d">3.28.2. Question</a></li>
<li><a href="#orgd2cc4fa">3.28.3. Answer</a></li>
</ul>
</li>
<li><a href="#org3d4d0ee">3.29. Exercise 2.25</a>
<ul>
<li><a href="#orgadae586">3.29.1. Question</a></li>
</ul>
</li>
<li><a href="#org80025c1">3.30. Exercise 2.26</a>
<ul>
<li><a href="#orga0b1c78">3.30.1. Question</a></li>
<li><a href="#org109e8b0">3.30.2. Answer</a></li>
</ul>
</li>
<li><a href="#org77c9087">3.31. Exercise 2.27</a>
<ul>
<li><a href="#org5fc0bf6">3.31.1. Question</a></li>
<li><a href="#orge0c9e43">3.31.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgc63c871">3.32. Exercise 2.28</a>
<ul>
<li><a href="#orgd5e41d9">3.32.1. Question</a></li>
<li><a href="#org9b70050">3.32.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgaf10a83">3.33. Exercise 2.29: Binary Mobiles</a>
<ul>
<li><a href="#org195e3fc">3.33.1. Text Definitions</a></li>
<li><a href="#org36f1eb6">3.33.2. Question A: Selectors</a></li>
<li><a href="#orga9f6275">3.33.3. Answer A</a></li>
<li><a href="#org548a40c">3.33.4. Question B: total-weight</a></li>
<li><a href="#orgc6636b9">3.33.5. Answer B</a></li>
<li><a href="#orgfedc33e">3.33.6. Question C: Balancing</a></li>
<li><a href="#orgda16958">3.33.7. Answer C</a></li>
<li><a href="#org293f244">3.33.8. Question D: Implementation shakeup</a></li>
<li><a href="#org6b249ed">3.33.9. Answer D</a></li>
</ul>
</li>
<li><a href="#org5bf9a41">3.34. Exercise 2.30</a>
<ul>
<li><a href="#org0ff2f50">3.34.1. Question</a></li>
<li><a href="#orgba151ab">3.34.2. Answer</a></li>
</ul>
</li>
<li><a href="#org6373be0">3.35. Exercise 2.31</a>
<ul>
<li><a href="#org6442098">3.35.1. Question</a></li>
<li><a href="#org729b032">3.35.2. Answer</a></li>
</ul>
</li>
<li><a href="#org9c4950a">3.36. Exercise 2.32</a>
<ul>
<li><a href="#orgb731aaa">3.36.1. Question</a></li>
<li><a href="#org26673a9">3.36.2. Answer</a></li>
</ul>
</li>
<li><a href="#org992bfb0">3.37. 2.2.3: Sequences as Conventional Interfaces</a></li>
<li><a href="#orgd5b8dcc">3.38. Exercise 2.33: The flexibility of <code>accumulate</code></a>
<ul>
<li><a href="#orgaa85487">3.38.1. Text Definitions</a></li>
<li><a href="#orged377e0">3.38.2. Question</a></li>
<li><a href="#orgd40d4d1">3.38.3. Answer</a></li>
</ul>
</li>
<li><a href="#orgf9912a5">3.39. Exercise 2.34</a>
<ul>
<li><a href="#orgb085631">3.39.1. Question</a></li>
<li><a href="#org02c2fb2">3.39.2. Answer</a></li>
</ul>
</li>
<li><a href="#org5ec19a4">3.40. Exercise 2.35</a>
<ul>
<li><a href="#org3360eb5">3.40.1. Question</a></li>
<li><a href="#org4fe7fd5">3.40.2. Answer</a></li>
</ul>
</li>
<li><a href="#org02a9abf">3.41. Exercise 2.36: Accumulate across multiple lists</a>
<ul>
<li><a href="#org6ef867b">3.41.1. Question</a></li>
<li><a href="#org12b5111">3.41.2. Answers</a></li>
</ul>
</li>
<li><a href="#org12dab51">3.42. Exercise 2.37: Enter the matrices</a>
<ul>
<li><a href="#org48a210f">3.42.1. Question</a></li>
<li><a href="#org45623c2">3.42.2. Answer</a></li>
</ul>
</li>
<li><a href="#org3b0b02a">3.43. Exercise 2.38: fold-right</a>
<ul>
<li><a href="#org8bbee10">3.43.1. Question A</a></li>
<li><a href="#orgca83920">3.43.2. Answer A</a></li>
<li><a href="#org2d96b6c">3.43.3. Question B</a></li>
<li><a href="#org3a0c56c">3.43.4. Answer B</a></li>
</ul>
</li>
<li><a href="#orgaf88c9d">3.44. Exercise 2.39: reverse via fold</a>
<ul>
<li><a href="#org187d285">3.44.1. Question</a></li>
<li><a href="#org66447d0">3.44.2. Answer</a></li>
</ul>
</li>
<li><a href="#org20d4702">3.45. Exercise 2.40: <code>unique-pairs</code></a>
<ul>
<li><a href="#orgdd7ac51">3.45.1. Text Definitions</a></li>
<li><a href="#org28bc434">3.45.2. Question</a></li>
<li><a href="#org558c06c">3.45.3. Answer</a></li>
</ul>
</li>
<li><a href="#orga77493d">3.46. Exercise 2.41: Ordered triples of positive integers</a>
<ul>
<li><a href="#org55f5300">3.46.1. Question</a></li>
<li><a href="#orgab10ea8">3.46.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgafea743">3.47. Exercise 2.42: Eight Queens</a>
<ul>
<li><a href="#org5a6e333">3.47.1. Question</a></li>
<li><a href="#org67c6c97">3.47.2. Answer</a></li>
</ul>
</li>
<li><a href="#org484983f">3.48. Exercise 2.43: Louis&rsquo; <code>queens</code></a>
<ul>
<li><a href="#org153be81">3.48.1. Question</a></li>
<li><a href="#org7e9f6f3">3.48.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgd2ab5b8">3.49. 2.2.4: Example: A Picture Language</a></li>
<li><a href="#orgaff5912">3.50. Exercise 2.44: <code>up-split</code></a>
<ul>
<li><a href="#org4317e3d">3.50.1. Text Definitions</a></li>
<li><a href="#org9f2d57c">3.50.2. Question</a></li>
<li><a href="#orgf3644e3">3.50.3. Answer</a></li>
</ul>
</li>
<li><a href="#org9e916b8">3.51. Exercise 2.45: Generalized splitting</a>
<ul>
<li><a href="#org7aaf539">3.51.1. Question</a></li>
<li><a href="#orge13d7c5">3.51.2. Answer</a></li>
</ul>
</li>
<li><a href="#org7e8fac1">3.52. Exercise 2.46: Defining vectors</a>
<ul>
<li><a href="#orgd574a32">3.52.1. Question</a></li>
<li><a href="#org97ebb04">3.52.2. Answer</a></li>
</ul>
</li>
<li><a href="#org452080f">3.53. Exercise 2.47: Defining frames</a>
<ul>
<li><a href="#orgd80c4da">3.53.1. Question</a></li>
<li><a href="#org392cf7f">3.53.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgeaae0b9">3.54. Exercise 2.48: Line segments</a>
<ul>
<li><a href="#org0cc5103">3.54.1. Question</a></li>
<li><a href="#org9b07170">3.54.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgf012add">3.55. Exercise 2.49: Primitive painters</a>
<ul>
<li><a href="#orgd969175">3.55.1. Text Definitions</a></li>
<li><a href="#org8129f07">3.55.2. Question</a></li>
<li><a href="#org5d1aee0">3.55.3. Answer</a></li>
</ul>
</li>
<li><a href="#orgd48b2a3">3.56. Exercise 2.50: Transforming painters</a>
<ul>
<li><a href="#org7536a23">3.56.1. Text Definitions</a></li>
<li><a href="#orgc280a2c">3.56.2. Question</a></li>
<li><a href="#org3f5969b">3.56.3. Answer</a></li>
</ul>
</li>
<li><a href="#org0b9e9d7">3.57. Exercise 2.51</a>
<ul>
<li><a href="#orga97a40d">3.57.1. Question</a></li>
<li><a href="#orgaa0e96e">3.57.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgc6da3f2">3.58. 2.2.4 continued</a></li>
<li><a href="#org194d56c">3.59. Exercise 2.52</a>
<ul>
<li><a href="#org0ac277b">3.59.1. Question A</a></li>
<li><a href="#orgf25157e">3.59.2. Answer A</a></li>
<li><a href="#orgfee2890">3.59.3. Question B</a></li>
<li><a href="#org887b8b9">3.59.4. Question C</a></li>
<li><a href="#org270f296">3.59.5. Textbook Definitions</a></li>
<li><a href="#org28058fc">3.59.6. Answer C</a></li>
</ul>
</li>
<li><a href="#orgbf2be52">3.60. 2.3.1: Quotation</a></li>
<li><a href="#org06b4cef">3.61. Exercise 2.53</a>
<ul>
<li><a href="#orgdd5c8e3">3.61.1. Question</a></li>
<li><a href="#org4c80e05">3.61.2. Answer</a></li>
</ul>
</li>
<li><a href="#org0384e6e">3.62. Exercise 2.54</a>
<ul>
<li><a href="#org00b0978">3.62.1. Answer</a></li>
</ul>
</li>
<li><a href="#org406b915">3.63. Exercise 2.55</a>
<ul>
<li><a href="#orgedb50be">3.63.1. Question</a></li>
<li><a href="#org87deecc">3.63.2. Answer</a></li>
</ul>
</li>
<li><a href="#org39d83e7">3.64. 2.3.2: Example: Symbolic differentiator</a></li>
<li><a href="#org793b4e3">3.65. Exercise 2.56: Differentiating exponentiation</a>
<ul>
<li><a href="#org49087a2">3.65.1. Text definitions</a></li>
<li><a href="#org079876a">3.65.2. Question</a></li>
<li><a href="#orgabb2209">3.65.3. Answer</a></li>
</ul>
</li>
<li><a href="#orga5745f1">3.66. Exercise 2.57: Differentiating arbitrary-length expressions</a>
<ul>
<li><a href="#org5834099">3.66.1. Question</a></li>
<li><a href="#org76b6db4">3.66.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgfea6ad2">3.67. Exercise 2.58: Processing expressions with infix notation</a>
<ul>
<li><a href="#org1435f14">3.67.1. Question</a></li>
<li><a href="#org0536a8f">3.67.2. Part 1</a></li>
<li><a href="#orga1b3300">3.67.3. Answer 1</a></li>
<li><a href="#org51cdf37">3.67.4. Part 2</a></li>
<li><a href="#org8af7435">3.67.5. Answer 2</a></li>
</ul>
</li>
<li><a href="#org3c4ae4b">3.68. Exercise 2.59: Representing sets</a>
<ul>
<li><a href="#org64d988e">3.68.1. Text definitions</a></li>
<li><a href="#org24f42c8">3.68.2. Question</a></li>
<li><a href="#org2780aff">3.68.3. Answer</a></li>
</ul>
</li>
<li><a href="#org3972c2a">3.69. Exercise 2.59: Sets with duplicates</a>
<ul>
<li><a href="#org02c2c8e">3.69.1. Question</a></li>
<li><a href="#orgf14e285">3.69.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgf469ab8">3.70. Exercise 2.61: Ordered sets</a>
<ul>
<li><a href="#org5c48a78">3.70.1. Question</a></li>
<li><a href="#org2900f90">3.70.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgb42eb5f">3.71. Exercise 2.62: <code>union-set</code> ordered</a>
<ul>
<li><a href="#orgd76d13a">3.71.1. Question</a></li>
<li><a href="#orgb7ee896">3.71.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgc782fc7">3.72. Exercise 2.63: binary trees</a>
<ul>
<li><a href="#org00436e2">3.72.1. Text definitions</a></li>
<li><a href="#org4916d1e">3.72.2. Question A</a></li>
<li><a href="#org38c0be4">3.72.3. Answer A</a></li>
<li><a href="#orgb622cfb">3.72.4. Question B</a></li>
<li><a href="#orge364bf9">3.72.5. Answer B</a></li>
</ul>
</li>
<li><a href="#org39999d8">3.73. Exercise 2.64: Making a balanced binary tree</a>
<ul>
<li><a href="#org1a7d45b">3.73.1. Question A</a></li>
<li><a href="#orgcd6d942">3.73.2. Answer A</a></li>
<li><a href="#org974dac7">3.73.3. Question B</a></li>
<li><a href="#org505c5d4">3.73.4. Answer B</a></li>
</ul>
</li>
<li><a href="#org74e5b4e">3.74. Exercise 2.65: Sets as binary trees</a>
<ul>
<li><a href="#org6e8166b">3.74.1. Textbook Definitions</a></li>
<li><a href="#orgf81863f">3.74.2. Question</a></li>
<li><a href="#org9272135">3.74.3. Answer</a></li>
</ul>
</li>
<li><a href="#org0558a3d">3.75. Exercise 2.66: binary tree <code>lookup</code></a>
<ul>
<li><a href="#org5705fcb">3.75.1. Question</a></li>
<li><a href="#orgfaea506">3.75.2. Answer</a></li>
</ul>
</li>
<li><a href="#org8ed18d3">3.76. Exercise 2.67: decoding Huffman tree messages</a>
<ul>
<li><a href="#org0e53b04">3.76.1. Text definitions</a></li>
<li><a href="#orgf3c4ec8">3.76.2. Question</a></li>
<li><a href="#org6c77772">3.76.3. Answer</a></li>
</ul>
</li>
<li><a href="#org5b28c20">3.77. Exercise 2.68: encoding Huffman tree messages</a>
<ul>
<li><a href="#orgee20f31">3.77.1. Question</a></li>
<li><a href="#org599fd1e">3.77.2. Answer</a></li>
</ul>
</li>
<li><a href="#org36d6254">3.78. Exercise 2.69: Generating Huffman trees</a>
<ul>
<li><a href="#orgb948896">3.78.1. Question</a></li>
<li><a href="#orgd3c0078">3.78.2. Answer</a></li>
</ul>
</li>
<li><a href="#org6b19201">3.79. Exercise 2.70: encoding 1950s rock songs</a>
<ul>
<li><a href="#org0f8c057">3.79.1. Question</a></li>
<li><a href="#org06c2875">3.79.2. Answer</a></li>
</ul>
</li>
<li><a href="#org496dad8">3.80. Exercise 2.71</a>
<ul>
<li><a href="#orgcea1061">3.80.1. Questions</a></li>
<li><a href="#orgf5744bd">3.80.2. Answers</a></li>
</ul>
</li>
<li><a href="#org687b5e1">3.81. Exercise 2.72: order of growth of <code>encode</code></a></li>
<li><a href="#orgf2c6518">3.82. 2.4: Multiple Representations for Abstract Data</a></li>
<li><a href="#orge735143">3.83. Exercise 2.73: Data-driven symbolic differentiator</a>
<ul>
<li><a href="#org3ddd59c">3.83.1. Question A</a></li>
<li><a href="#orgf2aa731">3.83.2. Answer A</a></li>
<li><a href="#orgd487c2b">3.83.3. Questions B and C</a></li>
<li><a href="#org2a70602">3.83.4. Answer B &amp; C version 1</a></li>
<li><a href="#org5405a0d">3.83.5. Answer B &amp; C version 2</a></li>
<li><a href="#org98c6437">3.83.6. Question D</a></li>
<li><a href="#org37272dc">3.83.7. Answer D</a></li>
</ul>
</li>
<li><a href="#org351a867">3.84. Exercise 2.74: Multi-division record storage</a>
<ul>
<li><a href="#org30b353d">3.84.1. Questions ABC</a></li>
<li><a href="#org066b786">3.84.2. Answers ABC</a></li>
<li><a href="#org03bd82d">3.84.3. Question D</a></li>
<li><a href="#org6935664">3.84.4. Answer D</a></li>
</ul>
</li>
<li><a href="#orgd8f23ef">3.85. 2.4.3: Data-directed and message-passing programs</a></li>
<li><a href="#org33e8165">3.86. Exercise 2.75: Message-passing styled imaginary numbers</a>
<ul>
<li><a href="#org6ccaffe">3.86.1. Question</a></li>
<li><a href="#org94df1e6">3.86.2. Answer</a></li>
</ul>
</li>
<li><a href="#org5eee372">3.87. Exercise 2.76: comparing generic operation solutions</a>
<ul>
<li><a href="#org48e6016">3.87.1. Question</a></li>
<li><a href="#org5ff264e">3.87.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgd6e126b">3.88. Exercise 2.77: generic arithmetic package</a>
<ul>
<li><a href="#orgdadea66">3.88.1. Question</a></li>
<li><a href="#org37f7c65">3.88.2. Answer</a></li>
</ul>
</li>
<li><a href="#orga9f2204">3.89. Exercise 2.78: native scheme numbers</a>
<ul>
<li><a href="#org6c4abc6">3.89.1. Question</a></li>
<li><a href="#org85c4f34">3.89.2. Answer</a></li>
</ul>
</li>
<li><a href="#org5a82483">3.90. Exercise 2.79: generic equality</a>
<ul>
<li><a href="#org46a5f64">3.90.1. Question</a></li>
<li><a href="#org2e78b8f">3.90.2. Answer</a></li>
</ul>
</li>
<li><a href="#org56b3232">3.91. Exercise 2.80: Generic testing for zero</a>
<ul>
<li><a href="#org2fc4a17">3.91.1. Question</a></li>
<li><a href="#org3549b5e">3.91.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgfe088ce">3.92. 2.4.3: Combining Data of Different Types</a></li>
<li><a href="#org8c9afc4">3.93. Exercise 2.81: Louis&rsquo; <code>apply-generic</code></a>
<ul>
<li><a href="#org1c2e37b">3.93.1. Question A</a></li>
<li><a href="#org99d8670">3.93.2. Answer A</a></li>
<li><a href="#org8a93c0f">3.93.3. Question B</a></li>
<li><a href="#org37fdfc1">3.93.4. Answer B</a></li>
<li><a href="#org00940bd">3.93.5. Question C</a></li>
<li><a href="#org46350cf">3.93.6. Answer C</a></li>
</ul>
</li>
<li><a href="#orgbeda1a4">3.94. Exercise 2.82: <code>apply-generic</code> with multiple coerced arguments</a>
<ul>
<li><a href="#org21665c5">3.94.1. Question</a></li>
<li><a href="#org62d6ad8">3.94.2. Answer</a></li>
<li><a href="#org612b504">3.94.3. Answer with vararg support</a></li>
</ul>
</li>
<li><a href="#org3f616d2">3.95. Exercise 2.83: <code>raise</code></a>
<ul>
<li><a href="#org9486f56">3.95.1. Question</a></li>
<li><a href="#orgbe41b31">3.95.2. Answer</a></li>
</ul>
</li>
<li><a href="#orge34f8d4">3.96. Exercise 2.84: <code>append-generic</code> with <code>raise</code></a>
<ul>
<li><a href="#orge5b53cd">3.96.1. Question</a></li>
<li><a href="#org4d41a68">3.96.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgeebf7d1">3.97. Exercise 2.85: <code>append-generic</code> with <code>drop</code></a>
<ul>
<li><a href="#orgbdf9371">3.97.1. Question</a></li>
<li><a href="#orgcad04b4">3.97.2. Answer</a></li>
</ul>
</li>
<li><a href="#org736aa95">3.98. Exercise 2.86: complex numbers with flexible types</a>
<ul>
<li><a href="#org59b1f12">3.98.1. Question</a></li>
<li><a href="#org55d9ce7">3.98.2. Answer</a></li>
</ul>
</li>
<li><a href="#org8f41b95">3.99. 2.5: Symbolic Algebra</a></li>
<li><a href="#org8a2819d">3.100. Exercise 2.87: <code>=zero?</code> for polynomials</a>
<ul>
<li><a href="#org6fd40af">3.100.1. Question</a></li>
<li><a href="#orgc3fff19">3.100.2. Answer</a></li>
</ul>
</li>
<li><a href="#org60fae57">3.101. Exercise 2.88: negation, subtracting polynomials</a>
<ul>
<li><a href="#org663fc42">3.101.1. Question</a></li>
<li><a href="#org533fb32">3.101.2. Answer</a></li>
</ul>
</li>
<li><a href="#org71e0abc">3.102. Exercise 2.89: an abstraction for dense polynomials</a>
<ul>
<li><a href="#org4bf09b0">3.102.1. Question</a></li>
<li><a href="#org0a6cb5d">3.102.2. Answer</a></li>
</ul>
</li>
<li><a href="#org518d3c5">3.103. Exercise 2.90: dense polynomials integrated into the system</a>
<ul>
<li><a href="#orgb713cdd">3.103.1. Question</a></li>
<li><a href="#orgad919a8">3.103.2. Answer</a></li>
</ul>
</li>
<li><a href="#orge16d28a">3.104. Exercise 2.91: division of polynomials</a>
<ul>
<li><a href="#orgb7bcddd">3.104.1. Question</a></li>
<li><a href="#org5196497">3.104.2. Answer</a></li>
</ul>
</li>
<li><a href="#org1306cf6">3.105. Exercise 2.92: operating on polys in different variables</a>
<ul>
<li><a href="#orgf3f5af5">3.105.1. Question</a></li>
<li><a href="#orgcbb35bd">3.105.2. Answer</a></li>
</ul>
</li>
<li><a href="#org767df2f">3.106. Exercise 2.93: extending <code>make-rational</code> for rational functions</a>
<ul>
<li><a href="#org21214c9">3.106.1. Question</a></li>
<li><a href="#orgedde683">3.106.2. Answer</a></li>
</ul>
</li>
<li><a href="#orge0aaf77">3.107. Exercise 2.94: GCD of polynomials</a>
<ul>
<li><a href="#orga277635">3.107.1. Question</a></li>
<li><a href="#org86cbaa3">3.107.2. Answer</a></li>
</ul>
</li>
<li><a href="#org2a7b64a">3.108. Exercise 2.95: a quirk in rational functions</a>
<ul>
<li><a href="#org44d444f">3.108.1. Question</a></li>
<li><a href="#org19304b2">3.108.2. Answer</a></li>
</ul>
</li>
<li><a href="#orgef2d5f5">3.109. Exercise 2.96: pseudodivision of polynomials</a>
<ul>
<li><a href="#orgf848407">3.109.1. Text formulas</a></li>
<li><a href="#orgbfb6312">3.109.2. Questions 1 and 2</a></li>
<li><a href="#orgb5e0c2d">3.109.3. Answers 1 and 2</a></li>
</ul>
</li>
<li><a href="#org661381b">3.110. Exercise 2.97: reducing terms of rational functions</a>
<ul>
<li><a href="#orga9ff61a">3.110.1. Questions 1 and 2</a></li>
<li><a href="#org2c2897b">3.110.2. Answers 1 and 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org45054f9" class="outline-2">
<h2 id="org45054f9"><span class="section-number-2">1.</span> Introduction Notes</h2>
<div class="outline-text-2" id="text-1">
</div>

<div id="outline-container-org2349180" class="outline-3">
<h3 id="org2349180"><span class="section-number-3">1.1.</span> Text Foreword</h3>
<div class="outline-text-3" id="text-1-1">
<p>
This book centers on three areas: the human mind, collections of computer
programs, and the computer.
</p>

<p>
Every program is a model of a real or mental process, and these processes are at
any time only partially understood. We change these programs as our
understandings of these processes evolve.
</p>

<p>
Ensuring the correctness of programs becomes a Herculean task as complexity
grows. Because of this, it&rsquo;s important to make fundamentals that can be relied
upon to support larger structures.
</p>
</div>
</div>

<div id="outline-container-org23767d9" class="outline-3">
<h3 id="org23767d9"><span class="section-number-3">1.2.</span> Preface, 1e</h3>
<div class="outline-text-3" id="text-1-2">
<p>
&ldquo;Computer Science&rdquo; isn&rsquo;t really about computers or science, in the same way that
geometry isn&rsquo;t really about measuring the earth (&rsquo;geometry&rsquo; translates to
&rsquo;measurement of earth&rsquo;).
</p>

<p>
Programming is a medium for expressing ideas about methodology. For this reason,
programs should be written first for people to read, and second for machines to
execute.
</p>

<p>
The essential material for introductory programming is how to control complexity
when building programs.
</p>

<p>
Computer Science is about imperative knowledge, as opposed to declarative. This
can be called <i>procedural epistemology</i>.
</p>

<dl class="org-dl">
<dt><b>Declarative knowledge</b></dt><dd><i>what is true</i>. For example: \(\sqrt{x}\) is the
\(y\) such that \(y^2 = x\) and \(y \geq 0\)</dd>

<dt><b>Imperative knowledge</b></dt><dd><i>How to follow a process</i>. For example: to find an
approximation to \(\sqrt{x}\), make a guess \(G\), improve the guess by
averaging \(G\) and \(x/G\), keep improving until the guess is good enough.</dd>
</dl>
</div>

<ol class="org-ol">
<li><a id="orgfc00348"></a>Techniques for controlling complexity<br />
<div class="outline-text-5" id="text-1-2-0-1">
<dl class="org-dl">
<dt>Black-box abstraction</dt><dd><p>
Encapsulating an operation so the details of it are
irrelevant.
</p>

<p>
The fixed point of a function \(f()\) is a value \(y\) such that \(f(y) = y\).
Method for finding a fixed point: start with a guess for \(y\) and keep applying
\(f(y)\) over and over until the result doesn&rsquo;t change very much.
</p>

<p>
Define a box of the method for finding the fixed point of \(f()\).
</p>

<p>
One way to find \(\sqrt{x}\) is to take our function for approaching a square
root <code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>guess target<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>average guess <span style="color: #99bb66;">(</span>divide target guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>, applying
that to our method for finding a fixed point, and this creates a <b>procedure</b> to
find a square root.
</p>

<p>
Black-box abstraction
</p>
<ol class="org-ol">
<li>Start with primitive objects of procedures and data.</li>
<li>Combination: combine procedures with <i>composition</i>, combine data with
<i>construction</i> of compound data.</li>
<li>Abstraction: defining procedures and abstracting data. Capture common
patterns by making high-order procedures composed of other procedures. Use
data as procedures.</li>
</ol></dd>

<dt>Conventional interfaces</dt><dd>Agreed-upon ways of connecting things together.

<ul class="org-ul">
<li>How do you make operations generalized?</li>
<li>How do you make large-scale structure and modularity?
<dl class="org-dl">
<dt>Object-oriented programming</dt><dd>thinking of your structure as a society of
discrete but interacting parts.</dd>
<dt>Operations on aggregates</dt><dd>thinking of your structure as operating on a
stream, comparable to signal processing. <i>(Needs clarification.)</i></dd>
</dl></li>
</ul></dd>

<dt>Metalinguistic abstractions</dt><dd>Making new languages. This changes the way you
interact with the system by letting you emphasize some parts and deemphasize
other parts.</dd>
</dl>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org3f78e6a" class="outline-2">
<h2 id="org3f78e6a"><span class="section-number-2">2.</span> Chapter 1: Building Abstractions with Procedures</h2>
<div class="outline-text-2" id="text-2">
<p>
<b>Computational processes</b> are abstract &rsquo;beings&rsquo; that inhabit computers. Their
evolution is directed by a pattern of rules called a <b>program</b>, and processes
manipulate other abstract things called <b>data</b>.
</p>

<p>
Master software engineers are able to organize programs so they can be
reasonably sure the resulting process performs the task intended, without
catastrophic consequences, and that any problems can be debugged.
</p>

<p>
Lisp&rsquo;s users have traditionally resisted attempts to select an &ldquo;official&rdquo;
version of the language, which has enabled Lisp to continually evolve.
</p>

<p>
There are powerful program-design techniques which rely on the ability to blur
the distinction between data and processes. Lisp enables these techniques by
allowing processes to be represented and manipulated as data.
</p>
</div>

<div id="outline-container-org24e147c" class="outline-3">
<h3 id="org24e147c"><span class="section-number-3">2.1.</span> 1.1: The Elements of Programming</h3>
<div class="outline-text-3" id="text-2-1">
<p>
A programming language isn&rsquo;t just a way to instruct a computer &#x2013; it&rsquo;s also a
framework for the programmer to organize their ideas. Thus it&rsquo;s important to
consider the means the language provides for combining ideas. Every powerful
language has three mechanisms for this:
</p>

<dl class="org-dl">
<dt><b>primitive expressions</b></dt><dd>the simplest entities the language is concerned with</dd>
<dt><b>means of combination</b></dt><dd>how compound elements can be built from simpler ones</dd>
<dt><b>means of abstraction</b></dt><dd>how which compound elements can be named and
manipulated as units</dd>
</dl>

<p>
In programming, we deal with <b>data</b> which is what we want to manipulate, and
<b>procedures</b> which are descriptions of the rules for manipulating the data.
</p>

<p>
A procedure has <b>formal parameters</b>. When the procedure is applied, the formal
parameters are replaced by the <b>arguments</b> it is being applied to. For example,
take the following code:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org7fced12"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>* x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span style="color: #51afef;">(</span>square <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code class="src src-scheme">x</code> is the formal parameter and  <code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">5</span></code> is the argument.
</p>
</div>
</div>

<div id="outline-container-org8040209" class="outline-3">
<h3 id="org8040209"><span class="section-number-3">2.2.</span> 1.1.1: Expressions</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The general form of Lisp is evaluating <b>combinations</b>, denoted by parenthesis,
in the form <code class="src src-scheme"><span style="color: #51afef;">(</span>operator operands<span style="color: #51afef;">)</span></code>, where <i>operator</i> is a procedure and
<i>operands</i> are the 0 or more arguments to the operator.
</p>

<p>
Lisp uses <b>prefix notation</b>, which is not customary mathematical notation, but
provides several advantages.
</p>
<ol class="org-ol">
<li>It supports procedures that take arbitrary numbers of arguments,
i.e. <code class="src src-scheme"><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span></code>.</li>
<li>It&rsquo;s straightforward to nest combinations in other combinations.</li>
</ol>
</div>
</div>

<div id="outline-container-orge69ca42" class="outline-3">
<h3 id="orge69ca42"><span class="section-number-3">2.3.</span> 1.1.3: Evaluating Combinations</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The evaluator can evaluate nested expressions recursively. <b>Tree accumulation</b>
is the process of evaluating nested combinations, &ldquo;percolating&rdquo; values upward.
</p>

<p>
The recursive evaluation of <code class="src src-scheme"><span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code> breaks down
into four parts:
</p>


<div id="orgf0f0b9a" class="figure">
<p><img src="1/fig/t_1-1-3.png" alt="t_1-1-3.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org5c2bbd7" class="outline-3">
<h3 id="org5c2bbd7"><span class="section-number-3">2.4.</span> 1.1.4: Compound Procedures</h3>
<div class="outline-text-3" id="text-2-4">
<p>
We have identified the following in Lisp:
</p>
<ul class="org-ul">
<li>primitive data are numbers, primitive procedures are arithmetic operations</li>
<li>Operations can be combined by nesting combinations</li>
<li>Data and procedures can be abstracted by variable &amp; procedure definitions</li>
</ul>

<p>
Procedure definitions give a name to a compound procedure.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">to square something, multiply it by itself</span>
<span style="color: #525252;">; </span><span style="color: #525252;">now it can be applied or used in other definitions:</span>
<span style="color: #51afef;">(</span>square <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">=&gt; 16</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum-of-squares</span> x y<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>square x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>square y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>sum-of-squares <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">=&gt; 25</span>
</pre>
</div>

<p>
Note how these compound procedures are used in the same way as primitive
procedures.
</p>
</div>
</div>

<div id="outline-container-org0a8536b" class="outline-3">
<h3 id="org0a8536b"><span class="section-number-3">2.5.</span> 1.1.5: The Substitution Model for Procedure Application</h3>
<div class="outline-text-3" id="text-2-5">
<p>
To understand how the interpreter works, imagine it substituting the procedure
calls with the bodies of the procedure and its arguments.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>square <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>square <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">has the same results as</span>
<span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This way of understanding procedure application is called the <b>substitution
model</b>. This model is to help you understand procedure substitution, and is
usually not how the interpreter actually works. This book will progress through
more intricate models of interpreters as it goes. This is the natural
progression when learning scientific phenomena, starting with a simple model,
and replace it with more refined models as the phenomena is examined in more
detail.
</p>

<p>
Evaluations can be done in different orders.
</p>

<dl class="org-dl">
<dt><b>Applicative order</b></dt><dd>evaluates the operator and operands, and then applies the</dd>
</dl>
<p>
resulting procedure to the resulting arguments. In other words, reducing, then
expanding, then reducing.
</p>

<dl class="org-dl">
<dt><b>Normal order</b></dt><dd>substitutes expressions until it obtains an expression involving</dd>
</dl>
<p>
only primitive operators, or until it can&rsquo;t substitute any further, and then
evaluates. This results in expanding the expression completely before doing any
reduction, which results in some repeated evaluations.
</p>

<p>
For all procedure applications that can be modeled using substitution,
applicative and normal order evaluation produce the same result. Normal order
becomes more complicated once dealing with procedures that can&rsquo;t be modeled by
substitution.
</p>

<p>
Lisp uses applicative order evaluation because it helps avoid repeated work and
other complications. But normal has its own advantages which will be explored in
Chapter 3 and 4.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #525252;">; </span><span style="color: #525252;">Applicative evaluation</span>
<span style="color: #51afef;">(</span>f <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>sum-of-squares <span style="color: #c678dd;">(</span>+ a <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>sum-of-squares <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>sum-of-squares <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>square x<span style="color: #c678dd;">)(</span>square y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>square <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)(</span>square <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)(</span>* <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">36</span> <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
<span style="color: #dd8844; font-weight: bold;">136</span>
<span style="color: #525252;">; </span><span style="color: #525252;">Normal evaluation</span>
<span style="color: #51afef;">(</span>f <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>sum-of-squares <span style="color: #c678dd;">(</span>+ a <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>sum-of-squares <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>square <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>square <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">36</span> <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
<span style="color: #dd8844; font-weight: bold;">136</span>
</pre>
</div>

<p>
(Extra-curricular clarification: Normal order delays evaluating arguments until
they&rsquo;re needed by a procedure, which is called lazy evaluation.)
</p>
</div>
</div>

<div id="outline-container-org25ab50f" class="outline-3">
<h3 id="org25ab50f"><span class="section-number-3">2.6.</span> 1.1.6: Conditional Expressions and Predicates</h3>
<div class="outline-text-3" id="text-2-6">
<p>
An important aspect of programming is testing and branching depending on the
results of the test. <code>cond</code> tests <b>predicates</b>, and upon encountering one,
returns a <b>consequent</b>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
     <span style="color: #c678dd;">(</span>predicate1 consequent1<span style="color: #c678dd;">)</span>
     ...
     <span style="color: #c678dd;">(</span>predicateN consequentN<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
A shorter form of conditional:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> predicate consequent alternative<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
If <code class="src src-scheme">predicate</code> is true, <code class="src src-scheme">consequent</code> is returned. Else,
<code class="src src-scheme">alternative</code> is returned.
</p>

<p>
Combining predicates:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> expression1 ... expressionN<span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">if encounters false, stop eval and returns false.</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> expression1 ... expressionN<span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">if encounters true, stop eval and return true. Else false.</span>
<span style="color: #51afef;">(</span>not expression<span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">true is expression is false, false if expression is true.</span>
</pre>
</div>

<p>
A small clarification:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">A</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">D</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
A <span style="color: #525252;">; </span><span style="color: #525252;">=&gt; 25</span>
D <span style="color: #525252;">; </span><span style="color: #525252;">=&gt; compound procedure D</span>
<span style="color: #51afef;">(</span>D<span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">=&gt; 25 (result of executing procedure D)</span>
</pre>
</div>

<p>
Special forms bring more nuances into the substitution model mentioned
previously. For example, when evaluating an <code class="src src-scheme">if</code> expression, you
evaluate the predicate and, depending on the result, either evaluate the
<b>consequent</b> or the <b>alternative</b>. If you were evaluating in a standard manner,
the consequent and alternative would both be evaluated, rendering the
<code class="src src-scheme">if</code> expression ineffective.
</p>
</div>
</div>

<div id="outline-container-org21da2f2" class="outline-3">
<h3 id="org21da2f2"><span class="section-number-3">2.7.</span> Exercise 1.1: Trying expressions</h3>
<div class="outline-text-3" id="text-2-7">
</div>

<div id="outline-container-org962b3a3" class="outline-4">
<h4 id="org962b3a3"><span class="section-number-4">2.7.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
Below is a sequence of expressions. What is the result printed by the
interpreter in response to each expression? Assume that the sequence is to be
evaluated in the order in which it is presented.
</p>
</div>
</div>


<div id="outline-container-orgb45a807" class="outline-4">
<h4 id="orgb45a807"><span class="section-number-4">2.7.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-7-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #525252;">;; </span><span style="color: #525252;">10</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">12</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>- <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">8</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">3</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>- <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">6</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">a</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">a=3</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">b</span> <span style="color: #c678dd;">(</span>+ a <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">b=4</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>+ a b <span style="color: #c678dd;">(</span>* a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">19</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>= a b<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">false</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>&gt; b a<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>&lt; b <span style="color: #a9a1e1;">(</span>* a b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>    b
<span class="linenr">12: </span>    a<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">4</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>= a <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>      <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>= b <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>      <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">16</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&gt; b a<span style="color: #99bb66;">)</span> b a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">6</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; a b<span style="color: #a9a1e1;">)</span> a<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>         <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; a b<span style="color: #a9a1e1;">)</span> b<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>         <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>   <span style="color: #c678dd;">(</span>+ a <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">16</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2184bf0" class="outline-3">
<h3 id="org2184bf0"><span class="section-number-3">2.8.</span> Exercise 1.2: Prefix form</h3>
<div class="outline-text-3" id="text-2-8">
</div>

<div id="outline-container-org4e82c70" class="outline-4">
<h4 id="org4e82c70"><span class="section-number-4">2.8.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-8-1">
<p>
Translate the following expression into prefix form:
\[
  \frac{5 + 2 + (2 - 3 - (6 + \frac{4}{5})))}
            {3(6 - 2)(2 - 7)}
\]
</p>
</div>
</div>


<div id="outline-container-org1a1a941" class="outline-4">
<h4 id="org1a1a941"><span class="section-number-4">2.8.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-8-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orga57a225"><span class="linenr">1: </span><span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>- <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #a9a1e1;">(</span>+ <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>   <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #99bb66;">(</span>- <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>- <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org8c42316">
1/75
</pre>
</div>
</div>
</div>

<div id="outline-container-org14ca440" class="outline-3">
<h3 id="org14ca440"><span class="section-number-3">2.9.</span> Exercise 1.3: Conditionals</h3>
<div class="outline-text-3" id="text-2-9">
</div>

<div id="outline-container-org68ee0e3" class="outline-4">
<h4 id="org68ee0e3"><span class="section-number-4">2.9.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-9-1">
<p>
Define a procedure that takes three numbers as arguments and
returns the sum of the squares of the two larger numbers.
</p>
</div>
</div>

<div id="outline-container-org71f6a3d" class="outline-4">
<h4 id="org71f6a3d"><span class="section-number-4">2.9.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-9-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgb4ba70a"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum-square</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>square x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>square y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-2of3</span> a b c<span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>&gt;= a b<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>&gt;= b c<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>sum-square a b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">6: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>&gt;= a b<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>&gt; c b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>sum-square a c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>sum-square b c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;EX1-3&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span> <span style="color: #51afef;">(</span>try-these square-2of3 '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>                        '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>                        '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">(7 5 3)</td>
<td class="org-right">74</td>
</tr>

<tr>
<td class="org-left">(7 3 5)</td>
<td class="org-right">74</td>
</tr>

<tr>
<td class="org-left">(3 5 7)</td>
<td class="org-right">74</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org8567449" class="outline-3">
<h3 id="org8567449"><span class="section-number-3">2.10.</span> Exercise 1.4: Compound expressions</h3>
<div class="outline-text-3" id="text-2-10">
</div>

<div id="outline-container-org75e839b" class="outline-4">
<h4 id="org75e839b"><span class="section-number-4">2.10.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-10-1">
<p>
Observe that our model of evaluation allows for combinations whose operators are
compound expressions. Use this observation to describe the behavior of the
following procedure:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org0bc6a4a"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">a-plus-abs-b</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; b <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> + -<span style="color: #99bb66;">)</span> a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8065906" class="outline-4">
<h4 id="org8065906"><span class="section-number-4">2.10.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-10-2">
<p>
This code accepts the variables <code class="src src-scheme">a</code> and <code class="src src-scheme">b</code>, and if
<code class="src src-scheme">b</code> is positive, it adds <code class="src src-scheme">a</code> and <code class="src src-scheme">b</code>. However, if
<code class="src src-scheme">b</code> is zero or negative, it subtracts them. This decision is made by
using the <code class="src src-scheme">+</code> and <code class="src src-scheme">-</code> procedures as the results of an if
expression, and then evaluating according to the results of that expression.
This is in contrast to a language like Python, which would do something like
this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">if</span> b &gt; <span style="color: #dd8844; font-weight: bold;">0</span>: a + b
<span style="color: #51afef;">else</span>: a - b
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org69bc97e" class="outline-3">
<h3 id="org69bc97e"><span class="section-number-3">2.11.</span> Exercise 1.5: Applicative vs normal-order evaluation</h3>
<div class="outline-text-3" id="text-2-11">
</div>

<div id="outline-container-org3adc1cf" class="outline-4">
<h4 id="org3adc1cf"><span class="section-number-4">2.11.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-11-1">
<p>
Ben Bitdiddle has invented a test to determine whether the interpreter he is
faced with is using applicative-order evaluation or normal-order evaluation. He
defines the following two procedures:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">p</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">test</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>      <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">6: </span>      y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Then he evaluates the expression:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>test <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span>p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
What behavior will Ben observe with an interpreter that uses applicative-order
evaluation?  What behavior will he observe with an interpreter that uses
normal-order evaluation?  Explain your answer.  (Assume that the evaluation
rule for the special form <code class="src src-scheme">if</code> is the same whether the interpreter is
using normal or applicative order: The predicate expression is evaluated first,
and the result determines whether to evaluate the consequent or the alternative
expression.)
</p>
</div>
</div>

<div id="outline-container-orgb9b2b1e" class="outline-4">
<h4 id="orgb9b2b1e"><span class="section-number-4">2.11.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-11-2">
<p>
In either type of language, <code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">p</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code> is an infinite loop.
However, a normal-order language will encounter the special form, return
<code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">0</span></code>, and never evaluate <code class="src src-scheme"><span style="color: #51afef;">(</span>p<span style="color: #51afef;">)</span></code>. An applicative-order language
evaluates the arguments to <code class="src src-scheme"><span style="color: #51afef;">(</span>test <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span>p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>, thus triggering the
infinite loop.
</p>
</div>
</div>
</div>

<div id="outline-container-org90821bd" class="outline-3">
<h3 id="org90821bd"><span class="section-number-3">2.12.</span> 1.1.7: Example: Square Roots by Newton&rsquo;s Method</h3>
<div class="outline-text-3" id="text-2-12">
<p>
Functions in the formal mathematical sense are <b>declarative knowledge</b>, while
procedures like in computer science are <b>imperative knowledge</b>.
</p>

<p>
Notice that the elements of the language that have been introduced so far are
sufficient for writing any purely numerical program, despite not having
introduced any looping constructs like <code>FOR</code> loops.
</p>
</div>
</div>

<div id="outline-container-orge5a6dc1" class="outline-3">
<h3 id="orge5a6dc1"><span class="section-number-3">2.13.</span> 1.1.8: Procedures as Black-Box Abstractions</h3>
<div class="outline-text-3" id="text-2-13">
<p>
Notice how the <code class="src src-scheme">sqrt</code> procedure is divided into other procedures,
which mirror the division of the square root problem into sub problems.
</p>

<p>
A procedure should accomplish an identifiable task, and be ready to be used as a
module in defining other procedures. This lets the programmer know how to use
the procedure while not needing to know the details of how it works.
</p>

<p>
Suppressing these details are particularly helpful:
</p>
<dl class="org-dl">
<dt>Local names.</dt><dd>A procedure user shouldn&rsquo;t need to know a procedure&rsquo;s choices
of variable names. A formal parameter of a procedure whose name is irrelevant
is called a <b>bound variable</b>. A procedure definition <b>binds</b> its parameters. A
<b>free variable</b> isn&rsquo;t bound. The set of expressions in which a binding defines
a name is the <b>scope</b> of that name.</dd>
<dt>Internal definitions and block structure.</dt><dd>By nesting relevant definitions
inside other procedures, you hide them from the global namespace. This nesting
is called <b>block structure</b>. Nesting these definitions also allows relevant
variables to be shared across procedures, which is called <b>lexical scoping</b>.</dd>
</dl>
</div>
</div>

<div id="outline-container-org2770b96" class="outline-3">
<h3 id="org2770b96"><span class="section-number-3">2.14.</span> Exercise 1.6: Special form evaluation</h3>
<div class="outline-text-3" id="text-2-14">
</div>

<div id="outline-container-org1f207f5" class="outline-4">
<h4 id="org1f207f5"><span class="section-number-4">2.14.1.</span> Text code</h4>
<div class="outline-text-4" id="text-2-14-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org8d7df1f"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">abs</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt; x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      <span style="color: #99bb66;">(</span>- x<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>      x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org4de397c"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">average</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>+ x y<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org679a3b9"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;average&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">improve</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>average guess <span style="color: #99bb66;">(</span>/ x guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;abs&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">good-enough?</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>&lt; <span style="color: #99bb66;">(</span>abs <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>square guess<span style="color: #51afef;">)</span> x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0.001</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt-iter</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>good-enough? guess x<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>      guess
<span class="linenr">13: </span>      <span style="color: #99bb66;">(</span>sqrt-iter <span style="color: #a9a1e1;">(</span>improve guess x<span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>sqrt-iter <span style="color: #dd8844; font-weight: bold;">1.0</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a9bc9e" class="outline-4">
<h4 id="org4a9bc9e"><span class="section-number-4">2.14.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-14-2">
<p>
Alyssa P. Hacker doesn&rsquo;t see why <code class="src src-scheme">if</code> needs to be provided as a
special form. &ldquo;Why can&rsquo;t I just define it as an ordinary procedure in terms of
cond?&rdquo; she asks. Alyssa&rsquo;s friend Eva Lu Ator claims this can indeed be done, and
she defines a new version of <code class="src src-scheme">if</code>:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">new-if</span> predicate
<span class="linenr">2: </span>                then-clause
<span class="linenr">3: </span>                else-clause<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span>predicate then-clause<span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> else-clause<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Eva demonstrates the program for Alyssa:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>new-if <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">=&gt; 5</span>
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>new-if <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #525252;">;; </span><span style="color: #525252;">=&gt; 0</span>
</pre>
</div>

<p>
Delighted, Alyssa uses <code class="src src-scheme">new-if</code> to rewrite the square-root program:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt-iter</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>new-if <span style="color: #99bb66;">(</span>good-enough? guess x<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>          guess
<span class="linenr">4: </span>          <span style="color: #99bb66;">(</span>sqrt-iter <span style="color: #a9a1e1;">(</span>improve guess x<span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
What happens when Alyssa attempts to use this to compute square roots? Explain.
</p>
</div>
</div>

<div id="outline-container-orgbfb328e" class="outline-4">
<h4 id="orgbfb328e"><span class="section-number-4">2.14.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-14-3">
<p>
Using Alyssa&rsquo;s <code class="src src-scheme">new-if</code> leads to an infinite loop because the
recursive call to <code class="src src-scheme">sqrt-iter</code> is evaluated before the actual call to
<code class="src src-scheme">new-if</code>. This is because <code class="src src-scheme">if</code> and <code class="src src-scheme">cond</code> are
special forms that change the way evaluation is handled; whichever branch is
chosen leaves the other branches unevaluated.
</p>
</div>
</div>
</div>

<div id="outline-container-orgcba267b" class="outline-3">
<h3 id="orgcba267b"><span class="section-number-3">2.15.</span> Exercise 1.7: <code>sqrt</code> with small and large numbers</h3>
<div class="outline-text-3" id="text-2-15">
</div>

<div id="outline-container-org9246aba" class="outline-4">
<h4 id="org9246aba"><span class="section-number-4">2.15.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-15-1">
<div class="org-src-container">
<pre class="src src-scheme" id="orgd458b0a"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mean-square</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>average <span style="color: #99bb66;">(</span>square x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>square y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org551591b" class="outline-4">
<h4 id="org551591b"><span class="section-number-4">2.15.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-15-2">
<p>
The <code class="src src-scheme">good-enough?</code> test used in computing square roots will not be
very effective for finding the square roots of very small numbers. Also, in real
computers, arithmetic operations are almost always performed with limited
precision. This makes our test inadequate for very large numbers. Explain these
statements, with examples showing how the test fails for small and large
numbers. An alternative strategy for implementing <code class="src src-scheme">good-enough?</code> is to
watch how <code class="src src-scheme">guess</code> changes from one iteration to the next and to stop
when the change is a very small fraction of the guess. Design a square-root
procedure that uses this kind of end test. Does this work better for small and
large numbers?
</p>
</div>
</div>

<div id="outline-container-org4219390" class="outline-4">
<h4 id="org4219390"><span class="section-number-4">2.15.3.</span> Diary</h4>
<div class="outline-text-4" id="text-2-15-3">
</div>

<ol class="org-ol">
<li><a id="org4e1995c"></a>Solving<br />
<div class="outline-text-5" id="text-2-15-3-1">
<p>
My original answer was this, which compares the previous iteration until the new
and old are within an arbitrary \(dx\).
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org39d3ee8"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;txt-sqrt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">inferior-good-enough?</span> guess lastguess<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>&lt;=
<span class="linenr"> 4: </span>   <span style="color: #99bb66;">(</span>abs <span style="color: #a9a1e1;">(</span>-
<span class="linenr"> 5: </span>         <span style="color: #51afef;">(</span>/ lastguess guess<span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>         <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>   <span style="color: #dd8844; font-weight: bold;">0.0000000000001</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">dx</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">new-sqrt-iter</span> guess x lastguess<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">Memory of previous value</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>inferior-good-enough? guess lastguess<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>      guess
<span class="linenr">11: </span>      <span style="color: #99bb66;">(</span>new-sqrt-iter <span style="color: #a9a1e1;">(</span>improve guess x<span style="color: #a9a1e1;">)</span> x guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">new-sqrt</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>new-sqrt-iter <span style="color: #dd8844; font-weight: bold;">1.0</span> x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This solution can correctly find small and large numbers:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;inferior-good-enough&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>new-sqrt <span style="color: #dd8844; font-weight: bold;">10000000000000</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org68924b8">
3162277.6601683795
</pre>

<div class="org-src-container">
<pre class="src src-scheme" id="orgf0a7735"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;inferior-good-enough&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these new-sqrt '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0.01</span> <span style="color: #dd8844; font-weight: bold;">0.0001</span> <span style="color: #dd8844; font-weight: bold;">0.000001</span> <span style="color: #dd8844; font-weight: bold;">0.00000001</span> <span style="color: #dd8844; font-weight: bold;">0.0000000001</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.01</td>
<td class="org-right">0.1</td>
</tr>

<tr>
<td class="org-right">0.0001</td>
<td class="org-right">0.01</td>
</tr>

<tr>
<td class="org-right">1e-06</td>
<td class="org-right">0.001</td>
</tr>

<tr>
<td class="org-right">1e-08</td>
<td class="org-right">9.999999999999999e-05</td>
</tr>

<tr>
<td class="org-right">1e-10</td>
<td class="org-right">9.999999999999999e-06</td>
</tr>
</tbody>
</table>


<p>
However, I found this solution online that isn&rsquo;t just simpler but automatically
reaches the precision limit of the system:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgb73afcd"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;txt-sqrt&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">best-good-enough?</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>   <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>improve guess x<span style="color: #99bb66;">)</span> guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org0667be0"></a>Imroving <code>sqrt</code> by avoiding extra <code>improve</code> call<br />
<div class="outline-text-5" id="text-2-15-3-2">
</div>

<ol class="org-ol">
<li><a id="orgc31eb7c"></a>Non-optimized<br />
<div class="outline-text-6" id="text-2-15-3-2-1">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">average</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>+ x y<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">improve</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>average guess <span style="color: #99bb66;">(</span>/ x guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">good-enough?</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>   <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>improve guess x<span style="color: #99bb66;">)</span> guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">improve call 1</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt-iter</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>good-enough? guess x<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>      guess
<span class="linenr">12: </span>      <span style="color: #99bb66;">(</span>sqrt-iter <span style="color: #a9a1e1;">(</span>improve guess x<span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">call 2</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>sqrt-iter <span style="color: #dd8844; font-weight: bold;">1.0</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>mattbench <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">(</span>sqrt <span style="color: #dd8844; font-weight: bold;">69420</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">400000000</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #525252;">;; </span><span style="color: #525252;">4731.30 &lt;- Benchmark results</span>
</pre>
</div>
</div>
</li>

<li><a id="orgbdd377f"></a>Optimized<br />
<div class="outline-text-6" id="text-2-15-3-2-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">average</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>+ x y<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">improve</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>average guess <span style="color: #99bb66;">(</span>/ x guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">good-enough?</span> guess nextguess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>= nextguess guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt-iter</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>nextguess <span style="color: #51afef;">(</span>improve guess x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>good-enough? guess nextguess x<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>        guess
<span class="linenr">13: </span>        <span style="color: #a9a1e1;">(</span>sqrt-iter nextguess x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>sqrt-iter <span style="color: #dd8844; font-weight: bold;">1.0</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>mattbench <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">(</span>sqrt <span style="color: #dd8844; font-weight: bold;">69420</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">400000000</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org6daf886"></a>Benchmark results<br />
<div class="outline-text-6" id="text-2-15-3-2-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Unoptimized</td>
<td class="org-right">4731.30</td>
</tr>

<tr>
<td class="org-left">Optimized</td>
<td class="org-right">2518.44</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</li>
</ol>
</div>

<div id="outline-container-org89df2ff" class="outline-4">
<h4 id="org89df2ff"><span class="section-number-4">2.15.4.</span> Answer</h4>
<div class="outline-text-4" id="text-2-15-4">
<p>
The current method has decreasing accuracy with smaller numbers. Notice the
steady divergence from correct answers here (should be decreasing powers of
0.1):
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org1d1c3a9"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;txt-sqrt&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these sqrt <span style="color: #dd8844; font-weight: bold;">0.01</span> <span style="color: #dd8844; font-weight: bold;">0.0001</span> <span style="color: #dd8844; font-weight: bold;">0.000001</span> <span style="color: #dd8844; font-weight: bold;">0.00000001</span> <span style="color: #dd8844; font-weight: bold;">0.0000000001</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.01</td>
<td class="org-right">0.10032578510960605</td>
</tr>

<tr>
<td class="org-right">0.0001</td>
<td class="org-right">0.03230844833048122</td>
</tr>

<tr>
<td class="org-right">1e-06</td>
<td class="org-right">0.031260655525445276</td>
</tr>

<tr>
<td class="org-right">1e-08</td>
<td class="org-right">0.03125010656242753</td>
</tr>

<tr>
<td class="org-right">1e-10</td>
<td class="org-right">0.03125000106562499</td>
</tr>
</tbody>
</table>

<p>
And for larger numbers, an infinite loop will eventually be reached. \(10^{12}\)
can resolve, but \(10^{13}\) cannot.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;txt-sqrt&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>sqrt <span style="color: #dd8844; font-weight: bold;">1000000000000</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgaa48be5">
1000000.0
</pre>

<p>
So, my definition of <code class="src src-scheme">sqrt</code>:
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org0636ab9"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;average&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">improve</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>average guess <span style="color: #99bb66;">(</span>/ x guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">good-enough?</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>   <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>improve guess x<span style="color: #99bb66;">)</span> guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt-iter</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>good-enough? guess x<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      guess
<span class="linenr"> 9: </span>      <span style="color: #99bb66;">(</span>sqrt-iter <span style="color: #a9a1e1;">(</span>improve guess x<span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>sqrt-iter <span style="color: #dd8844; font-weight: bold;">1.0</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org3aae1f6"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these sqrt '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0.01</span> <span style="color: #dd8844; font-weight: bold;">0.0001</span> <span style="color: #dd8844; font-weight: bold;">0.000001</span> <span style="color: #dd8844; font-weight: bold;">0.00000001</span> <span style="color: #dd8844; font-weight: bold;">0.0000000001</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.01</td>
<td class="org-right">0.1</td>
</tr>

<tr>
<td class="org-right">0.0001</td>
<td class="org-right">0.01</td>
</tr>

<tr>
<td class="org-right">1e-06</td>
<td class="org-right">0.001</td>
</tr>

<tr>
<td class="org-right">1e-08</td>
<td class="org-right">9.999999999999999e-05</td>
</tr>

<tr>
<td class="org-right">1e-10</td>
<td class="org-right">9.999999999999999e-06</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org6b04a5b" class="outline-3">
<h3 id="org6b04a5b"><span class="section-number-3">2.16.</span> Exercise 1.8: Cube roots</h3>
<div class="outline-text-3" id="text-2-16">
</div>

<div id="outline-container-org754cc13" class="outline-4">
<h4 id="org754cc13"><span class="section-number-4">2.16.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-16-1">
<p>
Newton&rsquo;s method for cube roots is based on the fact that if \(y\) is an
approximation to the cube root of \(x\), then a better approximation is given by
the value
</p>

<p>
\[
\frac{\frac{x}{y^2} + 2y}{3}
\]
</p>

<p>
Use this formula to implement a cube-root procedure analogous to the
<code class="src src-scheme">square-root</code> procedure. (In <a href="#org9617225">1.3.4 Procedures as Returned Values</a> we
will see how to implement Newton&rsquo;s method in general as an abstraction of these
square-root and cube-root procedures.)
</p>
</div>
</div>

<div id="outline-container-orgda5cd05" class="outline-4">
<h4 id="orgda5cd05"><span class="section-number-4">2.16.2.</span> Diary</h4>
<div class="outline-text-4" id="text-2-16-2">
<p>
My first attempt works, but needs an arbitrary limit to stop infinite loops:
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgbbb597f"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cb-good-enough?</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>cb-improve guess x<span style="color: #99bb66;">)</span> guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cb-improve</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>/
<span class="linenr"> 7: </span>   <span style="color: #99bb66;">(</span>+
<span class="linenr"> 8: </span>    <span style="color: #a9a1e1;">(</span>/ x <span style="color: #51afef;">(</span>square guess<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #a9a1e1;">(</span>* guess <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>   <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cbrt-iter</span> guess x counter<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span>cb-good-enough? guess x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>&gt; counter <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>      guess
<span class="linenr">14: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">begin</span>
<span class="linenr">15: </span>        <span style="color: #a9a1e1;">(</span>cbrt-iter <span style="color: #51afef;">(</span>cb-improve guess x<span style="color: #51afef;">)</span> x <span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> counter<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cbrt</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>cbrt-iter <span style="color: #dd8844; font-weight: bold;">1.0</span> x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>try-these cbrt <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">32</span> <span style="color: #dd8844; font-weight: bold;">56</span> <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">7</td>
<td class="org-right">1.912931182772389</td>
</tr>

<tr>
<td class="org-right">32</td>
<td class="org-right">3.174802103936399</td>
</tr>

<tr>
<td class="org-right">56</td>
<td class="org-right">3.825862365544778</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-right">4.641588833612779</td>
</tr>
</tbody>
</table>

<p>
However, this will hang on an infinite loop when trying to run <code class="src src-scheme"><span style="color: #51afef;">(</span>cbrt <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span></code>. I speculate it&rsquo;s a floating point precision issue with the &ldquo;improve&rdquo;
algorithm. So to avoid it I&rsquo;ll just keep track of the last guess and stop
improving when there&rsquo;s no more change occurring. Also while researching I
discovered that (again due to floating point) <code class="src src-scheme"><span style="color: #51afef;">(</span>cbrt <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #51afef;">)</span></code> loops
forever unless you initialize your guess with a slightly different value, so
let&rsquo;s do 1.1 instead.
</p>
</div>
</div>

<div id="outline-container-org7b48cfc" class="outline-4">
<h4 id="org7b48cfc"><span class="section-number-4">2.16.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-16-3">
<div class="org-src-container">
<pre class="src src-scheme" id="orgb75fa77"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cb-good-enough?</span> nextguess guess lastguess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>= nextguess guess<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>= nextguess lastguess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cb-improve</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>/
<span class="linenr"> 7: </span>   <span style="color: #99bb66;">(</span>+
<span class="linenr"> 8: </span>    <span style="color: #a9a1e1;">(</span>/ x <span style="color: #51afef;">(</span>square guess<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #a9a1e1;">(</span>* guess <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>   <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cbrt-iter</span> guess lastguess x<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">nextguess</span> <span style="color: #99bb66;">(</span>cb-improve guess x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>cb-good-enough? nextguess guess lastguess x<span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>      nextguess
<span class="linenr">15: </span>      <span style="color: #99bb66;">(</span>cbrt-iter nextguess guess x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cbrt</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>cbrt-iter <span style="color: #dd8844; font-weight: bold;">1.1</span> <span style="color: #dd8844; font-weight: bold;">9999</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;cbrt&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these cbrt <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">32</span> <span style="color: #dd8844; font-weight: bold;">56</span> <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">7</td>
<td class="org-right">1.912931182772389</td>
</tr>

<tr>
<td class="org-right">32</td>
<td class="org-right">3.174802103936399</td>
</tr>

<tr>
<td class="org-right">56</td>
<td class="org-right">3.825862365544778</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-right">4.641588833612779</td>
</tr>

<tr>
<td class="org-right">-2</td>
<td class="org-right">-1.2599210498948732</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org624eeef" class="outline-3">
<h3 id="org624eeef"><span class="section-number-3">2.17.</span> 1.2: Procedures and the Processes They Generate</h3>
<div class="outline-text-3" id="text-2-17">
<p>
Procedures define the <b>local evolution</b> of processes. We would like to be able
to make statements about the <b>global</b> behavior of a process.
</p>
</div>
</div>

<div id="outline-container-org90a8a9d" class="outline-3">
<h3 id="org90a8a9d"><span class="section-number-3">2.18.</span> 1.2.1: Linear Recursion and Iteration</h3>
<div class="outline-text-3" id="text-2-18">
<p>
Consider these two procedures for obtaining factorials:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">factorial-recursion</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
      <span style="color: #dd8844; font-weight: bold;">1</span>
      <span style="color: #99bb66;">(</span>* n 
         <span style="color: #a9a1e1;">(</span>factorial-recursion <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">factorial-iteration</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">fact-iter</span> product counter max-count<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; counter max-count<span style="color: #a9a1e1;">)</span>
          product
          <span style="color: #a9a1e1;">(</span>fact-iter
                    <span style="color: #51afef;">(</span>* counter product<span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span>+ counter <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
                    max-count<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  
  <span style="color: #c678dd;">(</span>fact-iter <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
These two procedures reach the same answers, but form very different processes.
The <code class="src src-scheme">factorial-recursion</code> version takes more computational <b>time</b> and
<b>space</b> to evaluate, by building up a chain of deferred operations. This is a
<b>recursive process</b>. As the number of steps needed to operate, and the amount of
info needed to keep track of these operations, both grow linearly with \(n\),
this is a <b>linear recursive process</b>.
</p>

<p>
The second version forms an <b>iterative process</b>. Its state can be summarized
with a fixed number of state variables. The number of steps required grow
linearly with \(n\), so this is a <b>linear iterative process</b>.
</p>

<dl class="org-dl">
<dt>recursive procedure</dt><dd>is a procedure whose definition refers to itself.</dd>
<dt>recursive process</dt><dd>is a process that evolves recursively.</dd>
</dl>

<p>
So <code class="src src-scheme">fact-iter</code> is a recursive <i>procedure</i> that generates an iterative
<i>process</i>.
</p>

<p>
Many implementations of programming languages interpret all recursive procedures
in a way that consume memory that grows with the number of procedure calls, even
when the process is essentially iterative. These languages instead use looping
constructs such as <code class="src src-scheme">do</code>, <code class="src src-scheme">repeat</code>, <code class="src src-scheme">for</code>, etc.
Implementations that execute iterative processes in constant space, even if the
procedure is recursive, are <b>tail-recursive</b>.
</p>
</div>
</div>

<div id="outline-container-org04c75c8" class="outline-3">
<h3 id="org04c75c8"><span class="section-number-3">2.19.</span> Exercise 1.9: Peano counting and recursion</h3>
<div class="outline-text-3" id="text-2-19">
</div>

<div id="outline-container-org2b6941e" class="outline-4">
<h4 id="org2b6941e"><span class="section-number-4">2.19.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-19-1">
<p>
Each of the following two procedures defines a method for adding two positive
integers in terms of the procedures <code class="src src-scheme">inc</code>, which increments its
argument by 1, and <code class="src src-scheme">dec</code>, which decrements its argument by 1.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">+</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= a <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      b
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>inc <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>dec a<span style="color: #51afef;">)</span> b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">+</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= a <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">8: </span>      b
<span class="linenr">9: </span>      <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>dec a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>inc b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Using the substitution model, illustrate the process generated by each procedure
in evaluating <code class="src src-scheme"><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span></code>. Are these processes iterative or recursive?
</p>
</div>
</div>

<div id="outline-container-org772c97b" class="outline-4">
<h4 id="org772c97b"><span class="section-number-4">2.19.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-19-2">
<p>
The first procedure is recursive, while the second is iterative though
tail-recursion.
</p>
</div>

<ol class="org-ol">
<li><a id="org091e1b2"></a>recursive procedure<br />
<div class="outline-text-5" id="text-2-19-2-1">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>inc <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>inc <span style="color: #c678dd;">(</span>inc <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>inc <span style="color: #c678dd;">(</span>inc <span style="color: #99bb66;">(</span>inc <span style="color: #a9a1e1;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>inc <span style="color: #c678dd;">(</span>inc <span style="color: #99bb66;">(</span>inc <span style="color: #a9a1e1;">(</span>inc <span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span>inc <span style="color: #c678dd;">(</span>inc <span style="color: #99bb66;">(</span>inc <span style="color: #a9a1e1;">(</span>inc <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span>inc <span style="color: #c678dd;">(</span>inc <span style="color: #99bb66;">(</span>inc <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>inc <span style="color: #c678dd;">(</span>inc <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>inc <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #dd8844; font-weight: bold;">9</span>
</pre>
</div>
</div>
</li>

<li><a id="orgca10a13"></a>iterative procedure<br />
<div class="outline-text-5" id="text-2-19-2-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #dd8844; font-weight: bold;">9</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org22a6df7" class="outline-3">
<h3 id="org22a6df7"><span class="section-number-3">2.20.</span> Exercise 1.10: Ackermann&rsquo;s Function</h3>
<div class="outline-text-3" id="text-2-20">
</div>

<div id="outline-container-orga5da6a8" class="outline-4">
<h4 id="orga5da6a8"><span class="section-number-4">2.20.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-20-1">
<p>
The following procedure computes a mathematical function called Ackermann&rsquo;s
function.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orge0eb1dc"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">A</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= y <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span> y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= y <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>A <span style="color: #51afef;">(</span>- x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span>                 <span style="color: #51afef;">(</span>A x <span style="color: #c678dd;">(</span>- y <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
What are the values of the following expressions?
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>A <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>A <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>A <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">(1 10)</td>
<td class="org-right">1024</td>
</tr>

<tr>
<td class="org-left">(2 4)</td>
<td class="org-right">65536</td>
</tr>

<tr>
<td class="org-left">(3 3)</td>
<td class="org-right">65536</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-scheme" id="org3453bea"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;ackermann&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">f</span> n<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>A <span style="color: #dd8844; font-weight: bold;">0</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">g</span> n<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>A <span style="color: #dd8844; font-weight: bold;">1</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">h</span> n<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>A <span style="color: #dd8844; font-weight: bold;">2</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">k</span> n<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> n n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Give concise mathematical definitions for the functions computed by the
procedures <code class="src src-scheme">f</code>, <code class="src src-scheme">g</code>, and <code class="src src-scheme">h</code> for positive integer
values of \(n\). For example, <code class="src src-scheme"><span style="color: #51afef;">(</span>k n<span style="color: #51afef;">)</span></code> computes \(5n^2\).
</p>
</div>
</div>

<div id="outline-container-org3e4c6ee" class="outline-4">
<h4 id="org3e4c6ee"><span class="section-number-4">2.20.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-20-2">
</div>

<ol class="org-ol">
<li><a id="orgb85b912"></a><code>f</code><br />
<div class="outline-text-5" id="text-2-20-2-1">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;EX1-10-defs&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these f <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">15</span> <span style="color: #dd8844; font-weight: bold;">20</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">20</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>

<p>
\[
f(n)=2n
\]
</p>
</div>
</li>

<li><a id="org04fcd93"></a><code>g</code><br />
<div class="outline-text-5" id="text-2-20-2-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;EX1-10-defs&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these g <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">16</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">32</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">256</td>
</tr>
</tbody>
</table>

<p>
\[
g(n)=2^n
\]
</p>
</div>
</li>

<li><a id="org621c11c"></a><code>h</code><br />
<div class="outline-text-5" id="text-2-20-2-3">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;EX1-10-defs&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these h <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">16</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">65536</td>
</tr>
</tbody>
</table>

<p>
It took a while to figure this one out, just because I didn&rsquo;t know the term.
This is repeated exponentiation. This operation is to exponentiation, what
exponentiation is to multiplication. It&rsquo;s called either <i>tetration</i> or <i>hyper-4</i>
and has no formal notation, but two common ways would be these:
</p>

<p>
\[
h(n)=2 \uparrow\uparrow n
\]
\[
h(n)={}^{n}2
\]
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org501c481" class="outline-3">
<h3 id="org501c481"><span class="section-number-3">2.21.</span> 1.2.2: Tree Recursion</h3>
<div class="outline-text-3" id="text-2-21">
<p>
Consider a recursive procedure for computing Fibonacci numbers:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>fib <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                 <span style="color: #51afef;">(</span>fib <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
The resulting process splits into two with every iteration, creating a tree of
computations, many of which are duplicates of previous computations. This kind
of pattern is called <b>tree-recursion</b>. However, this one is quite inefficient.
The time and space required grows exponentially with the number of iterations
requested.
</p>

<p>
Instead, it makes much more sense to start from <code>Fib(1) ~ 1</code> and <code>Fib(0) ~ 0</code>
and iterate upwards to the desired value. This only requires a linear number of
steps relative to the input.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>fib-iter <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib-iter</span> a b count<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= count <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span> b <span style="color: #99bb66;">(</span>fib-iter <span style="color: #a9a1e1;">(</span>+ a b<span style="color: #a9a1e1;">)</span> a <span style="color: #a9a1e1;">(</span>- count <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
However, notice that the inefficient tree-recursive version is a fairly
straightforward translation of the Fibonacci sequence&rsquo;s definition, while the
iterative version required redefining the process as an iteration with three
variables.
</p>
</div>

<div id="outline-container-org7dc93e6" class="outline-4">
<h4 id="org7dc93e6"><span class="section-number-4">2.21.1.</span> Example: Counting change</h4>
<div class="outline-text-4" id="text-2-21-1">
<p>
I should come back and try to make the &ldquo;better algorithm&rdquo; suggested.
</p>
</div>
</div>
</div>

<div id="outline-container-org9b9c209" class="outline-3">
<h3 id="org9b9c209"><span class="section-number-3">2.22.</span> Exercise 1.11: More recursion vs iteration</h3>
<div class="outline-text-3" id="text-2-22">
</div>

<div id="outline-container-orgf5c2b29" class="outline-4">
<h4 id="orgf5c2b29"><span class="section-number-4">2.22.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-22-1">
<p>
A function \(f\) is defined by the rule that:
\[
f(n)=n \text{ if } n<3
\]
\[
\text{ and }
\]
\[
f(n)=f(n-1)+2f(n-2)+3f(n-3) \text{ if } n \geq 3
\]
</p>

<p>
Write a procedure that computes \(f\) by means of a recursive process. Write a
procedure that computes \(f\) by means of an iterative process.
</p>
</div>
</div>

<div id="outline-container-orgfc961e7" class="outline-4">
<h4 id="orgfc961e7"><span class="section-number-4">2.22.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-22-2">
</div>

<ol class="org-ol">
<li><a id="org2019c45"></a>Recursive<br />
<div class="outline-text-5" id="text-2-22-2-1">
<div class="org-src-container">
<pre class="src src-scheme" id="orgdca0b37"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fr</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt; n <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      n
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>+      <span style="color: #a9a1e1;">(</span>fr <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>         <span style="color: #a9a1e1;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>fr <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>         <span style="color: #a9a1e1;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #51afef;">(</span>fr <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;EX1-11-fr&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these fr <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">25</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1892</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="org3d4369e"></a>Iterative<br />
<div class="outline-text-5" id="text-2-22-2-2">
</div>

<ol class="org-ol">
<li><a id="orga4b1143"></a>Attempt 1<br />
<div class="outline-text-6" id="text-2-22-2-2-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org826412c"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">This seems like it could be better</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fi</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">formula</span> l<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>a <span style="color: #c678dd;">(</span>car l<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>           <span style="color: #51afef;">(</span>b <span style="color: #c678dd;">(</span>cadr l<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>           <span style="color: #51afef;">(</span>c <span style="color: #c678dd;">(</span>caddr l<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #a9a1e1;">(</span>+ a
<span class="linenr"> 8: </span>         <span style="color: #51afef;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span> b<span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>         <span style="color: #51afef;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> c<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> l i<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= i n<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>        <span style="color: #a9a1e1;">(</span>car l<span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>formula l<span style="color: #c678dd;">)</span> l<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>              <span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> i<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt; n <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>      n
<span class="linenr">17: </span>      <span style="color: #99bb66;">(</span>iter '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;EX1-11-fi&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these fi <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">25</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1892</td>
</tr>
</tbody>
</table>

<p>
It works but it seems wasteful.
</p>
</div>
</li>

<li><a id="org5da7b29"></a>Attempt 2<br />
<div class="outline-text-6" id="text-2-22-2-2-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org5e44144"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fi2</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">formula</span> a b c<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      <span style="color: #99bb66;">(</span>+ a
<span class="linenr"> 4: </span>         <span style="color: #a9a1e1;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span> b<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> a b c i<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= i n<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        a
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>formula a b c<span style="color: #51afef;">)</span>
<span class="linenr">10: </span>              a
<span class="linenr">11: </span>              b
<span class="linenr">12: </span>              <span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> i<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt; n <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>      n
<span class="linenr">15: </span>      <span style="color: #99bb66;">(</span>iter <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;EX1-11-fi2&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these fi2 <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">25</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1892</td>
</tr>
</tbody>
</table>

<p>
I like that better.
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgc55a1c1" class="outline-3">
<h3 id="orgc55a1c1"><span class="section-number-3">2.23.</span> Exercise 1.12: Pascal&rsquo;s Triangle</h3>
<div class="outline-text-3" id="text-2-23">
</div>

<div id="outline-container-orgffd3290" class="outline-4">
<h4 id="orgffd3290"><span class="section-number-4">2.23.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-23-1">
<p>
The following pattern of numbers is called Pascal&rsquo;s triangle.
</p>

<pre class="example" id="org23d3a2d">
        1
      1   1
    1   2   1
  1   3   3   1
1   4   6   4   1
      . . .
</pre>

<p>
The numbers at the edge of the triangle are all 1, and each number inside the
triangle is the sum of the two numbers above it. Write a procedure that
computes elements of Pascal&rsquo;s triangle by means of a recursive process.
</p>
</div>
</div>

<div id="outline-container-orgbfd541c" class="outline-4">
<h4 id="orgbfd541c"><span class="section-number-4">2.23.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-23-2">
<p>
I guess I&rsquo;ll rotate the triangle 45 degrees to make it the corner of an
infinite spreadsheet.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orga83bb72"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pascal</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span>= x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">3: </span>          <span style="color: #a9a1e1;">(</span>= y <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>      <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>pascal <span style="color: #51afef;">(</span>- x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> y<span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>         <span style="color: #a9a1e1;">(</span>pascal x <span style="color: #51afef;">(</span>- y <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;pascal-rec&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l <span style="color: #a9a1e1;">(</span>iota <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>row<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>xy<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>                <span style="color: #c678dd;">(</span>apply pascal xy<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>              row<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>y<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>                     <span style="color: #99bb66;">(</span>list x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                   l<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>            l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">6</td>
<td class="org-right">10</td>
<td class="org-right">15</td>
<td class="org-right">21</td>
<td class="org-right">28</td>
<td class="org-right">36</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">10</td>
<td class="org-right">20</td>
<td class="org-right">35</td>
<td class="org-right">56</td>
<td class="org-right">84</td>
<td class="org-right">120</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">15</td>
<td class="org-right">35</td>
<td class="org-right">70</td>
<td class="org-right">126</td>
<td class="org-right">210</td>
<td class="org-right">330</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-right">21</td>
<td class="org-right">56</td>
<td class="org-right">126</td>
<td class="org-right">252</td>
<td class="org-right">462</td>
<td class="org-right">792</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">7</td>
<td class="org-right">28</td>
<td class="org-right">84</td>
<td class="org-right">210</td>
<td class="org-right">462</td>
<td class="org-right">924</td>
<td class="org-right">1716</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">8</td>
<td class="org-right">36</td>
<td class="org-right">120</td>
<td class="org-right">330</td>
<td class="org-right">792</td>
<td class="org-right">1716</td>
<td class="org-right">3432</td>
</tr>
</tbody>
</table>

<p>
The test code was much harder to write than the actual solution.
</p>
</div>
</div>
</div>

<div id="outline-container-orgced581a" class="outline-3">
<h3 id="orgced581a"><span class="section-number-3">2.24.</span> Exercise 1.13: Proving Fibonacci approximation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></h3>
<div class="outline-text-3" id="text-2-24">
</div>

<div id="outline-container-orgdef0356" class="outline-4">
<h4 id="orgdef0356"><span class="section-number-4">2.24.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-24-1">
<p>
Prove that \(\text{Fib}(n)\) is the closest integer to
\(\frac\Phi^n}{\sqrt{5}}\) where \(\Phi\) is \(\frac{1 + \sqrt{5}}{2}\). Hint: let
\(\Upsilon = \frac{1 - \sqrt{5}}{2}\). Use induction and the definition of the
Fibonacci numbers to prove that
</p>

<p>
\[
 \text{Fib}(n) = \frac{\Phi^n - \Upsilon^n}{\sqrt{5}}
\]
</p>
</div>
</div>

<div id="outline-container-orge8f526c" class="outline-4">
<h4 id="orge8f526c"><span class="section-number-4">2.24.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-24-2">
<p>
I don&rsquo;t know how to write a proof yet, but I can make functions to
demonstrate it.
</p>
</div>

<ol class="org-ol">
<li><a id="org0a6e703"></a>Fibonacci number generator<br />
<div class="outline-text-5" id="text-2-24-2-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org7dede4d"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib-iter</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> i a b<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= i n<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>        b
<span class="linenr"> 5: </span>    <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>+ i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>          b
<span class="linenr"> 7: </span>          <span style="color: #51afef;">(</span>+ a b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt;= n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>      <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">10: </span>      <span style="color: #99bb66;">(</span>iter <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org7fcfed3"></a>Various algorithms relating to the question<br />
<div class="outline-text-5" id="text-2-24-2-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org43cee13"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">sqrt5</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>sqrt <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">phi</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> sqrt5<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">upsilon</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>- <span style="color: #dd8844; font-weight: bold;">1</span> sqrt5<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib-phi</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>expt phi n<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>        <span style="color: #a9a1e1;">(</span>expt upsilon n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>     sqrt5<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgcc76e42"><span class="linenr">1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;fib-iter&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;fib-phi&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">5: </span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>vals <span style="color: #a9a1e1;">(</span>drop <span style="color: #51afef;">(</span>iota <span style="color: #dd8844; font-weight: bold;">21</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>       <span style="color: #99bb66;">(</span>fibs <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> fib-iter vals<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">8: </span>       <span style="color: #99bb66;">(</span>approx <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> fib-phi vals<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">9: </span>  <span style="color: #c678dd;">(</span>zip vals fibs approx<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">10</td>
<td class="org-right">55</td>
<td class="org-right">54.99999999999999</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">89</td>
<td class="org-right">89.0</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">144</td>
<td class="org-right">143.99999999999997</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-right">233</td>
<td class="org-right">232.99999999999994</td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-right">377</td>
<td class="org-right">377.00000000000006</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-right">610</td>
<td class="org-right">610.0</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-right">987</td>
<td class="org-right">986.9999999999998</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">1597</td>
<td class="org-right">1596.9999999999998</td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-right">2584</td>
<td class="org-right">2584.0</td>
</tr>

<tr>
<td class="org-right">19</td>
<td class="org-right">4181</td>
<td class="org-right">4181.0</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-right">6765</td>
<td class="org-right">6764.999999999999</td>
</tr>
</tbody>
</table>

<p>
You can see they follow closely. Graphing the differences, it&rsquo;s just
an exponential curve at very low values, presumably following the
exponential increase of the Fibonacci sequence itself.
</p>

<div id="org7a6c9ca" class="figure">
<p><img src="1/fig/1-13.png" alt="1-13.png" />
</p>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org7b4b219" class="outline-3">
<h3 id="org7b4b219"><span class="section-number-3">2.25.</span> 1.2.3: Orders of Growth</h3>
<div class="outline-text-3" id="text-2-25">
<p>
An <b>order of growth</b> gives you a gross measure of the resources required by a
process as its inputs grow larger.
</p>

<p>
Let \(n\) be a parameter for the size of a problem, and \(R(n)\) be the amount
of resources required for size \(n\). \(R(n)\) has order of growth
\(\Theta(f(n))\)
</p>

<p>
For example:
</p>
<dl class="org-dl">
<dt>\(\Theta(1)\)</dt><dd>is constant, not growing regardless of input size.</dd>
<dt>\(\Theta(n)\)</dt><dd>is growth 1-to-1 proportional to the input size.</dd>
</dl>

<p>
Some algorithms we&rsquo;ve already seen:
</p>
<dl class="org-dl">
<dt>Linear recursive</dt><dd>is time and space \(\Theta(n)\)</dd>
<dt>Iterative</dt><dd>is time \(\Theta(n)\) space \(\Theta(1)\)</dd>
<dt>Tree-recursive</dt><dd>means in general, time is proportional to the number of
nodes, space is proportional to the depth of the tree. In the Fibonacci
algorithm example, \(\Theta(n)\) and time \(\Theta(\Upsilon^{n})\) where
\(\Upsilon\) is the golden ratio \(\frac{1 + \sqrt{5}}{2}\)</dd>
</dl>

<p>
Orders of growth are very crude descriptions of process behaviors, but they are
useful in indicating how a process will change with the size of the problem.
</p>
</div>
</div>

<div id="outline-container-org91b8bd6" class="outline-3">
<h3 id="org91b8bd6"><span class="section-number-3">2.26.</span> Exercise 1.14: <code>count-change</code></h3>
<div class="outline-text-3" id="text-2-26">
</div>

<div id="outline-container-orgca9cb0a" class="outline-4">
<h4 id="orgca9cb0a"><span class="section-number-4">2.26.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-26-1">
<p>
Below is the default version of the <code class="src src-scheme">count-change</code> function. I&rsquo;ll be
aggressively modifying it in order to get a graph out of it.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orge7352ac"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">count-change</span> amount<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>cc amount <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cc</span> amount kinds-of-coins<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>&lt; amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>             <span style="color: #51afef;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>         <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>cc amount <span style="color: #c678dd;">(</span>- kinds-of-coins <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>            <span style="color: #51afef;">(</span>cc <span style="color: #c678dd;">(</span>- amount <span style="color: #99bb66;">(</span>first-denomination
<span class="linenr">12: </span>                           kinds-of-coins<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>                kinds-of-coins<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">first-denomination</span> kinds-of-coins<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">50</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c6749f" class="outline-4">
<h4 id="org4c6749f"><span class="section-number-4">2.26.2.</span> Question A: Draw the tree</h4>
<div class="outline-text-4" id="text-2-26-2">
<p>
Draw the tree illustrating the process generated by the <code class="src src-scheme">count-change</code>
procedure of <a href="#org501c481">1.2.2: Tree Recursion</a> in making change for 11 cents.
</p>
</div>
</div>

<div id="outline-container-org22aa091" class="outline-4">
<h4 id="org22aa091"><span class="section-number-4">2.26.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-26-3">
<p>
I want to generate this graph algorithmically.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org4bd18c0"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">cursed global</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">bubblecounter</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Returns # of ways change can be made</span>
<span class="linenr"> 4: </span><span style="color: #525252;">;; </span><span style="color: #525252;">"Helper" for (cc)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">count-change</span> amount<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">"digraph {\n"</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">start graph</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>cc amount <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">"}\n"</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">end graph</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">set!</span> bubblecounter <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #525252;">;; </span><span style="color: #525252;">GraphViz output</span>
<span class="linenr">12: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Derivative: https://stackoverflow.com/a/14806144</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cc</span> amount kinds-of-coins oldbubble<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>recur <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>new-amount new-kinds<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">begin</span>
<span class="linenr">16: </span>                   <span style="color: #99bb66;">(</span>display <span style="color: #99bb66;">"\""</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">Source bubble</span>
<span class="linenr">17: </span>                   <span style="color: #99bb66;">(</span>display `<span style="color: #a9a1e1;">(</span>,oldbubble ,amount ,kinds-of-coins<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>                   <span style="color: #99bb66;">(</span>display <span style="color: #99bb66;">"\""</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>                   <span style="color: #99bb66;">(</span>display <span style="color: #99bb66;">" -&gt; "</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">arrow pointing from parent to child</span>
<span class="linenr">20: </span>                   <span style="color: #99bb66;">(</span>display <span style="color: #99bb66;">"\""</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">child bubble</span>
<span class="linenr">21: </span>                   <span style="color: #99bb66;">(</span>display `<span style="color: #a9a1e1;">(</span>,bubblecounter ,new-amount ,new-kinds<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>                   <span style="color: #99bb66;">(</span>display <span style="color: #99bb66;">"\""</span><span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>                   <span style="color: #99bb66;">(</span>display <span style="color: #99bb66;">"\n"</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>                   <span style="color: #99bb66;">(</span>cc new-amount new-kinds bubblecounter<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">set!</span> bubblecounter <span style="color: #a9a1e1;">(</span>+ bubblecounter <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">27: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span>&lt; amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>+
<span class="linenr">29: </span>                 <span style="color: #c678dd;">(</span>recur amount <span style="color: #99bb66;">(</span>- kinds-of-coins <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">30: </span>                 <span style="color: #c678dd;">(</span>recur <span style="color: #99bb66;">(</span>- amount
<span class="linenr">31: </span>                           <span style="color: #a9a1e1;">(</span>first-denomination kinds-of-coins<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>                        kinds-of-coins<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">33: </span>
<span class="linenr">34: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">first-denomination</span> kinds-of-coins<span style="color: #c678dd;">)</span>
<span class="linenr">35: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">36: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">37: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #99bb66;">)</span>
<span class="linenr">39: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">50</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I&rsquo;m not going to include the full printout of the <code class="src src-scheme"><span style="color: #51afef;">(</span>count-change <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span></code>,
here&rsquo;s an example of what this looks like via <code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">1</span></code>.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orga72a6cd"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;count-change-graphviz&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>count-change <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-dot">digraph {
"(0 1 5)" -&gt; "(1 1 4)"
"(1 1 4)" -&gt; "(2 1 3)"
"(2 1 3)" -&gt; "(3 1 2)"
"(3 1 2)" -&gt; "(4 1 1)"
"(4 1 1)" -&gt; "(5 1 0)"
"(4 1 1)" -&gt; "(6 0 1)"
"(3 1 2)" -&gt; "(7 -4 2)"
"(2 1 3)" -&gt; "(8 -9 3)"
"(1 1 4)" -&gt; "(9 -24 4)"
"(0 1 5)" -&gt; "(10 -49 5)"
}
</pre>
</div>


<div id="org604f7f2" class="figure">
<p><img src="1/fig/cc-test.png" alt="cc-test.png" />
</p>
</div>

<p>
So, the graph of <code class="src src-scheme"><span style="color: #51afef;">(</span>count-change <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span></code> is:
</p>

<div id="org8c5a281" class="figure">
<p><img src="1/fig/cc-11.png" alt="cc-11.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgf4af2bf" class="outline-4">
<h4 id="orgf4af2bf"><span class="section-number-4">2.26.4.</span> Question B: Analyzing process growth</h4>
<div class="outline-text-4" id="text-2-26-4">
<p>
What are the orders of growth of the space and number of steps used by this
process as the amount to be changed increases?
</p>
</div>
</div>

<div id="outline-container-org7ede89e" class="outline-4">
<h4 id="org7ede89e"><span class="section-number-4">2.26.5.</span> Answer B</h4>
<div class="outline-text-4" id="text-2-26-5">
<p>
Let&rsquo;s look at this via the number of function calls needed for value
<code class="src src-scheme">n</code>. Instead of returning an integer, I&rsquo;ll return a pair where
<code class="src src-scheme">car</code> is the number of ways to count change, and <code class="src src-scheme">cdr</code> is
the number of function calls that have occurred down that branch of the tree.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org011ca03"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">count-calls</span> amount<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>cc-calls amount <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cc-calls</span> amount kinds-of-coins<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> . <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>&lt; amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>             <span style="color: #51afef;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>         '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> . <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>a <span style="color: #99bb66;">(</span>cc-calls amount <span style="color: #a9a1e1;">(</span>- kinds-of-coins <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>               <span style="color: #c678dd;">(</span>b <span style="color: #99bb66;">(</span>cc-calls <span style="color: #a9a1e1;">(</span>- amount <span style="color: #51afef;">(</span>first-denomination
<span class="linenr">12: </span>                                 kinds-of-coins<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>                      kinds-of-coins<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>car a<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                    <span style="color: #99bb66;">(</span>car b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>                 <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">17: </span>                    <span style="color: #99bb66;">(</span>cdr a<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>                    <span style="color: #99bb66;">(</span>cdr b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">first-denomination</span> kinds-of-coins<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= kinds-of-coins <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">50</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-scheme" id="org7786a27"><span class="linenr">1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;cc-calls&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>vals <span style="color: #a9a1e1;">(</span>drop <span style="color: #51afef;">(</span>iota <span style="color: #dd8844; font-weight: bold;">101</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>       <span style="color: #99bb66;">(</span>mine <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> count-calls vals<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span>zip vals <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> car mine<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> cdr mine<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org3358914" class="figure">
<p><img src="1/fig/cc-100.png" alt="cc-100.png" />
</p>
</div>

<p>
I believe the space to be \(\Theta(n+d)\) as the function calls count down the
denominations before counting down the change. However I notice most answers
describe \(\Theta(n)\) instead, maybe I&rsquo;m being overly pedantic and getting the
wrong answer.
</p>

<p>
My issues came finding the time. The book describes the meaning and properties
of \(\Theta\) notation in <a href="http://sarabander.github.io/sicp/html/1_002e2.xhtml#g_t1_002e2_002e3">Section 1.2.3</a>. However, my lack of formal math
education made realizing the significance of this passage difficult. For one, I
didn&rsquo;t understand that \(k_{1}f(n) \leq R(n) \leq k_{2}f(n)\) means &ldquo;you can
find the \(\Theta\) by proving that a graph of the algorithm&rsquo;s resource usage is
bounded by two identical functions multiplied by constants.&rdquo; So, the graph of
resource usage for an algorithm with \(\Theta(n^{2})\) will by bounded by lines
of \(n^{2} \times some constant\), the top boundary&rsquo;s constant being larger than
the small boundary. These are arbitrarily chosen constants, you&rsquo;re just proving
that the function behaves the way you think it does.
</p>

<p>
Overall, finding the \(\Theta\) and \(\Omega\) and \(O\) notations (they are all
different btw!) is about aggressively simplifying to make a very general
statement about the behavior of the algorithm.
</p>

<p>
I could tell that a &ldquo;correct&rdquo; way to find the \(\Theta\) would be to make a
formula which describes the algorithm&rsquo;s function calls for given input and
denominations. This is one of the biggest time sinks, although I had a lot of
fun and learned a lot. In the end, with some help from Jach in a Lisp Discord, I
had the following formula:
</p>

<p>
\[
\sum_{i=1}^{ceil(n / val(d))} T(n - val(d)*i, d)
\]
</p>

<p>
But I wasn&rsquo;t sure where to go from here. The graphs let me see some interesting
trends, though I didn&rsquo;t get any closer to an answer in the process.
</p>

<p>
By reading on other websites, I knew that you could find \(\Theta\) by obtaining
a formula for \(R(n)\) and removing constants to end up with a term of interest.
For example, if your algorithm&rsquo;s resource usage is \(\frac{n^{2} + 7n}{5}\),
this demonstrates \(\Theta(n^{2})\). So I know a formula <b>without</b> a \(\sum\)
would give me the answer I wanted. It didn&rsquo;t occur to me that it might be
possible to use calculus to remove the \(\sum\) from the equation. At this point
I knew I was stuck and decided to look up a guide.
</p>

<p>
After seeing a few solutions that I found somewhat confusing, I landed on <a href="https://codology.net/post/sicp-solution-exercise-1-14/">this
awesome article from Codology.net</a><sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>. They show how you can
remove the summation, and proposed this equation for count-change with 5
denominations:
</p>

<p>
\[
T(n,5)=\frac n{50}+1+\sum_{i=0}^{n/50}T(n-50i,1)
\]
</p>

<p>
Which, when expanded and simplified, demonstrates \(\Theta(n^{5})\) for 5
denominations.
</p>

<p>
Overall I&rsquo;m relieved that I wasn&rsquo;t entirely off, given I haven&rsquo;t done math work
like this since college. It&rsquo;s inspired me to restart my remedial math courses, I
don&rsquo;t think I really grasped the nature of math as a tool of empowerment until
now.
</p>
</div>
</div>
</div>

<div id="outline-container-org4fb13f8" class="outline-3">
<h3 id="org4fb13f8"><span class="section-number-3">2.27.</span> Exercise 1.15: Sine approximation</h3>
<div class="outline-text-3" id="text-2-27">
</div>

<div id="outline-container-org1a7096a" class="outline-4">
<h4 id="org1a7096a"><span class="section-number-4">2.27.1.</span> Question A</h4>
<div class="outline-text-4" id="text-2-27-1">
<p>
The sine of an angle (specified in radians) can be computed by making use of the
approximation \(\sin x \approx x\) if \(x\) is sufficiently small, and the
trigonometric identity \(\sin x = 3\sin\frac{x}{3} - 4\sin^3\frac{x}{3}\)
to reduce the size of the argument of sin. (For purposes of this exercise an
angle is considered &ldquo;sufficiently small&rdquo; if its magnitude is not greater than
0.1 radians.) These ideas are incorporated in the following procedures:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgbe08d0b"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cube</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* x x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">p</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>- <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #a9a1e1;">(</span>cube x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sine</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>abs angle<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>      angle
<span class="linenr">6: </span>      <span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>sine <span style="color: #51afef;">(</span>/ angle <span style="color: #dd8844; font-weight: bold;">3.0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
How many times is the procedure <code class="src src-scheme">p</code> applied when <code class="src src-scheme"><span style="color: #51afef;">(</span>sine <span style="color: #dd8844; font-weight: bold;">12.15</span><span style="color: #51afef;">)</span></code> is evaluated?
</p>
</div>
</div>

<div id="outline-container-orgc9757aa" class="outline-4">
<h4 id="orgc9757aa"><span class="section-number-4">2.27.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-2-27-2">
<p>
Let&rsquo;s find out!
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgf8bce2c"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cube</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* x x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">p</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>- <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">3</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #a9a1e1;">(</span>cube x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sine</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>abs angle<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>cons angle <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">6: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>x <span style="color: #c678dd;">(</span>sine <span style="color: #99bb66;">(</span>/ angle <span style="color: #dd8844; font-weight: bold;">3.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">7: </span>        <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>car x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span>cdr x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org8d34a39"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;1-15-p-measure&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>xy <span style="color: #a9a1e1;">(</span>sine <span style="color: #dd8844; font-weight: bold;">12.15</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>car xy<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr xy<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-0.39980345741334</td>
<td class="org-right">5</td>
</tr>
</tbody>
</table>

<p>
<code class="src src-scheme">p</code> is evaluated 5 times.
</p>
</div>
</div>

<div id="outline-container-orgf2cfc13" class="outline-4">
<h4 id="orgf2cfc13"><span class="section-number-4">2.27.3.</span> Question B</h4>
<div class="outline-text-4" id="text-2-27-3">
<p>
What is the order of growth in space and number of steps (as a function of
<code class="src src-scheme">a</code>) used by the process generated by the sine procedure when
<code class="src src-scheme"><span style="color: #51afef;">(</span>sine a<span style="color: #51afef;">)</span></code> is evaluated?
</p>
</div>
</div>

<div id="outline-container-orgf45a101" class="outline-4">
<h4 id="orgf45a101"><span class="section-number-4">2.27.4.</span> Answer B</h4>
<div class="outline-text-4" id="text-2-27-4">
<div class="org-src-container">
<pre class="src src-scheme" id="orge8b7d95"><span class="linenr">1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;1-15-p-measure&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>vals <span style="color: #a9a1e1;">(</span>iota <span style="color: #dd8844; font-weight: bold;">300</span> <span style="color: #dd8844; font-weight: bold;">0.1</span> <span style="color: #dd8844; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>       <span style="color: #99bb66;">(</span>sines <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>i<span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>                     <span style="color: #c678dd;">(</span>cdr <span style="color: #99bb66;">(</span>sine i<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span>                   vals<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>zip vals sines<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org25a22f9"><span class="linenr">1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;1-15-p-measure&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>vals <span style="color: #a9a1e1;">(</span>iota <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">0.1</span> <span style="color: #dd8844; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>       <span style="color: #99bb66;">(</span>sines <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>i<span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>                     <span style="color: #c678dd;">(</span>cdr <span style="color: #99bb66;">(</span>sine i<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span>                   vals<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>zip vals sines<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Example output:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.1</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0.2</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">0.30000000000000004</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">0.4</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">0.5</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">0.6</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">0.7000000000000001</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">0.8</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">0.9</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">1.0</td>
<td class="org-right">3</td>
</tr>
</tbody>
</table>


<div id="org6707fd4" class="figure">
<p><img src="1/fig/1-15-step.png" alt="1-15-step.png" />
</p>
</div>

<p>
This graph shows that the number of times <code class="src src-scheme">sine</code> will be called is
logarithmic.
</p>
<ul class="org-ul">
<li>0.1 to 0.2 are divided once</li>
<li>0.3 to 0.8 are divided twice</li>
<li>0.9 to 2.6 are divided three times</li>
<li>2.7 to 8 are divided four times</li>
<li>8.5 to 23.8 are divided five times</li>
</ul>

<p>
Given that the calls to <code class="src src-scheme">p</code> get stacked recursively, like this:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>sine <span style="color: #dd8844; font-weight: bold;">12.15</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>sine <span style="color: #dd8844; font-weight: bold;">4.05</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #99bb66;">(</span>sine <span style="color: #dd8844; font-weight: bold;">1.35</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>sine <span style="color: #dd8844; font-weight: bold;">0.45</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>p <span style="color: #51afef;">(</span>sine <span style="color: #dd8844; font-weight: bold;">0.15</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>p <span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>sine <span style="color: #dd8844; font-weight: bold;">0.05</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>p <span style="color: #51afef;">(</span>p <span style="color: #dd8844; font-weight: bold;">0.05</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>p <span style="color: #dd8844; font-weight: bold;">0.14950000000000002</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #99bb66;">(</span>p <span style="color: #dd8844; font-weight: bold;">0.43513455050000005</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>p <span style="color: #dd8844; font-weight: bold;">0.9758465331678772</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>p <span style="color: #dd8844; font-weight: bold;">-0.7895631144708228</span><span style="color: #51afef;">)</span>
<span style="color: #dd8844; font-weight: bold;">-0.39980345741334</span>
</pre>
</div>

<p>
So I argue the space and time is \(\Theta(\log(n))\)
</p>


<p>
We can also prove this for the time by benchmarking the function:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgd8f6869"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">This execution takes too long for org-mode, so I'm doing it</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">externally and importing the results</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;1-15-deps&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>vals <span style="color: #a9a1e1;">(</span>iota <span style="color: #dd8844; font-weight: bold;">300</span> <span style="color: #dd8844; font-weight: bold;">0.1</span> <span style="color: #dd8844; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       <span style="color: #99bb66;">(</span>times <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>i<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>                     <span style="color: #c678dd;">(</span>mattbench <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">(</span>sine i<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">1000000</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>                   vals<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-output-to-file</span> <span style="color: #99bb66;">"sine-bench.dat"</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">()</span>
<span class="linenr">12: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>x y<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>           <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~s~/~s~%"</span> x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>         vals times<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gnuplot">reset <span style="color: #525252;"># </span><span style="color: #525252;">helps with various issues in execution</span>
<span style="color: #a9a1e1;">set</span> xtics <span style="color: #dd8844; font-weight: bold;">0.5</span>
<span style="color: #a9a1e1;">set</span> xlabel <span style="color: #99bb66;">'values of x'</span>
<span style="color: #a9a1e1;">set</span> <span style="color: #51afef; font-weight: bold;">logscale</span> x
<span style="color: #a9a1e1;">set</span> key top left
<span style="color: #a9a1e1;">set</span> style fill solid <span style="color: #dd8844; font-weight: bold;">1.00</span> border
<span style="color: #525252;">#</span><span style="color: #525252;">set style function fillsteps below</span>

<span style="color: #dcaeea;">f(x) =</span> (<span style="color: #c678dd;">log</span>(x) * a) + b
<span style="color: #a9a1e1;">fit</span> f(x) <span style="color: #99bb66;">'Ex15/sine-bench.dat'</span> <span style="color: #ECBE7B;">using</span> <span style="color: #dd8844; font-weight: bold;">1</span>:<span style="color: #dd8844; font-weight: bold;">2</span> via a,b

<span style="color: #51afef;">plot</span> <span style="color: #99bb66;">'Ex15/sine-bench.dat'</span> <span style="color: #ECBE7B;">using</span> <span style="color: #dd8844; font-weight: bold;">1</span>:<span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #ECBE7B;">with</span> fillsteps <span style="color: #ECBE7B;">title</span> <span style="color: #99bb66;">'time to execute'</span>, \
     <span style="color: #99bb66;">'Ex15/sine-bench.dat'</span> <span style="color: #ECBE7B;">using</span> <span style="color: #dd8844; font-weight: bold;">1</span>:(f(<span style="color: #99bb66;">$1</span>)) <span style="color: #ECBE7B;">with</span> <span style="color: #c678dd;">lines</span> <span style="color: #ECBE7B;">title</span> <span style="color: #c678dd;">sprintf</span>(<span style="color: #99bb66;">'(log(x) * %.2f) + %.2f'</span>, a, b)
</pre>
</div>


<div id="org33b245e" class="figure">
<p><img src="1/fig/1-15-bench.png" alt="1-15-bench.png" />
</p>
</div>
</div>

<ol class="org-ol">
<li><a id="org483d444"></a>1.2.4 Exponentiation<br />
<div class="outline-text-5" id="text-2-27-4-1">
<p>
Considering a few ways to compute the exponential of a given number.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expt</span> b n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>expt-iter b n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expt-iter</span> b counter product<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= counter <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
      product
      <span style="color: #99bb66;">(</span>expt-iter b <span style="color: #a9a1e1;">(</span>- counter <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* b product<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This iterative procedure is essentially equivalent to:
</p>

<p>
\[b^{8} = b \cdot (b \cdot (b \cdot (b \cdot (b \cdot (b \cdot (b \cdot b))))))\]
</p>

<p>
But note it could be approached faster with squaring:
</p>

<p>
\[\begin{aligned}b^2 &= b \cdot b\\
b^4 &= b^2\cdot b^2\\
b^8 &= b^4 \cdot b^4\end{aligned}\]
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org593a2ac" class="outline-3">
<h3 id="org593a2ac"><span class="section-number-3">2.28.</span> Exercise 1.16: Making <code>fast-expt</code> iterative</h3>
<div class="outline-text-3" id="text-2-28">
</div>

<div id="outline-container-org6ff34dc" class="outline-4">
<h4 id="org6ff34dc"><span class="section-number-4">2.28.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-28-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org86b842d"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expt-rec</span> b n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span> 
<span class="linenr"> 3: </span>      <span style="color: #dd8844; font-weight: bold;">1</span> 
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>* b <span style="color: #a9a1e1;">(</span>expt-rec b <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expt-iter</span> b n<span style="color: #c678dd;">)</span> 
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> counter product<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= counter <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>        product
<span class="linenr">10: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>- counter <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>              <span style="color: #51afef;">(</span>* b product<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>iter n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fast-expt</span> b n<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> 
<span class="linenr">16: </span>         <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? n<span style="color: #a9a1e1;">)</span> 
<span class="linenr">18: </span>         <span style="color: #a9a1e1;">(</span>square <span style="color: #51afef;">(</span>fast-expt b <span style="color: #c678dd;">(</span>/ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> 
<span class="linenr">20: </span>         <span style="color: #a9a1e1;">(</span>* b <span style="color: #51afef;">(</span>fast-expt b <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfe932c9" class="outline-4">
<h4 id="orgfe932c9"><span class="section-number-4">2.28.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-28-2">
<p>
Design a procedure that evolves an iterative exponentiation process that uses
successive squaring and uses a logarithmic number of steps, as does fast-expt.
(Hint: Using the observation that \((b^{n/2})^2=(b^2)^{n/2}\), keep, along with
the exponent \(n\) and the base \(b\), an additional state variable \(a\) , and
define the state transformation in such a way that the product \({ab}^n\) is
unchanged from state to state. At the beginning of the process \(a\) is taken to
be 1, and the answer is given by the value of \(a\) at the end of the process.
In general, the technique of defining an <i>invariant quantity</i> that remains
unchanged from state to state is a powerful way to think about the design of
iterative algorithms.)
</p>
</div>
</div>

<div id="outline-container-orgdb49195" class="outline-4">
<h4 id="orgdb49195"><span class="section-number-4">2.28.3.</span> Diary</h4>
<div class="outline-text-4" id="text-2-28-3">
<p>
First I made this program which tries to use a false equivalence:
\[ab^2 = (a + 1)b^{n - 1}\]
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orga4d0302"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fast-expt-iter</span> b n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> b n a<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;|~s~/~/|~s~/~/|~s|~%"</span> b n a<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">begin</span> <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;|~s~/~/|~s~/~/|~s|~%"</span> <span style="color: #99bb66;">(</span>* b a<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>                          <span style="color: #c678dd;">(</span>* b a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>even? n<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>square b<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>                         <span style="color: #c678dd;">(</span>/ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>                         a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>iter b <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>+ a <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"|~a~/|~a~/|~a|~%"</span> <span style="color: #99bb66;">"base"</span> <span style="color: #99bb66;">"power"</span> <span style="color: #99bb66;">"variable"</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;|--|--|--|~%"</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>iter b n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fast-expt-iter-fail1&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>fast-expt-iter <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Here&rsquo;s what the internal state looks like during \(2^6\) (correct answer is 64):
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">base</th>
<th scope="col" class="org-right">power</th>
<th scope="col" class="org-right">variable</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">6</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">32</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org8a11bc5" class="outline-4">
<h4 id="org8a11bc5"><span class="section-number-4">2.28.4.</span> Answer</h4>
<div class="outline-text-4" id="text-2-28-4">
<p>
There are two key transforms to a faster algorithm. The first was already shown
in the text:
</p>

<p>
\[
    ab^n \to a(b^2)^{n/2}
\]
</p>

<p>
The second which I needed to deduce was this:
</p>

<p>
\[
    ab^n \to ((a \times b) \times b)^{n - 1}
\]
</p>

<p>
The solution essentially follows this logic:
</p>
<ul class="org-ul">
<li>initialize \(a\) to 1</li>
<li>If \( n \) is 1, return \(b * a\)</li>
<li>else if \(n\) is even, halve \(n\), square \(b\), and iterate</li>
<li>else \(n\) is odd, so subtract 1 from \(n\) and \(a \to a \times b\)</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme" id="orgcd3e1ad"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fast-expt-iter</span> b n<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> b n a<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>* b a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>even? n<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>square b<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>                         <span style="color: #c678dd;">(</span>/ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>                         a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">8: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>iter b <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* b a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">9: </span>  <span style="color: #c678dd;">(</span>iter b n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fast-expt-iter&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>fast-expt-iter <span style="color: #dd8844; font-weight: bold;">3</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr <span style="color: #99bb66;">(</span>iota <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">27</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">81</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">243</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">729</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">2187</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">6561</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">19683</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">59049</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org5abb578" class="outline-3">
<h3 id="org5abb578"><span class="section-number-3">2.29.</span> Exercise 1.17: Logarithmic multiplication (recursive)</h3>
<div class="outline-text-3" id="text-2-29">
</div>

<div id="outline-container-orgb32e9a2" class="outline-4">
<h4 id="orgb32e9a2"><span class="section-number-4">2.29.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-29-1">
<p>
The exponentiation algorithms in this section are based on performing
exponentiation by means of repeated multiplication. In a similar way, one can
perform integer multiplication by means of repeated addition. The following
multiplication procedure (in which it is assumed that our language can only add,
not multiply) is analogous to the expt procedure:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">*</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= b <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>+ a <span style="color: #a9a1e1;">(</span>* a <span style="color: #51afef;">(</span>- b <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This algorithm takes a number of steps that is linear in \( b \). Now suppose we
include, together with addition, operations double, which doubles an integer,
and halve, which divides an (even) integer by 2. Using these, design a
multiplication procedure analogous to fast-expt that uses a logarithmic number
of steps.
</p>
</div>
</div>

<div id="outline-container-org16c6b7b" class="outline-4">
<h4 id="org16c6b7b"><span class="section-number-4">2.29.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-29-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org45b87e1"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">double</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>+ x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">halve</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>/ x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fast-mult-rec</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= b <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? b<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>         <span style="color: #a9a1e1;">(</span>double <span style="color: #51afef;">(</span>fast-mult-rec a <span style="color: #c678dd;">(</span>halve b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">This was kind of a stretch to think of.G</span>
<span class="linenr"> 9: </span>         <span style="color: #525252;">;</span><span style="color: #525252;">(fast-mult (double a) (halve b))) &lt;== My first instinct is iterative</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>+ a <span style="color: #51afef;">(</span>fast-mult-rec a <span style="color: #c678dd;">(</span>- b <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Proof it works:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fast-mult-rec&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>fast-mult-rec <span style="color: #dd8844; font-weight: bold;">3</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr <span style="color: #99bb66;">(</span>iota <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">15</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">18</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">24</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">27</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">30</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org42a0e4e" class="outline-3">
<h3 id="org42a0e4e"><span class="section-number-3">2.30.</span> Exercise 1.18: Logarithmic multiplication (iterative)</h3>
<div class="outline-text-3" id="text-2-30">
</div>

<div id="outline-container-org19daba7" class="outline-4">
<h4 id="org19daba7"><span class="section-number-4">2.30.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-30-1">
<p>
Using the results of Exercise 1.16 and Exercise 1.17, devise a procedure that
generates an iterative process for multiplying two integers in terms of adding,
doubling, and halving and uses a logarithmic number of steps.
</p>
</div>
</div>

<div id="outline-container-orge9ca56e" class="outline-4">
<h4 id="orge9ca56e"><span class="section-number-4">2.30.2.</span> Diary</h4>
<div class="outline-text-4" id="text-2-30-2">
</div>

<ol class="org-ol">
<li><a id="orgac67a67"></a>Comparison benchmarks:<br />
<div class="outline-text-5" id="text-2-30-2-1">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;fast-mult-iter&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;fast-mult-rec&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span>print-table <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"fast-mult-rec"</span> <span style="color: #99bb66;">"fast-mult-iter"</span><span style="color: #99bb66;">)</span>
<span class="linenr">6: </span>                   <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>mattbench <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>fast-mult-rec <span style="color: #dd8844; font-weight: bold;">32</span> <span style="color: #dd8844; font-weight: bold;">32</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">10000000</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">7: </span>                         <span style="color: #a9a1e1;">(</span>mattbench <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>fast-mult <span style="color: #dd8844; font-weight: bold;">32</span> <span style="color: #dd8844; font-weight: bold;">32</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">10000000</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>             <span style="color: #c678dd;">#:colnames</span> #t<span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">&ldquo;fast-mult-rec&rdquo;</th>
<th scope="col" class="org-right">&ldquo;fast-mult-iter&rdquo;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">196.89</td>
<td class="org-right">166.35</td>
</tr>
</tbody>
</table>

<p>
So the iterative version takes 0.84 times less to do \(32 \times 32\).
</p>
</div>
</li>

<li><a id="org1195130"></a>Hall of shame<br />
<div class="outline-text-5" id="text-2-30-2-2">
<p>
Some of my <i>very</i> incorrect ideas:
\[ab = (a+1)(b-1)\]
\[ab = \big(a+\Big(\frac{a}{2}\Big)(b-1)\big)\]
\[ab+c = \big(a(b-1)+(b+c)\big)\]
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org3b6ddb0" class="outline-4">
<h4 id="org3b6ddb0"><span class="section-number-4">2.30.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-30-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org735b873"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">double</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>+ x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">halve</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>/ x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fast-mult</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> a b c<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= b <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= b <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ a c<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>even? b<span style="color: #51afef;">)</span>
<span class="linenr">10: </span>           <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>double a<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>halve b<span style="color: #c678dd;">)</span> c<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>iter a <span style="color: #c678dd;">(</span>- b <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>+ a c<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>iter a b <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fast-mult-iter&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>fast-mult <span style="color: #dd8844; font-weight: bold;">3</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr <span style="color: #99bb66;">(</span>iota <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">15</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">18</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">24</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">27</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">30</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org22498a1" class="outline-3">
<h3 id="org22498a1"><span class="section-number-3">2.31.</span> Exercise 1.19: Logarithmic fibonacci computing with \(T\)</h3>
<div class="outline-text-3" id="text-2-31">
</div>

<div id="outline-container-orgd0c497f" class="outline-4">
<h4 id="orgd0c497f"><span class="section-number-4">2.31.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-31-1">
<p>
There is a clever algorithm for computing the Fibonacci numbers in a logarithmic
number of steps. Recall the transformation of the state variables a and b in the
<code class="src src-scheme">fib-iter</code> process of section 1-2-2:
</p>

<p>
\[a <- a + b\text{ and }b <- a\]
</p>

<p>
Call this transformation T, and observe that applying T over and over again n
times, starting with 1 and 0, produces the pair Fib\((n + 1)\) and Fib\((n)\). In
other words, the Fibonacci numbers are produced by applying \( T^n \), the nth
power of the transformation T, starting with the pair (1,0). Now consider T to
be the special case of p = 0 and q = 1 in a family of transformations \(
T_{(pq)} \), where \( T_{(pq)} \) transforms the pair (a,b) according to \( a <-
bq + aq + ap \) and \( b <- bp + aq \). Show that if we apply such a
transformation \( T_{(pq)} \) twice, the effect is the same as using a single
transformation \( T_{(p'q')} \) of the same form, and compute p&rsquo; and q&rsquo; in terms
of p and q. This gives us an explicit way to square these transformations, and
thus we can compute \( T^n \) using successive squaring, as in the `fast-expt&rsquo;
procedure. Put this all together to complete the following procedure, which runs
in a logarithmic number of steps:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>fib-iter <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib-iter</span> a b p q count<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= count <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> b<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? count<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>         <span style="color: #a9a1e1;">(</span>fib-iter a
<span class="linenr"> 8: </span>                   b
<span class="linenr"> 9: </span>                   <span style="color: #ECBE7B;">&lt;??&gt;</span>      <span style="color: #525252;">; </span><span style="color: #525252;">compute p'</span>
<span class="linenr">10: </span>                   <span style="color: #ECBE7B;">&lt;??&gt;</span>      <span style="color: #525252;">; </span><span style="color: #525252;">compute q'</span>
<span class="linenr">11: </span>                   <span style="color: #51afef;">(</span>/ count <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>fib-iter <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* b q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                        <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* b p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                        p
<span class="linenr">15: </span>                        q
<span class="linenr">16: </span>                        <span style="color: #51afef;">(</span>- count <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbde4f52" class="outline-4">
<h4 id="orgbde4f52"><span class="section-number-4">2.31.2.</span> Diary</h4>
<div class="outline-text-4" id="text-2-31-2">
<p>
More succinctly put:
</p>

<p>
\[
    \text{Fib}_n \begin{cases}
        a \leftarrow a + b\\
        b \leftarrow a
    \end{cases}
\]
\[
    \text{Fib-iter}_{abpq} \begin{cases}
        a \leftarrow bq + aq + ap\\
        b \leftarrow bp + aq
    \end{cases}
\]
</p>

<p>
<code class="src src-scheme"><span style="color: #51afef;">(</span>T<span style="color: #51afef;">)</span></code> returns a transformation function based on the two numbers in
the attached list. so <code class="src src-scheme"><span style="color: #51afef;">(</span>T <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span></code> returns a fib function.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org3f8b955"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">T</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>a b<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>* b q<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>* a q<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>* a p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>          <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>* b p<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>* a q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">T-fib</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>T <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Repeatedly apply T functions:</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">Tr</span> f n<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>Tr-iter f n <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">Tr-iter</span> f n a b<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>      a
<span class="linenr">15: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>l <span style="color: #c678dd;">(</span>f a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>        <span style="color: #a9a1e1;">(</span>Tr-iter f <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>car l<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>cdr l<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
\text{T}<sub>pq</sub>: a,b\mapsto \begin{cases}
        a &larr; bq + aq + ap<br />
        b &larr; bp + aq
    \end{cases}
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org6c5a214"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;T-func&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;try-these&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>try-these <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>Tr <span style="color: #a9a1e1;">(</span>T <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr <span style="color: #99bb66;">(</span>iota <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">13</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">34</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">55</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orga8b1664" class="outline-4">
<h4 id="orga8b1664"><span class="section-number-4">2.31.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-31-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org889463a"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib-rec</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>fib-rec <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>                 <span style="color: #51afef;">(</span>fib-rec <span style="color: #c678dd;">(</span>- n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>fib-iter <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fib-iter</span> a b p q count<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= count <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> b<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? count<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>         <span style="color: #a9a1e1;">(</span>fib-iter a
<span class="linenr">13: </span>                   b
<span class="linenr">14: </span>                   <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* p p<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                      <span style="color: #c678dd;">(</span>* q q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>      <span style="color: #525252;">; </span><span style="color: #525252;">compute p'</span>
<span class="linenr">16: </span>                   <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* p q<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                      <span style="color: #c678dd;">(</span>* q q<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>                      <span style="color: #c678dd;">(</span>* q p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>      <span style="color: #525252;">; </span><span style="color: #525252;">compute q'</span>
<span class="linenr">19: </span>                   <span style="color: #51afef;">(</span>/ count <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>fib-iter <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* b q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>                        <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>* b p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* a q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span>                        p
<span class="linenr">23: </span>                        q
<span class="linenr">24: </span>                        <span style="color: #51afef;">(</span>- count <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">&ldquo;n&rdquo;</th>
<th scope="col" class="org-right">&ldquo;fib-rec&rdquo;</th>
<th scope="col" class="org-right">&ldquo;fib-iter&rdquo;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">5</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">8</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">13</td>
<td class="org-right">13</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">21</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">34</td>
<td class="org-right">34</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org639f31c" class="outline-3">
<h3 id="org639f31c"><span class="section-number-3">2.32.</span> 1.2.5: Greatest Common Divisor</h3>
<div class="outline-text-3" id="text-2-32">
<p>
A greatest common divisor (or GCD) for two integers is the largest integer that
divides both of them. A GCD can be quickly found by transforming the problem
like so: \[a \% b = r\]
</p>

<p>
\[\text{GCD}(a, b) = \text{GCD}(b, r)\]
</p>

<p>
This eventually produces a pair where the second number is 0. Then, the GCD is
the other number in the pair. This is Euclid&rsquo;s Algorithm.
</p>

<p>
\[\begin{aligned}\text{GCD}(206,40) &= \text{GCD}(40,6)\\ &=
            \text{GCD}(6,4)\\ &= \text{GCD}(4,2)\\ &~ \text{GCD}(2,0) ~
            2\end{aligned}\]
</p>

<blockquote>
<p>
<b>Lamé&rsquo;s Theorem:</b> If Euclid&rsquo;s Algorithm requires \(k\) steps to compute the
 GCD of some pair, then the smaller number in the pair must be greater than or
 equal to the \(k^{th}\)Fibonacci number.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgaec22df" class="outline-3">
<h3 id="orgaec22df"><span class="section-number-3">2.33.</span> Exercise 1.20: Inefficiency of normal-order evaluation</h3>
<div class="outline-text-3" id="text-2-33">
</div>

<div id="outline-container-orgdffd104" class="outline-4">
<h4 id="orgdffd104"><span class="section-number-4">2.33.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-33-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org9d05ddc"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= b <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      a
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>gcd b <span style="color: #a9a1e1;">(</span>remainder a b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org67e27fc" class="outline-4">
<h4 id="org67e27fc"><span class="section-number-4">2.33.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-33-2">
<p>
The process that a procedure generates is of course dependent on the rules used
by the interpreter. As an example, consider the iterative <code class="src src-scheme">gcd</code>
procedure given above. Suppose we were to interpret this procedure using
normal-order evaluation, as discussed in 1.1.5: The Substitution Model for Procedure Application. (The normal-order-evaluation
rule for <code class="src src-scheme">if</code> is described in Exercise 1.5.) Using the substitution
method (for normal order), illustrate the process generated in evaluating
<code class="src src-scheme"><span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span></code> and indicate the <code class="src src-scheme">remainder</code> operations that
are actually performed. How many <code class="src src-scheme">remainder</code> operations are actually
performed in the normal-order evaluation of <code class="src src-scheme"><span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span></code>? In the
applicative-order evaluation?
</p>
</div>
</div>

<div id="outline-container-org75bdc33" class="outline-4">
<h4 id="org75bdc33"><span class="section-number-4">2.33.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-33-3">
<p>
I struggled to understand this, but the key here is that normal-order evaluation
causes the unevaluated expressions to be duplicated, meaning they get evaluated
multiple times.
</p>
</div>

<ol class="org-ol">
<li><a id="org6ab679e"></a>Applicative order<br />
<div class="outline-text-5" id="text-2-33-3-1">
<div class="org-src-container">
<pre class="src src-scheme">call <span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
eval remainder before call
call <span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
eval remainder before call
call <span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
eval remainder before call
call <span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">=&gt; 2</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #525252;">;; </span><span style="color: #525252;">call gcd</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">;; </span><span style="color: #525252;">eval conditional</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #dd8844; font-weight: bold;">206</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">;; </span><span style="color: #525252;">recurse</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">encounter conditional</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #dd8844; font-weight: bold;">40</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span>
         <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">evaluate 1 remainder</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #dd8844; font-weight: bold;">40</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span>
         <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">recurse</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span>
     <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">encounter conditional</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
         <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">eval 2 remainder</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
         <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">recurse</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
     <span style="color: #c678dd;">(</span>remainder <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">encounter conditional</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
         <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">eval 4 remainders</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
         <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">recurse</span>
<span style="color: #51afef;">(</span>gcd <span style="color: #c678dd;">(</span>remainder <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
     <span style="color: #c678dd;">(</span>remainder <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">encounter conditional</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>remainder <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>remainder a  <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>remainder <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">eval 7 remainders</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>remainder <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>gcd <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>remainder a  <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>remainder <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">eval 4 remainders</span>
<span style="color: #51afef;">(</span>remainder <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #99bb66;">(</span>remainder <span style="color: #dd8844; font-weight: bold;">206</span> <span style="color: #dd8844; font-weight: bold;">40</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">=&gt; 2</span>
</pre>
</div>

<p>
So, in normal-order eval, remainder is called 18 times, while in applicative order
it&rsquo;s called 5 times.
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org0f87242" class="outline-3">
<h3 id="org0f87242"><span class="section-number-3">2.34.</span> 1.2.6: Example: Testing for Primality</h3>
<div class="outline-text-3" id="text-2-34">
<p>
Two algorithms for testing primality of numbers.
</p>

<ol class="org-ol">
<li>\(\Theta(\sqrt{n})\): Start with \(x = 2\), check for divisibility with
\(n\), if not then increment \(x\) by 1 and check again. If \(x^2 > n\) and
you haven&rsquo;t found a divisor, \(n\) is prime.</li>
<li>\(\Theta(\log n)\): Given a number \(n\), pick a random number \(a < n\) and
compute the remainder of \(a^n\) modulo \(n\). If the result is not equal to
\(a\), then \(n\) is certainly not prime. If it is \(a\), then chances are
good that \(n\) is prime. Now pick another random number \(a\) and test it
with the same method. If it also satisfies the equation, then we can be even
more confident that \(n\) is prime. By trying more and more values of \(a\),
we can increase our confidence in the result. This algorithm is known as the
Fermat test.</li>
</ol>

<blockquote>
<p>
<b>Fermat&rsquo;s Little Theorem:</b> If \(n\) is a prime number and \(a\) is any
 positive integer less than \(n\), then \(a\) raised to the \(n^{th}\) power
 is congruent to \(a\) modulo \(n\). [Two numbers are <i>congruent modulo</i> \(n\)
 if they both have the same remainder when divided by \(n\).]
</p>
</blockquote>

<p>
The Fermat test is a probabilistic algorithm, meaning its answer is likely to be
correct rather than guaranteed to be correct. Repeating the test increases the
likelihood of a correct answer.
</p>
</div>
</div>

<div id="outline-container-orgcbacc3a" class="outline-3">
<h3 id="orgcbacc3a"><span class="section-number-3">2.35.</span> Exercise 1.21</h3>
<div class="outline-text-3" id="text-2-35">
</div>

<div id="outline-container-orgd0dadfc" class="outline-4">
<h4 id="orgd0dadfc"><span class="section-number-4">2.35.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-35-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org9c4e601"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">smallest-divisor</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>find-divisor n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find-divisor</span> n test-divisor<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>square test-divisor<span style="color: #51afef;">)</span> n<span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 7: </span>         n<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>divides? test-divisor n<span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 9: </span>         test-divisor<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>find-divisor 
<span class="linenr">11: </span>               n 
<span class="linenr">12: </span>               <span style="color: #51afef;">(</span>+ test-divisor <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">divides?</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder b a<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge878ba2" class="outline-4">
<h4 id="orge878ba2"><span class="section-number-4">2.35.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-35-2">
<p>
Use the smallest-divisor procedure to find the smallest divisor of each of the
following numbers: 199, 1999, 19999.
</p>
</div>
</div>

<div id="outline-container-org8a2d92e" class="outline-4">
<h4 id="org8a2d92e"><span class="section-number-4">2.35.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-35-3">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;find-divisor-txt&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> smallest-divisor '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">199</span> <span style="color: #dd8844; font-weight: bold;">1999</span> <span style="color: #dd8844; font-weight: bold;">19999</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">199</td>
<td class="org-right">1999</td>
<td class="org-right">7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org447f37f" class="outline-3">
<h3 id="org447f37f"><span class="section-number-3">2.36.</span> Exercise 1.22</h3>
<div class="outline-text-3" id="text-2-36">
</div>

<div id="outline-container-org7a87589" class="outline-4">
<h4 id="org7a87589"><span class="section-number-4">2.36.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-36-1">
<p>
Most Lisp implementations include a primitive called <code class="src src-scheme">runtime</code> that
returns an integer that specifies the amount of time the system has been running
(measured, for example, in microseconds). The following
<code class="src src-scheme">timed-prime-test</code> procedure, when called with an integer \(n\),
prints \(n\) and checks to see if \(n\) is prime. If \(n\) is prime, the
procedure prints three asterisks followed by the amount of time used in
performing the test.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgdc13325"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;find-divisor-txt&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orga8e7893"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;prime-smallest-divisor&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">timed-prime-test</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>display n<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">Guile compatible \downarrow</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>start-prime-test n <span style="color: #99bb66;">(</span>get-internal-run-time<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">start-prime-test</span> n start-time<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>prime? n<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">begin</span>
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span>report-prime <span style="color: #51afef;">(</span>- <span style="color: #c678dd;">(</span>get-internal-run-time<span style="color: #c678dd;">)</span> 
<span class="linenr">10: </span>                       start-time<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>        n<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>      #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">report-prime</span> elapsed-time<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">" *** "</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>display elapsed-time<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Using this procedure, write a procedure <code class="src src-scheme">search-for-primes</code> that
checks the primality of consecutive odd integers in a specified range. Use your
procedure to find the three smallest primes larger than 1000; larger than
10,000; larger than 100,000; larger than 1,000,000. Note the time needed to test
each prime. Since the testing algorithm has order of growth of
\(\Theta(\sqrt{n})\), you should expect that testing for primes around 10,000
should take about \(\sqrt{10}\) times as long as testing for primes around 1000.
Do your timing data bear this out? How well do the data for 100,000 and
1,000,000 support the \(\Theta(\sqrt{n})\) prediction? Is your result compatible
with the notion that programs on your machine run in time proportional to the
number of steps required for the computation?
</p>
</div>
</div>

<div id="outline-container-orgd809196" class="outline-4">
<h4 id="orgd809196"><span class="section-number-4">2.36.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-36-2">
</div>

<ol class="org-ol">
<li><a id="org70c1060"></a>Part 1<br />
<div class="outline-text-5" id="text-2-36-2-1">
<p>
So this question is a little funky, because modern machines are so fast that the
single-run times can seriously vary.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org2a438cb"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;timed-prime-test-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">search-for-primes</span> minimum goal<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">m</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>even? minimum<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>                <span style="color: #a9a1e1;">(</span>+ minimum <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>                <span style="color: #a9a1e1;">(</span>minimum<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>search-for-primes-iter m '<span style="color: #99bb66;">()</span> goal<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">search-for-primes-iter</span> n lst goal<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= goal <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>      lst
<span class="linenr">10: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>x <span style="color: #c678dd;">(</span>timed-prime-test n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span>equal? x #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>            <span style="color: #51afef;">(</span>search-for-primes-iter <span style="color: #c678dd;">(</span>+ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cons x lst<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>- goal <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>            <span style="color: #51afef;">(</span>search-for-primes-iter <span style="color: #c678dd;">(</span>+ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> lst goal<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;search-primes-basic&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>lt1000-1 <span style="color: #a9a1e1;">(</span>search-for-primes <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"Primes &gt; 1000"</span> lt1000-1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">1001</span>
<span style="color: #dd8844; font-weight: bold;">1003</span>
<span style="color: #dd8844; font-weight: bold;">1005</span>
<span style="color: #dd8844; font-weight: bold;">1007</span>
<span style="color: #dd8844; font-weight: bold;">1009</span> *** <span style="color: #dd8844; font-weight: bold;">1651</span>
<span style="color: #dd8844; font-weight: bold;">1011</span>
<span style="color: #dd8844; font-weight: bold;">1013</span> *** <span style="color: #dd8844; font-weight: bold;">1425</span>
<span style="color: #dd8844; font-weight: bold;">1015</span>
<span style="color: #dd8844; font-weight: bold;">1017</span>
<span style="color: #dd8844; font-weight: bold;">1019</span> *** <span style="color: #dd8844; font-weight: bold;">1375</span>
</pre>
</div>

<p>
There&rsquo;s proof it works. And here are the answers to the question:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;search-primes-basic&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>lt1000-1 <span style="color: #a9a1e1;">(</span>search-for-primes <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      <span style="color: #99bb66;">(</span>lt10000-1 <span style="color: #a9a1e1;">(</span>search-for-primes <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>lt100000-1 <span style="color: #a9a1e1;">(</span>search-for-primes <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>      <span style="color: #99bb66;">(</span>lt100000000-1 <span style="color: #a9a1e1;">(</span>search-for-primes <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>list
<span class="linenr"> 7: </span>   <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"Primes &gt; 1000"</span> <span style="color: #a9a1e1;">(</span>reverse lt1000-1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>   <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"Primes &gt; 10000"</span> <span style="color: #a9a1e1;">(</span>reverse lt10000-1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>   <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"Primes &gt; 100000"</span> <span style="color: #a9a1e1;">(</span>reverse lt100000-1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>   <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"Primes &gt; 100000000"</span> <span style="color: #a9a1e1;">(</span>reverse lt100000000-1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>   <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Primes &gt; 1000</td>
<td class="org-left">(1009 1013 1019)</td>
</tr>

<tr>
<td class="org-left">Primes &gt; 10000</td>
<td class="org-left">(10007 10009 10037)</td>
</tr>

<tr>
<td class="org-left">Primes &gt; 100000</td>
<td class="org-left">(100003 100019 100043)</td>
</tr>

<tr>
<td class="org-left">Primes &gt; 100000000</td>
<td class="org-left">(1000003 1000033 1000037)</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="org12834b7"></a>Part 2<br />
<div class="outline-text-5" id="text-2-36-2-2">
<p>
Repeatedly re-running, it I see it occasionally jump to twice the time. I&rsquo;m not
happy with this, so I&rsquo;m going to refactor to use the <code class="src src-scheme">mattbench2</code>
utility from the root of the project folder.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org026ed17"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mattbench2</span> f n<span style="color: #c678dd;">)</span>
  <span style="color: #525252;">;; </span><span style="color: #525252;">Executes "f" for n times, and returns how long it took.</span>
  <span style="color: #525252;">;; </span><span style="color: #525252;">f is a lambda that takes no arguments, a.k.a. a "thunk"</span>
  
  <span style="color: #525252;">;; </span><span style="color: #525252;">Returns a list with car(last execution results) and cadr(time taken divided by iterations n)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">time-getter</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>get-internal-run-time<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">start-time</span> <span style="color: #99bb66;">(</span>time-getter<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">how-long</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>time-getter<span style="color: #a9a1e1;">)</span> start-time<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> i<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&lt;= i <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>f<span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">return the results of the last function call</span>
        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>- i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>iter n<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">result of last call of f</span>
        <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>how-long<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* n <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;; </span><span style="color: #525252;">Divide by iterations so changed n has no effect</span>
</pre>
</div>

<p>
I&rsquo;m going to get some more precise times. First, I need a prime searching
variant that doesn&rsquo;t bother benchmarking. This will call <code class="src src-scheme">prime?</code>,
which will be bound later since we&rsquo;ll be trying different methods.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org824940f"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">search-for-primes</span> minimum goal<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">m</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>even? minimum<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 3: </span>                <span style="color: #a9a1e1;">(</span>+ minimum <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>                <span style="color: #a9a1e1;">(</span>minimum<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>search-for-primes-iter m '<span style="color: #99bb66;">()</span> goal<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">search-for-primes-iter</span> n lst goal<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= goal <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      lst
<span class="linenr"> 9: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>x <span style="color: #c678dd;">(</span>prime? n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span>equal? x #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>            <span style="color: #51afef;">(</span>search-for-primes-iter <span style="color: #c678dd;">(</span>+ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cons n lst<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>- goal <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>            <span style="color: #51afef;">(</span>search-for-primes-iter <span style="color: #c678dd;">(</span>+ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> lst goal<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I can benchmark these functions like so:
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgaec4c05"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;prime-smallest-divisor&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;search-for-primes-untimed&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">benchmark-iterations</span> <span style="color: #dd8844; font-weight: bold;">1000000</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">testit</span> f<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span>print-row
<span class="linenr">14: </span> <span style="color: #c678dd;">(</span>testit search-for-primes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Here are the results (run externally from Org-Mode):
</p>

<table id="org9748bd6" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">5425.223086</td>
<td class="org-right">20772.332491</td>
<td class="org-right">53577.240193</td>
<td class="org-right">121986.712395</td>
</tr>
</tbody>
</table>


<div id="orga3d9015" class="figure">
<p><img src="1/fig/1-22-1.png" alt="1-22-1.png" />
</p>
</div>

<p>
The plot for the square root function doesn&rsquo;t quite fit the real one and I&rsquo;m not
sure where the fault lies. I don&rsquo;t struggle to understand things like &ldquo;this
algorithm is slower than this other one,&rdquo; but when asked to find or prove the
\(\Theta\) notation I&rsquo;m pretty clueless;
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org829598e" class="outline-3">
<h3 id="org829598e"><span class="section-number-3">2.37.</span> Exercise 1.23</h3>
<div class="outline-text-3" id="text-2-37">
</div>

<div id="outline-container-orgda09c63" class="outline-4">
<h4 id="orgda09c63"><span class="section-number-4">2.37.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-37-1">
<p>
The <code class="src src-scheme">smallest-divisor</code> procedure shown at the start of this section
does lots of needless testing: After it checks to see if the number is divisible
by 2 there is no point in checking to see if it is divisible by any larger even
numbers. This suggests that the values used for test-divisor should not be 2, 3,
4, 5, 6, &hellip;, but rather 2, 3, 5, 7, 9, &hellip;. To implement this change,
define a procedure <code class="src src-scheme">next</code> that returns 3 if its input is equal to 2
and otherwise returns its input plus 2. Modify the smallest-divisor procedure to
use <code class="src src-scheme"><span style="color: #51afef;">(</span>next test-divisor<span style="color: #51afef;">)</span></code> instead of <code class="src src-scheme"><span style="color: #51afef;">(</span>+ test-divisor <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span></code>.
With <code class="src src-scheme">timed-prime-test</code> incorporating this modified version of
<code class="src src-scheme">smallest-divisor</code>, run the test for each of the 12 primes found in
Exercise 1.22. Since this modification halves the number of test steps, you
should expect it to run about twice as fast. Is this expectation confirmed? If
not, what is the observed ratio of the speeds of the two algorithms, and how do
you explain the fact that it is different from 2?
</p>
</div>
</div>

<div id="outline-container-org0e6e3cc" class="outline-4">
<h4 id="org0e6e3cc"><span class="section-number-4">2.37.2.</span> A Comedy of Error (just the one)</h4>
<div class="outline-text-4" id="text-2-37-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org8025fcb"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">smallest-divisor</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>find-divisor n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">next</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #dd8844; font-weight: bold;">3</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>+ n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find-divisor</span> n test-divisor<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>square test-divisor<span style="color: #51afef;">)</span> n<span style="color: #a9a1e1;">)</span> 
<span class="linenr">12: </span>         n<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>divides? test-divisor n<span style="color: #a9a1e1;">)</span> 
<span class="linenr">14: </span>         test-divisor<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>find-divisor 
<span class="linenr">16: </span>               n 
<span class="linenr">17: </span>               <span style="color: #51afef;">(</span>next test-divisor<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">divides?</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder b a<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org7c3ee69"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;find-divisor-faster&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;search-for-primes-untimed&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">benchmark-iterations</span> <span style="color: #dd8844; font-weight: bold;">1000000</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">testit</span> f<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>print-row
<span class="linenr">16: </span> <span style="color: #c678dd;">(</span>testit search-for-primes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table id="org093ecc0" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">6456.538118</td>
<td class="org-right">25550.757304</td>
<td class="org-right">66746.041644</td>
<td class="org-right">148505.580638</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">min</td>
<td class="org-right">(+1)</td>
<td class="org-right">(next)</td>
</tr>

<tr>
<td class="org-right">1000</td>
<td class="org-right">5507.42497</td>
<td class="org-right">6366.99462</td>
</tr>

<tr>
<td class="org-right">10000</td>
<td class="org-right">20913.71497</td>
<td class="org-right">24845.9193</td>
</tr>

<tr>
<td class="org-right">100000</td>
<td class="org-right">53778.74737</td>
<td class="org-right">64756.73693</td>
</tr>

<tr>
<td class="org-right">1000000</td>
<td class="org-right">122135.60511</td>
<td class="org-right">143869.63561</td>
</tr>
</tbody>
</table>


<div id="orgc6d6b50" class="figure">
<p><img src="1/fig/1-22-2.png" alt="1-22-2.png" />
</p>
</div>

<p>
So it&rsquo;s <i>slower</i> than before. Why?
</p>

<p>
Oh, that&rsquo;s why.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">next</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
      <span style="color: #dd8844; font-weight: bold;">3</span>
      <span style="color: #99bb66;">(</span>+ n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">&lt;-- D'oh.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4eb99eb" class="outline-4">
<h4 id="org4eb99eb"><span class="section-number-4">2.37.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-37-3">
<p>
Ok, let&rsquo;s try that again.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org0db85d3"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">smallest-divisor</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>find-divisor n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">next</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #dd8844; font-weight: bold;">3</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>+ n <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find-divisor</span> n test-divisor<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>square test-divisor<span style="color: #51afef;">)</span> n<span style="color: #a9a1e1;">)</span> 
<span class="linenr">12: </span>         n<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>divides? test-divisor n<span style="color: #a9a1e1;">)</span> 
<span class="linenr">14: </span>         test-divisor<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>find-divisor 
<span class="linenr">16: </span>               n 
<span class="linenr">17: </span>               <span style="color: #51afef;">(</span>next test-divisor<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">divides?</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder b a<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org91ac028"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;find-divisor-faster-real&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;search-for-primes-untimed&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">benchmark-iterations</span> <span style="color: #dd8844; font-weight: bold;">500000</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">testit</span> f<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>print-row
<span class="linenr">16: </span> <span style="color: #c678dd;">(</span>testit search-for-primes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table id="orge7e4402" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">3863.7424</td>
<td class="org-right">13519.209814</td>
<td class="org-right">33520.676384</td>
<td class="org-right">73005.539932</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">min</td>
<td class="org-right">(+1)</td>
<td class="org-right">(next-broken)</td>
<td class="org-right">(next-fixed)</td>
</tr>

<tr>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
</tr>

<tr>
<td class="org-right">1000</td>
<td class="org-right">5425.223086</td>
<td class="org-right">6456.538118</td>
<td class="org-right">3863.7424</td>
</tr>

<tr>
<td class="org-right">10000</td>
<td class="org-right">20772.332491</td>
<td class="org-right">25550.757304</td>
<td class="org-right">13519.209814</td>
</tr>

<tr>
<td class="org-right">100000</td>
<td class="org-right">53577.240193</td>
<td class="org-right">66746.041644</td>
<td class="org-right">33520.676384</td>
</tr>

<tr>
<td class="org-right">1000000</td>
<td class="org-right">121986.712395</td>
<td class="org-right">148505.580638</td>
<td class="org-right">73005.539932</td>
</tr>
</tbody>
</table>


<div id="org195a70d" class="figure">
<p><img src="1/fig/1-22-3.png" alt="1-22-3.png" />
</p>
</div>

<p>
I had a lot of trouble getting this one to compile, I have to restart Emacs in
order to get it to render.
</p>

<p>
Anyways, there&rsquo;s the speedup that was expected. Let&rsquo;s compare the ratios.
</p>

<p>
Defining a new average that takes arbitrary numbers of arguments:
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org7aff840"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">average</span> . args<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>len <span style="color: #51afef;">(</span>length args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>apply + args<span style="color: #a9a1e1;">)</span> len<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Using it for percentage comparisons:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;average-varargs&gt;&gt;</span>
<span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">"% speedup for broken (next)"</span>
            <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>format #f <span style="color: #99bb66;">"~2$%"</span>
                          <span style="color: #51afef;">(</span>apply average
                                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                                      <span style="color: #99bb66;">(</span>car smd<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car smdf<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                  #nil<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
      <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">"% speedup for real (next)"</span>
            <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>format #f <span style="color: #99bb66;">"~2$%"</span>
                          <span style="color: #51afef;">(</span>apply average
                                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                                      <span style="color: #99bb66;">(</span>car smd<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car smdff<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                  #nil<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">% speedup for broken (next)</td>
<td class="org-right">81.93%</td>
</tr>

<tr>
<td class="org-left">% speedup for real (next)</td>
<td class="org-right">155.25%</td>
</tr>
</tbody>
</table>

<p>
Since this changed algorithm cuts out almost half of the steps, you might expect
something more like a 200% speedup. Let&rsquo;s try optimizing it further. Two observations:
</p>

<ol class="org-ol">
<li>The condition <code class="src src-scheme"><span style="color: #51afef;">(</span>divides? <span style="color: #dd8844; font-weight: bold;">2</span> n<span style="color: #51afef;">)</span></code> only needs to be run once at the
start of the program.</li>
<li>Because it only needs to be run once, it doesn&rsquo;t need to be a separate
function at all.</li>
</ol>

<div class="org-src-container">
<pre class="src src-scheme" id="org74962bd"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">smallest-divisor</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>divides? <span style="color: #dd8844; font-weight: bold;">2</span> n<span style="color: #99bb66;">)</span>                  <span style="color: #525252;">;; </span><span style="color: #525252;">check for division by 2</span>
<span class="linenr"> 4: </span>      <span style="color: #dd8844; font-weight: bold;">2</span>
<span class="linenr"> 5: </span>      <span style="color: #99bb66;">(</span>find-divisor n <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>            <span style="color: #525252;">;; </span><span style="color: #525252;">start find-divisor at 3</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find-divisor</span> n test-divisor<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>square test-divisor<span style="color: #51afef;">)</span> n<span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 9: </span>         n<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>divides? test-divisor n<span style="color: #a9a1e1;">)</span> 
<span class="linenr">11: </span>         test-divisor<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>find-divisor 
<span class="linenr">13: </span>               n 
<span class="linenr">14: </span>               <span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">2</span> test-divisor<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">just increase by 2</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">divides?</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>remainder b a<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org67525b2"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;find-divisor-faster-real2&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;search-for-primes-untimed&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">benchmark-iterations</span> <span style="color: #dd8844; font-weight: bold;">500000</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">testit</span> f<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>print-row
<span class="linenr">16: </span> <span style="color: #c678dd;">(</span>testit search-for-primes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<table id="orga7e9243" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">3151.259574</td>
<td class="org-right">11245.20428</td>
<td class="org-right">27803.067944</td>
<td class="org-right">61997.275154</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">min</td>
<td class="org-right">(+1)</td>
<td class="org-right">(next-broken)</td>
<td class="org-right">(next-fixed)</td>
<td class="org-right">integrated</td>
</tr>

<tr>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
</tr>

<tr>
<td class="org-right">1000</td>
<td class="org-right">5425.223086</td>
<td class="org-right">6456.538118</td>
<td class="org-right">3863.7424</td>
<td class="org-right">3151.259574</td>
</tr>

<tr>
<td class="org-right">10000</td>
<td class="org-right">20772.332491</td>
<td class="org-right">25550.757304</td>
<td class="org-right">13519.209814</td>
<td class="org-right">11245.20428</td>
</tr>

<tr>
<td class="org-right">100000</td>
<td class="org-right">53577.240193</td>
<td class="org-right">66746.041644</td>
<td class="org-right">33520.676384</td>
<td class="org-right">27803.067944</td>
</tr>

<tr>
<td class="org-right">1000000</td>
<td class="org-right">121986.712395</td>
<td class="org-right">148505.580638</td>
<td class="org-right">73005.539932</td>
<td class="org-right">61997.275154</td>
</tr>
</tbody>
</table>


<div id="org0682e45" class="figure">
<p><img src="1/fig/1-22-4.png" alt="1-22-4.png" />
</p>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">% speedup for broken (next)</td>
<td class="org-right">81.93%</td>
</tr>

<tr>
<td class="org-left">% speedup for real (next)</td>
<td class="org-right">155.25%</td>
</tr>

<tr>
<td class="org-left">% speedup for optimized</td>
<td class="org-right">186.59%</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgfcca5ef" class="outline-3">
<h3 id="orgfcca5ef"><span class="section-number-3">2.38.</span> Exercise 1.24</h3>
<div class="outline-text-3" id="text-2-38">
</div>

<div id="outline-container-org0788ee6" class="outline-4">
<h4 id="org0788ee6"><span class="section-number-4">2.38.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-38-1">
<div class="org-src-container">
<pre class="src src-scheme" id="orgc7ff5df"><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expmod</span> base exp m<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= exp <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? exp<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>remainder 
          <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>expmod base <span style="color: #99bb66;">(</span>/ exp <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          m<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
         <span style="color: #a9a1e1;">(</span>remainder 
          <span style="color: #51afef;">(</span>* base <span style="color: #c678dd;">(</span>expmod base <span style="color: #99bb66;">(</span>- exp <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          m<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgc8559c6"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fermat-test</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try-it</span> a<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>= <span style="color: #a9a1e1;">(</span>expmod a n n<span style="color: #a9a1e1;">)</span> a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>try-it <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>random <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org7efeb98"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fast-prime?</span> n times<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= times <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> #t<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>fermat-test n<span style="color: #a9a1e1;">)</span> 
         <span style="color: #a9a1e1;">(</span>fast-prime? n <span style="color: #51afef;">(</span>- times <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> #f<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4424b5" class="outline-4">
<h4 id="orga4424b5"><span class="section-number-4">2.38.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-38-2">
<p>
Modify the <code class="src src-scheme">timed-prime-test</code> procedure of <a href="#org447f37f">2.36</a> to use
<code class="src src-scheme">fast-prime?</code> (the Fermat method), and test each of the 12 primes you
found in that exercise. Since the Fermat test has \(\Theta(\text{log}n)\)
growth, how would you expect the time to test primes near 1,000,000 to compare
with the time needed to test primes near 1000? Do your data bear this out? Can
you explain any discrepancy you find?
</p>
</div>
</div>

<div id="outline-container-org0906e3c" class="outline-4">
<h4 id="org0906e3c"><span class="section-number-4">2.38.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-38-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org842b0f5"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;expmod&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;fermat-test&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;fast-prime&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">fermat-iterations</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>fast-prime? n fermat-iterations<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;search-for-primes-untimed&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">benchmark-iterations</span> <span style="color: #dd8844; font-weight: bold;">500000</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">testit</span> f<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>print-row
<span class="linenr">19: </span> <span style="color: #c678dd;">(</span>testit search-for-primes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table id="org42c82c4" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">11175.799722</td>
<td class="org-right">23518.62116</td>
<td class="org-right">32150.745642</td>
<td class="org-right">32679.766448</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">min</td>
<td class="org-right">(+1)</td>
<td class="org-right">integrated</td>
<td class="org-right">fermat (2 guesses)</td>
</tr>

<tr>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
</tr>

<tr>
<td class="org-right">1000</td>
<td class="org-right">5425.223086</td>
<td class="org-right">3151.259574</td>
<td class="org-right">11175.799722</td>
</tr>

<tr>
<td class="org-right">10000</td>
<td class="org-right">20772.332491</td>
<td class="org-right">11245.20428</td>
<td class="org-right">23518.62116</td>
</tr>

<tr>
<td class="org-right">100000</td>
<td class="org-right">53577.240193</td>
<td class="org-right">27803.067944</td>
<td class="org-right">32150.745642</td>
</tr>

<tr>
<td class="org-right">1000000</td>
<td class="org-right">121986.712395</td>
<td class="org-right">61997.275154</td>
<td class="org-right">32679.766448</td>
</tr>
</tbody>
</table>


<div id="org7407abc" class="figure">
<p><img src="1/fig/1-24-1.png" alt="1-24-1.png" />
</p>
</div>

<p>
It definitely looks to be advancing much slower than the other methods. I&rsquo;d like
to see more of the function.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org3afe38f"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;find-divisor-faster-real&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;search-for-primes-untimed&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">benchmark-iterations</span> <span style="color: #dd8844; font-weight: bold;">100000</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">testit</span> f<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>print-row
<span class="linenr">22: </span> <span style="color: #c678dd;">(</span>testit search-for-primes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org5408ab0"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;expmod&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;fermat-test&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;fast-prime&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">fermat-iterations</span> <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>fast-prime? n fermat-iterations<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;search-for-primes-untimed&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">benchmark-iterations</span> <span style="color: #dd8844; font-weight: bold;">100000</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">testit</span> f<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">10000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">100000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>        <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>f <span style="color: #dd8844; font-weight: bold;">1000000000000</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> benchmark-iterations<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>print-row
<span class="linenr">25: </span> <span style="color: #c678dd;">(</span>testit search-for-primes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgc0f5253" class="figure">
<p><img src="1/fig/1-24-2.png" alt="1-24-2.png" />
</p>
</div>

<p>
For the life of me I have no idea what that bump is. Maybe it needs more
aggressive bignum processing there?
</p>
</div>
</div>
</div>

<div id="outline-container-orgae7377a" class="outline-3">
<h3 id="orgae7377a"><span class="section-number-3">2.39.</span> Exercise 1.25</h3>
<div class="outline-text-3" id="text-2-39">
</div>

<div id="outline-container-org10e56b5" class="outline-4">
<h4 id="org10e56b5"><span class="section-number-4">2.39.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-39-1">
<p>
Alyssa P. Hacker complains that we went to a lot of extra work in writing
<code class="src src-scheme">expmod</code>. After all, she says, since we already know how to compute
exponentials, we could have simply written
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expmod</span> base exp m<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>remainder <span style="color: #99bb66;">(</span>fast-expt base exp<span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Is she correct? Would this procedure serve as well for our fast prime tester?
Explain.
</p>
</div>
</div>

<div id="outline-container-orgfb73cd6" class="outline-4">
<h4 id="orgfb73cd6"><span class="section-number-4">2.39.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-39-2">
<p>
In Alyssa&rsquo;s version of <code class="src src-scheme">expmod</code>, the result of the
<code class="src src-scheme">fast-expt</code> operation is <i>extremely</i> large. For example, in the
process of checking for divisors of 1,001, the number 455 will be tried.
<code class="src src-scheme"><span style="color: #51afef;">(</span>expt <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span></code> produces an integer 2,661 digits long. This is just
one of the thousands of exponentiations that <code class="src src-scheme">smallest-divisor</code> will
perform. It&rsquo;s best to avoid this, so we use to our advantage the fact that we
only need to know the remainder of the exponentiations. <code class="src src-scheme">expmod</code>
breaks down the exponentiation into smaller steps and performs
<code class="src src-scheme">remainder</code> after every step, significantly reducing the memory
requirements.
</p>

<p>
As an example, let&rsquo;s trace (some of) the execution of <code class="src src-scheme"><span style="color: #51afef;">(</span>expmod <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">1001</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span></code>:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>expmod <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">1001</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span>
&gt;  <span style="color: #51afef;">(</span>even? <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span>
&gt;  #f
&gt;  <span style="color: #51afef;">(</span>expmod <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span>
&gt;  &gt;  <span style="color: #51afef;">(</span>even? <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #51afef;">)</span>
&gt;  &gt;  #t
&gt;  &gt;  <span style="color: #51afef;">(</span>expmod <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">500</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  <span style="color: #51afef;">(</span>even? <span style="color: #dd8844; font-weight: bold;">500</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  #t
<span style="color: #525252;">;; </span><span style="color: #525252;">...</span>
&gt;  &gt;  &gt;  x11 <span style="color: #51afef;">(</span>expmod <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  x11 &gt;  <span style="color: #51afef;">(</span>even? <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  x11 &gt;  #t
&gt;  &gt;  &gt;  x11 &gt;  <span style="color: #51afef;">(</span>expmod <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  x11 &gt;  &gt;  <span style="color: #51afef;">(</span>even? <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  x11 &gt;  &gt;  #f
&gt;  &gt;  &gt;  x11 &gt;  &gt;  <span style="color: #51afef;">(</span>expmod <span style="color: #dd8844; font-weight: bold;">455</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1001</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  x11 &gt;  &gt;  <span style="color: #dd8844; font-weight: bold;">1</span>
&gt;  &gt;  &gt;  x11 &gt;  <span style="color: #dd8844; font-weight: bold;">455</span>
&gt;  &gt;  &gt;  x11 &gt;  <span style="color: #51afef;">(</span>square <span style="color: #dd8844; font-weight: bold;">455</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  x11 &gt;  <span style="color: #dd8844; font-weight: bold;">207025</span>
&gt;  &gt;  &gt;  x11 <span style="color: #dd8844; font-weight: bold;">819</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">...</span>
&gt;  &gt;  &gt;  <span style="color: #51afef;">(</span>square <span style="color: #dd8844; font-weight: bold;">364</span><span style="color: #51afef;">)</span>
&gt;  &gt;  &gt;  <span style="color: #dd8844; font-weight: bold;">132496</span>
&gt;  &gt;  <span style="color: #dd8844; font-weight: bold;">364</span>
&gt;  &gt;  <span style="color: #51afef;">(</span>square <span style="color: #dd8844; font-weight: bold;">364</span><span style="color: #51afef;">)</span>
&gt;  &gt;  <span style="color: #dd8844; font-weight: bold;">132496</span>
&gt;  <span style="color: #dd8844; font-weight: bold;">364</span>
<span style="color: #dd8844; font-weight: bold;">455</span>
</pre>
</div>

<p>
You can see that the numbers remain quite manageable throughout this process. So
taking these extra steps actually leads to an algorithm that performs better.
</p>
</div>
</div>
</div>

<div id="outline-container-org47d703a" class="outline-3">
<h3 id="org47d703a"><span class="section-number-3">2.40.</span> Exercise 1.26</h3>
<div class="outline-text-3" id="text-2-40">
</div>

<div id="outline-container-org8e2720e" class="outline-4">
<h4 id="org8e2720e"><span class="section-number-4">2.40.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-40-1">
<p>
Louis Reasoner is having great difficulty doing Exercise 1.24. His
<code class="src src-scheme">fast-prime?</code> test seems to run more slowly than his
<code class="src src-scheme">prime?</code> test. Louis calls his friend Eva Lu Ator over to help. When
they examine Louis&rsquo;s code, they find that he has rewritten the
<code class="src src-scheme">expmod</code> procedure to use an explicit multiplication, rather than
calling <code class="src src-scheme">square</code>:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expmod</span> base exp m<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= exp <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? exp<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>         <span style="color: #a9a1e1;">(</span>remainder 
<span class="linenr"> 5: </span>          <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>expmod base <span style="color: #99bb66;">(</span>/ exp <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">&lt;== hmm.</span>
<span class="linenr"> 6: </span>             <span style="color: #c678dd;">(</span>expmod base <span style="color: #99bb66;">(</span>/ exp <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>          m<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr"> 9: </span>         <span style="color: #a9a1e1;">(</span>remainder 
<span class="linenr">10: </span>          <span style="color: #51afef;">(</span>* base 
<span class="linenr">11: </span>             <span style="color: #c678dd;">(</span>expmod base <span style="color: #99bb66;">(</span>- exp <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>          m<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
&ldquo;I don&rsquo;t see what difference that could make,&rdquo; says Louis. &ldquo;I do.&rdquo; says Eva. &ldquo;By
writing the procedure like that, you have transformed the \(\Theta(\log n)\)
process into a \(\Theta(n)\) process.&rdquo; Explain.
</p>
</div>
</div>

<div id="outline-container-org479f63d" class="outline-4">
<h4 id="org479f63d"><span class="section-number-4">2.40.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-40-2">
<p>
Making the same function call twice isn&rsquo;t the same as using a variable twice &#x2013;
Louis&rsquo; version doubles the work, having two processes solving the exact same
problem. Since the number of processes used increases exponentially, this turns
\(\log n\) into \(n\).
</p>
</div>
</div>
</div>

<div id="outline-container-orgd4ba6c3" class="outline-3">
<h3 id="orgd4ba6c3"><span class="section-number-3">2.41.</span> Exercise 1.27</h3>
<div class="outline-text-3" id="text-2-41">
</div>

<div id="outline-container-orga752353" class="outline-4">
<h4 id="orga752353"><span class="section-number-4">2.41.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-41-1">
<p>
Demonstrate that the Carmichael numbers listed in Footnote 1.47 really do fool
the Fermat test. That is, write a procedure that takes an integer \(n\) and
tests whether \(a^n\) is congruent to \(a\) modulo \(n\) for every \(a < n\),
and try your procedure on the given Carmichael numbers.
</p>
<table id="orgcd74560" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">561</td>
<td class="org-right">1105</td>
<td class="org-right">1729</td>
<td class="org-right">2465</td>
<td class="org-right">2821</td>
<td class="org-right">6601</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgf46b4b8" class="outline-4">
<h4 id="orgf46b4b8"><span class="section-number-4">2.41.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-41-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orga08cef8"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;expmod&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">car-test</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">check</span> a<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>    <span style="color: #99bb66;">(</span>= <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>expt a n<span style="color: #51afef;">)</span> n<span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>       <span style="color: #a9a1e1;">(</span>remainder <span style="color: #51afef;">(</span>modulo a n<span style="color: #51afef;">)</span> n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>every check
<span class="linenr">7: </span>           <span style="color: #99bb66;">(</span>cddr <span style="color: #a9a1e1;">(</span>iota n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org1f54600"><span style="color: #ECBE7B;">&lt;&lt;car-test&gt;&gt;</span>
<span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>car-test <span style="color: #dd8844; font-weight: bold;">12</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">&lt;== false (not prime)</span>
      <span style="color: #c678dd;">(</span>car-test <span style="color: #dd8844; font-weight: bold;">1009</span><span style="color: #c678dd;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">&lt;== true  (real prime)</span>
      <span style="color: #c678dd;">(</span>car-test <span style="color: #dd8844; font-weight: bold;">561</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">&lt;== true  (not prime,</span>
                     <span style="color: #525252;">;      </span><span style="color: #525252;">Carmichael number)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org07cc73d" class="outline-3">
<h3 id="org07cc73d"><span class="section-number-3">2.42.</span> Exercise 1.28</h3>
<div class="outline-text-3" id="text-2-42">
</div>

<div id="outline-container-org6b13c95" class="outline-4">
<h4 id="org6b13c95"><span class="section-number-4">2.42.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-42-1">
<p>
One variant of the Fermat test that cannot be fooled is called the
<b><b>Miller-Rabin test</b></b> (Miller 1976; Rabin 1980). This starts from an alternate
form of Fermat&rsquo;s Little Theorem, which states that if \( n \) is a prime number
and \( a \) is any positive integer less than \( n \), then \( a \) raised to
the \( (n-1) \) -st power is congruent to 1 modulo \( n \). To test the
primality of a number \( n \) by the Miller-Rabin test, we pick a random number
\( a<n \) and raise \( a \) to the \( (n-1) \) -st power modulo \( n \) using
the <code class="src src-scheme">expmod</code> procedure. However, whenever we perform the squaring step
in <code class="src src-scheme">expmod</code>, we check to see if we have discovered a &ldquo;nontrivial
square root of 1 modulo \( n \),&rdquo; that is, a number not equal to 1 or \( n-1 \)
whose square is equal to 1 modulo \( n \). It is possible to prove that if such
a nontrivial square root of 1 exists, then \( n \) is not prime. It is also
possible to prove that if \( n \) is an odd number that is not prime, then, for
at least half the numbers \( a<n \), computing \( an-1 \) in this way will
reveal a nontrivial square root of 1 modulo \( n \). (This is why the
Miller-Rabin test cannot be fooled.) Modify the <code class="src src-scheme">expmod</code> procedure to
signal if it discovers a nontrivial square root of 1, and use this to implement
the Miller-Rabin test with a procedure analogous to fermat-test. Check your
procedure by testing various known primes and non-primes. Hint: One convenient
way to make <code class="src src-scheme">expmod</code> signal is to have it return 0.
</p>
</div>
</div>

<div id="outline-container-orge130868" class="outline-4">
<h4 id="orge130868"><span class="section-number-4">2.42.2.</span> Analysis</h4>
<div class="outline-text-4" id="text-2-42-2">
<p>
For the sake of verifying this, I want to get a bigger list of primes and
Carmichael numbers to verify against. I&rsquo;ll save them using Guile&rsquo;s built in
read/write functions that save Lisp lists to text:
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgc185a0f"><span style="color: #ECBE7B;">&lt;&lt;find-divisor-faster-real&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">call-with-output-file</span> <span style="color: #99bb66;">"Data/primes-1k_to_1mil.txt"</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>port<span style="color: #99bb66;">)</span>
  <span style="color: #99bb66;">(</span>write <span style="color: #a9a1e1;">(</span>filter prime? <span style="color: #51afef;">(</span>iota <span style="color: #c678dd;">(</span>- <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         port<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org58db623"><span style="color: #525252;">;; </span><span style="color: #525252;">fermat prime test but checks *every* value from 2 to n-1</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fermat-prime?</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> a<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= a n<span style="color: #a9a1e1;">)</span>
        #f
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span>expmod a n n<span style="color: #c678dd;">)</span> a<span style="color: #51afef;">)</span>
            #t
            <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>iter <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgfdbbddc"><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">&lt;&lt;expmod&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;fermat-prime?&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;find-divisor-faster-real&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">call-with-output-file</span> <span style="color: #99bb66;">"Data/carmichael-verification.txt"</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>port<span style="color: #99bb66;">)</span>
     <span style="color: #99bb66;">(</span>write <span style="color: #a9a1e1;">(</span>filter
             <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>fermat-prime? x<span style="color: #99bb66;">)</span>
                        <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>prime? x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>iota <span style="color: #c678dd;">(</span>- <span style="color: #dd8844; font-weight: bold;">1000000</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            port<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This will be useful in various future functions:
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org6e98db3"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">list-of-primes</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">call-with-input-file</span> <span style="color: #99bb66;">"Data/primes-1k_to_1mil.txt"</span> read<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">list-of-carmichaels</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">call-with-input-file</span> <span style="color: #99bb66;">"Data/carmichael.txt"</span> read<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">&lt;&lt;expmod&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;fermat-prime?&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;find-divisor-faster-real&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>= n <span style="color: #99bb66;">(</span>smallest-divisor n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">&lt;&lt;get-lists-of-primes&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">prime-is-working</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>and-map prime? list-of-primes<span style="color: #99bb66;">)</span>
       <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>and-map prime? list-of-carmichaels<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>format #t <span style="color: #99bb66;">"(prime?) is working: ~a~%"</span>
        <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> prime-is-working
            <span style="color: #99bb66;">"Yes"</span>
            <span style="color: #99bb66;">"No"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">fermat-is-vulnerable</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>and-map fermat-prime? list-of-primes<span style="color: #99bb66;">)</span>
       <span style="color: #99bb66;">(</span>and-map fermat-prime? list-of-carmichaels<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>format #t <span style="color: #99bb66;">"(fermat-prime?) is vulnerable: ~a~%"</span>
        <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> fermat-is-vulnerable
            <span style="color: #99bb66;">"Yes"</span>
            <span style="color: #99bb66;">"No"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgd91c08f">
(prime?) is working: Yes
(fermat-prime?) is vulnerable: Yes
</pre>
</div>
</div>

<div id="outline-container-orga50d3bb" class="outline-4">
<h4 id="orga50d3bb"><span class="section-number-4">2.42.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-42-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org8ddcfb3"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expmod-mr</span> base exp m<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= exp <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? exp<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>sqr
<span class="linenr"> 6: </span>                <span style="color: #99bb66;">(</span>square <span style="color: #a9a1e1;">(</span>expmod-mr base <span style="color: #51afef;">(</span>/ exp <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> m<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>modulo sqr m<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>               <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr"> 9: </span>               <span style="color: #c678dd;">(</span>remainder sqr m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">11: </span>         <span style="color: #a9a1e1;">(</span>remainder 
<span class="linenr">12: </span>          <span style="color: #51afef;">(</span>* base <span style="color: #c678dd;">(</span>expmod-mr base <span style="color: #99bb66;">(</span>- exp <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>          m<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org3a785e4"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mr-test</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try-it</span> a<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>it <span style="color: #c678dd;">(</span>expmod-mr a n n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>= it a<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>= it <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>try-it <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>random <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgb9f931f"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mr-prime?</span> n times<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= times <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> #t<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>mr-test n<span style="color: #a9a1e1;">)</span> 
         <span style="color: #a9a1e1;">(</span>mr-prime? n <span style="color: #51afef;">(</span>- times <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> #f<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org0d55027"><span style="color: #ECBE7B;">&lt;&lt;expmod-mr&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mr-test&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mr-prime&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">mr-times</span> <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">&lt;&lt;get-lists-of-primes&gt;&gt;</span>
<span style="color: #51afef;">(</span>format #t <span style="color: #99bb66;">"      mr detects primes: ~a~%mr false-positives Carmichaels: ~a~%"</span>
        <span style="color: #c678dd;">(</span>and-map <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>mr-prime? x mr-times<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> list-of-primes<span style="color: #c678dd;">)</span>
      <span style="color: #c678dd;">(</span>and-map <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>mr-prime? x mr-times<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> list-of-carmichaels<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">      mr detects primes: #t
mr false-positives Carmichaels: #t
</pre>
</div>

<p>
Shoot. And I thought I did a very literal interpretation of what the book asked.
</p>

<p>
Ah, I see the problem. I need to keep track of what the pre-squaring number was
and use that to determine whether the square is valid or not.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgabb7308"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">expmod-mr</span> base exp m<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= exp <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>even? exp<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #525252;">;; </span><span style="color: #525252;">Keep result and remainder seperate</span>
<span class="linenr"> 6: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>result <span style="color: #99bb66;">(</span>expmod-mr base <span style="color: #a9a1e1;">(</span>/ exp <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> m<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>                <span style="color: #c678dd;">(</span>rem <span style="color: #99bb66;">(</span>remainder <span style="color: #a9a1e1;">(</span>square result<span style="color: #a9a1e1;">)</span> m<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>= result <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>                    <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>= result <span style="color: #51afef;">(</span>- m <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>                    <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> rem<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>               <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #525252;">;; </span><span style="color: #525252;">non-trivial sqrt mod 1 is found</span>
<span class="linenr">12: </span>               rem<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">14: </span>         <span style="color: #a9a1e1;">(</span>remainder 
<span class="linenr">15: </span>          <span style="color: #51afef;">(</span>* base <span style="color: #c678dd;">(</span>expmod-mr base <span style="color: #99bb66;">(</span>- exp <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>          m<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Unfortunately this one has the same problem. What&rsquo;s the issue?
</p>

<p>
Sadly, there&rsquo;s a massive issue in <code class="src src-scheme">mr-test</code>.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">17: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mr-test</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try-it</span> a<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>it <span style="color: #c678dd;">(</span>expmod-mr a n n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">Should be "a (- n 1) n"</span>
<span class="linenr">20: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>= it a<span style="color: #51afef;">)</span>    <span style="color: #525252;">;; </span><span style="color: #525252;">Should be (= it 1)</span>
<span class="linenr">21: </span>          <span style="color: #51afef;">(</span>= it <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">Two strikes, you're out</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span>try-it <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>random <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
One more time.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org8b34a62"><span class="linenr">23: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mr-test</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try-it</span> a<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>    <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>expmod-mr a <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span>try-it <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>random <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org4f4fe70"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;expmod-mr2&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;mr-test2&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;mr-prime&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">mr-times</span> <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #ECBE7B;">&lt;&lt;get-lists-of-primes&gt;&gt;</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>format #t <span style="color: #99bb66;">"      mr detects primes: ~a~%mr false-positives Carmichaels: ~a~%"</span>
<span class="linenr">7: </span>        <span style="color: #c678dd;">(</span>and-map <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>mr-prime? x mr-times<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> list-of-primes<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>      <span style="color: #c678dd;">(</span>and-map <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>mr-prime? x mr-times<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> list-of-carmichaels<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">     mr detects primes: #t
mr false-positives Carmichaels: #f
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org65b7714" class="outline-3">
<h3 id="org65b7714"><span class="section-number-3">2.43.</span> 1.3: Formulating Abstractions with Higher-Order Procedures</h3>
<div class="outline-text-3" id="text-2-43">
<p>
Procedures that manipulate procedures are called <i>higher-order procedures</i>.
</p>
</div>
</div>

<div id="outline-container-org32d29c0" class="outline-3">
<h3 id="org32d29c0"><span class="section-number-3">2.44.</span> 1.3.1: Procedures as Arguments</h3>
<div class="outline-text-3" id="text-2-44">
<p>
Let&rsquo;s say we have several different types of series that we want to sum.
Functions for each of these tasks will look very similar, so we&rsquo;re better off
defining a general function that expresses the <i>idea</i> of summation, that can
then be passed specific functions to cause the specific behavior of the series.
Mathematicians express this as \(\sum\) (&ldquo;sigma&rdquo;) notation.
</p>

<p>
For the program:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum</span> term a next b<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&gt; a b<span style="color: #99bb66;">)</span>
      <span style="color: #dd8844; font-weight: bold;">0</span>
      <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>term a<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>sum term <span style="color: #51afef;">(</span>next a<span style="color: #51afef;">)</span> next b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Which is equivalent to:
</p>

<p>
\[\sum^{b}_{n~a}term(n)~term(a)+term(next(a))+term(next(next(a)))+\cdots+term(b)\]
</p>

<p>
We can pass integers to <code class="src src-scheme">a</code> and <code class="src src-scheme">b</code> and functions to
<code class="src src-scheme">term</code> and <code class="src src-scheme">next</code>. Note that in order to simply sum
integers, we&rsquo;d need to define and pass an identity function to <code class="src src-scheme">term</code>.
</p>
</div>
</div>

<div id="outline-container-org803dd39" class="outline-3">
<h3 id="org803dd39"><span class="section-number-3">2.45.</span> Exercise 1.29</h3>
<div class="outline-text-3" id="text-2-45">
</div>

<div id="outline-container-orgc04aabb" class="outline-4">
<h4 id="orgc04aabb"><span class="section-number-4">2.45.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-45-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org7e69156"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum</span> term a next b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&gt; a b<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>term a<span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>         <span style="color: #a9a1e1;">(</span>sum term <span style="color: #51afef;">(</span>next a<span style="color: #51afef;">)</span> next b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgc14ecba"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">integral</span> f a b dx<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-dx</span> x<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span>+ x dx<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #99bb66;">(</span>sum f <span style="color: #a9a1e1;">(</span>+ a <span style="color: #51afef;">(</span>/ dx <span style="color: #dd8844; font-weight: bold;">2.0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> add-dx b<span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>     dx<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org99ab29d" class="outline-4">
<h4 id="org99ab29d"><span class="section-number-4">2.45.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-45-2">
<p>
Simpson&rsquo;s Rule is a more accurate method of numerical integration than the
method illustrated above. Using Simpson&rsquo;s Rule, the integral of a function \(f\)
between \(a\) and \(b\) is approximated as
</p>

<p>
\[
\frac{h}{3}(y_0 + 4y_1 + 2y_2 + 4y_3 + 2y_4 + \dots + 2y_{n-2} + 4y_{n-1} + y_n)
\]
</p>

<p>
where \(h = (b - a) / n\), for some even integer \(n\), and \(y_k = f(a + kh)\).
(Increasing \(n\) increases the accuracy of the approximation.) Define a
procedure that takes as arguments \(f\), \(a\), \(b\), and \(n\) and returns the
value of the integral, computed using Simpson&rsquo;s Rule. Use your procedure to
integrate <code class="src src-scheme">cube</code> between 0 and 1 (with \(n = 100\) and \(n = 1000\)),
and compare the results to those of the <code class="src src-scheme">integral</code> procedure shown
above.
</p>
</div>
</div>

<div id="outline-container-orgc5964ad" class="outline-4">
<h4 id="orgc5964ad"><span class="section-number-4">2.45.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-45-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org5b646a5"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">int-simp</span> f a b n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">h</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>- b a<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>     n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">gety</span> k<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>+ a <span style="color: #51afef;">(</span>* k h<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">series-y</span> sum k<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">start with sum = y_0</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= k n<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ sum <span style="color: #c678dd;">(</span>gety k<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #525252;">;; </span><span style="color: #525252;">and k = 1</span>
<span class="linenr"> 9: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>even? k<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>series-y
<span class="linenr">10: </span>                      <span style="color: #c678dd;">(</span>+ sum <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>gety k<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                      <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> k<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>series-y
<span class="linenr">13: </span>                 <span style="color: #c678dd;">(</span>+ sum <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #a9a1e1;">(</span>gety k<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                 <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> k<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">sum-of-series</span> <span style="color: #99bb66;">(</span>series-y <span style="color: #a9a1e1;">(</span>gety a<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">(f a) = y_0</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #99bb66;">(</span>/ h <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span> sum-of-series<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Let&rsquo;s compare these at equal levels of computational difficulty.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cube</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>* x x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;sum&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;integral&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;int-simp&gt;&gt;</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">iterations</span> <span style="color: #dd8844; font-weight: bold;">100000</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">benchmark iterations</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">run-test1</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>integral cube <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">0.0008</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">run-test2</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>int-simp cube <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">1000.0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>print-table <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"integral dx:0.0008"</span> <span style="color: #99bb66;">"int-simp i:1000"</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                   <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>run-test1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>run-test2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>                   <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 run-test1 iterations<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>                         <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 run-test2 iterations<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>             <span style="color: #c678dd;">#:colnames</span> #t<span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">integral dx:0.0008</th>
<th scope="col" class="org-right">int-simp i:1000</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.24999992000001311</td>
<td class="org-right">0.25000000000000006</td>
</tr>

<tr>
<td class="org-right">321816.2755</td>
<td class="org-right">330405.8918</td>
</tr>
</tbody>
</table>

<p>
So, more accurate for roughly the same effort or less.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd34cfc4" class="outline-3">
<h3 id="orgd34cfc4"><span class="section-number-3">2.46.</span> Exercise 1.30</h3>
<div class="outline-text-3" id="text-2-46">
</div>

<div id="outline-container-org76e977c" class="outline-4">
<h4 id="org76e977c"><span class="section-number-4">2.46.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-46-1">
<p>
The <code class="src src-scheme">sum</code> procedure above generates a linear recursion. The procedure
can be rewritten so that the sum is performed iteratively. Show how to do this
by filling in the missing expressions in the following definition:
</p>
</div>
</div>

<div id="outline-container-org9c1d8a2" class="outline-4">
<h4 id="org9c1d8a2"><span class="section-number-4">2.46.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-46-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgba00ab2"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum-iter</span> term a next b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> a result<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; a b<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        result
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>next a<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ result <span style="color: #c678dd;">(</span>term a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>iter a <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Let&rsquo;s check the stats!
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">recursive</th>
<th scope="col" class="org-right">iterative</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">30051.080005</td>
<td class="org-right">19568.685587</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org9721bd1" class="outline-3">
<h3 id="org9721bd1"><span class="section-number-3">2.47.</span> Exercise 1.31</h3>
<div class="outline-text-3" id="text-2-47">
</div>

<div id="outline-container-org1d90a1e" class="outline-4">
<h4 id="org1d90a1e"><span class="section-number-4">2.47.1.</span> Question A.1</h4>
<div class="outline-text-4" id="text-2-47-1">
<p>
The <code class="src src-scheme">sum</code> procedure is only the simplest of a vast number of similar
abstractions that can be captured as higher-order procedures. Write an analogous
procedure called <code class="src src-scheme">product</code> that returns the product of the values of a
function at points over a given range.
</p>
</div>
</div>

<div id="outline-container-org53eccbe" class="outline-4">
<h4 id="org53eccbe"><span class="section-number-4">2.47.2.</span> Answer A.1</h4>
<div class="outline-text-4" id="text-2-47-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgea66a1a"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product-iter</span> term a next b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> a result<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; a b<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        result
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>next a<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>* result <span style="color: #c678dd;">(</span>term a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>iter a <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">start at 1 so it's not always 0</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org87f1f84" class="outline-4">
<h4 id="org87f1f84"><span class="section-number-4">2.47.3.</span> Question A.2</h4>
<div class="outline-text-4" id="text-2-47-3">
<p>
Show how to define <code class="src src-scheme">factorial</code> in terms of <code class="src src-scheme">product</code>.
</p>
</div>
</div>

<div id="outline-container-orgacb66f9" class="outline-4">
<h4 id="orgacb66f9"><span class="section-number-4">2.47.4.</span> Answer A.2</h4>
<div class="outline-text-4" id="text-2-47-4">
<p>
I was briefly stumped because <code class="src src-scheme">product</code> only counts upward. Then I
realized that&rsquo;s just how it&rsquo;s presented and it can go either direction, since
addition and multiplication are commutative. I look forward to building up a
more intuitive sense of numbers.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgaddf0fd"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;product-iter&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">identity</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  x<span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">inc</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>1+ x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">factorial</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>product-iter identity <span style="color: #dd8844; font-weight: bold;">1</span> inc n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>factorial <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org61b476c" class="outline-4">
<h4 id="org61b476c"><span class="section-number-4">2.47.5.</span> Question A.3</h4>
<div class="outline-text-4" id="text-2-47-5">
<p>
Also use <code class="src src-scheme">product</code> to compute approximations to \(\pi\) using the
formula
</p>

<p>
\[
\frac{\pi}{4} =
\frac{2\cdot 4\cdot 4\cdot 6\cdot 6\cdot 8\cdots}{3\cdot 3\cdot 5\cdot 5\cdot 7\cdot 7\cdots}
\]
</p>
</div>
</div>

<div id="outline-container-org247bca3" class="outline-4">
<h4 id="org247bca3"><span class="section-number-4">2.47.6.</span> Answer A.3</h4>
<div class="outline-text-4" id="text-2-47-6">
<p>
Once this equation is encoded, you just need to multiply it by two to get \(\pi\).
</p>

<p>
Fun fact: the formula is slightly wrong, it should start the series with \(\frac{1}{2}\).
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgf1c2f74"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;product-iter&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pi-product</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div</span> x<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>x1 <span style="color: #c678dd;">(</span>- x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span>          <span style="color: #51afef;">(</span>x2 <span style="color: #c678dd;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>      <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>/ x x1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>/ x x2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">2.0</span> <span style="color: #99bb66;">(</span>product-iter div <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ z <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">8: </span>
<span class="linenr">9: </span><span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>pi-product <span style="color: #dd8844; font-weight: bold;">100000</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0e55c07">
3.1415769458228726
</pre>
</div>
</div>

<div id="outline-container-org3e47c77" class="outline-4">
<h4 id="org3e47c77"><span class="section-number-4">2.47.7.</span> Question B</h4>
<div class="outline-text-4" id="text-2-47-7">
<p>
If your product procedure generates a recursive process, write one that
generates an iterative process. If it generates an iterative process, write one
that generates a recursive process.
</p>
</div>
</div>

<div id="outline-container-org39e4769" class="outline-4">
<h4 id="org39e4769"><span class="section-number-4">2.47.8.</span> Answer B</h4>
<div class="outline-text-4" id="text-2-47-8">
<div class="org-src-container">
<pre class="src src-scheme" id="orgc917219"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product-rec</span> term a next b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&gt; a b<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>term a<span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>         <span style="color: #a9a1e1;">(</span>product-rec term <span style="color: #51afef;">(</span>next a<span style="color: #51afef;">)</span> next b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgf9d055a"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;mattbench2&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;product-iter&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pi-product</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div</span> x<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>x1 <span style="color: #c678dd;">(</span>- x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>          <span style="color: #51afef;">(</span>x2 <span style="color: #c678dd;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>/ x x1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>/ x x2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">2.0</span> <span style="color: #99bb66;">(</span>product-iter div <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ z <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;product-rec&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pi-product-rec</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div</span> x<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>x1 <span style="color: #c678dd;">(</span>- x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>          <span style="color: #51afef;">(</span>x2 <span style="color: #c678dd;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>      <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>/ x x1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>/ x x2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">2.0</span> <span style="color: #99bb66;">(</span>product-rec div <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ z <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">iterations</span> <span style="color: #dd8844; font-weight: bold;">50000</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>print-table
<span class="linenr">20: </span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"iterative"</span> <span style="color: #99bb66;">"recursive"</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>       <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>pi-product <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> iterations<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>             <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>pi-product-rec <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> iterations<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span> <span style="color: #c678dd;">#:colnames</span> #t<span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">iterative</th>
<th scope="col" class="org-right">recursive</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1267118.0538</td>
<td class="org-right">3067085.5323</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org776c49e" class="outline-3">
<h3 id="org776c49e"><span class="section-number-3">2.48.</span> Exercise 1.32</h3>
<div class="outline-text-3" id="text-2-48">
</div>

<div id="outline-container-org146ce7c" class="outline-4">
<h4 id="org146ce7c"><span class="section-number-4">2.48.1.</span> Question A</h4>
<div class="outline-text-4" id="text-2-48-1">
<p>
Show that <code class="src src-scheme">sum</code> and <code class="src src-scheme">product</code> are both special cases of a
still more general notion called <code class="src src-scheme">accumulate</code> that combines a
collection of terms, using some general accumulation function:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>accumulate combiner null-value term a next b<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code class="src src-scheme">accumulate</code> takes as arguments the same term and range specifications
as <code class="src src-scheme">sum</code> and <code class="src src-scheme">product</code>, together with a <code class="src src-scheme">combiner</code>
procedure (of two arguments) that specifies how the current term is to be
combined with the accumulation of the preceding terms and a
<code class="src src-scheme">null-value</code> that specifies what base value to use when the terms run
out. Write <code class="src src-scheme">accumulate</code> and show how <code class="src src-scheme">sum</code> and
<code class="src src-scheme">product</code> can both be defined as simple calls to
<code class="src src-scheme">accumulate</code>.
</p>
</div>
</div>

<div id="outline-container-org1a29ec7" class="outline-4">
<h4 id="org1a29ec7"><span class="section-number-4">2.48.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-2-48-2">
<p>
When I first did this question, I struggled a lot before realizing
<code class="src src-scheme">accumulate</code> was much closer to the exact definitions of sum/product
than I thought.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org23c3f99"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">accumulate-iter</span> combiner null-value term a next b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> a result<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; a b<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        result
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>next a<span style="color: #51afef;">)</span>
<span class="linenr">6: </span>              <span style="color: #51afef;">(</span>combiner result <span style="color: #c678dd;">(</span>term a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>iter a null-value<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate-iter&gt;&gt;</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">here you can see definitions in terms of accumulate</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum</span> term a next b<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>accumulate-iter + <span style="color: #dd8844; font-weight: bold;">0</span> term a next b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product</span> term a next b<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>accumulate-iter * <span style="color: #dd8844; font-weight: bold;">1</span> term a next b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">identity</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  x<span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">inc</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>1+ x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #525252;">;; </span><span style="color: #525252;">accumulate in action</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">factorial</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>accumulate-iter * <span style="color: #dd8844; font-weight: bold;">1</span> identity <span style="color: #dd8844; font-weight: bold;">1</span> inc n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>factorial <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgb28f289">
5040
</pre>
</div>
</div>

<div id="outline-container-org881724f" class="outline-4">
<h4 id="org881724f"><span class="section-number-4">2.48.3.</span> Question B</h4>
<div class="outline-text-4" id="text-2-48-3">
<p>
If your <code class="src src-scheme">accumulate</code> procedure generates a recursive process, write
one that generates an iterative process. If it generates an iterative process,
write one that generates a recursive process.
</p>
</div>
</div>

<div id="outline-container-orga02646e" class="outline-4">
<h4 id="orga02646e"><span class="section-number-4">2.48.4.</span> Answer B</h4>
<div class="outline-text-4" id="text-2-48-4">
<div class="org-src-container">
<pre class="src src-scheme" id="orgab14996"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">accumulate-rec</span> combiner null-value term a next b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&gt; a b<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      null-value
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>combiner <span style="color: #a9a1e1;">(</span>term a<span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>         <span style="color: #a9a1e1;">(</span>accumulate-rec combiner null-value
<span class="linenr">6: </span>                         term <span style="color: #51afef;">(</span>next a<span style="color: #51afef;">)</span> next b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3ec0904" class="outline-3">
<h3 id="org3ec0904"><span class="section-number-3">2.49.</span> Exercise 1.33</h3>
<div class="outline-text-3" id="text-2-49">
</div>

<div id="outline-container-org0bb1264" class="outline-4">
<h4 id="org0bb1264"><span class="section-number-4">2.49.1.</span> Question A</h4>
<div class="outline-text-4" id="text-2-49-1">
<p>
You can obtain an even more general version of <code class="src src-scheme">accumulate</code> by
introducing the notion of a filter on the terms to be combined. That is, combine
only those terms derived from values in the range that satisfy a specified
condition. The resulting <code class="src src-scheme">filtered-accumulate</code> abstraction takes the
same arguments as accumulate, together with an additional predicate of one
argument that specifies the filter. Write <code class="src src-scheme">filtered-accumulate</code> as a
procedure.
</p>
</div>
</div>

<div id="outline-container-orga9c4888" class="outline-4">
<h4 id="orga9c4888"><span class="section-number-4">2.49.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-2-49-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgc27d7fb"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">filtered-accumulate-iter</span>
<span class="linenr"> 2: </span>           predicate? combiner null-value
<span class="linenr"> 3: </span>           term a next b<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> a result<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&gt; a b<span style="color: #51afef;">)</span> result<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>predicate? a<span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>           <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>next a<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>                 <span style="color: #c678dd;">(</span>combiner result <span style="color: #99bb66;">(</span>term a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>next a<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>                      result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>iter a null-value<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0bc5de" class="outline-4">
<h4 id="orge0bc5de"><span class="section-number-4">2.49.3.</span> Question B</h4>
<div class="outline-text-4" id="text-2-49-3">
<p>
Show how to express the following using <code class="src src-scheme">filtered-accumulate</code>:
</p>
</div>

<ol class="org-ol">
<li><a id="org1cc2c68"></a>A<br />
<div class="outline-text-5" id="text-2-49-3-1">
<p>
Find the sum of the squares of the prime numbers in the interval \(a\) to \(b\)
(assuming that you have a <code class="src src-scheme">prime?</code> predicate already written)
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>* x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;filtered-accumulate-iter&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;expmod-mr2&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;mr-test2&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;mr-prime&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">mr-times</span> <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime?</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>mr-prime? x mr-times<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime-sum</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>filtered-accumulate-iter prime? + <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">13: </span>                            square a 1+ b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>mattcheck-equal <span style="color: #99bb66;">"1 prime correct"</span>
<span class="linenr">16: </span>                 <span style="color: #c678dd;">(</span>prime-sum <span style="color: #dd8844; font-weight: bold;">1008</span> <span style="color: #dd8844; font-weight: bold;">1010</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                 <span style="color: #c678dd;">(</span>square <span style="color: #dd8844; font-weight: bold;">1009</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">1009</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>mattcheck-equal <span style="color: #99bb66;">"many primes correct"</span>
<span class="linenr">19: </span>                 <span style="color: #c678dd;">(</span>prime-sum <span style="color: #dd8844; font-weight: bold;">1000</span> <span style="color: #dd8844; font-weight: bold;">2001</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>                 <span style="color: #c678dd;">(</span>apply +
<span class="linenr">21: </span>                        <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> square
<span class="linenr">22: </span>                             <span style="color: #a9a1e1;">(</span>filter prime? <span style="color: #51afef;">(</span>iota <span style="color: #c678dd;">(</span>- <span style="color: #dd8844; font-weight: bold;">2001</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>                                                  <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org8d72fd8">
SUCCEED at 1 prime correct
SUCCEED at many primes correct
</pre>
</div>
</li>

<li><a id="orge28a216"></a>B<br />
<div class="outline-text-5" id="text-2-49-3-2">
<blockquote>
<p>
Find the product of all the positive integers less than \(n\) that are
relatively prime to \(n\) (i.e., all positive integers \(i < n\) such that
\(\textsc{gcd}(i, n) = 1\).
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>* x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">id</span> x<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;filtered-accumulate-iter&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;gcd&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">relative-prime?</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>gcd x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">Ex_1-33B</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>filtered-accumulate-iter
<span class="linenr">12: </span>   <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>relative-prime? i n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>   * <span style="color: #dd8844; font-weight: bold;">1</span> id
<span class="linenr">14: </span>   <span style="color: #dd8844; font-weight: bold;">1</span> 1+ <span style="color: #99bb66;">(</span>1- n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">alternate</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>apply *
<span class="linenr">18: </span>         <span style="color: #99bb66;">(</span>filter <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>i<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>relative-prime? i n<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">19: </span>                 <span style="color: #a9a1e1;">(</span>iota <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>mattcheck-equal <span style="color: #99bb66;">"Ex_1-33B"</span>
<span class="linenr">22: </span>                 <span style="color: #c678dd;">(</span>Ex_1-33B <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>                 <span style="color: #c678dd;">(</span>alternate <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org30e538e">
SUCCEED at Ex_1-33B
</pre>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org57b46bd" class="outline-3">
<h3 id="org57b46bd"><span class="section-number-3">2.50.</span> 1.3.2: Constructing Procedures Using lambda</h3>
<div class="outline-text-3" id="text-2-50">
<p>
A procedure that&rsquo;s only used once is more conveniently expressed as the special
form <code class="src src-scheme">lambda</code>.
</p>

<p>
Variables that are only briefly used in a limited scope can be specified with
the special form <code class="src src-scheme">let</code>. Variables in <code class="src src-scheme">let</code> blocks override
external variables. The authors recommend using <code class="src src-scheme">define</code> for
procedures and <code class="src src-scheme">let</code> for variables.
</p>
</div>
</div>

<div id="outline-container-org1377418" class="outline-3">
<h3 id="org1377418"><span class="section-number-3">2.51.</span> Exercise 1.34</h3>
<div class="outline-text-3" id="text-2-51">
</div>

<div id="outline-container-org60ae614" class="outline-4">
<h4 id="org60ae614"><span class="section-number-4">2.51.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-51-1">
<blockquote>
<p>
Suppose we define the procedure
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">f</span> g<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>g <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
Then, we have
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>f square<span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">4</span>
<span style="color: #51afef;">(</span>f <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* z <span style="color: #a9a1e1;">(</span>+ z <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">6</span>
</pre>
</div>

<blockquote>
<p>
What happens if we (perversely) ask the interpreter to evaluate the combination
<code class="src src-scheme"><span style="color: #51afef;">(</span>f f<span style="color: #51afef;">)</span></code>? Explain.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgbac8b30" class="outline-4">
<h4 id="orgbac8b30"><span class="section-number-4">2.51.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-51-2">
<p>
It ends up trying to execute <code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">2</span></code> as a function.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Will be evaluated like this:</span>
<span class="linenr">2: </span><span style="color: #525252;">;;   </span><span style="color: #525252;">(f f)</span>
<span class="linenr">3: </span><span style="color: #525252;">;;   </span><span style="color: #525252;">(f 2)</span>
<span class="linenr">4: </span><span style="color: #525252;">;;   </span><span style="color: #525252;">(2 2)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">f</span> g<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>g <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>f f<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org36eaeb7">
ice-9/boot-9.scm:1685:16: In procedure raise-exception:
Wrong type to apply: 2
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaff393d" class="outline-3">
<h3 id="orgaff393d"><span class="section-number-3">2.52.</span> 1.3.3 Procedures as General Methods</h3>
<div class="outline-text-3" id="text-2-52">
<p>
The <b>half-interval method</b>: if \(f(a)<0<f(b)\), then \(f\) must have at least
one 0 between \(a\) and \(b\). To find 0, let \(x\) be the average of \(a\) and
\(b\), if \(f(x) < 0\) then 0 must be between \(x\) and \(b\), if \(f(x)>0\)
than 0 must be between \(a\) and \(x\).
</p>

<p>
The <b>fixed point</b> of a function satisfies the equation \[f(x)=x\]
</p>

<p>
For some functions, we can locate a fixed point by beginning with an initial
guess \(y\) and applying \(f(y)\) repeatedly until the value doesn&rsquo;t change
much.
</p>

<p>
<b>Average damping</b> can help converge fixed-point searches.
</p>

<p>
The symbol \(\mapsto\) (&ldquo;maps to&rdquo;) can be considered equivalent to a lambda. For
example, \(x \mapsto x+x\) is equivalent to <code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>+ x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>. In
English, &ldquo;the function whose value at \(y\) is \(x/y\)&rdquo;. <i>Though it seems like
\(\mapsto\) doesn&rsquo;t necessarily describe a function, but the value of a function
at a certain point? Or maybe that would just be \(~\), ie \(f(x)~etc\)</i>
</p>
</div>
</div>

<div id="outline-container-orgac4a446" class="outline-3">
<h3 id="orgac4a446"><span class="section-number-3">2.53.</span> Exercise 1.35</h3>
<div class="outline-text-3" id="text-2-53">
</div>

<div id="outline-container-org0d8fae9" class="outline-4">
<h4 id="org0d8fae9"><span class="section-number-4">2.53.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-53-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org9409e4a"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">close-enough?</span> x y<span style="color: #c678dd;">)</span> 
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>&lt; <span style="color: #99bb66;">(</span>abs <span style="color: #a9a1e1;">(</span>- x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0.001</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgbf9f538"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tolerance</span> <span style="color: #dd8844; font-weight: bold;">0.00001</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fixed-point</span> f first-guess<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">close-enough?</span> v1 v2<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>    <span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>abs <span style="color: #51afef;">(</span>- v1 v2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 6: </span>       tolerance<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try</span> guess<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>next <span style="color: #c678dd;">(</span>f guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>close-enough? guess next<span style="color: #51afef;">)</span>
<span class="linenr">10: </span>          next
<span class="linenr">11: </span>          <span style="color: #51afef;">(</span>try next<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>try first-guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org21d508e" class="outline-4">
<h4 id="org21d508e"><span class="section-number-4">2.53.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-53-2">
<blockquote>
<p>
Show that the golden ratio \(\varphi\) is a fixed point of the transformation
\(x \mapsto 1 + 1 / x\), and use this fact to compute \(\varphi\) by means of
the <code class="src src-scheme">fixed-point</code> procedure.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org76a68ef" class="outline-4">
<h4 id="org76a68ef"><span class="section-number-4">2.53.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-53-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org1d8177d"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;close-enough&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;fixed-point-txt&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">golden-ratio</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>fixed-point <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>               <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span>display golden-ratio<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org860e4b7">
1.6180327868852458
</pre>
</div>
</div>
</div>

<div id="outline-container-org94c456e" class="outline-3">
<h3 id="org94c456e"><span class="section-number-3">2.54.</span> Exercise 1.36</h3>
<div class="outline-text-3" id="text-2-54">
</div>

<div id="outline-container-org217f072" class="outline-4">
<h4 id="org217f072"><span class="section-number-4">2.54.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-54-1">
<blockquote>
<p>
Modify <code class="src src-scheme">fixed-point</code> so that it prints the sequence of approximations
it generates, using the <code class="src src-scheme">newline</code> and <code class="src src-scheme">display</code> primitives
shown in Exercise 1.22. Then find a solution to \(x^x = 1000\) by finding a
fixed point of \(x \mapsto \log(1000) / \log(x)\). (Use Scheme&rsquo;s primitive
<code class="src src-scheme">log</code> procedure, which computes natural logarithms.) Compare the
number of steps this takes with and without average damping. (Note that you
cannot start <code class="src src-scheme">fixed-point</code> with a guess of 1, as this would cause
division by \(\log(1) = 0\).)
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgaa413d9" class="outline-4">
<h4 id="orgaa413d9"><span class="section-number-4">2.54.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-54-2">
<p>
Using the <code class="src src-scheme">display</code> and <code class="src src-scheme">newline</code> functions at any great
extent is pretty exhausting, so I&rsquo;ll use <code class="src src-scheme">format</code> instead.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgc367ea7"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tolerance</span> <span style="color: #dd8844; font-weight: bold;">0.00001</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fixed-point</span> f first-guess<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">close-enough?</span> v1 v2<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>abs <span style="color: #51afef;">(</span>- v1 v2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 7: </span>       tolerance<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try</span> guess<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>next <span style="color: #c678dd;">(</span>f guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>      <span style="color: #a9a1e1;">(</span>format #t <span style="color: #99bb66;">"~&amp;~a~%"</span> next<span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>close-enough? guess next<span style="color: #51afef;">)</span>
<span class="linenr">12: </span>          next
<span class="linenr">13: </span>          <span style="color: #51afef;">(</span>try next<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>try first-guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;close-enough&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;fixed-point-debug&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>fixed-point <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>log <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>log x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">1.1</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Undamped, fixed-point makes 37 guesses.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;close-enough&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;fixed-point-debug&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">average</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>+ x y<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span>fixed-point <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>average <span style="color: #a9a1e1;">(</span>log x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>/ <span style="color: #51afef;">(</span>log <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>log x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">1.1</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Damped, it makes 21.
</p>
</div>
</div>
</div>

<div id="outline-container-orgaf6c0ec" class="outline-3">
<h3 id="orgaf6c0ec"><span class="section-number-3">2.55.</span> Exercise 1.37</h3>
<div class="outline-text-3" id="text-2-55">
</div>

<div id="outline-container-org5e0c971" class="outline-4">
<h4 id="org5e0c971"><span class="section-number-4">2.55.1.</span> Question A</h4>
<div class="outline-text-4" id="text-2-55-1">
<blockquote>
<p>
An infinite continued fraction is an expression of the form
</p>

<p>
\[ {f} = \cfrac{N_1}{D_1 + \cfrac{N_2}{D_2 + \cfrac{N_3}{D_3 + \dots}}} \]
</p>

<p>
As an example, one can show that the infinite continued fraction expansion with
the \(N_i\) and the \(D_i\) all equal to 1 produces \(1 / \varphi\), where
\(\varphi\) is the golden ratio (described in 1.2.2). One way to approximate an
infinite continued fraction is to truncate the expansion after a given number of
terms. Such a truncation&#x2014;a so-called \(k\)-term finite continued
fraction}&#x2014;has the form
</p>

<p>
\[ \cfrac{N_1}{D_1 + \cfrac{N_2}{\ddots + \cfrac{N_k}{D_k}}} \]
</p>

<p>
Suppose that <code class="src src-scheme">n</code> and <code class="src src-scheme">d</code> are procedures of one argument (the
term index \(i\)) that return the \(N_i\) and \(D_i\) of the terms of the
continued fraction. Define a procedure <code class="src src-scheme">cont-frac</code> such that
evaluating <code class="src src-scheme"><span style="color: #51afef;">(</span>cont-frac n d k<span style="color: #51afef;">)</span></code> computes the value of the \(k\)-term
finite continued fraction.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgc583209" class="outline-4">
<h4 id="orgc583209"><span class="section-number-4">2.55.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-2-55-2">
<p>
A note: the &ldquo;golden ratio&rdquo; this code estimates is exactly <code>1.0</code> less than the
golden ratio anyone else seems to be talking about.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgb6e793f"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cont-frac</span> n d k<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> i result<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= i <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        result
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>1- i<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span>n i<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>d i<span style="color: #99bb66;">)</span> result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>iter <span style="color: #99bb66;">(</span>1- k<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>n k<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>d k<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4987756" class="outline-4">
<h4 id="org4987756"><span class="section-number-4">2.55.3.</span> Question B</h4>
<div class="outline-text-4" id="text-2-55-3">
<p>
Check your procedure by approximating \(1 / \varphi\) using
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>cont-frac <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>i<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #c678dd;">)</span>
           <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>i<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #c678dd;">)</span>
           k<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
for successive values of <code class="src src-scheme">k</code>. How large must you make <code class="src src-scheme">k</code> in
order to get an approximation that is accurate to 4 decimal places?
</p>
</div>
</div>

<div id="outline-container-org20e4f7a" class="outline-4">
<h4 id="org20e4f7a"><span class="section-number-4">2.55.4.</span> Answer B</h4>
<div class="outline-text-4" id="text-2-55-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">-0.3819660112501051</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">0.1180339887498949</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">-0.04863267791677173</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">0.018033988749894814</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">-0.0069660112501050975</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">0.0026493733652794837</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">-0.0010136302977241662</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">0.00038692992636546464</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">-0.00014782943192326314</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">5.6460660007306984e-05</td>
</tr>
</tbody>
</table>



<div id="orgccb7b23" class="figure">
<p><img src="1/fig/1-36-1.png" alt="1-36-1.png" />
</p>
</div>

<p>
\(k\) must be at least 10 to get precision of 4 decimal places.
</p>
</div>
</div>

<div id="outline-container-orgea240fc" class="outline-4">
<h4 id="orgea240fc"><span class="section-number-4">2.55.5.</span> Question C</h4>
<div class="outline-text-4" id="text-2-55-5">
<blockquote>
<p>
If your <code class="src src-scheme">cont-frac</code> procedure generates a recursive process, write one
that generates an iterative process. If it generates an iterative process, write
one that generates a recursive process.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org08c0c37" class="outline-4">
<h4 id="org08c0c37"><span class="section-number-4">2.55.6.</span> Answer C</h4>
<div class="outline-text-4" id="text-2-55-6">
<div class="org-src-container">
<pre class="src src-scheme" id="org548f002"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cont-frac-rec</span> n d k<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> i<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= i k<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        <span style="color: #a9a1e1;">(</span>/ <span style="color: #51afef;">(</span>n i<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>d i<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span>/ <span style="color: #51afef;">(</span>n i<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>d i<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>1+ i<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>rec <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;cont-frac&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;cont-frac-rec&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">golden-ratio</span> k<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>cont-frac <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span><span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span> k<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">golden-ratio-rec</span> k<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>cont-frac-rec <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span><span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span> k<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>mattcheck-equal <span style="color: #99bb66;">"cont-frac iter and recursive equivalence"</span>
<span class="linenr">10: </span>           <span style="color: #c678dd;">(</span>golden-ratio-rec <span style="color: #dd8844; font-weight: bold;">15</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>           <span style="color: #c678dd;">(</span>golden-ratio <span style="color: #dd8844; font-weight: bold;">15</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org1aff9c1">
SUCCEED at cont-frac iter and recursive equivalence
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd68f03d" class="outline-3">
<h3 id="orgd68f03d"><span class="section-number-3">2.56.</span> Exercise 1.38</h3>
<div class="outline-text-3" id="text-2-56">
</div>

<div id="outline-container-org681a519" class="outline-4">
<h4 id="org681a519"><span class="section-number-4">2.56.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-56-1">
<blockquote>
<p>
In 1737, the Swiss mathematician Leonhard Euler published a memoir <i>De
Fractionibus Continuis</i>, which included a continued fraction expansion for \(e -
2\), where \(e\) is the base of the natural logarithms. In this fraction, the
\(N_i\) are all 1, and the \(D_i\) are successively 1, 2, 1, 1, 4, 1, 1, 6, 1,
1, 8, \(\dots\). Write a program that uses your <code class="src src-scheme">cont-frac</code> procedure
from Exercise 1.37 to approximate \(e\), based on Euler&rsquo;s expansion.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org110ba83" class="outline-4">
<h4 id="org110ba83"><span class="section-number-4">2.56.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-56-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;cont-frac&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">euler</span> k<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">2</span>
<span class="linenr"> 4: </span>     <span style="color: #99bb66;">(</span>cont-frac <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>i<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>             <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>i<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>j <span style="color: #a9a1e1;">(</span>1+ i<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #a9a1e1;">(</span>modulo j <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>                         <span style="color: #99bb66;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>/ j <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>                         <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>             k<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>euler <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0181727">
2.7182818284590455
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8fe424" class="outline-3">
<h3 id="orge8fe424"><span class="section-number-3">2.57.</span> Exercise 1.39</h3>
<div class="outline-text-3" id="text-2-57">
</div>

<div id="outline-container-org0c60289" class="outline-4">
<h4 id="org0c60289"><span class="section-number-4">2.57.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-57-1">
<blockquote>
<p>
A continued fraction representation of the tangent function was published in
1770 by the German mathematician J.H. Lambert:
</p>

<p>
\[ {\tan x} = \cfrac{x}{1 - \cfrac{x^2}{3 - \cfrac{x^2}{5 - \dots}}} \]
</p>

<p>
where \(x\) is in radians. Define a procedure <code class="src src-scheme"><span style="color: #51afef;">(</span>tan-cf x k<span style="color: #51afef;">)</span></code> that
computes an approximation to the tangent function based on Lambert&rsquo;s formula.
<code class="src src-scheme">k</code> specifies the number of terms to compute, as in Exercise 1.37.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4252fc3" class="outline-4">
<h4 id="org4252fc3"><span class="section-number-4">2.57.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-57-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;cont-frac&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tan-cf</span> x k<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>cont-frac <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>= i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span>                       x
<span class="linenr"> 5: </span>                       <span style="color: #51afef;">(</span>* x x <span style="color: #dd8844; font-weight: bold;">-1.0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>             <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>= i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>                       <span style="color: #dd8844; font-weight: bold;">1.0</span>
<span class="linenr"> 8: </span>                       <span style="color: #51afef;">(</span>- <span style="color: #c678dd;">(</span>* i <span style="color: #dd8844; font-weight: bold;">2.0</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>             k<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>tan-cf <span style="color: #dd8844; font-weight: bold;">55</span> <span style="color: #dd8844; font-weight: bold;">101</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgdc62bcc">
-45.1830879105221
</pre>
</div>
</div>
</div>

<div id="outline-container-org9617225" class="outline-3">
<h3 id="org9617225"><span class="section-number-3">2.58.</span> 1.3.4 Procedures as Returned Values</h3>
<div class="outline-text-3" id="text-2-58">
<p>
Procedures can return other procedures, which opens up new ways to express
processes.
</p>

<blockquote>
<p>
Newton&rsquo;s Method: \(g(x)=0\) is a fixed point of the function \(x \mapsto f(x)\)
where \[f(x)=x-\frac{g(x)}{Dg(x)}\]
</p>

<p>
Where \(x \mapsto g(x)\) is a differentiable function and \(Dg(x)\) is the
derivative of \(g\) evaluated at \(x\).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4ede1cf" class="outline-3">
<h3 id="org4ede1cf"><span class="section-number-3">2.59.</span> Exercise 1.40</h3>
<div class="outline-text-3" id="text-2-59">
</div>

<div id="outline-container-org7a0a068" class="outline-4">
<h4 id="org7a0a068"><span class="section-number-4">2.59.1.</span> Text</h4>
<div class="outline-text-4" id="text-2-59-1">
<div class="org-src-container">
<pre class="src src-scheme" id="orgc6a10f2"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">average-damp</span> f<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>average x <span style="color: #a9a1e1;">(</span>f x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org6210bbc"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">dx</span> <span style="color: #dd8844; font-weight: bold;">0.00001</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org0319f19"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> g<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>g <span style="color: #c678dd;">(</span>+ x dx<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>g x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> dx<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org0b3843b"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">newton-transform</span> g<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>- x <span style="color: #a9a1e1;">(</span>/ <span style="color: #51afef;">(</span>g x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>deriv g<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">newtons-method</span> g guess<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>fixed-point <span style="color: #99bb66;">(</span>newton-transform g<span style="color: #99bb66;">)</span> guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgeb29074"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;average&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;average-damp&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;dx&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;deriv&gt;&gt;</span>
<span class="linenr">5: </span><span style="color: #ECBE7B;">&lt;&lt;newtons-method&gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org70b8d90" class="outline-4">
<h4 id="org70b8d90"><span class="section-number-4">2.59.2.</span> Question</h4>
<div class="outline-text-4" id="text-2-59-2">
<blockquote>
<p>
Define a procedure <code class="src src-scheme">cubic</code> that can be used together with the
<code class="src src-scheme">newtons-method</code> procedure in expressions of the form:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>newtons-method <span style="color: #c678dd;">(</span>cubic a b c<span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
to approximate zeros of the cubic \(x^3 + ax^2 + bx + c\).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4a34990" class="outline-4">
<h4 id="org4a34990"><span class="section-number-4">2.59.3.</span> Answer</h4>
<div class="outline-text-4" id="text-2-59-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org6aae63b"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cubic</span> a b c<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>expt x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>       <span style="color: #a9a1e1;">(</span>* a <span style="color: #51afef;">(</span>expt x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>       <span style="color: #a9a1e1;">(</span>* b x<span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>       c<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org9aa32e0"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cubic-zero</span> a b c<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>newtons-method <span style="color: #99bb66;">(</span>cubic a b c<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fixed-point-txt&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;newtons-method-txt&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;cubic&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;cubic-zero&gt;&gt;</span>
<span class="linenr">5: </span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>cubic-zero <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgea07867" class="outline-3">
<h3 id="orgea07867"><span class="section-number-3">2.60.</span> Exercise 1.41</h3>
<div class="outline-text-3" id="text-2-60">
</div>

<div id="outline-container-orgedb0ee0" class="outline-4">
<h4 id="orgedb0ee0"><span class="section-number-4">2.60.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-60-1">
<blockquote>
<p>
Define a procedure <code class="src src-scheme">double</code> that takes a procedure of one argument as
argument and returns a procedure that applies the original procedure twice. For
example, if <code class="src src-scheme">inc</code> is a procedure that adds 1 to its argument, then
<code class="src src-scheme"><span style="color: #51afef;">(</span>double inc<span style="color: #51afef;">)</span></code> should be a procedure that adds 2. What value is
returned by
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="org706948e"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>double <span style="color: #a9a1e1;">(</span>double double<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> inc<span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org66d16d0" class="outline-4">
<h4 id="org66d16d0"><span class="section-number-4">2.60.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-60-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org3125972"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">double</span> f<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>f x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">inc</span> 1+<span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">&lt;&lt;double&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;Ex1-41&gt;&gt;</span>
</pre>
</div>

<pre class="example" id="orgbf4b8dd">
21
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a8dcf2" class="outline-3">
<h3 id="org2a8dcf2"><span class="section-number-3">2.61.</span> Exercise 1.42</h3>
<div class="outline-text-3" id="text-2-61">
</div>

<div id="outline-container-orgb4da867" class="outline-4">
<h4 id="orgb4da867"><span class="section-number-4">2.61.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-61-1">
<blockquote>
<p>
Let \(f\) and \(g\) be two one-argument functions. The composition \(f\) after
\(g\) is defined to be the function \(x \mapsto f(g(x))\). Define a procedure
<code class="src src-scheme">compose</code> that implements composition.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgb043a8a" class="outline-4">
<h4 id="orgb043a8a"><span class="section-number-4">2.61.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-61-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org2c768e8"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">compose</span> f g<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>g x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;compose&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">inc</span> 1+<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>compose square inc<span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orge04b9da">
49
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd60ea52" class="outline-3">
<h3 id="orgd60ea52"><span class="section-number-3">2.62.</span> Exercise 1.43</h3>
<div class="outline-text-3" id="text-2-62">
</div>

<div id="outline-container-org86ba4be" class="outline-4">
<h4 id="org86ba4be"><span class="section-number-4">2.62.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-62-1">
<blockquote>
<p>
If \(f\) is a numerical function
and \(n\) is a positive integer, then we can form the \(n^{\mathrm{th}}\) repeated
application of \(f\), which is defined to be the function whose value at \(x\)
is \(f(f(\dots (f(x))\dots ))\).  For example, if \(f\) is the
function \(x \mapsto x + 1\), then the \(n^{\mathrm{th}}\) repeated application of \(f\) is
the function \(x \mapsto x + n\).  If \(f\) is the operation of squaring a
number, then the \(n^{\mathrm{th}}\) repeated application of \(f\) is the function that
raises its argument to the \(2^n\)-th power.  Write a procedure that takes as
inputs a procedure that computes \(f\) and a positive integer \(n\) and returns
the procedure that computes the \(n^{\mathrm{th}}\) repeated application of \(f\).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgb07985f" class="outline-4">
<h4 id="orgb07985f"><span class="section-number-4">2.62.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-62-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org952f313"><span style="color: #ECBE7B;">&lt;&lt;compose&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">repeated</span> f n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
      f
      <span style="color: #99bb66;">(</span>repeated <span style="color: #a9a1e1;">(</span>compose f f<span style="color: #a9a1e1;">)</span>
                <span style="color: #a9a1e1;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;repeated&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>repeated square <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">625</span><span style="color: #c678dd;">)</span>
    <span style="color: #99bb66;">"Success"</span>
    <span style="color: #99bb66;">"Fail"</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org3bfb8cd">
Success
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf94e7af" class="outline-3">
<h3 id="orgf94e7af"><span class="section-number-3">2.63.</span> Exercise 1.44</h3>
<div class="outline-text-3" id="text-2-63">
</div>

<div id="outline-container-org19c6599" class="outline-4">
<h4 id="org19c6599"><span class="section-number-4">2.63.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-63-1">
<blockquote>
<p>
The idea of smoothing a function is an important concept in signal processing.
If \(f\) is a function and \(dx\) is some small number, then the smoothed
version of \(f\) is the function whose value at a point \(x\) is the average of
\(f(x - dx)\), \(f(x)\), and \(f(x + dx)\). Write a procedure <code class="src src-scheme">smooth</code>
that takes as input a procedure that computes \(f\) and returns a procedure that
computes the smoothed \(f\). It is sometimes valuable to repeatedly smooth a
function (that is, smooth the smoothed function, and so on) to obtain the
\(n\)-fold smoothed function. Show how to generate the \(n\)-fold smoothed
function of any given function using <code class="src src-scheme">smooth</code> and <code class="src src-scheme">repeated</code>
from Exercise 1.43.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orga790372" class="outline-4">
<h4 id="orga790372"><span class="section-number-4">2.63.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-63-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org4d1cf40"><span style="color: #ECBE7B;">&lt;&lt;average-varargs&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">smooth</span> f<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>average <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span>- x dx<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span>f x<span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span>+ x dx<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">smooth-n</span> f n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>repeated smooth n<span style="color: #99bb66;">)</span> f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org30c71dd" class="outline-3">
<h3 id="org30c71dd"><span class="section-number-3">2.64.</span> Exercise 1.45</h3>
<div class="outline-text-3" id="text-2-64">
</div>

<div id="outline-container-org6800a54" class="outline-4">
<h4 id="org6800a54"><span class="section-number-4">2.64.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-64-1">
<blockquote>
<p>
We saw in 1.3.3 that attempting to compute square roots by naively finding a
fixed point of \(y \mapsto x / y\) does not converge, and that this can be fixed
by average damping. The same method works for finding cube roots as fixed points
of the average-damped \(y \mapsto x / y^2\). Unfortunately, the process does not
work for fourth roots&#x2014;a single average damp is not enough to make a
fixed-point search for \(y \mapsto x / y^3\) converge. On the other hand, if we
average damp twice (i.e., use the average damp of the average damp of \(y
\mapsto x / y^3\)) the fixed-point search does converge. Do some experiments to
determine how many average damps are required to compute \(n^{\mathrm{th}}\)
roots as a fixed-point search based upon repeated average damping of \(y \mapsto
x / y^{n-1}\). Use this to implement a simple procedure for computing
\(n^{\mathrm{th}}\) roots using <code class="src src-scheme">fixed-point~, ~average-damp</code>, and the
<code class="src src-scheme">repeated</code> procedure of Exercise 1.43. Assume that any arithmetic
operations you need are available as primitives.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org8e2bf2d" class="outline-4">
<h4 id="org8e2bf2d"><span class="section-number-4">2.64.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-64-2">
<p>
So this is strange. Back in my original workthrough of this book, I&rsquo;d decided
that finding an \(n\)th root required \(\lfloor\sqrt{n}\rfloor\) dampings. With
a solution like this:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;fixed-point-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;repeated&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;average-damp&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>fixed-point
   <span style="color: #99bb66;">(</span>average-damp
    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
   <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">nth-root</span> x n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>fixed-point
   <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>repeated average-damp <span style="color: #51afef;">(</span>ceiling <span style="color: #c678dd;">(</span>sqrt n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>/ x <span style="color: #c678dd;">(</span>expt y <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
   <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
While this solution appears to work fine, my experiments are suggesting that it
takes <i>less</i> than \(\lfloor\sqrt{n}\rfloor\). For example, I originally thought
powers of 16 required four dampings, but this code isn&rsquo;t failing until it
reaches powers of 32.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org6cabf77"><span style="color: #525252;">;; </span><span style="color: #525252;">Version of "repeated" that can handle being asked to repeat zero times.</span>
<span style="color: #ECBE7B;">&lt;&lt;compose&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;identity&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">repeated</span> f n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> m<span style="color: #99bb66;">)</span>
  <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
      f
      <span style="color: #a9a1e1;">(</span>repeated <span style="color: #51afef;">(</span>compose f f<span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
      identity
      <span style="color: #99bb66;">(</span>rec n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org7755157"><span style="color: #525252;">;; </span><span style="color: #525252;">version of "fixed-point" that will give up after a certain number of guesses.</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">limited-fixed-point</span> f first-guess<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">limit</span> <span style="color: #dd8844; font-weight: bold;">5000</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tolerance</span> <span style="color: #dd8844; font-weight: bold;">0.00000001</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">close-enough?</span> v1 v2<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>abs <span style="color: #51afef;">(</span>- v1 v2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> 
       tolerance<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try</span> guess tries<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= tries limit<span style="color: #a9a1e1;">)</span>
        <span style="color: #99bb66;">"LIMIT REACHED"</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>next <span style="color: #99bb66;">(</span>f guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>close-enough? guess next<span style="color: #c678dd;">)</span>
              next
              <span style="color: #c678dd;">(</span>try next <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> tries<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>try first-guess <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Let&rsquo;s automatically find how many dampings are necessary. We can make a program
that finds higher and higher \(n\)th roots, and adds another layer of damping
when it hits the error. It returns a list of \(n\)th roots along with how many
dampings were needed to find them.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org1440342"><span style="color: #ECBE7B;">&lt;&lt;fixed-point-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;limited-fixed-point&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;repeated&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;average-damp&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;average&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;print-table&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt</span> x<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>fixed-point
   <span style="color: #99bb66;">(</span>average-damp
    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
   <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">nth-tester</span> base n-max<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> ll<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>n <span style="color: #c678dd;">(</span>+ <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>length ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">define</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">try</span> damps<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x <span style="color: #a9a1e1;">(</span>limited-fixed-point
                  <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>repeated average-damp damps<span style="color: #c678dd;">)</span>
                   <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>y<span style="color: #99bb66;">)</span>
                     <span style="color: #99bb66;">(</span>/ base <span style="color: #a9a1e1;">(</span>expt y <span style="color: #51afef;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #dd8844; font-weight: bold;">1.1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>string? x<span style="color: #99bb66;">)</span>
              <span style="color: #99bb66;">(</span>try <span style="color: #a9a1e1;">(</span>1+ damps<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
              <span style="color: #99bb66;">(</span>list base n x damps<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>&gt; n n-max<span style="color: #51afef;">)</span>
          ll
          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>try <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> ll<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span>iter '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>t <span style="color: #a9a1e1;">(</span>reverse <span style="color: #51afef;">(</span>nth-tester <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">65</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cons '<span style="color: #99bb66;">(</span><span style="color: #99bb66;">"root"</span> <span style="color: #99bb66;">"result"</span> <span style="color: #99bb66;">"damps needed"</span> <span style="color: #99bb66;">"floor(sqrt(root))"</span> <span style="color: #99bb66;">"floor(log2(root))"</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span>append x
                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>floor <span style="color: #a9a1e1;">(</span>sqrt <span style="color: #51afef;">(</span>car x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                             <span style="color: #99bb66;">(</span>floor <span style="color: #a9a1e1;">(</span>/ <span style="color: #51afef;">(</span>log <span style="color: #c678dd;">(</span>car x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)(</span>log <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> cdr t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org14bff9c" class="figure">
<p><img src="1/fig/1-45-1.png" alt="1-45-1.png" />
</p>
</div>

<p>
I&rsquo;ve spent too much time on this problem already but I have to wonder about
floating-point issues, given that they are the core of the
<code class="src src-scheme">good-enough</code> procedure. I have to wonder whether a
<code class="src src-scheme">fixed-point</code> version that replaces the <code class="src src-scheme">tolerance</code> decision
making, and instead retains the last three guesses and checks for a loop. (TODO)
</p>
</div>
</div>
</div>

<div id="outline-container-orga9fd373" class="outline-3">
<h3 id="orga9fd373"><span class="section-number-3">2.65.</span> Exercise 1.46</h3>
<div class="outline-text-3" id="text-2-65">
</div>

<div id="outline-container-orgfdadfe2" class="outline-4">
<h4 id="orgfdadfe2"><span class="section-number-4">2.65.1.</span> Question</h4>
<div class="outline-text-4" id="text-2-65-1">
<blockquote>
<p>
Several of the numerical methods described in this chapter are instances of an
extremely general computational strategy known as <i>iterative improvement</i>.
Iterative improvement says that, to compute something, we start with an initial
guess for the answer, test if the guess is good enough, and otherwise improve
the guess and continue the process using the improved guess as the new guess.
Write a procedure <code class="src src-scheme">iterative-improve</code> that takes two procedures as
arguments: a method for telling whether a guess is good enough and a method for
improving a guess. <code class="src src-scheme">iterative-improve</code> should return as its value a
procedure that takes a guess as argument and keeps improving the guess until it
is good enough. Rewrite the <code class="src src-scheme">sqrt</code> procedure of 1.1.7 and the
<code class="src src-scheme">fixed-point</code> procedure of 1.3.3 in terms of
<code class="src src-scheme">iterative-improve</code>.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge7358f3" class="outline-4">
<h4 id="orge7358f3"><span class="section-number-4">2.65.2.</span> Answer</h4>
<div class="outline-text-4" id="text-2-65-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org7d72409"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">iterative-improve</span> good-enough? improve<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> guess<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>next <span style="color: #c678dd;">(</span>improve guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>good-enough? guess next<span style="color: #51afef;">)</span>
<span class="linenr">5: </span>          next
<span class="linenr">6: </span>          <span style="color: #51afef;">(</span>iter next<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  iter<span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgd1fd29c"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;iterative-improve&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tolerance</span> <span style="color: #dd8844; font-weight: bold;">0.00001</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fixed-point-improve</span> f first-guess<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">close-enough?</span> v1 v2<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>abs <span style="color: #51afef;">(</span>- v1 v2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 7: </span>       tolerance<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>iterative-improve
<span class="linenr"> 9: </span>    close-enough?
<span class="linenr">10: </span>    f<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>   first-guess<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org8cbc245"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;average&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;iterative-improve&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">improve</span> guess x<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>average guess <span style="color: #99bb66;">(</span>/ x guess<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">good-enough?</span> next x<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">(= guess next)) ;; no longer works with this method</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>&lt; <span style="color: #99bb66;">(</span>abs <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>square next<span style="color: #51afef;">)</span> x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0.001</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sqrt-improve</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>iterative-improve
<span class="linenr">11: </span>    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>guess next<span style="color: #51afef;">)(</span>good-enough? next x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>guess<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>improve guess x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>   <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;fixed-point-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;fixed-point-improve&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"fixed-point-improve still working"</span>
<span class="linenr"> 5: </span>                 <span style="color: #c678dd;">(</span>fixed-point <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">1.1</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>                 <span style="color: #c678dd;">(</span>fixed-point-improve <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">1.1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt-improve&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"sqrt-improve still working"</span>
<span class="linenr">10: </span>                 <span style="color: #c678dd;">(</span>sqrt <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                 <span style="color: #c678dd;">(</span>sqrt-improve <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org159fb48">
SUCCEED at fixed-point-improve still working
SUCCEED at sqrt-improve still working
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb929002" class="outline-2">
<h2 id="orgb929002"><span class="section-number-2">3.</span> Chapter 2: Building Abstractions with Data</h2>
<div class="outline-text-2" id="text-3">
<p>
The basic representations of data we&rsquo;ve used so far aren&rsquo;t enough to deal with
complex, real-world phenomena. We need to combine these representations to form
<b>compound data</b>.
</p>

<p>
The technique of isolating how data objects are <i>represented</i> from how they are
<i>used</i> is called <b>data abstraction</b>.
</p>
</div>

<div id="outline-container-org672a852" class="outline-3">
<h3 id="org672a852"><span class="section-number-3">3.1.</span> 2.1.1: Example: Arithmetic Operations for Rational Numbers</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Lisp gives the procedures <code class="src src-scheme">cons</code>, <code class="src src-scheme">car</code>, and <code class="src src-scheme">cdr</code>
to create <b>pairs</b>. This is an easy system for representing rational numbers.
</p>

<p>
Note that the system proposed for representing and working with rational numbers
has <b>abstraction barriers</b> isolating different parts of the system. The parts
that use rational numbers don&rsquo;t know how the constructors and selectors for
rational numbers work, and the constructors and selectors use the underlying
Lisp interpreter&rsquo;s pair functions without caring how they work.
</p>

<p>
Note that these abstraction layers allow the developer to change the underlying
architecture without modifying the programs that depend on it.
</p>
</div>
</div>

<div id="outline-container-org7725d27" class="outline-3">
<h3 id="org7725d27"><span class="section-number-3">3.2.</span> Exercise 2.1</h3>
<div class="outline-text-3" id="text-3-2">
</div>

<div id="outline-container-orgc55d891" class="outline-4">
<h4 id="orgc55d891"><span class="section-number-4">3.2.1.</span> Text</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org34a1646"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-rat</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>make-rat <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 3: </span>               <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>            <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>denom x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>denom y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-rat</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>make-rat <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>               <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>            <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>denom x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>denom y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-rat</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>make-rat <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>numer x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>numer y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>            <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>denom x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>denom y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-rat</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>make-rat <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>numer x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>denom y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>            <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>denom x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>numer y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equal-rat?</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>numer x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>denom y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>     <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>numer y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>denom x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org31ef4e3"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rat</span> n d<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cons n d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">numer</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">denom</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org4386685"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">print-rat</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">(</span>numer x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">"/"</span><span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">(</span>denom x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgc2fe3ce"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">one-half</span> <span style="color: #c678dd;">(</span>make-rat <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">one-third</span> <span style="color: #c678dd;">(</span>make-rat <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>print-rat one-half<span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>print-rat
<span class="linenr">5: </span> <span style="color: #c678dd;">(</span>mul-rat one-half one-third<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<pre class="example" id="orgcfb6e2c">
1/2
1/6
</pre>
</div>
</div>

<div id="outline-container-org81ae6ec" class="outline-4">
<h4 id="org81ae6ec"><span class="section-number-4">3.2.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-2-2">
<blockquote>
<p>
Define a better version of <code class="src src-scheme">make-rat</code> that handles both positive and
negative arguments. <code class="src src-scheme">make-rat</code> should normalize the sign so that if
the rational number is positive, both the numerator and denominator are
positive, and if the rational number is negative, only the numerator is
negative.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org723b8d4" class="outline-4">
<h4 id="org723b8d4"><span class="section-number-4">3.2.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-2-3">
<div class="org-src-container">
<pre class="src src-scheme" id="orgbb21d1c"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;abs&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rat</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span>&lt; n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>              <span style="color: #c678dd;">(</span>&lt; d <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span>cons n d<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>&lt; n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>              <span style="color: #51afef;">(</span>&lt; d <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>         <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>- n<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>- d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>- <span style="color: #c678dd;">(</span>abs n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>abs d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">numer</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">denom</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Bonus: an attempt to optimize</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rat-opt</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>nn <span style="color: #51afef;">(</span>&lt; n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>        <span style="color: #a9a1e1;">(</span>dn <span style="color: #51afef;">(</span>&lt; d <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> nn dn<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>           <span style="color: #51afef;">(</span>cons n d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> nn dn<span style="color: #51afef;">)</span>
<span class="linenr">21: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>- n<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>- d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">23: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>- <span style="color: #99bb66;">(</span>abs n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>abs d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;make-rat&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;print-rat-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;rat-ops-txt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-rat double negative"</span>
<span class="linenr"> 6: </span>           <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>           <span style="color: #c678dd;">(</span>make-rat <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-rat numerator negative"</span>
<span class="linenr"> 9: </span>           <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>           <span style="color: #c678dd;">(</span>make-rat <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-rat denominator negative"</span>
<span class="linenr">12: </span>           <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>           <span style="color: #c678dd;">(</span>make-rat <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-rat-opt double negative"</span>
<span class="linenr">15: </span>           <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>           <span style="color: #c678dd;">(</span>make-rat-opt <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-rat-opt numerator negative"</span>
<span class="linenr">18: </span>           <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>           <span style="color: #c678dd;">(</span>make-rat-opt <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-rat-opt denominator negative"</span>
<span class="linenr">21: </span>           <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>           <span style="color: #c678dd;">(</span>make-rat-opt <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orge357856">
SUCCEED at make-rat double negative
SUCCEED at make-rat numerator negative
SUCCEED at make-rat denominator negative
SUCCEED at make-rat-opt double negative
SUCCEED at make-rat-opt numerator negative
SUCCEED at make-rat-opt denominator negative
</pre>

<p>
My &ldquo;optimized&rdquo; version shows no benefit at all:
</p>
<pre class="example" id="org90da3f6">
unoptimized make-rat: ((1 . 2) 231.74267794)
optimized make-rat: ((1 . 2) 233.99087033)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a93c8b" class="outline-3">
<h3 id="org3a93c8b"><span class="section-number-3">3.3.</span> Exercise 2.2</h3>
<div class="outline-text-3" id="text-3-3">
</div>

<div id="outline-container-org601f529" class="outline-4">
<h4 id="org601f529"><span class="section-number-4">3.3.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-3-1">
<blockquote>
<p>
Consider the problem of representing line segments in a plane. Each segment is
represented as a pair of points: a starting point and an ending point. Define a
constructor <code class="src src-scheme">make-segment</code> and selectors <code class="src src-scheme">start-segment</code> and
<code class="src src-scheme">end-segment</code> that define the representation of segments in terms of
points. Furthermore, a point can be represented as a pair of numbers: the \(x\)
coordinate and the \(y\) coordinate. Accordingly, specify a constructor
<code class="src src-scheme">make-point</code> and selectors <code class="src src-scheme">x-point</code> and <code class="src src-scheme">y-point</code>
that define this representation. Finally, using your selectors and constructors,
define a procedure <code class="src src-scheme">midpoint-segment</code> that takes a line segment as
argument and returns its midpoint (the point whose coordinates are the average
of the coordinates of the endpoints). To try your procedures, you&rsquo;ll need a way
to print points:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="org8a39be1"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">print-point</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">"("</span><span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">(</span>x-point p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">","</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">(</span>y-point p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">")"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb3bcc5" class="outline-4">
<h4 id="orgfb3bcc5"><span class="section-number-4">3.3.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-3-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org1dd8a5e"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;average&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-point</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>cons x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">x-point</span> p<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">y-point</span> p<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>cdr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-segment</span> start end<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>cons start end<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">start-segment</span> seg<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>car seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">end-segment</span> seg<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>cdr seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">midpoint-segment</span> seg<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>make-point <span style="color: #99bb66;">(</span>average <span style="color: #a9a1e1;">(</span>x-point <span style="color: #51afef;">(</span>start-segment seg<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>                       <span style="color: #a9a1e1;">(</span>x-point <span style="color: #51afef;">(</span>end-segment seg<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>              <span style="color: #99bb66;">(</span>average <span style="color: #a9a1e1;">(</span>y-point <span style="color: #51afef;">(</span>start-segment seg<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>                       <span style="color: #a9a1e1;">(</span>y-point <span style="color: #51afef;">(</span>end-segment seg<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">midpoint-segment-opt</span> seg<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>ax <span style="color: #51afef;">(</span>x-point <span style="color: #c678dd;">(</span>start-segment seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>        <span style="color: #a9a1e1;">(</span>bx <span style="color: #51afef;">(</span>x-point <span style="color: #c678dd;">(</span>end-segment seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>        <span style="color: #a9a1e1;">(</span>ay <span style="color: #51afef;">(</span>y-point <span style="color: #c678dd;">(</span>start-segment seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">23: </span>        <span style="color: #a9a1e1;">(</span>by <span style="color: #51afef;">(</span>y-point <span style="color: #c678dd;">(</span>end-segment seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>  <span style="color: #99bb66;">(</span>make-point <span style="color: #a9a1e1;">(</span>average ax
<span class="linenr">25: </span>                       bx<span style="color: #a9a1e1;">)</span>
<span class="linenr">26: </span>              <span style="color: #a9a1e1;">(</span>average ay
<span class="linenr">27: </span>                       by<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org5281416"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;make-point&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-point"</span>
<span class="linenr"> 4: </span>           <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>           <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>p <span style="color: #51afef;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>             <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>x-point p<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>                   <span style="color: #a9a1e1;">(</span>y-point p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>      <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>      <span style="color: #99bb66;">(</span>s <span style="color: #a9a1e1;">(</span>make-segment p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"make-segment"</span>
<span class="linenr">12: </span>             <span style="color: #99bb66;">(</span>list p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>             <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>start-segment s<span style="color: #a9a1e1;">)</span>
<span class="linenr">14: </span>                   <span style="color: #a9a1e1;">(</span>end-segment s<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"midpoint-segment"</span>
<span class="linenr">16: </span>              <span style="color: #99bb66;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>              <span style="color: #99bb66;">(</span>midpoint-segment s<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"midpoint-segment-opt"</span>
<span class="linenr">19: </span>              <span style="color: #99bb66;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>              <span style="color: #99bb66;">(</span>midpoint-segment-opt s<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org2e388e8">
SUCCEED at make-point
SUCCEED at make-segment
SUCCEED at midpoint-segment
SUCCEED at midpoint-segment-opt
</pre>

<p>
And once again my bikeshedding is revealed:
</p>
<pre class="example" id="org41e57df">
unoptimized make-rat: ((0.0 . 0.0) 326.94653558)
optimized make-rat: ((0.0 . 0.0) 331.83410742)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4612f4" class="outline-3">
<h3 id="orgc4612f4"><span class="section-number-3">3.4.</span> Exercise 2.3</h3>
<div class="outline-text-3" id="text-3-4">
</div>

<div id="outline-container-org4ac2020" class="outline-4">
<h4 id="org4ac2020"><span class="section-number-4">3.4.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-4-1">
<blockquote>
<p>
Implement a representation for rectangles in a plane. (Hint: You may want to
make use of Exercise 2.2.) In terms of your constructors and selectors, create
procedures that compute the perimeter and the area of a given rectangle. Now
implement a different representation for rectangles. Can you design your system
with suitable abstraction barriers, so that the same perimeter and area
procedures will work using either representation?
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org831a79c" class="outline-4">
<h4 id="org831a79c"><span class="section-number-4">3.4.2.</span> Answer 1</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
I don&rsquo;t really like the &ldquo;wishful thinking&rdquo; process the book advocates but since
this question specifically regards abstraction, I&rsquo;ll start by writing the two
requested procedures first.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org7780360"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-area</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #99bb66;">(</span>rect-height R<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>     <span style="color: #99bb66;">(</span>rect-width R<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-peri</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">2</span>
<span class="linenr">7: </span>     <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>rect-height R<span style="color: #a9a1e1;">)</span>
<span class="linenr">8: </span>        <span style="color: #a9a1e1;">(</span>rect-width R<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
So my &ldquo;wishlist&rdquo; is just for <code class="src src-scheme"><span style="color: #51afef;">(</span>rect-area R<span style="color: #51afef;">)</span></code> and <code class="src src-scheme"><span style="color: #51afef;">(</span>rect-width R<span style="color: #51afef;">)</span></code>.
</p>

<p>
So, my first implementation of a rectangle will be of a list of 3 points
\(\mathrm{ABC}\), with the fourth point \(\mathrm{D}\) being constructed from
the others. I haven&rsquo;t done geometry lessons in a while but logically I can
deduce that \(\mathrm{D}\) is as far from \(\mathrm{A}\) as \(\mathrm{B}\) is
from \(\mathrm{C}\), and as far from \(\mathrm{C}\) as \(\mathrm{A}\) is from
\(\mathrm{B}\). by experimentation I&rsquo;ve figured out that
\(\mathrm{D}=\mathrm{A} + (\mathrm{C}-\mathrm{B})=\mathrm{C} +
(\mathrm{A}-\mathrm{B})\).
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org1e096f6"><span class="linenr"> 1: </span><span style="color: #525252;">;;   </span><span style="color: #525252;">AB = width</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;;</span><span style="color: #525252;">(0,1) (1,1)</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">A-----B</span>
<span class="linenr"> 4: </span><span style="color: #525252;">;; </span><span style="color: #525252;">|     | BC = height</span>
<span class="linenr"> 5: </span><span style="color: #525252;">;; </span><span style="color: #525252;">D-----C</span>
<span class="linenr"> 6: </span><span style="color: #525252;">;;</span><span style="color: #525252;">(0,0) (1,0)</span>
<span class="linenr"> 7: </span><span style="color: #525252;">;; </span><span style="color: #525252;">could be rotated any direction</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;make-point&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rect</span> a b c<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>cons a b<span style="color: #99bb66;">)</span> c<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-a</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>caar R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-b</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>cdar R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-c</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>cdr R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #525252;">;</span><span style="color: #525252;">(define (rect-d R)</span>
<span class="linenr">19: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(make-point (x-point (rect-a R))</span>
<span class="linenr">20: </span><span style="color: #525252;">;              </span><span style="color: #525252;">(y-point (rect-c R))))</span>
<span class="linenr">21: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Wait, this won't work if the rectangle is angled.</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-points</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span>make-point <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>x-point a<span style="color: #a9a1e1;">)</span>
<span class="linenr">25: </span>                 <span style="color: #a9a1e1;">(</span>x-point b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>              <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>y-point a<span style="color: #a9a1e1;">)</span>
<span class="linenr">27: </span>                 <span style="color: #a9a1e1;">(</span>y-point b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">28: </span>
<span class="linenr">29: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-points</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">30: </span>  <span style="color: #c678dd;">(</span>make-point <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>x-point a<span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>                 <span style="color: #a9a1e1;">(</span>x-point b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>              <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>y-point a<span style="color: #a9a1e1;">)</span>
<span class="linenr">33: </span>                 <span style="color: #a9a1e1;">(</span>y-point b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">34: </span>
<span class="linenr">35: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-d</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>a <span style="color: #51afef;">(</span>rect-a R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">37: </span>        <span style="color: #a9a1e1;">(</span>b <span style="color: #51afef;">(</span>rect-b R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">38: </span>        <span style="color: #a9a1e1;">(</span>c <span style="color: #51afef;">(</span>rect-c R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">39: </span>    <span style="color: #99bb66;">(</span>add-points a
<span class="linenr">40: </span>                <span style="color: #a9a1e1;">(</span>sub-points c b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">41: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-d-alt</span> R<span style="color: #c678dd;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">should be mathematically identical.</span>
<span class="linenr">42: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>a <span style="color: #51afef;">(</span>rect-a R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">43: </span>        <span style="color: #a9a1e1;">(</span>b <span style="color: #51afef;">(</span>rect-b R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">44: </span>        <span style="color: #a9a1e1;">(</span>c <span style="color: #51afef;">(</span>rect-c R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">45: </span>    <span style="color: #99bb66;">(</span>add-points c
<span class="linenr">46: </span>                <span style="color: #a9a1e1;">(</span>sub-points a b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">47: </span>
<span class="linenr">48: </span><span style="color: #525252;">;; </span><span style="color: #525252;">this is incorrect</span>
<span class="linenr">49: </span><span style="color: #525252;">;</span><span style="color: #525252;">(define (length-points a b)</span>
<span class="linenr">50: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(let ((diffP (sub-points a b)))</span>
<span class="linenr">51: </span><span style="color: #525252;">;    </span><span style="color: #525252;">(+ (abs (x-point diffP))</span>
<span class="linenr">52: </span><span style="color: #525252;">;       </span><span style="color: #525252;">(abs (y-point diffP)))))</span>
<span class="linenr">53: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">length-points</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">54: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>ax <span style="color: #51afef;">(</span>x-point a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">55: </span>        <span style="color: #a9a1e1;">(</span>ay <span style="color: #51afef;">(</span>y-point a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">56: </span>        <span style="color: #a9a1e1;">(</span>bx <span style="color: #51afef;">(</span>x-point b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">57: </span>        <span style="color: #a9a1e1;">(</span>by <span style="color: #51afef;">(</span>y-point b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">58: </span>    <span style="color: #99bb66;">(</span>sqrt <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>- ax bx<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">59: </span>          <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>- ay by<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">60: </span>
<span class="linenr">61: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-height</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">62: </span>  <span style="color: #c678dd;">(</span>abs <span style="color: #99bb66;">(</span>length-points <span style="color: #a9a1e1;">(</span>rect-b R<span style="color: #a9a1e1;">)</span>
<span class="linenr">63: </span>                 <span style="color: #a9a1e1;">(</span>rect-c R<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">64: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-width</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">65: </span>  <span style="color: #c678dd;">(</span>abs <span style="color: #99bb66;">(</span>length-points <span style="color: #a9a1e1;">(</span>rect-b R<span style="color: #a9a1e1;">)</span>
<span class="linenr">66: </span>                 <span style="color: #a9a1e1;">(</span>rect-a R<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">67: </span>
<span class="linenr">68: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">length-segment</span> seg<span style="color: #c678dd;">)</span>
<span class="linenr">69: </span>  <span style="color: #c678dd;">(</span>abs <span style="color: #99bb66;">(</span>length-points <span style="color: #a9a1e1;">(</span>start-segment seg<span style="color: #a9a1e1;">)</span>
<span class="linenr">70: </span>                 <span style="color: #a9a1e1;">(</span>end-segment seg<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org6737907"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;rect-4pt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;rect-area-peri&gt;&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>a <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">13</span> <span style="color: #dd8844; font-weight: bold;">14</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span>b <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">14</span> <span style="color: #dd8844; font-weight: bold;">14</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       <span style="color: #99bb66;">(</span>c <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">14</span> <span style="color: #dd8844; font-weight: bold;">13</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>       <span style="color: #99bb66;">(</span>d <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">13</span> <span style="color: #dd8844; font-weight: bold;">13</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>       <span style="color: #99bb66;">(</span>ABC <span style="color: #a9a1e1;">(</span>make-rect a b c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>       <span style="color: #99bb66;">(</span>CDA <span style="color: #a9a1e1;">(</span>make-rect c d a<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>       <span style="color: #99bb66;">(</span>w <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-2.0</span> <span style="color: #dd8844; font-weight: bold;">-2.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>       <span style="color: #99bb66;">(</span>x <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-0.5</span> <span style="color: #dd8844; font-weight: bold;">-0.5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>       <span style="color: #99bb66;">(</span>y <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-1.5</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>       <span style="color: #99bb66;">(</span>z <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-3.0</span> <span style="color: #dd8844; font-weight: bold;">-1.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>       <span style="color: #99bb66;">(</span>WXY <span style="color: #a9a1e1;">(</span>make-rect w x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"make-rect"</span>
<span class="linenr">18: </span>             ABC
<span class="linenr">19: </span>             <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>cons a b<span style="color: #a9a1e1;">)</span> c<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-d and rect-d-alt (ABCD)"</span>
<span class="linenr">21: </span>             <span style="color: #99bb66;">(</span>rect-d ABC<span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>             <span style="color: #99bb66;">(</span>rect-d-alt ABC<span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>             d<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-d and rect-d-alt (CDAB)"</span>
<span class="linenr">25: </span>             <span style="color: #99bb66;">(</span>rect-d CDA<span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>             <span style="color: #99bb66;">(</span>rect-d-alt CDA<span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>             b<span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-d and rect-d-alt (WXYZ)"</span>
<span class="linenr">29: </span>             <span style="color: #99bb66;">(</span>rect-d WXY<span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>             <span style="color: #99bb66;">(</span>rect-d-alt WXY<span style="color: #99bb66;">)</span>
<span class="linenr">31: </span>             z<span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-d and rect-d-alt (XYZW)"</span>
<span class="linenr">33: </span>             <span style="color: #99bb66;">(</span>rect-d <span style="color: #a9a1e1;">(</span>make-rect x y z<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">34: </span>             w<span style="color: #c678dd;">)</span>
<span class="linenr">35: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-height ABC"</span>
<span class="linenr">36: </span>             <span style="color: #99bb66;">(</span>rect-height ABC<span style="color: #99bb66;">)</span>
<span class="linenr">37: </span>             <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr">38: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-width ABC"</span>
<span class="linenr">39: </span>             <span style="color: #99bb66;">(</span>rect-width ABC<span style="color: #99bb66;">)</span>
<span class="linenr">40: </span>             <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr">41: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-height WXY"</span>
<span class="linenr">42: </span>             <span style="color: #99bb66;">(</span>rect-height WXY<span style="color: #99bb66;">)</span>
<span class="linenr">43: </span>             <span style="color: #dd8844; font-weight: bold;">1.4142135623730951</span><span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-width WXY"</span>
<span class="linenr">45: </span>             <span style="color: #99bb66;">(</span>rect-width WXY<span style="color: #99bb66;">)</span>
<span class="linenr">46: </span>             <span style="color: #dd8844; font-weight: bold;">2.1213203435596424</span><span style="color: #c678dd;">)</span>
<span class="linenr">47: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-area ABCD"</span>
<span class="linenr">48: </span>             <span style="color: #99bb66;">(</span>rect-area ABC<span style="color: #99bb66;">)</span>
<span class="linenr">49: </span>             <span style="color: #99bb66;">(</span>rect-area CDA<span style="color: #99bb66;">)</span>
<span class="linenr">50: </span>             <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr">51: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-area WXYZ"</span>
<span class="linenr">52: </span>             <span style="color: #99bb66;">(</span>rect-area WXY<span style="color: #99bb66;">)</span>
<span class="linenr">53: </span>             <span style="color: #dd8844; font-weight: bold;">3.0</span><span style="color: #c678dd;">)</span>
<span class="linenr">54: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-peri ABCD"</span>
<span class="linenr">55: </span>             <span style="color: #99bb66;">(</span>rect-peri ABC<span style="color: #99bb66;">)</span>
<span class="linenr">56: </span>             <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span>
<span class="linenr">57: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-peri WXYZ"</span>
<span class="linenr">58: </span>             <span style="color: #99bb66;">(</span>rect-peri WXY<span style="color: #99bb66;">)</span>
<span class="linenr">59: </span>             <span style="color: #dd8844; font-weight: bold;">7.0710678118654755</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org8be5b2d">
SUCCEED at make-rect
SUCCEED at rect-d and rect-d-alt (ABCD)
SUCCEED at rect-d and rect-d-alt (CDAB)
SUCCEED at rect-d and rect-d-alt (WXYZ)
SUCCEED at rect-d and rect-d-alt (XYZW)
SUCCEED at rect-height ABC
SUCCEED at rect-width ABC
SUCCEED at rect-height WXY
SUCCEED at rect-width WXY
SUCCEED at rect-area ABCD
SUCCEED at rect-area WXYZ
SUCCEED at rect-peri ABCD
SUCCEED at rect-peri WXYZ
</pre>
</div>
</div>

<div id="outline-container-org2486979" class="outline-4">
<h4 id="org2486979"><span class="section-number-4">3.4.3.</span> Answer 2</h4>
<div class="outline-text-4" id="text-3-4-3">
<p>
My second implementation will be of a rectangle as an origin, height, width, and
angle. Basically, height and width are two vectors originating from origin, with
width going straight right and height offset \(90\deg\) from width. Angle is
added during conversion from Polar to Cartesian coordinates. In relation to my
1st implementation, point D is where the origin is.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgf68d29d"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;make-point&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">origin is a (make-point), hwa are floats</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rect</span> origin height width angle<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>cons origin height<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>        <span style="color: #99bb66;">(</span>cons width angle<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-origin</span> R<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>caar R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">rect-d</span> rect-origin<span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-height</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>cdar R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-width</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>cadr R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-angle</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>cddr R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #525252;">;; </span><span style="color: #525252;">I underestimated how much math this would take.</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-points</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>make-point <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>x-point a<span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>                 <span style="color: #a9a1e1;">(</span>x-point b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>              <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>y-point a<span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>                 <span style="color: #a9a1e1;">(</span>y-point b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">pi</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #99bb66;">(</span>atan <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">radian</span> deg<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span>* deg <span style="color: #99bb66;">(</span>/ pi <span style="color: #dd8844; font-weight: bold;">180.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">vector-to-xy</span> distance angle<span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>      <span style="color: #525252;">;; </span><span style="color: #525252;">rect-c: (cos(Theta),sin(Theta)) * width</span>
<span class="linenr">29: </span>      <span style="color: #c678dd;">(</span>make-point <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>cos <span style="color: #51afef;">(</span>radian angle<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">30: </span>                     distance<span style="color: #99bb66;">)</span>
<span class="linenr">31: </span>                  <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>sin <span style="color: #51afef;">(</span>radian angle<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">32: </span>                     distance<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">33: </span>      <span style="color: #525252;">;; </span><span style="color: #525252;">could also be rotated by 90 degrees just by using</span>
<span class="linenr">34: </span>      <span style="color: #525252;">;;   </span><span style="color: #525252;">(-sin(Theta),cos(Theta)) * height</span>
<span class="linenr">35: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-c</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>  <span style="color: #c678dd;">(</span>add-points
<span class="linenr">37: </span>   <span style="color: #99bb66;">(</span>rect-origin R<span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>   <span style="color: #99bb66;">(</span>vector-to-xy <span style="color: #a9a1e1;">(</span>rect-width R<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>rect-angle R<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">39: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-a</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">40: </span>  <span style="color: #c678dd;">(</span>add-points
<span class="linenr">41: </span>   <span style="color: #99bb66;">(</span>rect-origin R<span style="color: #99bb66;">)</span>
<span class="linenr">42: </span>   <span style="color: #99bb66;">(</span>vector-to-xy <span style="color: #a9a1e1;">(</span>rect-height R<span style="color: #a9a1e1;">)</span>
<span class="linenr">43: </span>                 <span style="color: #a9a1e1;">(</span>+ <span style="color: #dd8844; font-weight: bold;">90</span> <span style="color: #51afef;">(</span>rect-angle R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">44: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rect-b</span> R<span style="color: #c678dd;">)</span>
<span class="linenr">45: </span>  <span style="color: #c678dd;">(</span>add-points
<span class="linenr">46: </span>   <span style="color: #99bb66;">(</span>rect-origin R<span style="color: #99bb66;">)</span>
<span class="linenr">47: </span>   <span style="color: #99bb66;">(</span>add-points
<span class="linenr">48: </span>    <span style="color: #a9a1e1;">(</span>vector-to-xy <span style="color: #51afef;">(</span>rect-width R<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>rect-angle R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">49: </span>    <span style="color: #a9a1e1;">(</span>vector-to-xy <span style="color: #51afef;">(</span>rect-height R<span style="color: #51afef;">)</span>
<span class="linenr">50: </span>                  <span style="color: #51afef;">(</span>+ <span style="color: #dd8844; font-weight: bold;">90</span> <span style="color: #c678dd;">(</span>rect-angle R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgeb531c0"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;rect-ohwa&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;rect-area-peri&gt;&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>a <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">13.0</span> <span style="color: #dd8844; font-weight: bold;">14.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span>b <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">14.0</span> <span style="color: #dd8844; font-weight: bold;">14.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       <span style="color: #99bb66;">(</span>c <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">14.0</span> <span style="color: #dd8844; font-weight: bold;">13.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>       <span style="color: #99bb66;">(</span>d <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">13.0</span> <span style="color: #dd8844; font-weight: bold;">13.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>       <span style="color: #99bb66;">(</span>ABC <span style="color: #a9a1e1;">(</span>make-rect d <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>       <span style="color: #99bb66;">(</span>CDA <span style="color: #a9a1e1;">(</span>make-rect b <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">180</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>       <span style="color: #99bb66;">(</span>w <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-2.0</span> <span style="color: #dd8844; font-weight: bold;">-2.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>       <span style="color: #99bb66;">(</span>x <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-2.5</span> <span style="color: #dd8844; font-weight: bold;">1.5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>       <span style="color: #99bb66;">(</span>y <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-1.5</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>       <span style="color: #99bb66;">(</span>z <span style="color: #a9a1e1;">(</span>make-point <span style="color: #dd8844; font-weight: bold;">-3.0</span> <span style="color: #dd8844; font-weight: bold;">-1.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>       <span style="color: #99bb66;">(</span>wxy-height <span style="color: #dd8844; font-weight: bold;">1.4142135623730951</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>       <span style="color: #99bb66;">(</span>wxy-width <span style="color: #dd8844; font-weight: bold;">2.1213203435596424</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>       <span style="color: #99bb66;">(</span>WXY <span style="color: #a9a1e1;">(</span>make-rect z wxy-height wxy-width <span style="color: #dd8844; font-weight: bold;">45</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"make-rect"</span>
<span class="linenr">20: </span>             ABC
<span class="linenr">21: </span>             <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>cons d <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-b (ABCD)"</span>
<span class="linenr">23: </span>             <span style="color: #99bb66;">(</span>rect-b ABC<span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>             b<span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-b (CDAB)"</span>
<span class="linenr">26: </span>             <span style="color: #99bb66;">(</span>rect-b CDA<span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>             d<span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-b (WXYZ)"</span>
<span class="linenr">29: </span>             <span style="color: #99bb66;">(</span>rect-b WXY<span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>             x<span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-height"</span>
<span class="linenr">32: </span>             <span style="color: #99bb66;">(</span>rect-height WXY<span style="color: #99bb66;">)</span>
<span class="linenr">33: </span>             wxy-height<span style="color: #c678dd;">)</span>
<span class="linenr">34: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-width"</span>
<span class="linenr">35: </span>             <span style="color: #99bb66;">(</span>rect-width WXY<span style="color: #99bb66;">)</span>
<span class="linenr">36: </span>             wxy-width<span style="color: #c678dd;">)</span>
<span class="linenr">37: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-area ABCD"</span>
<span class="linenr">38: </span>             <span style="color: #99bb66;">(</span>rect-area ABC<span style="color: #99bb66;">)</span>
<span class="linenr">39: </span>             <span style="color: #99bb66;">(</span>rect-area CDA<span style="color: #99bb66;">)</span>
<span class="linenr">40: </span>             <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr">41: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-area WXYZ"</span>
<span class="linenr">42: </span>             <span style="color: #99bb66;">(</span>rect-area WXY<span style="color: #99bb66;">)</span>
<span class="linenr">43: </span>             <span style="color: #dd8844; font-weight: bold;">3.0</span><span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-peri ABCD"</span>
<span class="linenr">45: </span>             <span style="color: #99bb66;">(</span>rect-peri ABC<span style="color: #99bb66;">)</span>
<span class="linenr">46: </span>             <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span>
<span class="linenr">47: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"rect-peri WXYZ"</span>
<span class="linenr">48: </span>             <span style="color: #99bb66;">(</span>rect-peri WXY<span style="color: #99bb66;">)</span>
<span class="linenr">49: </span>             <span style="color: #dd8844; font-weight: bold;">7.0710678118654755</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org6aacd86">
SUCCEED at make-rect
SUCCEED at rect-b (ABCD)
SUCCEED at rect-b (CDAB)
SUCCEED at rect-b (WXYZ)
SUCCEED at rect-height
SUCCEED at rect-width
SUCCEED at rect-area ABCD
SUCCEED at rect-area WXYZ
SUCCEED at rect-peri ABCD
SUCCEED at rect-peri WXYZ
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd56f180" class="outline-3">
<h3 id="orgd56f180"><span class="section-number-3">3.5.</span> 2.1.3: What Is Meant by Data?</h3>
<div class="outline-text-3" id="text-3-5">
<p>
We can consider data as being a collection of selectors and constructors,
together with specific conditions that these procedures must fulfill in order to
be a valid representation. For example, in the case of our rational number
implementation, for rational number \(x\) made with numerator \(n\) and
denominator \(d\), dividing the result of <code class="src src-scheme"><span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span></code> over the result
of <code class="src src-scheme"><span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span></code> should be equivalent to dividing \(n\) over \(d\).
</p>
</div>
</div>

<div id="outline-container-org0a269c1" class="outline-3">
<h3 id="org0a269c1"><span class="section-number-3">3.6.</span> Exercise 2.4</h3>
<div class="outline-text-3" id="text-3-6">
</div>

<div id="outline-container-org0070f10" class="outline-4">
<h4 id="org0070f10"><span class="section-number-4">3.6.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-6-1">
<blockquote>
<p>
Here is an alternative procedural representation of pairs. For this
representation, verify that <code class="src src-scheme"><span style="color: #51afef;">(</span>car <span style="color: #c678dd;">(</span>cons x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code> yields <code class="src src-scheme">x</code> for any
objects <code class="src src-scheme">x</code> and <code class="src src-scheme">y</code>.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="org0c097c8"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cons</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>m<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>m x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">car</span> z<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>z <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p q<span style="color: #a9a1e1;">)</span> p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
What is the corresponding definition of <code class="src src-scheme">cdr</code>? (Hint: To verify that
this works, make use of the substitution model of 1.1.5.)
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgade1f73" class="outline-4">
<h4 id="orgade1f73"><span class="section-number-4">3.6.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-6-2">
<p>
First, let&rsquo;s explain with the substitution model.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>m<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>m <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>car <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>m<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>m <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>m<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>m <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p q<span style="color: #99bb66;">)</span> p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>cdr <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>m<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>m <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>m<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>m <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p q<span style="color: #99bb66;">)</span> q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #dd8844; font-weight: bold;">1</span>
</pre>
</div>

<p>
Now for implementation.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgd7b7a20"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;alt-pairs-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cdr</span> z<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>z <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p q<span style="color: #a9a1e1;">)</span> q<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>pair <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"car"</span>
<span class="linenr"> 8: </span>             <span style="color: #99bb66;">(</span>car pair<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>             <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"cdr"</span>
<span class="linenr">11: </span>             <span style="color: #99bb66;">(</span>cdr pair<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>             <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org9d390c4">
| (0 . 0) | (0 . 1) | (0 . 2) | (0 . 3) | (0 . 4) | (0 . 5) | (0 . 6) |
| (1 . 0) | (1 . 1) | (1 . 2) | (1 . 3) | (1 . 4) | (1 . 5) | (1 . 6) |
| (2 . 0) | (2 . 1) | (2 . 2) | (2 . 3) | (2 . 4) | (2 . 5) | (2 . 6) |
| (3 . 0) | (3 . 1) | (3 . 2) | (3 . 3) | (3 . 4) | (3 . 5) | (3 . 6) |
| (4 . 0) | (4 . 1) | (4 . 2) | (4 . 3) | (4 . 4) | (4 . 5) | (4 . 6) |
| (5 . 0) | (5 . 1) | (5 . 2) | (5 . 3) | (5 . 4) | (5 . 5) | (5 . 6) |
| (6 . 0) | (6 . 1) | (6 . 2) | (6 . 3) | (6 . 4) | (6 . 5) | (6 . 6) |
</pre>
</div>
</div>
</div>

<div id="outline-container-org1155f55" class="outline-3">
<h3 id="org1155f55"><span class="section-number-3">3.7.</span> Exercise 2.5&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></h3>
<div class="outline-text-3" id="text-3-7">
</div>

<div id="outline-container-org39c45df" class="outline-4">
<h4 id="org39c45df"><span class="section-number-4">3.7.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-7-1">
<blockquote>
<p>
Show that we can represent pairs of nonnegative integers using only numbers and
arithmetic operations if we represent the pair \(a\) and \(b\) as the integer
that is the product \(2^a 3^b\). Give the corresponding definitions of the
procedures <code class="src src-scheme">cons</code>, <code class="src src-scheme">car</code>, and <code class="src src-scheme">cdr</code>.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org8c5bfdf" class="outline-4">
<h4 id="org8c5bfdf"><span class="section-number-4">3.7.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-7-2">
<p>
This one really blew my mind inside-out when I first did it. Basically, because
the two numbers are coprime, you can factor out the unwanted number and be left
with the desired one.
</p>

<blockquote>
<p>
Where \(x\) is the scrambled number, \(p\) is the base we want to remove, \(q\)
is the base we want to retrieve from and \(y\) is the value exponentiating
\(p\), the original number is retrieved by dividing \(x\) by \(p\) for \(y\)
number of times, and then applying \(\log_{q}\) to the result.
</p>
</blockquote>

<p>
First, let&rsquo;s make <code class="src src-scheme">cons</code>.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org40e1967"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cons-nnint</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #99bb66;">(</span>expt <span style="color: #dd8844; font-weight: bold;">2</span> a<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>expt <span style="color: #dd8844; font-weight: bold;">3</span> b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cons-nnint-debug</span> a b<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">DEBUG</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>aa <span style="color: #51afef;">(</span>expt <span style="color: #dd8844; font-weight: bold;">2</span> a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span>bb <span style="color: #51afef;">(</span>expt <span style="color: #dd8844; font-weight: bold;">3</span> b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>         <span style="color: #a9a1e1;">(</span>ab <span style="color: #51afef;">(</span>* aa bb<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span>display aa<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span>newline<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span>display bb<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>    <span style="color: #99bb66;">(</span>newline<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span>display ab<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>    <span style="color: #99bb66;">(</span>newline<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>    ab<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Also, Guile doesn&rsquo;t have a function for custom logs so let&rsquo;s define that now.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org0946279"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">logn</span> b p<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>log p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>log b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Let&rsquo;s do some analysis to see how these numbers are related.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="orgda96f56"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;cons-nnint&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span>
<span class="linenr"> 3: </span>    <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>tablesize <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>     <span style="color: #99bb66;">(</span>inputs <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>                    <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>y<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>                           <span style="color: #a9a1e1;">(</span>cons x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>                         <span style="color: #99bb66;">(</span>iota tablesize<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>                  <span style="color: #51afef;">(</span>iota tablesize<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>     <span style="color: #99bb66;">(</span>outputs <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>row<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>col<span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>                            <span style="color: #a9a1e1;">(</span>cons-nnint <span style="color: #51afef;">(</span>car col<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>cdr col<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>                          row<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                   inputs<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  outputs<span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">9</td>
<td class="org-right">27</td>
<td class="org-right">81</td>
<td class="org-right">243</td>
<td class="org-right">729</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">6</td>
<td class="org-right">18</td>
<td class="org-right">54</td>
<td class="org-right">162</td>
<td class="org-right">486</td>
<td class="org-right">1458</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">12</td>
<td class="org-right">36</td>
<td class="org-right">108</td>
<td class="org-right">324</td>
<td class="org-right">972</td>
<td class="org-right">2916</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">24</td>
<td class="org-right">72</td>
<td class="org-right">216</td>
<td class="org-right">648</td>
<td class="org-right">1944</td>
<td class="org-right">5832</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-right">48</td>
<td class="org-right">144</td>
<td class="org-right">432</td>
<td class="org-right">1296</td>
<td class="org-right">3888</td>
<td class="org-right">11664</td>
</tr>

<tr>
<td class="org-right">32</td>
<td class="org-right">96</td>
<td class="org-right">288</td>
<td class="org-right">864</td>
<td class="org-right">2592</td>
<td class="org-right">7776</td>
<td class="org-right">23328</td>
</tr>

<tr>
<td class="org-right">64</td>
<td class="org-right">192</td>
<td class="org-right">576</td>
<td class="org-right">1728</td>
<td class="org-right">5184</td>
<td class="org-right">15552</td>
<td class="org-right">46656</td>
</tr>
</tbody>
</table>

<p>
Here are our scrambled numbers. 
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgb3095d4"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">To find a number of some base in some column,</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">First divide by unwantedbase for targetcol number of times</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;repeated&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>targetcol <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>      <span style="color: #99bb66;">(</span>unwantedbase <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>row<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>item<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>                <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>repeated <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span> 
<span class="linenr"> 9: </span>                             <span style="color: #51afef;">(</span>/ x unwantedbase<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> targetcol<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>                 item<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                row<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>       data<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">1/9</td>
<td class="org-left">1/3</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">9</td>
<td class="org-right">27</td>
<td class="org-right">81</td>
</tr>

<tr>
<td class="org-left">2/9</td>
<td class="org-left">2/3</td>
<td class="org-right">2</td>
<td class="org-right">6</td>
<td class="org-right">18</td>
<td class="org-right">54</td>
<td class="org-right">162</td>
</tr>

<tr>
<td class="org-left">4/9</td>
<td class="org-left">4/3</td>
<td class="org-right">4</td>
<td class="org-right">12</td>
<td class="org-right">36</td>
<td class="org-right">108</td>
<td class="org-right">324</td>
</tr>

<tr>
<td class="org-left">8/9</td>
<td class="org-left">8/3</td>
<td class="org-right">8</td>
<td class="org-right">24</td>
<td class="org-right">72</td>
<td class="org-right">216</td>
<td class="org-right">648</td>
</tr>

<tr>
<td class="org-left">16/9</td>
<td class="org-left">16/3</td>
<td class="org-right">16</td>
<td class="org-right">48</td>
<td class="org-right">144</td>
<td class="org-right">432</td>
<td class="org-right">1296</td>
</tr>

<tr>
<td class="org-left">32/9</td>
<td class="org-left">32/3</td>
<td class="org-right">32</td>
<td class="org-right">96</td>
<td class="org-right">288</td>
<td class="org-right">864</td>
<td class="org-right">2592</td>
</tr>

<tr>
<td class="org-left">64/9</td>
<td class="org-left">64/3</td>
<td class="org-right">64</td>
<td class="org-right">192</td>
<td class="org-right">576</td>
<td class="org-right">1728</td>
<td class="org-right">5184</td>
</tr>
</tbody>
</table>

<p>
The numbers from our target column onwards are integers, with the target column
being linearly exponentiated by 2 because the original numbers were linear.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org8071258"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;logn&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>wantedbase <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>row<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>item<span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>                <span style="color: #c678dd;">(</span>format #f <span style="color: #99bb66;">"~6,3f"</span> <span style="color: #99bb66;">(</span>logn <span style="color: #dd8844; font-weight: bold;">2</span> item<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span>                row<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>       data<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-3.170</td>
<td class="org-right">-1.585</td>
<td class="org-right">0.000</td>
<td class="org-right">1.585</td>
<td class="org-right">3.170</td>
<td class="org-right">4.755</td>
<td class="org-right">6.340</td>
</tr>

<tr>
<td class="org-right">-2.170</td>
<td class="org-right">-0.585</td>
<td class="org-right">1.000</td>
<td class="org-right">2.585</td>
<td class="org-right">4.170</td>
<td class="org-right">5.755</td>
<td class="org-right">7.340</td>
</tr>

<tr>
<td class="org-right">-1.170</td>
<td class="org-right">0.415</td>
<td class="org-right">2.000</td>
<td class="org-right">3.585</td>
<td class="org-right">5.170</td>
<td class="org-right">6.755</td>
<td class="org-right">8.340</td>
</tr>

<tr>
<td class="org-right">-0.170</td>
<td class="org-right">1.415</td>
<td class="org-right">3.000</td>
<td class="org-right">4.585</td>
<td class="org-right">6.170</td>
<td class="org-right">7.755</td>
<td class="org-right">9.340</td>
</tr>

<tr>
<td class="org-right">0.830</td>
<td class="org-right">2.415</td>
<td class="org-right">4.000</td>
<td class="org-right">5.585</td>
<td class="org-right">7.170</td>
<td class="org-right">8.755</td>
<td class="org-right">10.340</td>
</tr>

<tr>
<td class="org-right">1.830</td>
<td class="org-right">3.415</td>
<td class="org-right">5.000</td>
<td class="org-right">6.585</td>
<td class="org-right">8.170</td>
<td class="org-right">9.755</td>
<td class="org-right">11.340</td>
</tr>

<tr>
<td class="org-right">2.830</td>
<td class="org-right">4.415</td>
<td class="org-right">6.000</td>
<td class="org-right">7.585</td>
<td class="org-right">9.170</td>
<td class="org-right">10.755</td>
<td class="org-right">12.340</td>
</tr>
</tbody>
</table>

<p>
Now the second column has recovered its original values. Although we didn&rsquo;t know
what the original integer values were, we can now tell which column has the
correct numbers by looking at which are integer values.
</p>

<p>
We can use this sign of a correct result in the proposed <code class="src src-scheme">car</code> and
<code class="src src-scheme">cdr</code> procedures.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org2cd5dfc"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;cons-nnint&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;logn&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">all-your-base</span> ab unwanted wanted<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>equal? <span style="color: #a9a1e1;">(</span>modulo ab unwanted<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">(</span>all-your-base <span style="color: #a9a1e1;">(</span>/ ab unwanted<span style="color: #a9a1e1;">)</span> unwanted wanted<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>equal? <span style="color: #51afef;">(</span>modulo ab wanted<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>          <span style="color: #a9a1e1;">(</span>round <span style="color: #51afef;">(</span>logn wanted ab<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>          <span style="color: #99bb66;">"This number isn't a factor!"</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">car-nnint</span> ab<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>all-your-base ab <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cdr-nnint</span> ab<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>all-your-base ab <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>initvalues '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>       <span style="color: #99bb66;">(</span>conslist <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                        <span style="color: #c678dd;">(</span>apply cons-nnint x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>                      initvalues<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>       <span style="color: #99bb66;">(</span>carlist <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>                       <span style="color: #c678dd;">(</span>car-nnint x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>                     conslist<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>       <span style="color: #99bb66;">(</span>cdrlist <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>                       <span style="color: #c678dd;">(</span>cdr-nnint x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span>                     conslist<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cons x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>       <span style="color: #99bb66;">(</span>list <span style="color: #99bb66;">"pairs"</span> <span style="color: #99bb66;">"cons'd"</span> <span style="color: #99bb66;">"car"</span> <span style="color: #99bb66;">"cdr"</span><span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>       <span style="color: #99bb66;">(</span>list initvalues conslist carlist cdrlist<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">pairs</th>
<th scope="col" class="org-right">(2 3)</th>
<th scope="col" class="org-right">(4 5)</th>
<th scope="col" class="org-right">(7 2)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">cons&rsquo;d</td>
<td class="org-right">108</td>
<td class="org-right">3888</td>
<td class="org-right">1152</td>
</tr>

<tr>
<td class="org-left">car</td>
<td class="org-right">2.0</td>
<td class="org-right">4.0</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">cdr</td>
<td class="org-right">3.0</td>
<td class="org-right">5.0</td>
<td class="org-right">2.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org23ba788" class="outline-3">
<h3 id="org23ba788"><span class="section-number-3">3.8.</span> Exercise 2.6&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></h3>
<div class="outline-text-3" id="text-3-8">
</div>

<div id="outline-container-orgfe9891f" class="outline-4">
<h4 id="orgfe9891f"><span class="section-number-4">3.8.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-8-1">
<blockquote>
<p>
In case representing pairs as procedures wasn&rsquo;t mind-boggling enough, consider
that, in a language that can manipulate procedures, we can get by without
numbers (at least insofar as nonnegative integers are concerned) by implementing
0 and the operation of adding 1 as
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="org9ea1064"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">zero</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-1</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>n f<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
This representation is known as <i>Church numerals</i>, after its inventor, Alonzo
Church, the logician who invented the &lambda;-calculus.
</p>

<p>
Define <code class="src src-scheme">one</code> and <code class="src src-scheme">two</code> directly (not in terms of
<code class="src src-scheme">zero</code> and <code class="src src-scheme">add-1</code>). (Hint: Use substitution to evaluate
<code class="src src-scheme"><span style="color: #51afef;">(</span>add-1 zero<span style="color: #51afef;">)</span></code>). Give a direct definition of the addition procedure
<code class="src src-scheme">+</code> (not in terms of repeated application of <code class="src src-scheme">add-1</code>).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgad5859b" class="outline-4">
<h4 id="orgad5859b"><span class="section-number-4">3.8.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-8-2">
<p>
First, let&rsquo;s check out <code class="src src-scheme"><span style="color: #51afef;">(</span>add-1 zero<span style="color: #51afef;">)</span></code>.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">zero</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-1</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>           <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>n f<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span>add-1 zero<span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>          <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>zero f<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>          <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>          <span style="color: #a9a1e1;">(</span>f x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
So from this I believe the correct definition of one and two are:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">one</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>           <span style="color: #a9a1e1;">(</span>f x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">two</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>            <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span>f x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"1 = 1+0"</span>
<span class="linenr">10: </span>           <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">11: </span>           <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>one 1+<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"2 = 1+1+0"</span>
<span class="linenr">13: </span>           <span style="color: #dd8844; font-weight: bold;">2</span>
<span class="linenr">14: </span>           <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>two 1+<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>f<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>a f<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>b f<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"3 = 1+2 = (1+0) + (1+1+0)"</span>
<span class="linenr">21: </span>           <span style="color: #dd8844; font-weight: bold;">3</span>
<span class="linenr">22: </span>           <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>add one two<span style="color: #a9a1e1;">)</span> 1+<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0497453">
SUCCEED at 1 = 1+0
SUCCEED at 2 = 1+1+0
SUCCEED at 3 = 1+2 = (1+0) + (1+1+0)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee5662b" class="outline-3">
<h3 id="orgee5662b"><span class="section-number-3">3.9.</span> Exercise 2.7</h3>
<div class="outline-text-3" id="text-3-9">
</div>

<div id="outline-container-orgce2504b" class="outline-4">
<h4 id="orgce2504b"><span class="section-number-4">3.9.1.</span> Text</h4>
<div class="outline-text-4" id="text-3-9-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org3317e3e"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-interval</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>make-interval <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>lower-bound x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>lower-bound y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>                 <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>upper-bound x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>upper-bound y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-interval</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>p1 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>lower-bound x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>lower-bound y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #a9a1e1;">(</span>p2 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>lower-bound x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>upper-bound y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>        <span style="color: #a9a1e1;">(</span>p3 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>upper-bound x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>lower-bound y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #a9a1e1;">(</span>p4 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>upper-bound x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>upper-bound y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span>make-interval <span style="color: #a9a1e1;">(</span>min p1 p2 p3 p4<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                   <span style="color: #a9a1e1;">(</span>max p1 p2 p3 p4<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-interval</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>mul-interval
<span class="linenr">13: </span>   x
<span class="linenr">14: </span>   <span style="color: #99bb66;">(</span>make-interval <span style="color: #a9a1e1;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #51afef;">(</span>upper-bound y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>                  <span style="color: #a9a1e1;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #51afef;">(</span>lower-bound y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeaba4a1" class="outline-4">
<h4 id="orgeaba4a1"><span class="section-number-4">3.9.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-9-2">
<blockquote>
<p>
Alyssa&rsquo;s program is incomplete because she has not specified the implementation
of the interval abstraction. Here is a definition of the interval constructor:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-interval</span> a b<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cons a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
Define selectors <code class="src src-scheme">upper-bound</code> and <code class="src src-scheme">lower-bound</code> to complete
the implementation.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgdf65aa9" class="outline-4">
<h4 id="orgdf65aa9"><span class="section-number-4">3.9.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-9-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org99b74a3"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;interval-txt&gt;&gt;</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Makes more sense to me to test</span>
<span class="linenr"> 4: </span><span style="color: #525252;">;; </span><span style="color: #525252;">order in the constructor than selector</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-interval</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&gt; a b<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span>cons a b<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>cons b a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">upper-bound</span> i<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>car i<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">lower-bound</span> i<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>cdr i<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9234bf2" class="outline-3">
<h3 id="org9234bf2"><span class="section-number-3">3.10.</span> Exercise 2.8</h3>
<div class="outline-text-3" id="text-3-10">
</div>

<div id="outline-container-org8f55a53" class="outline-4">
<h4 id="org8f55a53"><span class="section-number-4">3.10.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-10-1">
<blockquote>
<p>
Using reasoning analogous to Alyssa&rsquo;s, describe how the difference of two
intervals may be computed. Define a corresponding subtraction procedure, called
<code class="src src-scheme">sub-interval</code>.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org3482fa6" class="outline-4">
<h4 id="org3482fa6"><span class="section-number-4">3.10.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-10-2">
<p>
I would argue that with one interval subtracted from the other, the lowest
possible value is the lower of the first subtracted from the <i>upper</i> of the
second, and the highest is the upper of the first subtracted from the lower of
the second.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org469370c"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-interval</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>make-interval <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>lower-bound x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>upper-bound y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>                 <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>upper-bound x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>lower-bound y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb5f5b61" class="outline-3">
<h3 id="orgb5f5b61"><span class="section-number-3">3.11.</span> Exercise 2.9</h3>
<div class="outline-text-3" id="text-3-11">
</div>

<div id="outline-container-orgd26bbe8" class="outline-4">
<h4 id="orgd26bbe8"><span class="section-number-4">3.11.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-11-1">
<blockquote>
<p>
The <i>width</i> of an interval is half of the difference between its upper and lower
bounds. The width is a measure of the uncertainty of the number specified by the
interval. For some arithmetic operations the width of the result of combining
two intervals is a function only of the widths of the argument intervals,
whereas for others the width of the combination is not a function of the widths
of the argument intervals. Show that the width of the sum (or difference) of two
intervals is a function only of the widths of the intervals being added (or
subtracted). Give examples to show that this is not true for multiplication or
division.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgda77416" class="outline-4">
<h4 id="orgda77416"><span class="section-number-4">3.11.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-11-2">
<p>
My first interpretation of the question was that it asked whether width
operations are <i>distributive</i>. For example, multiplication is distributive:
</p>

<p>
\[
  a(b+c) = (a \times b)+(a \times c)
\]
</p>

<p>
For this I wrote the following tests:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org372c45a"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;make-interval&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sub-interval&gt;&gt;</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">halve</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>/ x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">width-interval</span> I<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>halve <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>upper-bound I<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>            <span style="color: #a9a1e1;">(</span>lower-bound I<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>ia <span style="color: #a9a1e1;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">10.1</span> <span style="color: #dd8844; font-weight: bold;">9.9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>       <span style="color: #99bb66;">(</span>ib <span style="color: #a9a1e1;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">5.2</span> <span style="color: #dd8844; font-weight: bold;">4.8</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>       <span style="color: #99bb66;">(</span>Aab <span style="color: #a9a1e1;">(</span>add-interval ia ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>       <span style="color: #99bb66;">(</span>Sab <span style="color: #a9a1e1;">(</span>sub-interval ia ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>       <span style="color: #99bb66;">(</span>Mab <span style="color: #a9a1e1;">(</span>mul-interval ia ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>       <span style="color: #99bb66;">(</span>Dab <span style="color: #a9a1e1;">(</span>div-interval ia ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"ia width = roughly .1"</span>
<span class="linenr">19: </span>                   <span style="color: #dd8844; font-weight: bold;">0.1</span>
<span class="linenr">20: </span>                   <span style="color: #99bb66;">(</span>width-interval ia<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"ib width = roughly .2"</span>
<span class="linenr">22: </span>                   <span style="color: #dd8844; font-weight: bold;">0.2</span>
<span class="linenr">23: </span>                   <span style="color: #99bb66;">(</span>width-interval ib<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"width addition is distributive"</span>
<span class="linenr">25: </span>                   <span style="color: #99bb66;">(</span>width-interval Aab<span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>                   <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>width-interval ia<span style="color: #a9a1e1;">)</span>
<span class="linenr">27: </span>                      <span style="color: #a9a1e1;">(</span>width-interval ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"width subtraction is distributive"</span>
<span class="linenr">29: </span>                   <span style="color: #99bb66;">(</span>width-interval Sab<span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>                   <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>width-interval ia<span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>                      <span style="color: #a9a1e1;">(</span>width-interval ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"width multiplication is distributive"</span>
<span class="linenr">33: </span>                   <span style="color: #99bb66;">(</span>width-interval Mab<span style="color: #99bb66;">)</span>
<span class="linenr">34: </span>                   <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>width-interval ia<span style="color: #a9a1e1;">)</span>
<span class="linenr">35: </span>                      <span style="color: #a9a1e1;">(</span>width-interval ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"width division is distributive"</span>
<span class="linenr">37: </span>                   <span style="color: #99bb66;">(</span>width-interval Dab<span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>                   <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>width-interval ia<span style="color: #a9a1e1;">)</span>
<span class="linenr">39: </span>                      <span style="color: #a9a1e1;">(</span>width-interval ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgd261096">
SUCCEED at ia width = roughly .1
SUCCEED at ib width = roughly .2
SUCCEED at width addition is distributive
FAIL at width subtraction is distributive
expected: -0.10000000000000053
returned: 0.2999999999999998
FAIL at width multiplication is distributive
expected: 0.01999999999999995
returned: 2.5
FAIL at width division is distributive
expected: 0.4999999999999978
returned: 0.10016025641025639
</pre>

<p>
However upon rereading the question I see that it could be rephrased as &ldquo;in what
operations can you calculate the resulting interval&rsquo;s width with only the widths
of the argument intervals?&rdquo;
</p>

<p>
Basically, for argument interval \(x\) and \(y\) and result interval \(z\):
</p>

<blockquote>
<p>
<code>IF</code> \(z = x + y\) <br />
<code>THEN</code> \(z_{width} = x_{width} + y_{width}\) <br />
<code>IF</code> \(z = x - y\) <br />
<code>THEN</code> \(z_{width} = x_{width} + y_{width}\) <br />
Multiplied or divided widths cannot be determined from widths alone.
</p>
</blockquote>

<p>
So, let&rsquo;s try that again.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org4918444"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;make-interval&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sub-interval&gt;&gt;</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">halve</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>/ x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">width-interval</span> I<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>halve <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>upper-bound I<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>            <span style="color: #a9a1e1;">(</span>lower-bound I<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>ia <span style="color: #a9a1e1;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">10.1</span> <span style="color: #dd8844; font-weight: bold;">9.9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>       <span style="color: #99bb66;">(</span>ib <span style="color: #a9a1e1;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">5.2</span> <span style="color: #dd8844; font-weight: bold;">4.8</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>       <span style="color: #99bb66;">(</span>Aab <span style="color: #a9a1e1;">(</span>add-interval ia ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>       <span style="color: #99bb66;">(</span>Sab <span style="color: #a9a1e1;">(</span>sub-interval ia ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"ia width = roughly .1"</span>
<span class="linenr">17: </span>                   <span style="color: #dd8844; font-weight: bold;">0.1</span>
<span class="linenr">18: </span>                   <span style="color: #99bb66;">(</span>width-interval ia<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"ib width = roughly .2"</span>
<span class="linenr">20: </span>                   <span style="color: #dd8844; font-weight: bold;">0.2</span>
<span class="linenr">21: </span>                   <span style="color: #99bb66;">(</span>width-interval ib<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"width(ia+ib) = width(ia) + width(ib)"</span>
<span class="linenr">23: </span>                   <span style="color: #99bb66;">(</span>width-interval Aab<span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>                   <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>width-interval ia<span style="color: #a9a1e1;">)</span>
<span class="linenr">25: </span>                      <span style="color: #a9a1e1;">(</span>width-interval ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span>mattcheck-float <span style="color: #99bb66;">"width(ia-ib) = width(ia) + width(ib)"</span>
<span class="linenr">27: </span>                   <span style="color: #99bb66;">(</span>width-interval Sab<span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>                   <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>width-interval ia<span style="color: #a9a1e1;">)</span>
<span class="linenr">29: </span>                      <span style="color: #a9a1e1;">(</span>width-interval ib<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org223b218">
SUCCEED at ia width = roughly .1
SUCCEED at ib width = roughly .2
SUCCEED at width(ia+ib) = width(ia) + width(ib)
SUCCEED at width(ia-ib) = width(ia) + width(ib)
</pre>
</div>
</div>
</div>

<div id="outline-container-org96aed24" class="outline-3">
<h3 id="org96aed24"><span class="section-number-3">3.12.</span> Exercise 2.10</h3>
<div class="outline-text-3" id="text-3-12">
</div>

<div id="outline-container-org4ede5ae" class="outline-4">
<h4 id="org4ede5ae"><span class="section-number-4">3.12.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-12-1">
<blockquote>
<p>
Ben Bitdiddle, an expert systems programmer, looks over Alyssa&rsquo;s shoulder and
comments that it is not clear what it means to divide by an interval that spans
zero. Modify Alyssa&rsquo;s code to check for this condition and to signal an error if
it occurs.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgcf9fe5e" class="outline-4">
<h4 id="orgcf9fe5e"><span class="section-number-4">3.12.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-12-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">interval-spans-zero?</span> I<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>&gt; upper-bound <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>       <span style="color: #99bb66;">(</span>&lt; lower-bound <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-interval</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>interval-spans-zero? y<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">"DIV-INTERVAL ERROR: denominator spans zero"</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span>mul-interval
<span class="linenr"> 8: </span>       x
<span class="linenr"> 9: </span>       <span style="color: #a9a1e1;">(</span>make-interval <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #c678dd;">(</span>upper-bound y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>                      <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #c678dd;">(</span>lower-bound y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org297ff2c" class="outline-3">
<h3 id="org297ff2c"><span class="section-number-3">3.13.</span> Exercise 2.11</h3>
<div class="outline-text-3" id="text-3-13">
</div>

<div id="outline-container-org3e62048" class="outline-4">
<h4 id="org3e62048"><span class="section-number-4">3.13.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-13-1">
<blockquote>
<p>
In passing, Ben also cryptically comments: ``By testing the signs of the
endpoints of the intervals, it is possible to break <code class="src src-scheme">mul-interval</code>
into nine cases, only one of which requires more than two multiplications.&rsquo;&rsquo;
Rewrite this procedure using Ben&rsquo;s suggestion.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge118460" class="outline-4">
<h4 id="orge118460"><span class="section-number-4">3.13.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-13-2">
<p>
This problem doesn&rsquo;t appear to have a beautiful, elegant answer.
</p>

<p>
Let&rsquo;s examine the nine cases.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org569391a"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;make-interval&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;sub-interval&gt;&gt;</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">matt-examine-mult</span> f<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>pp <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>         <span style="color: #a9a1e1;">(</span>pn <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span>pn2 <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-0.5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>         <span style="color: #a9a1e1;">(</span>nn <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">-5</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>         <span style="color: #a9a1e1;">(</span>listofpairs <span style="color: #51afef;">(</span>list
<span class="linenr">13: </span>                       <span style="color: #c678dd;">(</span>list pp pp<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                       <span style="color: #c678dd;">(</span>list pp pn<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                       <span style="color: #c678dd;">(</span>list pp nn<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>                       <span style="color: #c678dd;">(</span>list pn pp<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                       <span style="color: #c678dd;">(</span>list pn pn<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>                       <span style="color: #c678dd;">(</span>list pn pn2<span style="color: #c678dd;">)</span> <span style="color: #525252;">;;</span><span style="color: #525252;">&lt;- edge case to catch incomplete</span>
<span class="linenr">19: </span>                       <span style="color: #c678dd;">(</span>list pn nn<span style="color: #c678dd;">)</span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">multiplication functions</span>
<span class="linenr">20: </span>                       <span style="color: #c678dd;">(</span>list nn pp<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>                       <span style="color: #c678dd;">(</span>list nn pn<span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>                       <span style="color: #c678dd;">(</span>list nn nn<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">23: </span>         <span style="color: #a9a1e1;">(</span>givesign <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>negative? x<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>                         <span style="color: #99bb66;">"-"</span>
<span class="linenr">26: </span>                         <span style="color: #99bb66;">"+"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">27: </span>         <span style="color: #a9a1e1;">(</span>print-sign <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>I<span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>                       <span style="color: #c678dd;">(</span>format #f <span style="color: #99bb66;">"~a ~a"</span>
<span class="linenr">29: </span>                               <span style="color: #99bb66;">(</span>givesign <span style="color: #a9a1e1;">(</span>upper-bound I<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>                               <span style="color: #99bb66;">(</span>givesign <span style="color: #a9a1e1;">(</span>lower-bound I<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>         <span style="color: #a9a1e1;">(</span>print-int <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>I<span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>                      <span style="color: #c678dd;">(</span>format #f <span style="color: #99bb66;">"~a/~a"</span>
<span class="linenr">33: </span>                              <span style="color: #99bb66;">(</span>upper-bound I<span style="color: #99bb66;">)</span>
<span class="linenr">34: </span>                              <span style="color: #99bb66;">(</span>lower-bound I<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">35: </span>         <span style="color: #a9a1e1;">(</span>print-ints <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>I J<span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>                       <span style="color: #c678dd;">(</span>format #f <span style="color: #99bb66;">"~a times ~a"</span>
<span class="linenr">37: </span>                               <span style="color: #99bb66;">(</span>print-int I<span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>                               <span style="color: #99bb66;">(</span>print-int J<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">39: </span>         <span style="color: #a9a1e1;">(</span>results <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>p<span style="color: #99bb66;">)</span>
<span class="linenr">40: </span>                         <span style="color: #99bb66;">(</span>apply f p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">41: </span>                       listofpairs<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">42: </span>    <span style="color: #99bb66;">(</span>list
<span class="linenr">43: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>p<span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>            <span style="color: #c678dd;">(</span>apply print-ints p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">45: </span>          listofpairs<span style="color: #a9a1e1;">)</span>
<span class="linenr">46: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> print-int results<span style="color: #a9a1e1;">)</span>
<span class="linenr">47: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>I<span style="color: #c678dd;">)</span>
<span class="linenr">48: </span>            <span style="color: #c678dd;">(</span>print-sign I<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">49: </span>          results<span style="color: #a9a1e1;">)</span>
<span class="linenr">50: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>p<span style="color: #c678dd;">)</span>
<span class="linenr">51: </span>            <span style="color: #c678dd;">(</span>format #f <span style="color: #99bb66;">"~a // ~a"</span>
<span class="linenr">52: </span>                    <span style="color: #99bb66;">(</span>print-sign <span style="color: #a9a1e1;">(</span>car p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">53: </span>                    <span style="color: #99bb66;">(</span>print-sign <span style="color: #a9a1e1;">(</span>cadr p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">54: </span>          listofpairs<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">55: </span><span style="color: #51afef;">(</span>cons
<span class="linenr">56: </span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"problem"</span> <span style="color: #99bb66;">"result"</span> <span style="color: #99bb66;">"signs"</span> <span style="color: #99bb66;">"problem signs"</span><span style="color: #c678dd;">)</span>
<span class="linenr">57: </span> <span style="color: #c678dd;">(</span>apply zip 
<span class="linenr">58: </span>        <span style="color: #99bb66;">(</span>matt-examine-mult mul-interval<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">problem</th>
<th scope="col" class="org-left">result</th>
<th scope="col" class="org-left">signs</th>
<th scope="col" class="org-left">problem signs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">3/2 times 3/2</td>
<td class="org-left">9/4</td>
<td class="org-left">+ +</td>
<td class="org-left">+ + // + +</td>
</tr>

<tr>
<td class="org-left">3/2 times 3/-5</td>
<td class="org-left">9/-15</td>
<td class="org-left">+ -</td>
<td class="org-left">+ + // + -</td>
</tr>

<tr>
<td class="org-left">3/2 times -5/-7</td>
<td class="org-left">-10/-21</td>
<td class="org-left">- -</td>
<td class="org-left">+ + // - -</td>
</tr>

<tr>
<td class="org-left">3/-5 times 3/2</td>
<td class="org-left">9/-15</td>
<td class="org-left">+ -</td>
<td class="org-left">+ - // + +</td>
</tr>

<tr>
<td class="org-left">3/-5 times 3/-5</td>
<td class="org-left">25/-15</td>
<td class="org-left">+ -</td>
<td class="org-left">+ - // + -</td>
</tr>

<tr>
<td class="org-left">3/-5 times 1/-0.5</td>
<td class="org-left">3.0/-5.0</td>
<td class="org-left">+ -</td>
<td class="org-left">+ - // + -</td>
</tr>

<tr>
<td class="org-left">3/-5 times -5/-7</td>
<td class="org-left">35/-21</td>
<td class="org-left">+ -</td>
<td class="org-left">+ - // - -</td>
</tr>

<tr>
<td class="org-left">-5/-7 times 3/2</td>
<td class="org-left">-10/-21</td>
<td class="org-left">- -</td>
<td class="org-left">- - // + +</td>
</tr>

<tr>
<td class="org-left">-5/-7 times 3/-5</td>
<td class="org-left">35/-21</td>
<td class="org-left">+ -</td>
<td class="org-left">- - // + -</td>
</tr>

<tr>
<td class="org-left">-5/-7 times -5/-7</td>
<td class="org-left">49/25</td>
<td class="org-left">+ +</td>
<td class="org-left">- - // - -</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-scheme" id="orge051108"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-interval-opt</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>xu <span style="color: #51afef;">(</span>upper-bound x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 3: </span>        <span style="color: #a9a1e1;">(</span>xl <span style="color: #51afef;">(</span>lower-bound x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #a9a1e1;">(</span>yu <span style="color: #51afef;">(</span>upper-bound y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>        <span style="color: #a9a1e1;">(</span>yl <span style="color: #51afef;">(</span>lower-bound y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p?</span> positive?<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">n?</span> negative?<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">check-signs?</span> a b x y<span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">pass functions</span>
<span class="linenr"> 9: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>a xu<span style="color: #51afef;">)</span>
<span class="linenr">10: </span>           <span style="color: #51afef;">(</span>b xl<span style="color: #51afef;">)</span>
<span class="linenr">11: </span>           <span style="color: #51afef;">(</span>x yu<span style="color: #51afef;">)</span>
<span class="linenr">12: </span>           <span style="color: #51afef;">(</span>y yl<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">same-signs?</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">14: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>check-signs? p? p? p? p?<span style="color: #51afef;">)</span>
<span class="linenr">15: </span>          <span style="color: #51afef;">(</span>check-signs? n? n? n? n?<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">alt-signs?</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>check-signs? p? p? n? n?<span style="color: #51afef;">)</span>
<span class="linenr">18: </span>          <span style="color: #51afef;">(</span>check-signs? n? n? p? p?<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>same-signs?<span style="color: #51afef;">)</span>
<span class="linenr">20: </span>           <span style="color: #51afef;">(</span>make-interval <span style="color: #c678dd;">(</span>* xu yu<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>                          <span style="color: #c678dd;">(</span>* xl yl<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>alt-signs?<span style="color: #51afef;">)</span>
<span class="linenr">23: </span>           <span style="color: #51afef;">(</span>make-interval <span style="color: #c678dd;">(</span>* xl yu<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>                          <span style="color: #c678dd;">(</span>* xu yl<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">25: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>check-signs? p? p? p? n?<span style="color: #51afef;">)</span>
<span class="linenr">26: </span>           <span style="color: #51afef;">(</span>make-interval <span style="color: #c678dd;">(</span>* xu yu<span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>                          <span style="color: #c678dd;">(</span>* xu yl<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>check-signs? p? n? p? p?<span style="color: #51afef;">)</span>
<span class="linenr">29: </span>           <span style="color: #51afef;">(</span>make-interval <span style="color: #c678dd;">(</span>* xu yu<span style="color: #c678dd;">)</span>
<span class="linenr">30: </span>                          <span style="color: #c678dd;">(</span>* xl yu<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>check-signs? p? n? p? n?<span style="color: #51afef;">)</span>
<span class="linenr">32: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>* xu yu<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">33: </span>                 <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>* xu yl<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">34: </span>                 <span style="color: #99bb66;">(</span>p3 <span style="color: #a9a1e1;">(</span>* xl yu<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>                 <span style="color: #99bb66;">(</span>p4 <span style="color: #a9a1e1;">(</span>* xl yl<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>             <span style="color: #c678dd;">(</span>make-interval <span style="color: #99bb66;">(</span>max p1 p2 p3 p4<span style="color: #99bb66;">)</span>
<span class="linenr">37: </span>                            <span style="color: #99bb66;">(</span>min p1 p2 p3 p4<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">38: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>check-signs? p? n? n? n?<span style="color: #51afef;">)</span>
<span class="linenr">39: </span>           <span style="color: #51afef;">(</span>make-interval <span style="color: #c678dd;">(</span>* xl yl<span style="color: #c678dd;">)</span>
<span class="linenr">40: </span>                          <span style="color: #c678dd;">(</span>* xu yl<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">41: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>check-signs? n? n? p? n?<span style="color: #51afef;">)</span>
<span class="linenr">42: </span>           <span style="color: #51afef;">(</span>make-interval <span style="color: #c678dd;">(</span>* xl yl<span style="color: #c678dd;">)</span>
<span class="linenr">43: </span>                          <span style="color: #c678dd;">(</span>* xl yu<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org813eb92"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;make-interval&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;sub-interval&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;mul-interval-opt&gt;&gt;</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">matt-mult-consistency</span> f1 f2<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>pp <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span>pn <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>         <span style="color: #a9a1e1;">(</span>pn2 <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-0.5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>         <span style="color: #a9a1e1;">(</span>nn <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">-5</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>         <span style="color: #a9a1e1;">(</span>listofpairs <span style="color: #51afef;">(</span>list
<span class="linenr">14: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"pp*nn"</span> pp pp<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"pp*pn"</span> pp pn<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"pp*nn"</span> pp nn<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"pn*pp"</span> pn pp<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"pn*pn"</span> pn pn<span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"pn*pn2"</span> pn pn2<span style="color: #c678dd;">)</span> <span style="color: #525252;">;;</span><span style="color: #525252;">&lt;- edge case to catch incomplete</span>
<span class="linenr">20: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"pn*nn"</span> pn nn<span style="color: #c678dd;">)</span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">multiplication functions</span>
<span class="linenr">21: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"nn*pp"</span> nn pp<span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"nn*pn"</span> nn pn<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>                       <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"nn*nn"</span> nn nn<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>l<span style="color: #51afef;">)</span>
<span class="linenr">25: </span>           <span style="color: #51afef;">(</span>mattcheck <span style="color: #c678dd;">(</span>car l<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>                      <span style="color: #c678dd;">(</span>apply f1 <span style="color: #99bb66;">(</span>cdr l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>                      <span style="color: #c678dd;">(</span>apply f2 <span style="color: #99bb66;">(</span>cdr l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>         listofpairs<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">29: </span>
<span class="linenr">30: </span><span style="color: #51afef;">(</span>matt-mult-consistency mul-interval mul-interval-opt<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org2a480be">
SUCCEED at pp*nn
SUCCEED at pp*pn
SUCCEED at pp*nn
SUCCEED at pn*pp
SUCCEED at pn*pn
SUCCEED at pn*pn2
SUCCEED at pn*nn
SUCCEED at nn*pp
SUCCEED at nn*pn
SUCCEED at nn*nn
</pre>

<pre class="example" id="org7a6e2c1">
Unoptimized mul-interval: (5231.8421225)
Optimized mul-interval: (2526.5896437)
</pre>

<p>
So as expected, about twice as fast!
</p>
</div>
</div>
</div>

<div id="outline-container-org0889f3d" class="outline-3">
<h3 id="org0889f3d"><span class="section-number-3">3.14.</span> Exercise 2.12</h3>
<div class="outline-text-3" id="text-3-14">
</div>

<div id="outline-container-org93eb4c9" class="outline-4">
<h4 id="org93eb4c9"><span class="section-number-4">3.14.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-14-1">
<p>
After debugging her program, Alyssa shows it to a potential user, who complains
that her program solves the wrong problem. He wants a program that can deal with
numbers represented as a center value and an additive tolerance; for example, he
wants to work with intervals such as \(3.5 \pm 0.15\) rather than [3.35, 3.65].
Alyssa returns to her desk and fixes this problem by supplying an alternate
constructor and alternate selectors:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgd0d5a3f"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-center-width</span> c w<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>make-interval <span style="color: #99bb66;">(</span>- c w<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>+ c w<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">center</span> i<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>lower-bound i<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>upper-bound i<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">width</span> i<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>upper-bound i<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>lower-bound i<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Unfortunately, most of Alyssa&rsquo;s users are engineers. Real engineering situations
usually involve measurements with only a small uncertainty, measured as the
ratio of the width of the interval to the midpoint of the interval. Engineers
usually specify percentage tolerances on the parameters of devices, as in the
resistor specifications given earlier.
</p>

<p>
Define a constructor <code class="src src-scheme">make-center-percent</code> that takes a center and a
percentage tolerance and produces the desired interval. You must also define a
selector <code class="src src-scheme">percent</code> that produces the percentage tolerance for a given
interval. The <code class="src src-scheme">center</code> selector is the same as the one shown above.
</p>
</div>
</div>

<div id="outline-container-orgac3f815" class="outline-4">
<h4 id="orgac3f815"><span class="section-number-4">3.14.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-14-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgbaadea8"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reciprocal</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgd04415a"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;reciprocal&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;make-interval&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sub-interval&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;interval-center-width&gt;&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-center-percent</span> c pt<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>pp <span style="color: #51afef;">(</span>* c
<span class="linenr"> 8: </span>               <span style="color: #c678dd;">(</span>* pt <span style="color: #dd8844; font-weight: bold;">0.01</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span>make-interval <span style="color: #a9a1e1;">(</span>- c pp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>+ c pp<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">percent</span> I<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">100.0</span>
<span class="linenr">12: </span>     <span style="color: #99bb66;">(</span>/ <span style="color: #a9a1e1;">(</span>width I<span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>        <span style="color: #a9a1e1;">(</span>center I<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgf533c3d"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;interval-percent&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">roughly-eq?</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">error size varies with magnitude of fp</span>
<span class="linenr"> 5: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">so dx must vary too.</span>
<span class="linenr"> 6: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">dx</span> <span style="color: #99bb66;">(</span>* a <span style="color: #dd8844; font-weight: bold;">0.000001</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>&gt; a <span style="color: #a9a1e1;">(</span>- b dx<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>         <span style="color: #99bb66;">(</span>&lt; a <span style="color: #a9a1e1;">(</span>+ b dx<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">interval-roughly-eq?</span> I J<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>roughly-eq? <span style="color: #a9a1e1;">(</span>upper-bound I<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>upper-bound J<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>       <span style="color: #99bb66;">(</span>roughly-eq? <span style="color: #a9a1e1;">(</span>lower-bound I<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>lower-bound J<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>i1 <span style="color: #a9a1e1;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">105.0</span> <span style="color: #dd8844; font-weight: bold;">95.0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>      <span style="color: #99bb66;">(</span>i2 <span style="color: #a9a1e1;">(</span>make-center-width <span style="color: #dd8844; font-weight: bold;">100.0</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>      <span style="color: #99bb66;">(</span>i3 <span style="color: #a9a1e1;">(</span>make-center-percent <span style="color: #dd8844; font-weight: bold;">100.0</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>      <span style="color: #99bb66;">(</span>i1a <span style="color: #a9a1e1;">(</span>upper-bound i1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"make-center-width"</span>
<span class="linenr">18: </span>             i1
<span class="linenr">19: </span>             i2<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"make-center-percent"</span>
<span class="linenr">21: </span>             i1
<span class="linenr">22: </span>             i3<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"percent"</span>
<span class="linenr">24: </span>             <span style="color: #99bb66;">(</span>percent i1<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>             <span style="color: #99bb66;">(</span>percent i3<span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>             <span style="color: #dd8844; font-weight: bold;">5.0</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>  <span style="color: #c678dd;">(</span>mattcheck+ <span style="color: #99bb66;">"make-center-percent is consistent"</span>
<span class="linenr">28: </span>              <span style="color: #99bb66;">(</span>list i1 i3<span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>              <span style="color: #c678dd;">#:eql?</span> interval-roughly-eq?<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org790a261">
SUCCEED at make-center-width
SUCCEED at make-center-percent
SUCCEED at percent
SUCCEED at make-center-percent is consistent
</pre>
</div>
</div>
</div>

<div id="outline-container-org47e4163" class="outline-3">
<h3 id="org47e4163"><span class="section-number-3">3.15.</span> Exercise 2.13&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></h3>
<div class="outline-text-3" id="text-3-15">
</div>

<div id="outline-container-orgf72f99e" class="outline-4">
<h4 id="orgf72f99e"><span class="section-number-4">3.15.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-15-1">
<blockquote>
<p>
Show that under the assumption of small percentage tolerances there is a simple
formula for the approximate percentage tolerance of the product of two intervals
in terms of the tolerances of the factors. You may simplify the problem by
assuming that all numbers are positive.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4c297f3" class="outline-4">
<h4 id="org4c297f3"><span class="section-number-4">3.15.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-15-2">
<p>
I should&rsquo;ve written this function a while ago.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org4e97f9e"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">stringit</span> . args<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>string-append
<span class="linenr">4: </span>   <span style="color: #99bb66;">(</span>apply string-append
<span class="linenr">5: </span>    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>          <span style="color: #c678dd;">(</span>format #f <span style="color: #99bb66;">"~:a "</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span>        args<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">echo</span> . args<span style="color: #c678dd;">)</span>
<span class="linenr">9: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;~:a~%"</span> <span style="color: #99bb66;">(</span>apply stringit args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Now, let&rsquo;s examine how interval percents relate to each other.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orga84201d"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;interval-percent&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;mul-interval-opt&gt;&gt;</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>i1 <span style="color: #a9a1e1;">(</span>make-center-width <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       <span style="color: #99bb66;">(</span>i2 <span style="color: #a9a1e1;">(</span>make-center-width <span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span>M12 <span style="color: #a9a1e1;">(</span>mul-interval-opt i1 i2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"intervals 1 and 2:"</span> i1 i2<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"width of 1 and 2:"</span> <span style="color: #99bb66;">(</span>width i1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>width i2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"percent of 1 and 2:"</span> <span style="color: #99bb66;">(</span>percent i1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>percent i2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"i1*i2 = "</span> M12<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"width M12:"</span> <span style="color: #99bb66;">(</span>width M12<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"percent M12:"</span> <span style="color: #99bb66;">(</span>percent M12<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgeb8fadc">
intervals 1 and 2: (105 . 95) (205 . 195) 
width of 1 and 2: 5 5 
percent of 1 and 2: 5.0 2.5 
i1*i2 =  (21525 . 18525) 
width M12 1500 
percent M12 7.490636704119851 
</pre>

<p>
Perhaps percent\((A\times B) =\)percent\((A)+\)percent\((B)\)?
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org375dedd"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;interval-percent&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;mul-interval-opt&gt;&gt;</span>
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>i1 <span style="color: #a9a1e1;">(</span>make-center-percent <span style="color: #dd8844; font-weight: bold;">40</span> <span style="color: #dd8844; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">6: </span>       <span style="color: #99bb66;">(</span>i2 <span style="color: #a9a1e1;">(</span>make-center-percent <span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>       <span style="color: #99bb66;">(</span>M12 <span style="color: #a9a1e1;">(</span>mul-interval-opt i1 i2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"percent of 1 and 2:"</span> <span style="color: #99bb66;">(</span>percent i1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>percent i2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">9: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"percent M12:"</span> <span style="color: #99bb66;">(</span>percent M12<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgcc556c5">
percent of 1 and 2: 0.09999999999999788 0.40000000000000563 
percent M12: 0.499998000008 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc89532c" class="outline-3">
<h3 id="orgc89532c"><span class="section-number-3">3.16.</span> Exercise 2.14</h3>
<div class="outline-text-3" id="text-3-16">
</div>

<div id="outline-container-org9f679ec" class="outline-4">
<h4 id="org9f679ec"><span class="section-number-4">3.16.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-16-1">
<blockquote>
<p>
After considerable work, Alyssa P. Hacker delivers her finished system. Several
years later, after she has forgotten all about it, she gets a frenzied call from
an irate user, Lem E. Tweakit. It seems that Lem has noticed that the formula
for parallel resistors can be written in two algebraically equivalent ways:
</p>

<p>
\[
\frac{R_1 R_2}{R_1 + R_2}
\]
</p>

<p>
and
</p>

<p>
\[
\frac{1}{\frac{1}{R_1} + \frac{1}{R_2}}
\]
</p>

<p>
He has written the following two programs, each of which computes the
parallel-resistors formula differently:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="org16dad5e"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">par1</span> r1 r2<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>div-interval <span style="color: #99bb66;">(</span>mul-interval r1 r2<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>                <span style="color: #99bb66;">(</span>add-interval r1 r2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">par2</span> r1 r2<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>one <span style="color: #51afef;">(</span>make-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>    <span style="color: #99bb66;">(</span>div-interval
<span class="linenr">8: </span>     one <span style="color: #a9a1e1;">(</span>add-interval <span style="color: #51afef;">(</span>div-interval one r1<span style="color: #51afef;">)</span>
<span class="linenr">9: </span>                       <span style="color: #51afef;">(</span>div-interval one r2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
Lem complains that Alyssa&rsquo;s program gives different answers for the two ways of
computing. This is a serious complaint.
</p>

<p>
Demonstrate that Lem is right. Investigate the behavior of the system on a
variety of arithmetic expressions. Make some intervals \(A\) and \(B\), and use
them in computing the expressions \(A / A\) and \(A / B\). You will get the most
insight by using intervals whose width is a small percentage of the center
value. Examine the results of the computation in center-percent form (see
Exercise 2.12).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org323edf8" class="outline-4">
<h4 id="org323edf8"><span class="section-number-4">3.16.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-16-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orge483df8"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;interval-percent&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;mul-interval-opt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;par-resistors&gt;&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>A <span style="color: #a9a1e1;">(</span>make-center-percent <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span>B <span style="color: #a9a1e1;">(</span>make-center-percent <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">0.01</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       <span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>par1 A B<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>       <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>par2 A B<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"A,B:"</span> A B<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"par1(A,B):"</span> p1<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"par2(A,B):"</span> p2<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"percent(par1):"</span> <span style="color: #99bb66;">(</span>percent p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"percent(par2):"</span> <span style="color: #99bb66;">(</span>percent p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"center(par1):"</span> <span style="color: #99bb66;">(</span>center p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"center(par2):"</span> <span style="color: #99bb66;">(</span>center p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"So these two have inconsistent effects on the width."</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"It should also be noted that floating-point errors accumulate."</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"Take a look at the error on these (correct answer is 1)"</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>A <span style="color: #a9a1e1;">(</span>make-center-percent <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>       <span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>div-interval
<span class="linenr">25: </span>            <span style="color: #51afef;">(</span>div-interval
<span class="linenr">26: </span>             <span style="color: #c678dd;">(</span>mul-interval A A<span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>             A<span style="color: #51afef;">)</span>
<span class="linenr">28: </span>            A<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>       <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>div-interval
<span class="linenr">30: </span>            <span style="color: #51afef;">(</span>div-interval
<span class="linenr">31: </span>             <span style="color: #c678dd;">(</span>div-interval
<span class="linenr">32: </span>              <span style="color: #99bb66;">(</span>mul-interval
<span class="linenr">33: </span>               <span style="color: #a9a1e1;">(</span>mul-interval A A<span style="color: #a9a1e1;">)</span>
<span class="linenr">34: </span>               A<span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>              A<span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>             A<span style="color: #51afef;">)</span>
<span class="linenr">37: </span>            A<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">38: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"p1:"</span> <span style="color: #99bb66;">(</span>center p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">39: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"p2:"</span> <span style="color: #99bb66;">(</span>center p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org92767f4">
A,B: (10.1 . 9.9) (10.001 . 9.999) 
par1(A,B): (5.076139504497713 . 4.924635590269141) 
par2(A,B): (5.025128103079449 . 4.974626865671642) 
percent(par1): 1.5149217214958663 
percent(par2): 0.5050247487625606 
center(par1): 5.000387547383427 
center(par2): 4.999877484375546 
So these two have inconsistent effects on the width. 

It should also be noted that floating-point errors accumulate. 
Take a look at the error on these (correct answer is 1) 
p1: 1.0008001600240033 
p2: 1.0018006601460259 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9f2adb" class="outline-3">
<h3 id="orgf9f2adb"><span class="section-number-3">3.17.</span> Exercise 2.15</h3>
<div class="outline-text-3" id="text-3-17">
</div>

<div id="outline-container-orge83b3aa" class="outline-4">
<h4 id="orge83b3aa"><span class="section-number-4">3.17.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-17-1">
<blockquote>
<p>
Eva Lu Ator, another user, has also noticed the different intervals computed by
different but algebraically equivalent expressions. She says that a formula to
compute with intervals using Alyssa&rsquo;s system will produce tighter error bounds
if it can be written in such a form that no variable that represents an
uncertain number is repeated. Thus, she says, <code class="src src-scheme">par2</code> is a &ldquo;better&rdquo;
program for parallel resistances than <code class="src src-scheme">par1</code>. Is she right? Why?
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4c24b43" class="outline-4">
<h4 id="org4c24b43"><span class="section-number-4">3.17.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-17-2">
<p>
If I am correct in understanding that &ldquo;uncertain number&rdquo; means &ldquo;a number with an
error tolerance&rdquo;, than <code class="src src-scheme">par2</code> <i>is</i> better &#x2013; it only uses two
instances of variables with error tolerance, while <code class="src src-scheme">par1</code> uses four.
</p>

<p>
It should be noted that this system does not directly translate to algebraic
expressions. For example, take these expressions:
</p>

<p>
\[A + A = 2A\]
\[A - A = 0\]
\[A / A = 1\]
</p>

<p>
Note that these do not hold up in practice with uncertain numbers:
</p>


<div class="org-src-container">
<pre class="src src-scheme" id="orgeddc296"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;interval-percent&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;mul-interval-opt&gt;&gt;</span>
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">A</span> <span style="color: #c678dd;">(</span>make-center-percent <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"A+A = 2A !="</span> <span style="color: #c678dd;">(</span>add-interval A A<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"A-A = 0 !="</span> <span style="color: #c678dd;">(</span>sub-interval A A<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">8: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"A/A = 1 !="</span> <span style="color: #c678dd;">(</span>div-interval A A<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org1c5e19f">
A+A = 2A != (20.2 . 19.8) 
A-A = 0 != (0.1999999999999993 . -0.1999999999999993) 
A/A = 1 != (1.02020202020202 . 0.9801980198019803) 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc826d6f" class="outline-3">
<h3 id="orgc826d6f"><span class="section-number-3">3.18.</span> Exercise 2.16&#xa0;&#xa0;&#xa0;<span class="tag"><span class="optional">optional</span></span></h3>
<div class="outline-text-3" id="text-3-18">
</div>

<div id="outline-container-org61981dc" class="outline-4">
<h4 id="org61981dc"><span class="section-number-4">3.18.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-18-1">
<blockquote>
<p>
Explain, in general, why equivalent algebraic expressions may lead to different
answers. Can you devise an interval-arithmetic package that does not have this
shortcoming, or is this task impossible? (Warning: This problem is very
difficult.)
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org5128d95" class="outline-4">
<h4 id="org5128d95"><span class="section-number-4">3.18.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-18-2">
<p>
It is <i>indeed</i> very difficult, because from what I&rsquo;m seeing online, no interval
system without these issues exists. To avoid these issues, interval mathematics
would need to satisfy the conditions for a <b>field</b> &#x2013; and failing that, needs to
only use each variable once, which becomes impossible as soon as you encounter
an expression as simple as \(x^2\).
</p>

<p>
GitHub user &ldquo;<code>diiq</code>&rdquo; has an incredible analysis of this, which can be found here:
<a href="https://gist.github.com/diiq/1f39df0e54b2137bb07e7e04b11cb075">https://gist.github.com/diiq/1f39df0e54b2137bb07e7e04b11cb075</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org7db10a6" class="outline-3">
<h3 id="org7db10a6"><span class="section-number-3">3.19.</span> 2.2: Hierarchical Data and the Closure Property</h3>
<div class="outline-text-3" id="text-3-19">
<p>
<code class="src src-scheme">cons</code> pairs can be used to construct more complex data-types.
</p>


<div id="org62d64e2" class="figure">
<p><img src="2/cons-cells.jpeg" alt="cons-cells.jpeg" />
</p>
</div>

<p>
The ability to combine things using an operation, then combine those results
using the same operation, can be called the <b>closure property</b>. <code class="src src-scheme">cons</code> can
create pairs whose elements are pairs, which satisfies the closure property.
This property enables you to create hierarchical structures. We&rsquo;ve already
regularly used the closure property in creating procedures composed of other
procedures.
</p>

<blockquote>
<p>
<b>Definitions of &ldquo;closure&rdquo;</b>
</p>

<p>
The use of the word &ldquo;closure&rdquo; here comes from abstract algebra, where a set of
elements is said to be closed under an operation if applying the operation to
elements in the set produces an element that is again an element of the set.
The Lisp community also (unfortunately) uses the word &ldquo;closure&rdquo; to describe a
totally unrelated concept: A closure is an implementation technique for
representing procedures with free variables. We do not use the word &ldquo;closure&rdquo;
in this second sense in this book.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org1f2ee87" class="outline-3">
<h3 id="org1f2ee87"><span class="section-number-3">3.20.</span> 2.2.1: Representing Sequences</h3>
<div class="outline-text-3" id="text-3-20">
<dl class="org-dl">
<dt><b>sequence</b></dt><dd>An ordered collection of data objects.</dd>
<dt><b>list</b></dt><dd>A sequence of <code class="src src-scheme">cons</code> pairs.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span>
      <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span>
            <span style="color: #99bb66;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span>
                  <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">4</span> nil<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">both evaluate to '(1 2 3 4)</span>
</pre>
</div>


<p>
An aside: many parts of this book have covered ways to solve problems by
splitting problems into simple recursive solutions. I may be getting ahead of
myself, but I wanted to note how the <code class="src src-scheme">cons</code> pair system goes
hand-in-hand with this. For example, when going over a list <code class="src src-scheme">l</code> with
function <code class="src src-scheme">f</code>:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map</span> f l<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? l<span style="color: #99bb66;">)</span>
      #nil
      <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>f <span style="color: #51afef;">(</span>car l<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> f <span style="color: #51afef;">(</span>cdr l<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)(</span>* x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
     <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgf954fa0">
| 2 | 4 | 6 | 8 |
</pre>
</div>
</div>

<div id="outline-container-orgf34b509" class="outline-3">
<h3 id="orgf34b509"><span class="section-number-3">3.21.</span> Exercise 2.17</h3>
<div class="outline-text-3" id="text-3-21">
</div>

<div id="outline-container-org15d5362" class="outline-4">
<h4 id="org15d5362"><span class="section-number-4">3.21.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-21-1">
<blockquote>
<p>
Define a procedure
<code class="src src-scheme">last-pair</code> that returns the list that contains only the last element of a
given (nonempty) list:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>last-pair <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">23</span> <span style="color: #dd8844; font-weight: bold;">72</span> <span style="color: #dd8844; font-weight: bold;">149</span> <span style="color: #dd8844; font-weight: bold;">34</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">(34)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org93c46eb" class="outline-4">
<h4 id="org93c46eb"><span class="section-number-4">3.21.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-21-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org6878bb6"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">last-pair</span> l<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>a <span style="color: #51afef;">(</span>car l<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>d <span style="color: #51afef;">(</span>cdr l<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>length d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        d
        <span style="color: #a9a1e1;">(</span>last-pair d<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;last-pair&gt;&gt;</span>
<span style="color: #51afef;">(</span>last-pair <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">23</span> <span style="color: #dd8844; font-weight: bold;">72</span> <span style="color: #dd8844; font-weight: bold;">149</span> <span style="color: #dd8844; font-weight: bold;">34</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org24e505a">
| 34 |
</pre>
</div>
</div>
</div>

<div id="outline-container-orga23ddde" class="outline-3">
<h3 id="orga23ddde"><span class="section-number-3">3.22.</span> Exercise 2.18</h3>
<div class="outline-text-3" id="text-3-22">
</div>

<div id="outline-container-orgca2a110" class="outline-4">
<h4 id="orgca2a110"><span class="section-number-4">3.22.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-22-1">
<blockquote>
<p>
Define a procedure <code class="src src-scheme">reverse</code> that takes a list as argument and returns
a list of the same elements in reverse order:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>reverse <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">16</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">(25 16 9 4 1)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c38eb3" class="outline-4">
<h4 id="org3c38eb3"><span class="section-number-4">3.22.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-22-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org6754998"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reverse</span> l<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">len</span> <span style="color: #99bb66;">(</span>length l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> i result<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&lt; <span style="color: #51afef;">(</span>1- len<span style="color: #51afef;">)</span> i<span style="color: #a9a1e1;">)</span>
        result
        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>+ i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>list-ref l i<span style="color: #c678dd;">)</span>
                    result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>iter <span style="color: #dd8844; font-weight: bold;">0</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;reverse&gt;&gt;</span>
<span style="color: #51afef;">(</span>reverse <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">23</span> <span style="color: #dd8844; font-weight: bold;">72</span> <span style="color: #dd8844; font-weight: bold;">149</span> <span style="color: #dd8844; font-weight: bold;">34</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">34</td>
<td class="org-right">149</td>
<td class="org-right">72</td>
<td class="org-right">23</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org83a54a9" class="outline-3">
<h3 id="org83a54a9"><span class="section-number-3">3.23.</span> Exercise 2.19</h3>
<div class="outline-text-3" id="text-3-23">
</div>

<div id="outline-container-org498572d" class="outline-4">
<h4 id="org498572d"><span class="section-number-4">3.23.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-23-1">
<blockquote>
<p>
Consider the change-counting program of 1.2.2. It would be nice to be able to
easily change the currency used by the program, so that we could compute the
number of ways to change a British pound, for example. As the program is
written, the knowledge of the currency is distributed partly into the procedure
<code class="src src-scheme">first-denomination</code> and partly into the procedure
<code class="src src-scheme">count-change</code> (which knows that there are five kinds of U.S. coins).
It would be nicer to be able to supply a list of coins to be used for making
change.
</p>

<p>
We want to rewrite the procedure <code class="src src-scheme">cc</code> so that its second argument is a
list of the values of the coins to use rather than an integer specifying which
coins to use. We could then have lists that defined each kind of currency:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">us-coins</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">50</span> <span style="color: #dd8844; font-weight: bold;">25</span> <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">uk-coins</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">50</span> <span style="color: #dd8844; font-weight: bold;">20</span> <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
We could then call <code class="src src-scheme">cc</code> as follows:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>cc <span style="color: #dd8844; font-weight: bold;">100</span> us-coins<span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">292</span>
</pre>
</div>

<blockquote>
<p>
To do this will require changing the program <code class="src src-scheme">cc</code> somewhat. It will
still have the same form, but it will access its second argument differently, as
follows:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="org8ac570c"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cc</span> amount coin-values<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>&lt; amount <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>no-more? coin-values<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>cc amount
<span class="linenr"> 6: </span>                <span style="color: #c678dd;">(</span>except-first-denomination
<span class="linenr"> 7: </span>                 coin-values<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>            <span style="color: #51afef;">(</span>cc <span style="color: #c678dd;">(</span>- amount
<span class="linenr"> 9: </span>                   <span style="color: #99bb66;">(</span>first-denomination
<span class="linenr">10: </span>                    coin-values<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                coin-values<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
Define the procedures <code class="src src-scheme">first-denomination</code>,
<code class="src src-scheme">except-first-denomination</code>, and <code class="src src-scheme">no-more?</code> in terms of
primitive operations on list structures. Does the order of the list
<code class="src src-scheme">coin-values</code> affect the answer produced by <code class="src src-scheme">cc</code>? Why or why
not?
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org0de5034" class="outline-4">
<h4 id="org0de5034"><span class="section-number-4">3.23.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-23-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgea36bef"><span style="color: #ECBE7B;">&lt;&lt;cc-lists&gt;&gt;</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">us-coins</span> 
  <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">50</span> <span style="color: #dd8844; font-weight: bold;">25</span> <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">uk-coins</span> 
  <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">50</span> <span style="color: #dd8844; font-weight: bold;">20</span> <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">first-denomination</span> car<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">except-first-denomination</span> cdr<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">no-more?</span> null?<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;Ex-2-19&gt;&gt;</span>
<span style="color: #51afef;">(</span>list
 <span style="color: #c678dd;">(</span>cc <span style="color: #dd8844; font-weight: bold;">100</span> us-coins<span style="color: #c678dd;">)</span>
 <span style="color: #c678dd;">(</span>cc <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #99bb66;">(</span>reverse us-coins<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
 <span style="color: #c678dd;">(</span>cc <span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">50</span> <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">25</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgb1045dc">
| 292 | 292 | 292 |
</pre>

<p>
Apparently, the order of the list does <i>not</i> affect the value. However, it does effect the execution time, with small-to-large coin lists taking more time than large-to-small.
</p>

<pre class="example" id="org40024e7">
decreasing values: (357503.80704)
increasing values: (823460.64376)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f5e284" class="outline-3">
<h3 id="org6f5e284"><span class="section-number-3">3.24.</span> Exercise 2.20</h3>
<div class="outline-text-3" id="text-3-24">
</div>

<div id="outline-container-orgde1b89e" class="outline-4">
<h4 id="orgde1b89e"><span class="section-number-4">3.24.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-24-1">
<blockquote>
<p>
Use <code>[dotted-pair]</code> notation to write a procedure <code class="src src-scheme">same-parity</code> that takes one or
more integers and returns a list of all the arguments that have the same
even-odd parity as the first argument.  For example,
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>same-parity <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">(1 3 5 7)</span>
<span style="color: #51afef;">(</span>same-parity <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">; </span><span style="color: #525252;">(2 4 6)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org716bdfd" class="outline-4">
<h4 id="org716bdfd"><span class="section-number-4">3.24.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-24-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgf1e4f92"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-parity</span> . rest<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">same?</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>even? <span style="color: #51afef;">(</span>car rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>        even?
<span class="linenr"> 5: </span>        odd?<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> l results<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? l<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>         results
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>a <span style="color: #99bb66;">(</span>car l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>cdr l<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same? a<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>                    <span style="color: #99bb66;">(</span>cons a results<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                    results<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>iter <span style="color: #99bb66;">(</span>reverse rest<span style="color: #99bb66;">)</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Attempting to remove the reversing</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-parity2</span> . args<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">first</span> <span style="color: #99bb66;">(</span>car args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">same?</span>
<span class="linenr">20: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>even? first<span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>        even?
<span class="linenr">22: </span>        odd?<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> l results<span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? l<span style="color: #a9a1e1;">)</span>
<span class="linenr">25: </span>        results
<span class="linenr">26: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>a <span style="color: #99bb66;">(</span>car l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>              <span style="color: #c678dd;">(</span>d <span style="color: #99bb66;">(</span>cdr l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">28: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>same? a<span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>              <span style="color: #c678dd;">(</span>iter d <span style="color: #99bb66;">(</span>append results
<span class="linenr">30: </span>                              <span style="color: #a9a1e1;">(</span>cons a #nil<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>              <span style="color: #c678dd;">(</span>iter d results<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>  <span style="color: #c678dd;">(</span>iter <span style="color: #99bb66;">(</span>cdr args<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons first #nil<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;same-parity&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>list
<span class="linenr">3: </span> <span style="color: #c678dd;">(</span>same-parity <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span>
<span class="linenr">4: </span> <span style="color: #c678dd;">(</span>same-parity2 <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgd26c948">
| 1 | 3 | 5 | 7 |
| 2 | 4 | 6 |   |
</pre>

<pre class="example" id="orgf0f05a8">
same-parity: (10003.483436)
same-parity2: (56007.042334)
</pre>

<p>
Once again, my attempts to optimize are a complete failure. I&rsquo;m guessing that
the act of traversing the whole list in the call to <code class="src src-scheme">append</code> is the
problem.
</p>
</div>
</div>
</div>

<div id="outline-container-org285c80e" class="outline-3">
<h3 id="org285c80e"><span class="section-number-3">3.25.</span> Exercise 2.21</h3>
<div class="outline-text-3" id="text-3-25">
</div>

<div id="outline-container-org30f1f4a" class="outline-4">
<h4 id="org30f1f4a"><span class="section-number-4">3.25.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-25-1">
<blockquote>
<p>
The procedure <code class="src src-scheme">square-list</code> takes a list of numbers as argument and
returns a list of the squares of those numbers.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>square-list <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">(1 4 9 16)</span>
</pre>
</div>

<blockquote>
<p>
Here are two different definitions of <code class="src src-scheme">square-list</code>. Complete both of
them by filling in the missing expressions:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-list</span> items<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? items<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      nil
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>cons <span style="color: #ECBE7B;">&lt;??&gt;</span> <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-list</span> items<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #ECBE7B;">&lt;??&gt;</span> <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3da7d75" class="outline-4">
<h4 id="org3da7d75"><span class="section-number-4">3.25.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-25-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orga9e193f"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-list-manual</span> items<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? items<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>      #nil
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>square <span style="color: #51afef;">(</span>car items<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>            <span style="color: #a9a1e1;">(</span>square-list-manual <span style="color: #51afef;">(</span>cdr items<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-list</span> items<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> square items<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;square-list&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>list l
<span class="linenr">4: </span>        <span style="color: #99bb66;">(</span>square-list-manual l<span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>        <span style="color: #99bb66;">(</span>square-list l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org74ae3c4">
| 2 | 3 |  4 |  5 |  6 |
| 4 | 9 | 16 | 25 | 36 |
| 4 | 9 | 16 | 25 | 36 |
</pre>
</div>
</div>
</div>

<div id="outline-container-orge844114" class="outline-3">
<h3 id="orge844114"><span class="section-number-3">3.26.</span> Exercise 2.22</h3>
<div class="outline-text-3" id="text-3-26">
</div>

<div id="outline-container-org5a0f6ae" class="outline-4">
<h4 id="org5a0f6ae"><span class="section-number-4">3.26.1.</span> Questions</h4>
<div class="outline-text-4" id="text-3-26-1">
<blockquote>
<p>
Louis Reasoner tries to rewrite the first <code class="src src-scheme">square-list</code> procedure of
Exercise 2.21 so that it evolves an iterative process:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-list</span> items<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> things answer<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? things<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        answer
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cdr things<span style="color: #51afef;">)</span>
<span class="linenr">6: </span>              <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>square <span style="color: #99bb66;">(</span>car things<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>                    answer<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>iter items nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
Unfortunately, defining <code class="src src-scheme">square-list</code> this way produces the answer
list in the reverse order of the one desired. Why?
</p>

<p>
Louis then tries to fix his bug by interchanging the arguments to
<code class="src src-scheme">cons</code>:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-list</span> items<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> things answer<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? things<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        answer
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cdr things<span style="color: #51afef;">)</span>
<span class="linenr">6: </span>              <span style="color: #51afef;">(</span>cons answer
<span class="linenr">7: </span>                    <span style="color: #c678dd;">(</span>square <span style="color: #99bb66;">(</span>car things<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>iter items nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
This doesn&rsquo;t work either.  Explain.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org89b1e81" class="outline-4">
<h4 id="org89b1e81"><span class="section-number-4">3.26.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-26-2">
<p>
I&rsquo;m positive I&rsquo;ve made this exact mistake before, though this is likely not
recorded.
</p>

<p>
The first form of <code class="src src-scheme">square-list</code> produces a correct list in reverse order:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>square-list <span style="color: #c678dd;">(</span>iota <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">25</span> <span style="color: #dd8844; font-weight: bold;">16</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This is because he is prepending to the list every iteration.
</p>

<p>
While the second produces a broken list, which is literally backwards:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>square-list <span style="color: #c678dd;">(</span>iota <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>#nil . <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span> . <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> . <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> . <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #99bb66;">)</span> . <span style="color: #dd8844; font-weight: bold;">16</span><span style="color: #c678dd;">)</span> . <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Equivalent to:</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>cons #nil
<span class="linenr"> 5: </span>                                    <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>                              <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>                        <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>                  <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>            <span style="color: #dd8844; font-weight: bold;">16</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>      <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Since Lisp was designed with the <code>cons pair</code> structure of list-building, it
needed to define a &ldquo;correct&rdquo; direction for the pairs to go. Since the Western
world thinks left-to-right, they made it so that the left (first) cell is for
content, and the right is for the pointer to the next pair. However, this means
that you can&rsquo;t append to a list without first traveling its length and changing
the <code class="src src-scheme">nil</code> marking the end to a pointer to your new pair. Since that is
a lot of list traveling, it makes more sense to <code class="src src-scheme">cons</code> your list
together in reverse and then calling <code class="src src-scheme">reverse</code> only once at the end of
the procedure.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd686e56" class="outline-3">
<h3 id="orgd686e56"><span class="section-number-3">3.27.</span> Exercise 2.23</h3>
<div class="outline-text-3" id="text-3-27">
</div>

<div id="outline-container-orgbc911bf" class="outline-4">
<h4 id="orgbc911bf"><span class="section-number-4">3.27.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-27-1">
<blockquote>
<p>
The procedure <code class="src src-scheme">for-each</code> is similar to <code class="src src-scheme">map</code>. It takes as
arguments a procedure and a list of elements. However, rather than forming a
list of the results, <code class="src src-scheme">for-each</code> just applies the procedure to each of
the elements in turn, from left to right. The values returned by applying the
procedure to the elements are not used at all---<code class="src src-scheme">for-each</code> is used
with procedures that perform an action, such as printing. For example,
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">for-each</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span>
<span class="linenr">2: </span>            <span style="color: #99bb66;">(</span>newline<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>            <span style="color: #99bb66;">(</span>display x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>          <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">57</span> <span style="color: #dd8844; font-weight: bold;">321</span> <span style="color: #dd8844; font-weight: bold;">88</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #525252;">;; </span><span style="color: #525252;">57</span>
<span class="linenr">6: </span><span style="color: #525252;">;; </span><span style="color: #525252;">321</span>
<span class="linenr">7: </span><span style="color: #525252;">;; </span><span style="color: #525252;">88</span>
</pre>
</div>

<blockquote>
<p>
The value returned by the call to <code class="src src-scheme">for-each</code> (not illustrated above)
can be something arbitrary, such as true. Give an implementation of
<code class="src src-scheme">for-each</code>.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgc80e93e" class="outline-4">
<h4 id="orgc80e93e"><span class="section-number-4">3.27.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-27-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgbda2ac6"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">for-each-mine</span> proc items<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> l<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? l<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>        #t
<span class="linenr">5: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">begin</span> <span style="color: #51afef;">(</span>proc <span style="color: #c678dd;">(</span>car l<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span>               <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>cdr l<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>iter items<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;for-each-mine&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>for-each-mine <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)(</span>display x<span style="color: #99bb66;">)(</span>display <span style="color: #99bb66;">" "</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"all"</span> <span style="color: #99bb66;">"your"</span> <span style="color: #99bb66;">"base"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">for-each</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)(</span>display x<span style="color: #99bb66;">)(</span>display <span style="color: #99bb66;">" "</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">"are"</span> <span style="color: #99bb66;">"belong"</span> <span style="color: #99bb66;">"to"</span> <span style="color: #99bb66;">"us"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgbb19162">
all your base are belong to us 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf400d86" class="outline-3">
<h3 id="orgf400d86"><span class="section-number-3">3.28.</span> Exercise 2.24</h3>
<div class="outline-text-3" id="text-3-28">
</div>

<div id="outline-container-orgae92e7d" class="outline-4">
<h4 id="orgae92e7d"><span class="section-number-4">3.28.1.</span> Text Definitions</h4>
<div class="outline-text-4" id="text-3-28-1">
<div class="org-src-container">
<pre class="src src-scheme" id="orga0b027f"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">count-leaves</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? x<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>pair? x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>count-leaves <span style="color: #c678dd;">(</span>car x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span>                 <span style="color: #51afef;">(</span>count-leaves <span style="color: #c678dd;">(</span>cdr x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org432ed3d" class="outline-4">
<h4 id="org432ed3d"><span class="section-number-4">3.28.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-28-2">
<blockquote>
<p>
Suppose we evaluate the expression <code class="src src-scheme"><span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>.
Give the result printed by the interpreter, the corresponding box-and-pointer
structure, and the interpretation of this as a tree (as in Figure 2.6).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgd2cc4fa" class="outline-4">
<h4 id="orgd2cc4fa"><span class="section-number-4">3.28.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-28-3">
<p>
This is sort of a trick question &#x2013; on first reading, I read it like a series of
<code class="src src-scheme">cons</code> statements. Looking again, though, I can see that the correct
formulation is as follows:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l1 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      <span style="color: #99bb66;">(</span>l2 <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr"> 4: </span>                <span style="color: #51afef;">(</span>cons
<span class="linenr"> 5: </span>                 <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span>
<span class="linenr"> 6: </span>                       <span style="color: #99bb66;">(</span>cons
<span class="linenr"> 7: </span>                        <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span>
<span class="linenr"> 8: </span>                              <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">4</span>
<span class="linenr"> 9: </span>                                    #nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                        #nil<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                 #nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"textbook version:"</span> l1<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"cons'd version:"</span> l2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org600a843">
textbook version: (1 (2 (3 4))) 
cons'd version: (1 (2 (3 4))) 
</pre>

<p>
Dot and box version:
</p>

<div id="org6943475" class="figure">
<p><img src="2/fig/24-dotandbox.png" alt="24-dotandbox.png" />
</p>
</div>

<p>
Tree version:
</p>

<div id="org69dff4e" class="figure">
<p><img src="2/fig/24-tree.png" alt="24-tree.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org3d4d0ee" class="outline-3">
<h3 id="org3d4d0ee"><span class="section-number-3">3.29.</span> Exercise 2.25</h3>
<div class="outline-text-3" id="text-3-29">
</div>

<div id="outline-container-orgadae586" class="outline-4">
<h4 id="orgadae586"><span class="section-number-4">3.29.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-29-1">
<blockquote>
<p>
Give combinations of <code class="src src-scheme">car</code>s and <code class="src src-scheme">cdr</code>s that will pick 7 from
each of the following lists:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l1 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      <span style="color: #99bb66;">(</span>l2 <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>l3 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">(</span>car <span style="color: #a9a1e1;">(</span>cdaddr l1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">6: </span>        <span style="color: #99bb66;">(</span>caar l2<span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>        <span style="color: #99bb66;">(</span>cadadr <span style="color: #a9a1e1;">(</span>cadadr <span style="color: #51afef;">(</span>cadadr l3<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgedb914a">
7 7 7 
</pre>
</div>
</div>
</div>

<div id="outline-container-org80025c1" class="outline-3">
<h3 id="org80025c1"><span class="section-number-3">3.30.</span> Exercise 2.26</h3>
<div class="outline-text-3" id="text-3-30">
</div>

<div id="outline-container-orga0b1c78" class="outline-4">
<h4 id="orga0b1c78"><span class="section-number-4">3.30.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-30-1">
<blockquote>
<p>
Suppose we define <code class="src src-scheme">x</code> and <code class="src src-scheme">y</code> to be two lists:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">x</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">y</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
What result is printed by the interpreter in response to evaluating each of the
following expressions:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>append x y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>cons x y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>list x y<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org109e8b0" class="outline-4">
<h4 id="org109e8b0"><span class="section-number-4">3.30.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-30-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      <span style="color: #99bb66;">(</span>y <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>e1 <span style="color: #a9a1e1;">(</span>append x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>e2 <span style="color: #a9a1e1;">(</span>cons x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">6: </span>      <span style="color: #99bb66;">(</span>e3 <span style="color: #a9a1e1;">(</span>list x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"(append x y):"</span> e1<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"(cons x y):"</span> e2<span style="color: #c678dd;">)</span>
<span class="linenr">9: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"(list x y):"</span> e3<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org783e6a6">
(append x y): (1 2 3 4 5 6) 
(cons x y): ((1 2 3) 4 5 6) 
(list x y): ((1 2 3) (4 5 6)) 
</pre>
</div>
</div>
</div>

<div id="outline-container-org77c9087" class="outline-3">
<h3 id="org77c9087"><span class="section-number-3">3.31.</span> Exercise 2.27</h3>
<div class="outline-text-3" id="text-3-31">
</div>

<div id="outline-container-org5fc0bf6" class="outline-4">
<h4 id="org5fc0bf6"><span class="section-number-4">3.31.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-31-1">
<p>
Modify your <code class="src src-scheme">reverse</code> procedure of Exercise 2.18 to produce a
<code class="src src-scheme">deep-reverse</code> procedure that takes a list as argument and returns as
its value the list with its elements reversed and with all sublists
deep-reversed as well. For example,
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">x</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
x
<span style="color: #525252;">;; </span><span style="color: #525252;">((1 2) (3 4))</span>
<span style="color: #51afef;">(</span>reverse x<span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">((3 4) (1 2))</span>
<span style="color: #51afef;">(</span>deep-reverse x<span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">((4 3) (2 1))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0c9e43" class="outline-4">
<h4 id="orge0c9e43"><span class="section-number-4">3.31.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-31-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orge3e6be6"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deep-reverse</span> l<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">len</span> <span style="color: #99bb66;">(</span>length l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> i result<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&lt; <span style="color: #51afef;">(</span>1- len<span style="color: #51afef;">)</span> i<span style="color: #a9a1e1;">)</span>
        result
        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>+ i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>here <span style="color: #51afef;">(</span>list-ref l i<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                      <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>pair? here<span style="color: #a9a1e1;">)</span>
                          <span style="color: #a9a1e1;">(</span>deep-reverse here<span style="color: #a9a1e1;">)</span>
                          here<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
                    result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>iter <span style="color: #dd8844; font-weight: bold;">0</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;deep-reverse&gt;&gt;</span>
<span style="color: #51afef;">(</span>deep-reverse <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc63c871" class="outline-3">
<h3 id="orgc63c871"><span class="section-number-3">3.32.</span> Exercise 2.28</h3>
<div class="outline-text-3" id="text-3-32">
</div>

<div id="outline-container-orgd5e41d9" class="outline-4">
<h4 id="orgd5e41d9"><span class="section-number-4">3.32.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-32-1">
<p>
Write a procedure <code class="src src-scheme">fringe</code> that takes as argument a tree (represented
as a list) and returns a list whose elements are all the leaves of the tree
arranged in left-to-right order. For example,
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">x</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>fringe x<span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">(1 2 3 4)</span>
<span style="color: #51afef;">(</span>fringe <span style="color: #c678dd;">(</span>list x x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">(1 2 3 4 1 2 3 4)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b70050" class="outline-4">
<h4 id="org9b70050"><span class="section-number-4">3.32.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-32-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org43d0512"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fringe</span> l<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? l<span style="color: #99bb66;">)</span>
      #nil
      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>a <span style="color: #c678dd;">(</span>car l<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span>d <span style="color: #c678dd;">(</span>cdr l<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>append <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>pair? a<span style="color: #c678dd;">)</span>
                    <span style="color: #c678dd;">(</span>fringe a<span style="color: #c678dd;">)</span>
                    <span style="color: #c678dd;">(</span>list a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span>fringe d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;fringe&gt;&gt;</span>
<span style="color: #51afef;">(</span>fringe <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">(1 2 3 4 5)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaf10a83" class="outline-3">
<h3 id="orgaf10a83"><span class="section-number-3">3.33.</span> Exercise 2.29: Binary Mobiles</h3>
<div class="outline-text-3" id="text-3-33">
</div>

<div id="outline-container-org195e3fc" class="outline-4">
<h4 id="org195e3fc"><span class="section-number-4">3.33.1.</span> Text Definitions</h4>
<div class="outline-text-4" id="text-3-33-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org7abd7fe"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-mobile</span> left right<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>list left right<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-branch</span> length structure<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>list length structure<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36f1eb6" class="outline-4">
<h4 id="org36f1eb6"><span class="section-number-4">3.33.2.</span> Question A: Selectors</h4>
<div class="outline-text-4" id="text-3-33-2">
<blockquote>
<p>
Write the corresponding selectors <code class="src src-scheme">left-branch</code> and
<code class="src src-scheme">right-branch</code>, which return the branches of a mobile, and
<code class="src src-scheme">branch-length</code> and <code class="src src-scheme">branch-structure</code>, which return the
components of a branch.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orga9f6275" class="outline-4">
<h4 id="orga9f6275"><span class="section-number-4">3.33.3.</span> Answer A</h4>
<div class="outline-text-4" id="text-3-33-3">
<div class="org-src-container">
<pre class="src src-scheme" id="orgc6e6248"><span style="color: #ECBE7B;">&lt;&lt;mobile-constructors-list&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">left-branch</span> mobile<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>car mobile<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">right-branch</span> mobile<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cadr mobile<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">branch-length</span> branch<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>car branch<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">branch-structure</span> branch<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cadr branch<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org548a40c" class="outline-4">
<h4 id="org548a40c"><span class="section-number-4">3.33.4.</span> Question B: total-weight</h4>
<div class="outline-text-4" id="text-3-33-4">
<blockquote>
<p>
Using your selectors, define a procedure <code class="src src-scheme">total-weight</code> that returns
the total weight of a mobile.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgc6636b9" class="outline-4">
<h4 id="orgc6636b9"><span class="section-number-4">3.33.5.</span> Answer B</h4>
<div class="outline-text-4" id="text-3-33-5">
<div class="org-src-container">
<pre class="src src-scheme" id="orgf977b3d"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">total-weight</span> mobile<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>leftS <span style="color: #51afef;">(</span>branch-structure <span style="color: #c678dd;">(</span>left-branch mobile<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>rightS <span style="color: #51afef;">(</span>branch-structure <span style="color: #c678dd;">(</span>right-branch mobile<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>number? leftS<span style="color: #51afef;">)</span>
           leftS
           <span style="color: #51afef;">(</span>total-weight leftS<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
       <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>number? rightS<span style="color: #51afef;">)</span>
           rightS
           <span style="color: #51afef;">(</span>total-weight rightS<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;mobile-selectors-list&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mobile-total-weight&gt;&gt;</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>M1 <span style="color: #a9a1e1;">(</span>make-mobile
           <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span>
                        <span style="color: #c678dd;">(</span>make-mobile <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
                                     <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>M2 <span style="color: #a9a1e1;">(</span>make-mobile
           <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span>
                        <span style="color: #c678dd;">(</span>make-mobile
                         <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
                         <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span>
                        <span style="color: #c678dd;">(</span>make-mobile
                         <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
                         <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>total-weight M1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span>total-weight M2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0557f39">
| 10 | 8 |
</pre>
</div>
</div>

<div id="outline-container-orgfedc33e" class="outline-4">
<h4 id="orgfedc33e"><span class="section-number-4">3.33.6.</span> Question C: Balancing</h4>
<div class="outline-text-4" id="text-3-33-6">
<p>
A mobile is said to be <b>balanced</b> if the torque applied by its top-left branch is
equal to that applied by its top-right branch (that is, if the length of the
left rod multiplied by the weight hanging from that rod is equal to the
corresponding product for the right side) and if each of the submobiles hanging
off its branches is balanced. Design a predicate that tests whether a binary
mobile is balanced.
</p>
</div>
</div>

<div id="outline-container-orgda16958" class="outline-4">
<h4 id="orgda16958"><span class="section-number-4">3.33.7.</span> Answer C</h4>
<div class="outline-text-4" id="text-3-33-7">
<p>
I can imagine a ton of ways I could shoot myself in the foot by starting with
optimization, so let&rsquo;s just try to nail down exactly what needs to happen.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orga852788"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">total-torque</span> branch<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>len <span style="color: #51afef;">(</span>branch-length branch<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>struct <span style="color: #51afef;">(</span>branch-structure branch<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>* len
       <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>number? struct<span style="color: #51afef;">)</span>
           struct
           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>lbs <span style="color: #a9a1e1;">(</span>branch-structure <span style="color: #51afef;">(</span>left-branch struct<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                 <span style="color: #99bb66;">(</span>rbs <span style="color: #a9a1e1;">(</span>branch-structure <span style="color: #51afef;">(</span>right-branch struct<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>total-weight lbs<span style="color: #99bb66;">)</span>
                <span style="color: #99bb66;">(</span>total-weight rbs<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">balanced?</span> mobile<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>l <span style="color: #51afef;">(</span>left-branch mobile<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>ls <span style="color: #51afef;">(</span>branch-structure l<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>r <span style="color: #51afef;">(</span>right-branch mobile<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>rs <span style="color: #51afef;">(</span>branch-structure r<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>l-balanced <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>number? ls<span style="color: #c678dd;">)</span>
                         #t
                         <span style="color: #c678dd;">(</span>balanced? ls<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>r-balanced <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>number? rs<span style="color: #c678dd;">)</span>
                         #t <span style="color: #525252;">;; </span><span style="color: #525252;">Fixed: accidentally used ls again.</span>
                         <span style="color: #c678dd;">(</span>balanced? rs<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> l-balanced r-balanced<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>= <span style="color: #51afef;">(</span>total-torque l<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>total-torque r<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        #f<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I&rsquo;ll also need a modified <code class="src src-scheme">total-weight</code> that can notice when its
argument is a non-mobile and just return the value.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orga3d08bf"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">total-weight</span> mobile<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>number? mobile<span style="color: #99bb66;">)</span>
      mobile <span style="color: #525252;">;; </span><span style="color: #525252;">this is a weight, just return it</span>
      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>leftS <span style="color: #c678dd;">(</span>branch-structure <span style="color: #99bb66;">(</span>left-branch mobile<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span>rightS <span style="color: #c678dd;">(</span>branch-structure <span style="color: #99bb66;">(</span>right-branch mobile<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>number? leftS<span style="color: #c678dd;">)</span>
               leftS
               <span style="color: #c678dd;">(</span>total-weight leftS<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>number? rightS<span style="color: #c678dd;">)</span>
               rightS
               <span style="color: #c678dd;">(</span>total-weight rightS<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mobile-selectors-list&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mobile-total-weight-2&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mobile-balanced-dumb&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M1</span> <span style="color: #525252;">;; </span><span style="color: #525252;">all segments unbalanced</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 25 = 5*5</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 5 = (2 + 3) * 1</span>
                <span style="color: #a9a1e1;">(</span>make-mobile <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">all segments balanced as they are duplicates</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 8 = 2*(2+2)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M3</span> <span style="color: #525252;">;; </span><span style="color: #525252;">equal torque, but one segment is unbalanced.</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 2*(4+2)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 8 = 2*4</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;</span><span style="color: #525252;">torque 8 = 4*2</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 3*(1+3)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 1</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 3</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M4</span> <span style="color: #525252;">;; </span><span style="color: #525252;">equal torque</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 2*(4+2)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 8 = 2*4</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;</span><span style="color: #525252;">torque 8 = 4*2</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 3*(1+3)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 3</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 3</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">isbalanced?</span> Name Status<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">Success</span> <span style="color: #99bb66;">"is balanced!"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">Failure</span> <span style="color: #99bb66;">"is not balanced!"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>eq? Status #t<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>echo Name Success<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>echo Name Failure<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M1"</span> <span style="color: #c678dd;">(</span>balanced? M1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M2"</span> <span style="color: #c678dd;">(</span>balanced? M2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M3"</span> <span style="color: #c678dd;">(</span>balanced? M3<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M4"</span> <span style="color: #c678dd;">(</span>balanced? M4<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgbd29718">
M1 is not balanced! 
M2 is balanced! 
M3 is not balanced! 
M4 is balanced! 
</pre>

<p>
This one took quite some fiddling. First I struggled to figure out exactly how I
should juggle of torque, weight, and balance. For example, a mobile is balanced
if the torques of its branches are equal, and if every submobile is also
balanced, with torque being defined as length\(\times\)weight. Note that it&rsquo;s
the <i>weight</i>, not its submobile&rsquo;s <i>torque</i>.
</p>

<p>
TODO: I&rsquo;d like to come back and make an optimized version that doesn&rsquo;t have to
crawl the tree multiple times. Maybe getting torque/weight/balanced status at
the same time?
</p>
</div>
</div>

<div id="outline-container-org293f244" class="outline-4">
<h4 id="org293f244"><span class="section-number-4">3.33.8.</span> Question D: Implementation shakeup</h4>
<div class="outline-text-4" id="text-3-33-8">
<blockquote>
<p>
Suppose we change the representation of mobiles so that the constructors are
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="orgcf6ffc9"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-mobile</span> left right<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cons left right<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-branch</span> length structure<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cons length structure<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
How much do you need to change your programs to convert to the new representation?
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org6b249ed" class="outline-4">
<h4 id="org6b249ed"><span class="section-number-4">3.33.9.</span> Answer D</h4>
<div class="outline-text-4" id="text-3-33-9">
<p>
Ideally I should only need to change the selectors, like this:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org771f5a7"><span style="color: #ECBE7B;">&lt;&lt;mobile-constructors-cons&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">left-branch</span> mobile<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>car mobile<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">right-branch</span> mobile<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cdr mobile<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">branch-length</span> branch<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>car branch<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">branch-structure</span> branch<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cdr branch<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Now, if I run the same code, I should get the same result:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mobile-selectors-cons&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mobile-total-weight-2&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;mobile-balanced-dumb&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M1</span> <span style="color: #525252;">;; </span><span style="color: #525252;">all segments unbalanced</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 25 = 5*5</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 5 = (2 + 3) * 1</span>
                <span style="color: #a9a1e1;">(</span>make-mobile <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">all segments balanced as they are duplicates</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 8 = 2*(2+2)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M3</span> <span style="color: #525252;">;; </span><span style="color: #525252;">equal torque, but one segment is unbalanced.</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 2*(4+2)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 8 = 2*4</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;</span><span style="color: #525252;">torque 8 = 4*2</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 3*(1+3)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 1</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 3</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">M4</span> <span style="color: #525252;">;; </span><span style="color: #525252;">equal torque</span>
  <span style="color: #c678dd;">(</span>make-mobile
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 2*(4+2)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 8 = 2*4</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;</span><span style="color: #525252;">torque 8 = 4*2</span>
   <span style="color: #99bb66;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 12 = 3*(1+3)</span>
                <span style="color: #a9a1e1;">(</span>make-mobile
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 3</span>
                 <span style="color: #51afef;">(</span>make-branch <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">torque 3</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">isbalanced?</span> Name Status<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">Success</span> <span style="color: #99bb66;">"is balanced!"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">Failure</span> <span style="color: #99bb66;">"is not balanced!"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>eq? Status #t<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>echo Name Success<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>echo Name Failure<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M1"</span> <span style="color: #c678dd;">(</span>balanced? M1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M2"</span> <span style="color: #c678dd;">(</span>balanced? M2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M3"</span> <span style="color: #c678dd;">(</span>balanced? M3<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>isbalanced? <span style="color: #99bb66;">"M4"</span> <span style="color: #c678dd;">(</span>balanced? M4<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org980a32b">
M1 is not balanced! 
M2 is balanced! 
M3 is not balanced! 
M4 is balanced! 
</pre>
</div>
</div>
</div>

<div id="outline-container-org5bf9a41" class="outline-3">
<h3 id="org5bf9a41"><span class="section-number-3">3.34.</span> Exercise 2.30</h3>
<div class="outline-text-3" id="text-3-34">
</div>

<div id="outline-container-org0ff2f50" class="outline-4">
<h4 id="org0ff2f50"><span class="section-number-4">3.34.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-34-1">
<p>
Define a procedure
<code class="src src-scheme">square-tree</code> analogous to the <code class="src src-scheme">square-@/list</code> procedure of
<a href="#org285c80e">3.25</a>.  That is, <code class="src src-scheme">square-tree</code> should behave as follows:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>square-tree
<span class="linenr">2: </span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">3: </span>       <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>       <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #525252;">;; </span><span style="color: #525252;">(1 (4 (9 16) 25) (36 49))</span>
</pre>
</div>

<p>
Define <code class="src src-scheme">square-tree</code> both directly (i.e., without using any higher-order
procedures) and also by using <code class="src src-scheme">map</code> and recursion.
</p>
</div>
</div>

<div id="outline-container-orgba151ab" class="outline-4">
<h4 id="orgba151ab"><span class="section-number-4">3.34.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-34-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgcc7e014"><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-tree-discrete</span> tree<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? tree<span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>pair? tree<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>square tree<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>square-tree-discrete <span style="color: #c678dd;">(</span>car tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span>square-tree-discrete <span style="color: #c678dd;">(</span>cdr tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-tree-map</span> tree<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>sub-tree<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>pair? sub-tree<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>square-tree-map sub-tree<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>square sub-tree<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
       tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">&lt;&lt;square-tree&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>testlist
       <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>answer
       <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">16</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">36</span> <span style="color: #dd8844; font-weight: bold;">49</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"square-tree-discrete"</span>
             <span style="color: #99bb66;">(</span>square-tree-discrete testlist<span style="color: #99bb66;">)</span>
             answer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"square-tree-map"</span>
             <span style="color: #99bb66;">(</span>square-tree-map testlist<span style="color: #99bb66;">)</span>
             answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org795c25a">
SUCCEED at square-tree-discrete
SUCCEED at square-tree-map
</pre>

<p>
While writing that, I ran headfirst into a lesson I&rsquo;ve had to repeatedly learn: default Guile functions end their lists with <code class="src src-scheme">'<span style="color: #51afef;">()</span></code> which does not match equality with lists ended with <code class="src src-scheme">#nil</code>.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>parens-list <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>nil-list <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> #nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display parens-list<span style="color: #c678dd;">)(</span>display <span style="color: #99bb66;">" &lt;== ends with '()"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display nil-list<span style="color: #c678dd;">)(</span>display <span style="color: #99bb66;">" &lt;== ends with #nil"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">"Are these two lists equal? &gt; "</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">(</span>equal? parens-list nil-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">"Does Guile consider #nil and '() equal? &gt; "</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">(</span>equal? #nil '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">"What about #nil and #f? &gt; "</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #99bb66;">(</span>equal? #nil #f<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org4e35ce9">
(1 2 3) &lt;== ends with '()
(1 2 3) &lt;== ends with #nil
Are these two lists equal? &gt; #f
Does Guile consider #nil and '() equal? &gt; #f
What about #nil and #f? &gt; #f
</pre>
</div>
</div>
</div>

<div id="outline-container-org6373be0" class="outline-3">
<h3 id="org6373be0"><span class="section-number-3">3.35.</span> Exercise 2.31</h3>
<div class="outline-text-3" id="text-3-35">
</div>

<div id="outline-container-org6442098" class="outline-4">
<h4 id="org6442098"><span class="section-number-4">3.35.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-35-1">
<blockquote>
<p>
Abstract your answer to <a href="#org5bf9a41">3.34</a> to produce a procedure
<code class="src src-scheme">tree-map</code> with the property that <code class="src src-scheme">square-tree</code> could be
defined as
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-tree</span> tree<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>tree-map square tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org729b032" class="outline-4">
<h4 id="org729b032"><span class="section-number-4">3.35.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-35-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org9d5ba68"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tree-map</span> f tree<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? tree<span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>pair? tree<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>f tree<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>tree-map f <span style="color: #c678dd;">(</span>car tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span>tree-map f <span style="color: #c678dd;">(</span>cdr tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">&lt;&lt;tree-map&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-tree-tm</span> tree<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>tree-map square tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>testlist
       <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>answer
       <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">16</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">36</span> <span style="color: #dd8844; font-weight: bold;">49</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"square-tree-tm"</span>
             <span style="color: #99bb66;">(</span>square-tree-tm testlist<span style="color: #99bb66;">)</span>
             answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgbfdb2d2">
SUCCEED at square-tree-tm
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c4950a" class="outline-3">
<h3 id="org9c4950a"><span class="section-number-3">3.36.</span> Exercise 2.32</h3>
<div class="outline-text-3" id="text-3-36">
</div>

<div id="outline-container-orgb731aaa" class="outline-4">
<h4 id="orgb731aaa"><span class="section-number-4">3.36.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-36-1">
<blockquote>
<p>
We can represent a set as a list of distinct elements, and we can represent the
set of all subsets of the set as a list of lists. For example, if the set is
<code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span></code>, then the set of all subsets is <code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>. Complete the following definition of a procedure that
generates the set of subsets of a set and give a clear explanation of why it
works:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">subsets</span> s<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? s<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>list nil<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>rest <span style="color: #c678dd;">(</span>subsets <span style="color: #99bb66;">(</span>cdr s<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>append rest <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #ECBE7B;">&lt;??&gt;</span> rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org26673a9" class="outline-4">
<h4 id="org26673a9"><span class="section-number-4">3.36.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-36-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org74a0962"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">subsets</span> s<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? s<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>list '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>rest <span style="color: #c678dd;">(</span>subsets <span style="color: #99bb66;">(</span>cdr s<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>append rest <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span>
                            <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>car s<span style="color: #a9a1e1;">)</span> x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
                          rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;subsets&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>answer
       <span style="color: #a9a1e1;">(</span>list '<span style="color: #51afef;">()</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"subsets"</span>
             <span style="color: #99bb66;">(</span>subsets <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
             answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org92fe6a7">
SUCCEED at subsets
</pre>

<p>
Essentially, <code class="src src-scheme">subsets</code> is rotating through members of the list in a
similar way that a counter incrementing rotates through all numbers in its base.
For a list with items \(1\) to \(n\), <code class="src src-scheme">subsets</code> makes a list with the
last item, \([n]\), then lists \([n-1]\) and \([n-1, n]\), then lists
\([n-2][n-2, n-1][n-2,n]\), then \([n-3][n-3,n-2][n-3,n-1][n-3,n]\) and so on.
</p>

<p>
I&rsquo;d like to try adding some debugging statements to subsets and see if it might
help clarify the operation.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgfc37ac2"><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">doit</span> f x<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>f x<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">this probably has a formal lambda calculus name</span>
  x<span style="color: #51afef;">)</span>    <span style="color: #525252;">;; </span><span style="color: #525252;">but I don't know what it is</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">echo-return</span> x<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>doit echo x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">echo-y-return-x</span> x . y<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>apply echo y<span style="color: #c678dd;">)</span>
  x<span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;subsets&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;echo-return&gt;&gt;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">subsets-debug</span> s<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"Enter with"</span> s <span style="color: #99bb66;">"{"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>a1
         <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>null? s<span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>echo-return <span style="color: #99bb66;">(</span>list '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>subsets-debug <span style="color: #c678dd;">(</span>cdr s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
               <span style="color: #99bb66;">(</span>echo <span style="color: #99bb66;">"[ iter"</span> <span style="color: #a9a1e1;">(</span>car s<span style="color: #a9a1e1;">)</span> <span style="color: #99bb66;">"over"</span> rest <span style="color: #99bb66;">"]"</span><span style="color: #99bb66;">)</span>
               <span style="color: #99bb66;">(</span>append rest <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
                                   <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>y <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>car s<span style="color: #c678dd;">)</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                                     <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~a "</span> y<span style="color: #99bb66;">)</span>
                                     y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                                 rest<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>echo <span style="color: #99bb66;">"} end"</span> s<span style="color: #99bb66;">)</span>
    a1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>answer
       <span style="color: #a9a1e1;">(</span>list '<span style="color: #51afef;">()</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>subsets-debug <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  answer<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org5d8a60a">
Enter with (1 2 3) { 
Enter with (2 3) { 
Enter with (3) { 
Enter with () { 
(()) 
} end () 
[ iter 3 over (()) ] 
(3) 
} end (3) 
[ iter 2 over (() (3)) ] 
(2) (2 3) 
} end (2 3) 
[ iter 1 over (() (3) (2) (2 3)) ] 
(1) (1 3) (1 2) (1 2 3) 
} end (1 2 3) 
</pre>
</div>
</div>
</div>

<div id="outline-container-org992bfb0" class="outline-3">
<h3 id="org992bfb0"><span class="section-number-3">3.37.</span> 2.2.3: Sequences as Conventional Interfaces</h3>
<div class="outline-text-3" id="text-3-37">
<p>
Abstractions are an important part of making code clearer and more easy to
understand. One beneficial manner of abstraction is making available
conventional interfaces for working with compound data, such as
<code class="src src-scheme">filter</code> and <code class="src src-scheme">map</code>.
</p>

<p>
This allows for easily making &ldquo;signal-flow&rdquo; conceptions of processes:
</p>


<div id="orgfde2022" class="figure">
<p><img src="2/fig/t_2-2-3.png" alt="t_2-2-3.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgd5b8dcc" class="outline-3">
<h3 id="orgd5b8dcc"><span class="section-number-3">3.38.</span> Exercise 2.33: The flexibility of <code>accumulate</code></h3>
<div class="outline-text-3" id="text-3-38">
</div>

<div id="outline-container-orgaa85487" class="outline-4">
<h4 id="orgaa85487"><span class="section-number-4">3.38.1.</span> Text Definitions</h4>
<div class="outline-text-4" id="text-3-38-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org0e48b36"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">accumulate</span> op initial sequence<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? sequence<span style="color: #99bb66;">)</span>
      initial
      <span style="color: #99bb66;">(</span>op <span style="color: #a9a1e1;">(</span>car sequence<span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span>accumulate op 
                      initial 
                      <span style="color: #51afef;">(</span>cdr sequence<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orged377e0" class="outline-4">
<h4 id="orged377e0"><span class="section-number-4">3.38.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-38-2">
<blockquote>
<p>
Fill in the missing expressions to complete the following definitions of some basic list-manipulation operations as accumulations.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map</span> p sequence<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>accumulate <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #99bb66;">)</span> nil sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">append</span> seq1 seq2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>accumulate cons <span style="color: #ECBE7B;">&lt;??&gt;</span> <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">length</span> sequence<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>accumulate <span style="color: #ECBE7B;">&lt;??&gt;</span> <span style="color: #dd8844; font-weight: bold;">0</span> sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd40d4d1" class="outline-4">
<h4 id="orgd40d4d1"><span class="section-number-4">3.38.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-38-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org9428bf3"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map-acc</span> p sequence<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>accumulate <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 3: </span>                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>p x<span style="color: #51afef;">)</span> y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>              '<span style="color: #99bb66;">()</span> sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">append-acc</span> seq1 seq2<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>accumulate cons seq2 seq1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">length-acc</span> sequence<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>accumulate <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>                <span style="color: #a9a1e1;">(</span>1+ y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>              <span style="color: #dd8844; font-weight: bold;">0</span> sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate-forms&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"map"</span>
<span class="linenr"> 7: </span>             <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> square l<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>             <span style="color: #99bb66;">(</span>map-acc square l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"append"</span>
<span class="linenr">10: </span>             <span style="color: #99bb66;">(</span>append l l<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>             <span style="color: #99bb66;">(</span>append-acc l l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"length"</span>
<span class="linenr">13: </span>             <span style="color: #99bb66;">(</span>length l<span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>             <span style="color: #99bb66;">(</span>length-acc l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org839cdee">
SUCCEED at map
SUCCEED at append
SUCCEED at length
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9912a5" class="outline-3">
<h3 id="orgf9912a5"><span class="section-number-3">3.39.</span> Exercise 2.34</h3>
<div class="outline-text-3" id="text-3-39">
</div>

<div id="outline-container-orgb085631" class="outline-4">
<h4 id="orgb085631"><span class="section-number-4">3.39.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-39-1">
<blockquote>
<p>
Evaluating a polynomial in \(x\) at a given value of \(x\) can be formulated as
an accumulation. We evaluate the polynomial
</p>

<p>
\[ a_n x^n + a_{n-1} x^{n-1} + \dots + a_1 x + a_0 \]
</p>

<p>
using a well-known algorithm called <i>Horner&rsquo;s rule</i>, which structures the
computation as
</p>

<p>
\[ (\dots (a_n x + a_{n-1}) x + \dots + a_1) x + a_0. \]
</p>

<p>
In other words, we start with \(a_n\), multiply by \(x\), add \(a_{n-1}\),
multiply by \(x\), and so on, until we reach \(a_0\).
</p>

<p>
Fill in the following template to produce a procedure that evaluates a
polynomial using Horner&rsquo;s rule. Assume that the coefficients of the polynomial
are arranged in a sequence, from \(a_0\) through \(a_n\).
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">horner-eval</span> x coefficient-sequence<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>accumulate <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>this-coeff higher-terms<span style="color: #a9a1e1;">)</span> <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #99bb66;">)</span>
              <span style="color: #dd8844; font-weight: bold;">0</span>
              coefficient-sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
For example, to compute \(1 + 3x + 5x^3 + x^5\) at \(x = 2\) you
would evaluate
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>horner-eval <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org02c2fb2" class="outline-4">
<h4 id="org02c2fb2"><span class="section-number-4">3.39.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-39-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgbc1fb20"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">horner-eval</span> x coefficient-sequence<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>accumulate <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>this-coeff higher-terms<span style="color: #a9a1e1;">)</span>
<span class="linenr">3: </span>                <span style="color: #a9a1e1;">(</span>+ this-coeff
<span class="linenr">4: </span>                   <span style="color: #51afef;">(</span>* higher-terms x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>              <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">6: </span>              coefficient-sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;horner-eval&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"horner-eval"</span>
<span class="linenr">5: </span>           <span style="color: #c678dd;">(</span>horner-eval <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>           <span style="color: #dd8844; font-weight: bold;">79</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgaf12c34">
SUCCEED at horner-eval
</pre>

<p>
This one was very satisfying. It essentially &ldquo;delays&rdquo; the exponentiation, carrying it out per stage, by rewriting this:
</p>

<p>
\(1 + 3 \times 2 + 5 \times 2^3 + 2^5\)
</p>

<p>
Into this operation, left to right:
</p>

<p>
\[ 0+1*2+0*2+0*2+3*2+1 \]
</p>
</div>
</div>
</div>


<div id="outline-container-org5ec19a4" class="outline-3">
<h3 id="org5ec19a4"><span class="section-number-3">3.40.</span> Exercise 2.35</h3>
<div class="outline-text-3" id="text-3-40">
</div>

<div id="outline-container-org3360eb5" class="outline-4">
<h4 id="org3360eb5"><span class="section-number-4">3.40.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-40-1">
<blockquote>
<p>
Redefine <code class="src src-scheme">count-leaves</code> from
2.2.2 as an accumulation:
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4fe7fd5" class="outline-4">
<h4 id="org4fe7fd5"><span class="section-number-4">3.40.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-40-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orga5d95a3"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">count-leaves-acc</span> t<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>accumulate <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i total<span style="color: #a9a1e1;">)</span>
<span class="linenr">3: </span>                <span style="color: #a9a1e1;">(</span>+ i total<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>              <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span>
<span class="linenr">5: </span>                       <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>pair? x<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>                           <span style="color: #c678dd;">(</span>count-leaves-acc x<span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>                           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">8: </span>                     t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;count-leaves&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;count-leaves-acc&gt;&gt;</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"count-leaves-acc"</span>
<span class="linenr">7: </span>              <span style="color: #99bb66;">(</span>count-leaves l<span style="color: #99bb66;">)</span>
<span class="linenr">8: </span>              <span style="color: #99bb66;">(</span>count-leaves-acc l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org9492d15">
SUCCEED at count-leaves-acc
</pre>
</div>
</div>
</div>

<div id="outline-container-org02a9abf" class="outline-3">
<h3 id="org02a9abf"><span class="section-number-3">3.41.</span> Exercise 2.36: Accumulate across multiple lists</h3>
<div class="outline-text-3" id="text-3-41">
</div>

<div id="outline-container-org6ef867b" class="outline-4">
<h4 id="org6ef867b"><span class="section-number-4">3.41.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-41-1">
<blockquote>
<p>
The procedure <code class="src src-scheme">accumulate-n</code> is similar to <code class="src src-scheme">accumulate</code>
except that it takes as its third argument a sequence of sequences, which are
all assumed to have the same number of elements. It applies the designated
accumulation procedure to combine all the first elements of the sequences, all
the second elements of the sequences, and so on, and returns a sequence of the
results. For instance, if <code class="src src-scheme">s</code> is a sequence containing four sequences,
<code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">11</span> <span style="color: #dd8844; font-weight: bold;">12</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>, then the value of
<code class="src src-scheme"><span style="color: #51afef;">(</span>accumulate-n + <span style="color: #dd8844; font-weight: bold;">0</span> s<span style="color: #51afef;">)</span></code> should be the sequence <code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">22</span> <span style="color: #dd8844; font-weight: bold;">26</span> <span style="color: #dd8844; font-weight: bold;">30</span><span style="color: #51afef;">)</span></code>.
Fill in the missing expressions in the following definition of
<code class="src src-scheme">accumulate-n</code>:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">accumulate-n</span> op init seqs<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>car seqs<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      nil
      <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>accumulate op init <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span>accumulate-n op init <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org12b5111" class="outline-4">
<h4 id="org12b5111"><span class="section-number-4">3.41.2.</span> Answers</h4>
<div class="outline-text-4" id="text-3-41-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org94ef504"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">accumulate-n</span> op init seqs<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>car seqs<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      '<span style="color: #99bb66;">()</span>
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>accumulate op init
<span class="linenr">5: </span>                        <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> car seqs<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>            <span style="color: #a9a1e1;">(</span>accumulate-n op init
<span class="linenr">7: </span>                          <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> cdr seqs<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate-n&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>s <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">10</span> <span style="color: #dd8844; font-weight: bold;">11</span> <span style="color: #dd8844; font-weight: bold;">12</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"accumulate-n"</span>
<span class="linenr">6: </span>             <span style="color: #99bb66;">(</span>accumulate-n + <span style="color: #dd8844; font-weight: bold;">0</span> s<span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>             <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">22</span> <span style="color: #dd8844; font-weight: bold;">26</span> <span style="color: #dd8844; font-weight: bold;">30</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org1ffc9a5">
SUCCEED at accumulate-n
</pre>
</div>
</div>
</div>

<div id="outline-container-org12dab51" class="outline-3">
<h3 id="org12dab51"><span class="section-number-3">3.42.</span> Exercise 2.37: Enter the matrices</h3>
<div class="outline-text-3" id="text-3-42">
</div>

<div id="outline-container-org48a210f" class="outline-4">
<h4 id="org48a210f"><span class="section-number-4">3.42.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-42-1">
<p>
<i>See full quote in book.</i>
</p>

<p>
Suppose we represent vectors as lists, and matrices as lists of vectors. For example:
</p>

<p>
\left(
</p>
\begin{array}{cccc}
  1 & 2 & 3 & 4 \\
  4 & 5 & 6 & 6 \\
  6 & 7 & 8 & 9
\end{array}
<p>
\right)
</p>

<p>
<code class="src src-scheme">'<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>
</p>

<p>
Define these operations:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dot-product</span> v w<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>accumulate + <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> * v w<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">matrix-*-vector</span> m v<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #ECBE7B;">&lt;??&gt;</span> m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">transpose</span> mat<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>accumulate-n <span style="color: #ECBE7B;">&lt;??&gt;</span> <span style="color: #ECBE7B;">&lt;??&gt;</span> mat<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">matrix-*-matrix</span> m n<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>cols <span style="color: #51afef;">(</span>transpose n<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">9: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #ECBE7B;">&lt;??&gt;</span> m<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org45623c2" class="outline-4">
<h4 id="org45623c2"><span class="section-number-4">3.42.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-42-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org3a1f4e6"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dot-product</span> v w<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>accumulate + <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> * v w<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">matrix-*-vector</span> m v<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>row<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span>dot-product v row<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       m<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">transpose</span> mat<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>accumulate-n cons '<span style="color: #99bb66;">()</span> mat<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">matrix-*-matrix</span> m n<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>cols <span style="color: #51afef;">(</span>transpose n<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>row<span style="color: #51afef;">)</span>
<span class="linenr">12: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>col<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                  <span style="color: #99bb66;">(</span>dot-product row col<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                cols<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>           m<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate-n&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;matrix-ops&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>v1 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span>v2 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>m1 <span style="color: #a9a1e1;">(</span>list v1 v2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>      <span style="color: #99bb66;">(</span>m1t <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>                <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>                <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>      <span style="color: #99bb66;">(</span>m1-*-m1t <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">30</span> <span style="color: #dd8844; font-weight: bold;">70</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                      <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">70</span> <span style="color: #dd8844; font-weight: bold;">174</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"transpose"</span>
<span class="linenr">16: </span>             <span style="color: #99bb66;">(</span>transpose m1<span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>             m1t<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"dot-product"</span>
<span class="linenr">19: </span>             <span style="color: #99bb66;">(</span>dot-product v1 v2<span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>             <span style="color: #dd8844; font-weight: bold;">70</span><span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"matrix-*-vector"</span>
<span class="linenr">22: </span>             <span style="color: #99bb66;">(</span>matrix-*-vector m1 v1<span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>             <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">30</span> <span style="color: #dd8844; font-weight: bold;">70</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"matrix-*-matrix"</span>
<span class="linenr">25: </span>             <span style="color: #99bb66;">(</span>matrix-*-matrix m1 m1t<span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>             m1-*-m1t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orge191f23">
SUCCEED at transpose
SUCCEED at dot-product
SUCCEED at matrix-*-vector
SUCCEED at matrix-*-matrix
</pre>

<p>
I struggled a lot with what order things should be processed and applied in.
Some of that came from never having done matrix multiplication before now. I
would probably still not understand it if I hadn&rsquo;t found <a href="https://youtu.be/MfN1lqArwAg">Herb Gross&rsquo; lecture
regarding matrix operations</a><sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>.
</p>

<p>
The other issue is nested map operations. I find it easy to read Python-ish
code like this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #525252;"># </span><span style="color: #525252;">Pseudocode</span>
<span style="color: #51afef;">for</span> row <span style="color: #51afef;">in</span> <span style="color: #dcaeea;">m1</span>:
    <span style="color: #51afef;">for</span> column <span style="color: #51afef;">in</span> m2t:
        <span style="color: #51afef;">for</span> a,b <span style="color: #51afef;">in</span> row,column:
            answer[i:j] += a*b
</pre>
</div>

<p>
But much harder to comprehend Lisp code like this:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>row<span style="color: #99bb66;">)</span>
       <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>col<span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span>dot-product row col<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            m1t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
     m1<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I must have a mental block in the way I think about map operations.
</p>
</div>
</div>
</div>

<div id="outline-container-org3b0b02a" class="outline-3">
<h3 id="org3b0b02a"><span class="section-number-3">3.43.</span> Exercise 2.38: fold-right</h3>
<div class="outline-text-3" id="text-3-43">
</div>

<div id="outline-container-org8bbee10" class="outline-4">
<h4 id="org8bbee10"><span class="section-number-4">3.43.1.</span> Question A</h4>
<div class="outline-text-4" id="text-3-43-1">
<blockquote>
<p>
The <code class="src src-scheme">accumulate</code> procedure
is also known as <code class="src src-scheme">fold-right</code>, because it combines the first element of
the sequence with the result of combining all the elements to the right.  There
is also a <code class="src src-scheme">fold-left</code>, which is similar to <code class="src src-scheme">fold-right</code>, except that
it combines elements working in the opposite direction:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="orgd8d9cef"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">fold-left</span> op initial sequence<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> result rest<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? rest<span style="color: #a9a1e1;">)</span>
        result
        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>op result <span style="color: #c678dd;">(</span>car rest<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>iter initial sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
What are the values of
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>fold-right / <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>fold-left / <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>fold-right list nil <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>fold-left list nil <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca83920" class="outline-4">
<h4 id="orgca83920"><span class="section-number-4">3.43.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-3-43-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">fold-right</span> accumulate<span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;fold-left&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"(fold-right / 1 (list 1 2 3)):"</span> <span style="color: #c678dd;">(</span>fold-right / <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"(fold-left / 1 (list 1 2 3)):"</span> <span style="color: #c678dd;">(</span>fold-left / <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"(fold-right list nil (list 1 2 3))"</span> <span style="color: #c678dd;">(</span>fold-right list '<span style="color: #99bb66;">()</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">8: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"(fold-left list nil (list 1 2 3))"</span> <span style="color: #c678dd;">(</span>fold-left list '<span style="color: #99bb66;">()</span> <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgaa037e8">
(fold-right / 1 (list 1 2 3)): 3/2 
(fold-left / 1 (list 1 2 3)): 1/6 
(fold-right list nil (list 1 2 3)) (1 (2 (3 ()))) 
(fold-left list nil (list 1 2 3)) (((() 1) 2) 3) 
</pre>
</div>
</div>

<div id="outline-container-org2d96b6c" class="outline-4">
<h4 id="org2d96b6c"><span class="section-number-4">3.43.3.</span> Question B</h4>
<div class="outline-text-4" id="text-3-43-3">
<blockquote>
<p>
Give a property that <code class="src src-scheme">op</code> should satisfy to guarantee that
<code class="src src-scheme">fold-right</code> and <code class="src src-scheme">fold-left</code> will produce the same values
for any sequence.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org3a0c56c" class="outline-4">
<h4 id="org3a0c56c"><span class="section-number-4">3.43.4.</span> Answer B</h4>
<div class="outline-text-4" id="text-3-43-4">
<p>
They would need to be commutative, like addition and multiplication.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;accumulate&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">fold-right</span> accumulate<span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;fold-left&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>lr <span style="color: #a9a1e1;">(</span>reverse l<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"commutative addition"</span>
<span class="linenr">10: </span>             <span style="color: #99bb66;">(</span>fold-right + <span style="color: #dd8844; font-weight: bold;">0</span> l<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>             <span style="color: #99bb66;">(</span>fold-right + <span style="color: #dd8844; font-weight: bold;">0</span> lr<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>             <span style="color: #99bb66;">(</span>fold-left + <span style="color: #dd8844; font-weight: bold;">0</span> l<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>             <span style="color: #99bb66;">(</span>fold-left + <span style="color: #dd8844; font-weight: bold;">0</span> lr<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"commutative multiplication"</span>
<span class="linenr">15: </span>             <span style="color: #99bb66;">(</span>fold-right * <span style="color: #dd8844; font-weight: bold;">1</span> l<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>             <span style="color: #99bb66;">(</span>fold-right * <span style="color: #dd8844; font-weight: bold;">1</span> lr<span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>             <span style="color: #99bb66;">(</span>fold-left * <span style="color: #dd8844; font-weight: bold;">1</span> l<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>             <span style="color: #99bb66;">(</span>fold-left * <span style="color: #dd8844; font-weight: bold;">1</span> lr<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0a7ea84">
SUCCEED at commutative addition
SUCCEED at commutative multiplication
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf88c9d" class="outline-3">
<h3 id="orgaf88c9d"><span class="section-number-3">3.44.</span> Exercise 2.39: reverse via fold</h3>
<div class="outline-text-3" id="text-3-44">
</div>

<div id="outline-container-org187d285" class="outline-4">
<h4 id="org187d285"><span class="section-number-4">3.44.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-44-1">
<blockquote>
<p>
Complete the following
definitions of <code class="src src-scheme">reverse</code> (Exercise 2.18) in terms of
<code class="src src-scheme">fold-right</code> and <code class="src src-scheme">fold-left</code> from Exercise 2.38:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reverse</span> sequence<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>fold-right <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #99bb66;">)</span> nil sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reverse</span> sequence<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>fold-left <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #ECBE7B;">&lt;??&gt;</span><span style="color: #99bb66;">)</span> nil sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org66447d0" class="outline-4">
<h4 id="org66447d0"><span class="section-number-4">3.44.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-44-2">
<p>
First, I&rsquo;d like to start using the SRFI folds instead. This is my little &ldquo;compatibility module&rdquo;.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgf0c6212"><span class="linenr">1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">SICP compat</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">accumulate</span> fold-right<span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">fold-left</span> fold<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Now to the problem.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org1411746"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fold-compat&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reverse-fr</span> sequence<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>fold-right <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>                <span style="color: #a9a1e1;">(</span>append  y <span style="color: #51afef;">(</span>list x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>              '<span style="color: #99bb66;">()</span> sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reverse-fl</span> sequence<span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>  <span style="color: #c678dd;">(</span>fold-left <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">8: </span>               <span style="color: #a9a1e1;">(</span>append <span style="color: #51afef;">(</span>list x<span style="color: #51afef;">)</span> y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">9: </span>             '<span style="color: #99bb66;">()</span> sequence<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;reverse-fold&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>l <span style="color: #a9a1e1;">(</span>iota <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>lr <span style="color: #a9a1e1;">(</span>reverse <span style="color: #51afef;">(</span>iota <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"reverse-fr"</span>
<span class="linenr"> 6: </span>             <span style="color: #99bb66;">(</span>reverse-fr l<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>             lr<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"reverse-fl"</span>
<span class="linenr"> 9: </span>             <span style="color: #99bb66;">(</span>reverse-fl l<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>             lr<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgbfbf281">
SUCCEED at reverse-fr
SUCCEED at reverse-fl
</pre>
</div>
</div>
</div>

<div id="outline-container-org20d4702" class="outline-3">
<h3 id="org20d4702"><span class="section-number-3">3.45.</span> Exercise 2.40: <code>unique-pairs</code></h3>
<div class="outline-text-3" id="text-3-45">
</div>

<div id="outline-container-orgdd7ac51" class="outline-4">
<h4 id="orgdd7ac51"><span class="section-number-4">3.45.1.</span> Text Definitions</h4>
<div class="outline-text-4" id="text-3-45-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org319da26"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">enumerate-interval</span> low high<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&gt; low high<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      '<span style="color: #99bb66;">()</span>
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>cons low 
<span class="linenr">5: </span>            <span style="color: #a9a1e1;">(</span>enumerate-interval 
<span class="linenr">6: </span>             <span style="color: #51afef;">(</span>+ low <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> 
<span class="linenr">7: </span>             high<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgbda7802"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fold-compat&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">flatmap</span> proc seq<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>accumulate append '<span style="color: #99bb66;">()</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> proc seq<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org209b31a"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;flatmap&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;prime-smallest-divisor&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime-sum?</span> pair<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>prime? <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>car pair<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cadr pair<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-pair-sum</span> pair<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>car pair<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cadr pair<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>car pair<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cadr pair<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime-sum-pairs</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> make-pair-sum
<span class="linenr">10: </span>       <span style="color: #99bb66;">(</span>filter prime-sum? <span style="color: #a9a1e1;">(</span>flatmap
<span class="linenr">11: </span>                           <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>i<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>                             <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>j<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>list i j<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                                  <span style="color: #99bb66;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>- i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                           <span style="color: #51afef;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> n<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org28bc434" class="outline-4">
<h4 id="org28bc434"><span class="section-number-4">3.45.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-45-2">
<blockquote>
<p>
Define a procedure <code class="src src-scheme">unique-pairs</code> that, given an integer \(n\),
generates the sequence of pairs \((i, j)\) with \(1 \le j < i \le n\). Use
<code class="src src-scheme">unique-pairs</code> to simplify the definition of
<code class="src src-scheme">prime-sum-pairs</code> given above.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org558c06c" class="outline-4">
<h4 id="org558c06c"><span class="section-number-4">3.45.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-45-3">
<div class="org-src-container">
<pre class="src src-scheme" id="orgd29d648"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;fold-compat&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;flatmap&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">unique-pairs</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span>flatmap
<span class="linenr">6: </span>   <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span>
<span class="linenr">7: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>j<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>list i j<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">8: </span>          <span style="color: #51afef;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span>- i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">9: </span>   <span style="color: #99bb66;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;unique-pairs&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>target <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>answer <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>                    <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>                    <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"unique-pairs"</span>
<span class="linenr"> 8: </span>             <span style="color: #99bb66;">(</span>unique-pairs target<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>             answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;prime-sum-txt&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prime-sum-pairs-mine</span> n<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> make-pair-sum
<span class="linenr">14: </span>       <span style="color: #99bb66;">(</span>filter prime-sum?
<span class="linenr">15: </span>               <span style="color: #a9a1e1;">(</span>unique-pairs n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>answer <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>                    <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>                    <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"prime-sum-pairs with unique-pairs"</span>
<span class="linenr">20: </span>             <span style="color: #99bb66;">(</span>prime-sum-pairs-mine <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>             answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgccd7d85">
SUCCEED at unique-pairs
SUCCEED at prime-sum-pairs with unique-pairs
</pre>
</div>
</div>
</div>

<div id="outline-container-orga77493d" class="outline-3">
<h3 id="orga77493d"><span class="section-number-3">3.46.</span> Exercise 2.41: Ordered triples of positive integers</h3>
<div class="outline-text-3" id="text-3-46">
</div>

<div id="outline-container-org55f5300" class="outline-4">
<h4 id="org55f5300"><span class="section-number-4">3.46.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-46-1">
<blockquote>
<p>
Write a procedure to find all ordered triples of distinct positive integers
\(i\), \(j\), and \(k\) less than or equal to a given integer \(n\) that sum to
a given integer \(s\).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgab10ea8" class="outline-4">
<h4 id="orgab10ea8"><span class="section-number-4">3.46.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-46-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgda47686"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;fold-compat&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flatmap&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">unique-triplets</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>flatmap <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>i<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>             <span style="color: #a9a1e1;">(</span>flatmap <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>j<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>                        <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>k<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>list i j k<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>                             <span style="color: #99bb66;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>- j <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>                      <span style="color: #51afef;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span>- i <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>           <span style="color: #99bb66;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org4f7f111"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">triplets-sum</span> n s<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>filter <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>triplet<span style="color: #a9a1e1;">)</span>
<span class="linenr">3: </span>            <span style="color: #a9a1e1;">(</span>= s <span style="color: #51afef;">(</span>fold + <span style="color: #dd8844; font-weight: bold;">0</span> triplet<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>          <span style="color: #99bb66;">(</span>unique-triplets n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;unique-triplets&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;triplets-sum&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>answer-a
<span class="linenr"> 5: </span>       <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>      <span style="color: #99bb66;">(</span>answer-b
<span class="linenr">11: </span>       <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>             <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"unique-triplets"</span>
<span class="linenr">14: </span>             <span style="color: #99bb66;">(</span>unique-triplets <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>             answer-a<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"triplets-sum"</span>
<span class="linenr">17: </span>             <span style="color: #99bb66;">(</span>triplets-sum <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>             answer-b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgbc8f99e">
SUCCEED at unique-triplets
SUCCEED at triplets-sum
</pre>
</div>
</div>
</div>

<div id="outline-container-orgafea743" class="outline-3">
<h3 id="orgafea743"><span class="section-number-3">3.47.</span> Exercise 2.42: Eight Queens</h3>
<div class="outline-text-3" id="text-3-47">
</div>

<div id="outline-container-org5a6e333" class="outline-4">
<h4 id="org5a6e333"><span class="section-number-4">3.47.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-47-1">
<blockquote>
<p>
The ``eight-queens puzzle&rsquo;&rsquo; asks how to place eight queens on a chessboard so
that no queen is in check from any other.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme" id="org05e8eb2"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;flatmap&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">queens</span> board-size<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">queen-cols</span> k<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= k <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #a9a1e1;">(</span>list empty-board<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>        <span style="color: #a9a1e1;">(</span>filter
<span class="linenr"> 8: </span>         <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>positions<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>safe? k positions<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>         <span style="color: #51afef;">(</span>flatmap
<span class="linenr">10: </span>          <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>rest-of-queens<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>            <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>new-row<span style="color: #51afef;">)</span>
<span class="linenr">12: </span>                   <span style="color: #51afef;">(</span>adjoin-position
<span class="linenr">13: </span>                    new-row k rest-of-queens<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">14: </span>                 <span style="color: #a9a1e1;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> board-size<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>          <span style="color: #c678dd;">(</span>queen-cols <span style="color: #99bb66;">(</span>- k <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>queen-cols board-size<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
Complete the program by writing the following:
</p>
<ul class="org-ul">
<li>representation for sets of board positions, including:
<ul class="org-ul">
<li><code class="src src-scheme">adjoin-position</code>, which adjoins a new row-column position to a
set of positions</li>
<li><code class="src src-scheme">empty-board</code>, which represents an empty set of positions.</li>
</ul></li>
<li><code class="src src-scheme">safe?</code>, which determines for a set of positions, whether the queen
in the \(k^{\mathrm{th}}\) column is safe with respect to the others. (Note
that we need only check whether the new queen is safe&#x2014;the other queens are
already guaranteed safe with respect to each other.)</li>
</ul>
</blockquote>
</div>
</div>

<div id="outline-container-org67c6c97" class="outline-4">
<h4 id="org67c6c97"><span class="section-number-4">3.47.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-47-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org093594d"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">empty-board</span> '<span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-position</span> new-row column rest-of-queens<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>list new-row column<span style="color: #99bb66;">)</span> rest-of-queens<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">newer-position</span> board<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>car board<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">older-positions</span> board<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>cdr board<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">get-row</span> position<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>car position<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">get-column</span> position<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>cadr position<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">safe?</span> k board<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">same-row?</span> a b<span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>    <span style="color: #99bb66;">(</span>= <span style="color: #a9a1e1;">(</span>get-row a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>get-row b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">diagonal?</span> a b<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>row-diff <span style="color: #c678dd;">(</span>abs <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>get-row a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>get-row b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>          <span style="color: #51afef;">(</span>col-diff <span style="color: #c678dd;">(</span>abs <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>get-column a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>get-column b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>      <span style="color: #a9a1e1;">(</span>= row-diff col-diff<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>new <span style="color: #51afef;">(</span>newer-position board<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>         <span style="color: #a9a1e1;">(</span>compare <span style="color: #51afef;">(</span>older-positions board<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>    <span style="color: #99bb66;">(</span>and-map <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>pos<span style="color: #51afef;">)</span>
<span class="linenr">22: </span>               <span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>same-row? new pos<span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>                   <span style="color: #99bb66;">(</span>diagonal? new pos<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">24: </span>             compare<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;queens-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;queens-mine&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>q4 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       <span style="color: #99bb66;">(</span>q11l <span style="color: #dd8844; font-weight: bold;">2680</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"queens"</span>
<span class="linenr"> 8: </span>             <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>queens <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>                   <span style="color: #a9a1e1;">(</span>length <span style="color: #51afef;">(</span>queens <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>             <span style="color: #99bb66;">(</span>list q4 q11l<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org7669ad7">
SUCCEED at queens
</pre>
</div>
</div>
</div>

<div id="outline-container-org484983f" class="outline-3">
<h3 id="org484983f"><span class="section-number-3">3.48.</span> Exercise 2.43: Louis&rsquo; <code>queens</code></h3>
<div class="outline-text-3" id="text-3-48">
</div>

<div id="outline-container-org153be81" class="outline-4">
<h4 id="org153be81"><span class="section-number-4">3.48.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-48-1">
<blockquote>
<p>
Louis Reasoner is having a terrible time doing Exercise 2.42. His
<code class="src src-scheme">queens</code> procedure seems to work, but it runs extremely slowly. (Louis
never does manage to wait long enough for it to solve even the \(6\times6\)
case.) When Louis asks Eva Lu Ator for help, she points out that he has
interchanged the order of the nested mappings in the <code class="src src-scheme">flatmap</code>,
writing it as
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>flatmap
 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>new-row<span style="color: #99bb66;">)</span>
   <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>rest-of-queens<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>adjoin-position new-row k rest-of-queens<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>queen-cols <span style="color: #51afef;">(</span>- k <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
 <span style="color: #c678dd;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> board-size<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
Explain why this interchange makes the program run slowly. Estimate how long it
will take Louis&rsquo;s program to solve the eight-queens puzzle, assuming that the
program in Exercise 2.42 solves the puzzle in time \(T\).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org7e9f6f3" class="outline-4">
<h4 id="org7e9f6f3"><span class="section-number-4">3.48.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-48-2">
<p>
The biggest contributor to the slowdown is likely the location of the
<code class="src src-scheme">queen-cols</code> recursive call. This call being inside of the loop means
it is being called \(k\) more times, all returning the same answer. But my math reasoning skills limit me from going further .Let&rsquo;s check
with benchmarks.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org3467a7f"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;queens-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;queens-mine&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">queens-louis</span> board-size<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">queen-cols</span> k<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= k <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #a9a1e1;">(</span>list empty-board<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span>filter
<span class="linenr">10: </span>         <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>positions<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>safe? k positions<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>         <span style="color: #51afef;">(</span>flatmap
<span class="linenr">12: </span>          <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>new-row<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>            <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>rest-of-queens<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                   <span style="color: #51afef;">(</span>adjoin-position new-row k rest-of-queens<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>                 <span style="color: #a9a1e1;">(</span>queen-cols <span style="color: #51afef;">(</span>- k <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>          <span style="color: #c678dd;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> board-size<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>queen-cols board-size<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">test</span> size<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;normal queens x~a: ~a"</span> size
<span class="linenr">21: </span>          <span style="color: #99bb66;">(</span>mattbench <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">()(</span>queens size<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;swapped queens x~a: ~a"</span> size
<span class="linenr">23: </span>          <span style="color: #99bb66;">(</span>mattbench <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">()(</span>queens-louis size<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>n<span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>       <span style="color: #99bb66;">(</span>test n<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>     <span style="color: #c678dd;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgcee7c90">
normal queens x5: 135424.6151
swapped queens x5: 5487381.643
normal queens x6: 538798.604
swapped queens x6: 85704466.218
normal queens x7: 2210394.5659
swapped queens x7: 1255288880.717
normal queens x8: 8067290.5992
swapped queens x8: 25384464494.259
</pre>


<div id="orgc0873ff" class="figure">
<p><img src="2/fig/2-43.png" alt="2-43.png" />
</p>
</div>

<p>
So that&rsquo;s 40 times worse at 5x5, 159 times worse at 6x6, 568 times worse at 7x7,
and 3146 times at 8x8.
</p>

<p>
after checking online with posts like this one <sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup> It looks
like the big-O notation could be considered \(\Theta((N^N)*T)\) at its simplest.
I don&rsquo;t have a good grasp on how to reason out the time complexity of a
non-trivial algorithm. I aim to eventually do &ldquo;How to Solve It&rdquo; and &ldquo;How to
Prove It&rdquo; and possibly that will fill in the missing gaps before trying more
serious comp-sci literature.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd2ab5b8" class="outline-3">
<h3 id="orgd2ab5b8"><span class="section-number-3">3.49.</span> 2.2.4: Example: A Picture Language</h3>
<div class="outline-text-3" id="text-3-49">
<p>
Authors describe a possible implementation of a &ldquo;picture language&rdquo; that tiles,
patterns, and warps images according to a specification. This language consists
of:
</p>

<ul class="org-ul">
<li>a <b>painter</b> which makes an image within a specified parallelogram shaped
frame. This is the most primitive element.</li>
<li><b>Operations</b> which make new painters from other painters. For example:
<ul class="org-ul">
<li><i>beside</i> takes two painters, producing a new painter that puts one in the
left half and one in the right half.</li>
<li><i>flip-horiz</i> takes one painter and produces another to draw its image
right-to-left reversed. These are defined as Scheme procedures and therefore
have all the properties of Scheme procedures.</li>
</ul></li>
</ul>

<p>
I&rsquo;m going to have to get a little messy in order to make the picture language a
reality. First I need a support library called <a href="https://git.elephly.net/gitweb.cgi?p=software/guile-picture-language.git;a=blob;f=pict.scm;h=54f0ce09f4ac33c3ecc3340f038d4c9da5f4a443;hb=HEAD">guile-picture-language</a><sup><a id="fnr.4" class="footref" href="#fn.4" role="doc-backlink">4</a></sup> I
installed Guix on my system and ran <code class="src src-bash">guix shell guile-picture-language guile</code>. Now the <code class="src src-scheme">pict</code> module is availale to me.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>pict<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>pict-&gt;file <span style="color: #c678dd;">(</span>triangle <span style="color: #dd8844; font-weight: bold;">50</span> <span style="color: #dd8844; font-weight: bold;">70</span><span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>           <span style="color: #99bb66;">"2/pict/test.svg"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org86ad406" class="figure">
<p><img src="2/pict/test.png" alt="test.png" />
</p>
</div>

<p>
So that works.
</p>

<p>
How about this?
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>pict<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>pict-from-file <span style="color: #99bb66;">"2/pict/Potato.png"</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>       <span style="color: #99bb66;">(</span>pr <span style="color: #a9a1e1;">(</span>rotate p <span style="color: #dd8844; font-weight: bold;">180</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">4: </span><span style="color: #c678dd;">(</span>pict-&gt;file
<span class="linenr">5: </span> <span style="color: #99bb66;">(</span>scale <span style="color: #a9a1e1;">(</span>ht-append <span style="color: #51afef;">(</span>vl-append pr p<span style="color: #51afef;">)</span> pr p <span style="color: #51afef;">(</span>vc-append pr p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>        <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span> <span style="color: #99bb66;">"2/pict/Rotato.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">must be SVG</span>
</pre>
</div>


<div id="orge369918" class="figure">
<p><img src="2/pict/Rotato.png" alt="Rotato.png" />
</p>
</div>

<p>
And I just realized there&rsquo;s no flip/mirror function in this library. Racket&rsquo;s
picture language is more complete, but it won&rsquo;t integrate with org-mode how I
need. Maybe I can mock up a text-based version, similar to the binary mobile,
and simultaneously check my work with Racket.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">tilting at windmills trying to make a text-only picture language</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #525252;">, probably won't finish</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">pl-defaultsize</span> <span style="color: #dd8844; font-weight: bold;">32</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-painter</span> orientation height width<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>cons orientation <span style="color: #99bb66;">(</span>cons a b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">p-orientation</span> p<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">p-height</span> p<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>cadr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">p-width</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>cddr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">opposite</span> orientation<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>eq? orientation 'down<span style="color: #a9a1e1;">)</span> 'up<span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>eq? orientation 'up <span style="color: #a9a1e1;">)</span> 'down<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>eq? orientation 'left<span style="color: #a9a1e1;">)</span> 'right<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>eq? orientation 'right<span style="color: #a9a1e1;">)</span> 'left<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">flip-p</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>make-painter <span style="color: #99bb66;">(</span>opposite <span style="color: #a9a1e1;">(</span>p-orientation p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">below</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>make-painter 'down a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">beside</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span>make-painter 'right a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">flip-vert</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>pair? p<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>      <span style="color: #99bb66;">(</span>make-painter <span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">26: </span><span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">paint</span> pict<span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>  <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">rect</span> p x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>string? p<span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>           <span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>  <span style="color: #99bb66;">(</span>rec p pl-defaultsize pl-defaultsize<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">31: </span><span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">beside</span> a b<span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>  <span style="color: #99bb66;">(</span>hc-append a b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">33: </span><span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">below</span> a b<span style="color: #99bb66;">)</span>
<span class="linenr">34: </span>  <span style="color: #99bb66;">(</span>vc-append a b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgaff5912" class="outline-3">
<h3 id="orgaff5912"><span class="section-number-3">3.50.</span> Exercise 2.44: <code>up-split</code></h3>
<div class="outline-text-3" id="text-3-50">
</div>

<div id="outline-container-org4317e3d" class="outline-4">
<h4 id="org4317e3d"><span class="section-number-4">3.50.1.</span> Text Definitions</h4>
<div class="outline-text-4" id="text-3-50-1">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">right-split</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      painter
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>smaller <span style="color: #c678dd;">(</span>right-split painter 
<span class="linenr">5: </span>                                  <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>        <span style="color: #a9a1e1;">(</span>beside painter 
<span class="linenr">7: </span>                <span style="color: #51afef;">(</span>below smaller smaller<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f2d57c" class="outline-4">
<h4 id="org9f2d57c"><span class="section-number-4">3.50.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-50-2">
<blockquote>
<p>
Define the procedure <code class="src src-scheme">up-split</code> used by <code class="src src-scheme">corner-split</code>. It
is similar to <code class="src src-scheme">right-split</code>, except that it switches the roles of
<code class="src src-scheme">below</code> and <code class="src src-scheme">beside</code>.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgf3644e3" class="outline-4">
<h4 id="orgf3644e3"><span class="section-number-4">3.50.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-50-3">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">up-split</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      painter
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>smaller <span style="color: #c678dd;">(</span>up-split painter 
<span class="linenr">5: </span>                               <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>        <span style="color: #a9a1e1;">(</span>below painter 
<span class="linenr">7: </span>               <span style="color: #51afef;">(</span>beside smaller smaller<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9e916b8" class="outline-3">
<h3 id="org9e916b8"><span class="section-number-3">3.51.</span> Exercise 2.45: Generalized splitting</h3>
<div class="outline-text-3" id="text-3-51">
</div>

<div id="outline-container-org7aaf539" class="outline-4">
<h4 id="org7aaf539"><span class="section-number-4">3.51.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-51-1">
<blockquote>
<p>
<code class="src src-scheme">right-split</code> and <code class="src src-scheme">up-split</code> can be expressed as instances
of a general splitting operation. Define a procedure <code class="src src-scheme">split</code> with the
property that evaluating
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">right-split</span> <span style="color: #c678dd;">(</span>split beside below<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">up-split</span> <span style="color: #c678dd;">(</span>split below beside<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
produces procedures <code class="src src-scheme">right-split</code> and <code class="src src-scheme">up-split</code> with the
same behaviors as the ones already defined.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge13d7c5" class="outline-4">
<h4 id="orge13d7c5"><span class="section-number-4">3.51.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-51-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org2a22c44"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">split</span> f1 f2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> painter n<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>        painter
<span class="linenr"> 5: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>smaller <span style="color: #99bb66;">(</span>rec painter 
<span class="linenr"> 6: </span>                            <span style="color: #a9a1e1;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>          <span style="color: #51afef;">(</span>f1 painter 
<span class="linenr"> 8: </span>              <span style="color: #c678dd;">(</span>f2 smaller smaller<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  rec<span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">right-split</span> <span style="color: #c678dd;">(</span>split beside below<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #525252;">;; </span><span style="color: #525252;">This one goes down for some reason?</span>
<span class="linenr">12: </span><span style="color: #525252;">;</span><span style="color: #525252;">(define up-split (split below beside))</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">up-split</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>      painter
<span class="linenr">16: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>smaller <span style="color: #c678dd;">(</span>up-split painter 
<span class="linenr">17: </span>                               <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>        <span style="color: #a9a1e1;">(</span>below painter 
<span class="linenr">19: </span>               <span style="color: #51afef;">(</span>beside smaller smaller<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7e8fac1" class="outline-3">
<h3 id="org7e8fac1"><span class="section-number-3">3.52.</span> Exercise 2.46: Defining vectors</h3>
<div class="outline-text-3" id="text-3-52">
</div>

<div id="outline-container-orgd574a32" class="outline-4">
<h4 id="orgd574a32"><span class="section-number-4">3.52.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-52-1">
<blockquote>
<p>
A two-dimensional vector \(\hbox{\bf v}\) running from the origin to a point can
be represented as a pair consisting of an \(x\)-coordinate and a
\(y\)-coordinate. Implement a data abstraction for vectors by giving a
constructor <code class="src src-scheme">make-vect</code> and corresponding selectors
<code class="src src-scheme">xcor-vect</code> and <code class="src src-scheme">ycor-vect</code>. In terms of your selectors and
constructor, implement procedures <code class="src src-scheme">add-vect</code>, <code class="src src-scheme">sub-vect</code>,
and <code class="src src-scheme">scale-vect</code> that perform the operations vector addition, vector
subtraction, and multiplying a vector by a scalar:
</p>

<p>
\[
</p>
\begin{array}{r@{{}={}}l}
	(x_1, y_1) + (x_2, y_2) 	& (x_1 + x_2, y_1 + y_2), \\
	(x_1, y_1) - (x_2, y_2) 	& (x_1 - x_2, y_1 - y_2), \\
	s \cdot (x, y) 			& (sx, sy).
\end{array}
<p>
\]
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org97ebb04" class="outline-4">
<h4 id="org97ebb04"><span class="section-number-4">3.52.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-52-2">
<p>
This is pretty close to the <code class="src src-scheme">make-point</code> work done in Exercise 2.2, as well as my 2nd implementation of a rectangle in Exercise 2.3. Let&rsquo;s start there. Also, <i>aren&rsquo;t these points and not vectors since they don&rsquo;t have direction??</i>
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgb0fb448"><span class="linenr">1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Guarentee x is a float</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">float</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>inexact? x<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>      x
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>exact-&gt;inexact x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org1785dd3"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;force-float&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-vect</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>float x<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #99bb66;">(</span>float y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">make-point</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">xcor-vect</span> v<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>car v<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">x-point</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">ycor-vect</span> v<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>cdr v<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">y-point</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-vect</span> v w<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>make-vect <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>xcor-vect v<span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>                <span style="color: #a9a1e1;">(</span>xcor-vect w<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>             <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>ycor-vect v<span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>                <span style="color: #a9a1e1;">(</span>ycor-vect w<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-vect</span> v w<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>make-vect <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>xcor-vect v<span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>                <span style="color: #a9a1e1;">(</span>xcor-vect w<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>             <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>ycor-vect v<span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>                <span style="color: #a9a1e1;">(</span>ycor-vect w<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">scale-vect</span> s v<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>make-vect <span style="color: #99bb66;">(</span>* s <span style="color: #a9a1e1;">(</span>xcor-vect v<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>             <span style="color: #99bb66;">(</span>* s <span style="color: #a9a1e1;">(</span>ycor-vect v<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I originally got the definition for <code class="src src-scheme">scale-vect</code> wrong by making it
<code class="src src-scheme"><span style="color: #51afef;">(</span>scale v s<span style="color: #51afef;">)</span></code>, then modified <code class="src src-scheme">frame-coord-map</code> when that
broke. I realized my mistake once I went to write <code class="src src-scheme">beside</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-org452080f" class="outline-3">
<h3 id="org452080f"><span class="section-number-3">3.53.</span> Exercise 2.47: Defining frames</h3>
<div class="outline-text-3" id="text-3-53">
</div>

<div id="outline-container-orgd80c4da" class="outline-4">
<h4 id="orgd80c4da"><span class="section-number-4">3.53.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-53-1">
<blockquote>
<p>
Here are two possible
constructors for frames:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-frame</span> origin edge1 edge2<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>list origin edge1 edge2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-frame</span> origin edge1 edge2<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>cons origin <span style="color: #99bb66;">(</span>cons edge1 edge2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
For each constructor supply the appropriate selectors to produce an
implementation for frames.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org392cf7f" class="outline-4">
<h4 id="org392cf7f"><span class="section-number-4">3.53.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-53-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-frame</span> origin edge1 edge2<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>list origin edge1 edge2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">origin-frame</span> F<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>car F<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">edge1-frame</span> F<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>cadr F<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">edge2-frame</span> F<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>caddr F<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org8b3e2ee"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-frame</span> origin edge1 edge2<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>cons origin <span style="color: #99bb66;">(</span>cons edge1 edge2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">origin-frame</span> F<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>car F<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">edge1-frame</span> F<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>cadr F<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">edge2-frame</span> F<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>cddr F<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeaae0b9" class="outline-3">
<h3 id="orgeaae0b9"><span class="section-number-3">3.54.</span> Exercise 2.48: Line segments</h3>
<div class="outline-text-3" id="text-3-54">
</div>

<div id="outline-container-org0cc5103" class="outline-4">
<h4 id="org0cc5103"><span class="section-number-4">3.54.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-54-1">
<blockquote>
<p>
A directed line segment in the plane can be represented as a pair of
vectors&#x2014;the vector running from the origin to the start-point of the segment,
and the vector running from the origin to the end-point of the segment. Use your
vector representation from Exercise 2.46 to define a
representation for segments with a constructor <code class="src src-scheme">make-segment</code> and
selectors <code class="src src-scheme">start-segment</code> and <code class="src src-scheme">end-segment</code>.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org9b07170" class="outline-4">
<h4 id="org9b07170"><span class="section-number-4">3.54.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-54-2">
<p>
Again reminding me of Exercise 2.2.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org9ee470c"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-segment</span> start end<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>cons start end<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">start-segment</span> seg<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>car seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">end-segment</span> seg<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>cdr seg<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf012add" class="outline-3">
<h3 id="orgf012add"><span class="section-number-3">3.55.</span> Exercise 2.49: Primitive painters</h3>
<div class="outline-text-3" id="text-3-55">
</div>

<div id="outline-container-orgd969175" class="outline-4">
<h4 id="orgd969175"><span class="section-number-4">3.55.1.</span> Text Definitions</h4>
<div class="outline-text-4" id="text-3-55-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org4f4c2ba"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">frame-coord-map</span> frame<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>v<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span>add-vect
<span class="linenr"> 4: </span>     <span style="color: #a9a1e1;">(</span>origin-frame frame<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>     <span style="color: #a9a1e1;">(</span>add-vect 
<span class="linenr"> 6: </span>      <span style="color: #51afef;">(</span>scale-vect <span style="color: #c678dd;">(</span>xcor-vect v<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>                  <span style="color: #c678dd;">(</span>edge1-frame frame<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #51afef;">(</span>scale-vect <span style="color: #c678dd;">(</span>ycor-vect v<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>                  <span style="color: #c678dd;">(</span>edge2-frame frame<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">segments-&gt;painter</span> segment-list<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>frame<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">for-each</span>
<span class="linenr">13: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>segment<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>       <span style="color: #51afef;">(</span>draw-line
<span class="linenr">15: </span>        <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>frame-coord-map frame<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>         <span style="color: #99bb66;">(</span>start-segment segment<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>        <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>frame-coord-map frame<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>         <span style="color: #99bb66;">(</span>end-segment segment<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">19: </span>     segment-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8129f07" class="outline-4">
<h4 id="org8129f07"><span class="section-number-4">3.55.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-55-2">
<blockquote>
<p>
Use <code class="src src-scheme">segments-&gt;painter</code>
to define the following primitive painters:
</p>

<ol class="org-ol">
<li>The painter that draws the outline of the designated frame.</li>
<li>The painter that draws an <code>X</code> by connecting opposite corners of the frame.</li>
<li>The painter that draws a diamond shape by connecting the midpoints of the
sides of the frame.</li>
<li>The <code class="src src-scheme">wave</code> painter.</li>
</ol>
</blockquote>
</div>
</div>

<div id="outline-container-org5d1aee0" class="outline-4">
<h4 id="org5d1aee0"><span class="section-number-4">3.55.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-55-3">
<p>
In the past I would need to constantly execute my code to &ldquo;see&rdquo; what I&rsquo;m doing.
But I&rsquo;m starting to think in larger chunks and need the feedback less.
</p>


<div class="org-src-container">
<pre class="src src-scheme" id="orga3e7d65"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">outline</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>list
<span class="linenr"> 4: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">frame-X</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>list
<span class="linenr">14: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">diamond</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>list
<span class="linenr">20: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">24: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">26: </span>   <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span>
<span class="linenr">27: </span>                 <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I&rsquo;ll make the wave painter once I have some graph paper in front of me.
</p>

<p>
Ok, how can I verify this? I guess I could rewrite <code class="src src-scheme">segments-&gt;painter</code>
for <code class="src src-scheme">pict</code>. Since this isn&rsquo;t a drawing system with imperative
procedures, I should make it return a list of lines to be superimposed.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org9053d2c"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>pict<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;make-frame&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;make-vect&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;make-segment&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">frame-coord-map</span> frame<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">Returns a function for adjusting a frame by a vector</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>v<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span>add-vect
<span class="linenr"> 9: </span>     <span style="color: #a9a1e1;">(</span>origin-frame frame<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>     <span style="color: #a9a1e1;">(</span>add-vect 
<span class="linenr">11: </span>      <span style="color: #51afef;">(</span>scale-vect <span style="color: #c678dd;">(</span>xcor-vect v<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>                  <span style="color: #c678dd;">(</span>edge1-frame frame<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>      <span style="color: #51afef;">(</span>scale-vect <span style="color: #c678dd;">(</span>ycor-vect v<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                  <span style="color: #c678dd;">(</span>edge2-frame frame<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">draw-line</span> start end<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">take two vectors, returns a line SVG object for pict</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>line <span style="color: #99bb66;">(</span>xcor-vect start<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>        <span style="color: #99bb66;">(</span>ycor-vect start<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>        <span style="color: #99bb66;">(</span>xcor-vect end<span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span>ycor-vect end<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">segments-&gt;painter</span> segment-list<span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">takes a list of segments, returns a "painter" lambda, which applies a frame</span>
<span class="linenr">23: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">to those segments and then maps over the result with draw-line to make a</span>
<span class="linenr">24: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">list of SVG line objects which pict can combine.</span>
<span class="linenr">25: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>frame<span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span>
<span class="linenr">27: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>segment<span style="color: #51afef;">)</span>
<span class="linenr">28: </span>       <span style="color: #51afef;">(</span>draw-line
<span class="linenr">29: </span>        <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>frame-coord-map frame<span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>         <span style="color: #99bb66;">(</span>start-segment segment<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>        <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>frame-coord-map frame<span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>         <span style="color: #99bb66;">(</span>end-segment segment<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">33: </span>     segment-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">34: </span><span style="color: #525252;">;; </span><span style="color: #99bb66; font-weight: bold;">NOTE:</span><span style="color: #525252;"> in the text, draw-line is a function which triggers an action in</span>
<span class="linenr">35: </span><span style="color: #525252;">;; </span><span style="color: #525252;">some graphics driver, and returns nothing. Because of this, (map) was</span>
<span class="linenr">36: </span><span style="color: #525252;">;; </span><span style="color: #525252;">originally (for-each). Thus the final result would have been thrown away.</span>
<span class="linenr">37: </span>
<span class="linenr">38: </span><span style="color: #ECBE7B;">&lt;&lt;painters&gt;&gt;</span>
<span class="linenr">39: </span>
<span class="linenr">40: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">paint-lines</span> painter<span style="color: #c678dd;">)</span>
<span class="linenr">41: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">use pict to compile an SVG with the elements described by painter</span>
<span class="linenr">42: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>Frame <span style="color: #51afef;">(</span>make-frame <span style="color: #c678dd;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr">43: </span>                           <span style="color: #c678dd;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">500</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>                           <span style="color: #c678dd;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">500</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">45: </span>    <span style="color: #99bb66;">(</span>apply lt-superimpose
<span class="linenr">46: </span>           <span style="color: #a9a1e1;">(</span>painter Frame<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>pict-&gt;file <span style="color: #c678dd;">(</span>paint-lines diamond<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>            <span style="color: #99bb66;">"2/pict/testline.svg"</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #525252;">; </span><span style="color: #525252;">#:maxw 100 #:maxh 100) &lt;- </span><span style="color: #ff6655; font-weight: bold;">FIXME:</span><span style="color: #525252;"> This procedure should take these arguments</span>
<span class="linenr">5: </span><span style="color: #525252;">; </span><span style="color: #525252;">but I can't get it to work.</span>
</pre>
</div>


<div id="orgbd1ab95" class="figure">
<p><img src="2/pict/testline.png" alt="testline.png" />
</p>
</div>

<p>
Holy moly it actually works.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd48b2a3" class="outline-3">
<h3 id="orgd48b2a3"><span class="section-number-3">3.56.</span> Exercise 2.50: Transforming painters</h3>
<div class="outline-text-3" id="text-3-56">
</div>

<div id="outline-container-org7536a23" class="outline-4">
<h4 id="org7536a23"><span class="section-number-4">3.56.1.</span> Text Definitions</h4>
<div class="outline-text-4" id="text-3-56-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org48e3800"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">transform-painter</span> 
<span class="linenr"> 2: </span>         painter origin corner1 corner2<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>frame<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>m <span style="color: #c678dd;">(</span>frame-coord-map frame<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>new-origin <span style="color: #99bb66;">(</span>m origin<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #51afef;">(</span>painter <span style="color: #c678dd;">(</span>make-frame new-origin
<span class="linenr"> 7: </span>                             <span style="color: #99bb66;">(</span>sub-vect <span style="color: #a9a1e1;">(</span>m corner1<span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 8: </span>                                       new-origin<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>                             <span style="color: #99bb66;">(</span>sub-vect <span style="color: #a9a1e1;">(</span>m corner2<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                                       new-origin<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">flip-vert</span> painter<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>transform-painter 
<span class="linenr">14: </span>   painter
<span class="linenr">15: </span>   <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span>   <span style="color: #525252;">; </span><span style="color: #525252;">new origin</span>
<span class="linenr">16: </span>   <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span>   <span style="color: #525252;">; </span><span style="color: #525252;">new end of edge1</span>
<span class="linenr">17: </span>   <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">new end of edge2</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rotate90</span> painter<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>transform-painter painter
<span class="linenr">21: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">squash-inwards</span> painter<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span>transform-painter painter
<span class="linenr">27: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.65</span> <span style="color: #dd8844; font-weight: bold;">0.35</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.35</span> <span style="color: #dd8844; font-weight: bold;">0.65</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">30: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">beside</span> painter1 painter2<span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>split-point <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>paint-left  <span style="color: #c678dd;">(</span>transform-painter 
<span class="linenr">33: </span>                        painter1
<span class="linenr">34: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>                        split-point
<span class="linenr">36: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">37: </span>          <span style="color: #51afef;">(</span>paint-right <span style="color: #c678dd;">(</span>transform-painter
<span class="linenr">38: </span>                        painter2
<span class="linenr">39: </span>                        split-point
<span class="linenr">40: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">41: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">42: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>frame<span style="color: #51afef;">)</span>
<span class="linenr">43: </span>        <span style="color: #51afef;">(</span>append
<span class="linenr">44: </span>         <span style="color: #c678dd;">(</span>paint-left frame<span style="color: #c678dd;">)</span>
<span class="linenr">45: </span>         <span style="color: #c678dd;">(</span>paint-right frame<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">topleft-tri</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>list
<span class="linenr"> 5: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.4</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.4</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>picture <span style="color: #a9a1e1;">(</span>beside <span style="color: #51afef;">(</span>beside topleft-tri
<span class="linenr">12: </span>                               topleft-tri<span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                       <span style="color: #51afef;">(</span>rotate90 topleft-tri<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span><span style="color: #c678dd;">(</span>pict-&gt;file <span style="color: #99bb66;">(</span>paint-lines picture<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>            <span style="color: #99bb66;">"2/pict/rotatetest.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orga9c2a7c" class="figure">
<p><img src="2/pict/rotatetest.png" alt="rotatetest.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgc280a2c" class="outline-4">
<h4 id="orgc280a2c"><span class="section-number-4">3.56.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-56-2">
<blockquote>
<p>
Define the transformation <code class="src src-scheme">flip-horiz</code>, which flips painters
horizontally, and transformations that rotate painters counterclockwise by 180
degrees and 270 degrees.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org3f5969b" class="outline-4">
<h4 id="org3f5969b"><span class="section-number-4">3.56.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-56-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org0c19d0a"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">flip-horiz</span> painter<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>transform-painter 
<span class="linenr"> 3: </span>   painter
<span class="linenr"> 4: </span>   <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>   <span style="color: #525252;">; </span><span style="color: #525252;">new origin</span>
<span class="linenr"> 5: </span>   <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>   <span style="color: #525252;">; </span><span style="color: #525252;">new end of edge1</span>
<span class="linenr"> 6: </span>   <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">new end of edge2</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rotate180</span> painter<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>transform-painter painter
<span class="linenr">10: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rotate270</span> painter<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>transform-painter painter
<span class="linenr">15: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>                     <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">topleft-tri</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>list
<span class="linenr"> 6: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>picture <span style="color: #a9a1e1;">(</span>beside <span style="color: #51afef;">(</span>beside
<span class="linenr">13: </span>                        <span style="color: #c678dd;">(</span>flip-vert topleft-tri<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                        <span style="color: #c678dd;">(</span>rotate90 topleft-tri<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>                       <span style="color: #51afef;">(</span>beside
<span class="linenr">16: </span>                        <span style="color: #c678dd;">(</span>rotate180 topleft-tri<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                        <span style="color: #c678dd;">(</span>rotate270 topleft-tri<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>pict-&gt;file <span style="color: #99bb66;">(</span>paint-lines picture<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>              <span style="color: #99bb66;">"2/pict/rotate2.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgf5e376b" class="figure">
<p><img src="2/pict/rotate2.png" alt="rotate2.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org0b9e9d7" class="outline-3">
<h3 id="org0b9e9d7"><span class="section-number-3">3.57.</span> Exercise 2.51</h3>
<div class="outline-text-3" id="text-3-57">
</div>

<div id="outline-container-orga97a40d" class="outline-4">
<h4 id="orga97a40d"><span class="section-number-4">3.57.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-57-1">
<blockquote>
<p>
Define the <code class="src src-scheme">below</code> operation
for painters.  <code class="src src-scheme">below</code> takes two painters as arguments.  The resulting
painter, given a frame, draws with the first painter in the bottom of the frame
and with the second painter in the top.  Define <code class="src src-scheme">below</code> in two different
ways&#x2014;first by writing a procedure that is analogous to the <code class="src src-scheme">beside</code>
procedure given above, and again in terms of <code class="src src-scheme">beside</code> and suitable
rotation operations (from @ref{Exercise 2.50}).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgaa0e96e" class="outline-4">
<h4 id="orgaa0e96e"><span class="section-number-4">3.57.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-57-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgbedadc6"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">below</span> painter1 painter2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>split-point <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>paint-left  <span style="color: #c678dd;">(</span>transform-painter 
<span class="linenr"> 4: </span>                        painter1
<span class="linenr"> 5: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">0.0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>                        split-point<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>          <span style="color: #51afef;">(</span>paint-right <span style="color: #c678dd;">(</span>transform-painter
<span class="linenr"> 9: </span>                        painter2
<span class="linenr">10: </span>                        split-point
<span class="linenr">11: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">1.0</span> <span style="color: #dd8844; font-weight: bold;">0.5</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>                        <span style="color: #99bb66;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.0</span> <span style="color: #dd8844; font-weight: bold;">1.0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>frame<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>        <span style="color: #51afef;">(</span>append
<span class="linenr">15: </span>         <span style="color: #c678dd;">(</span>paint-left frame<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>         <span style="color: #c678dd;">(</span>paint-right frame<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">below-rotate</span> painter1 painter2<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>rotate270 <span style="color: #99bb66;">(</span>beside
<span class="linenr">19: </span>              <span style="color: #a9a1e1;">(</span>rotate90 painter2<span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>              <span style="color: #a9a1e1;">(</span>rotate90 painter1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">topleft-tri</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>list
<span class="linenr"> 7: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>below <span style="color: #51afef;">(</span>beside
<span class="linenr">14: </span>                        topleft-tri
<span class="linenr">15: </span>                        <span style="color: #c678dd;">(</span>rotate90 topleft-tri<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>                       <span style="color: #51afef;">(</span>beside
<span class="linenr">17: </span>                        <span style="color: #c678dd;">(</span>rotate180 topleft-tri<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>                        <span style="color: #c678dd;">(</span>rotate270 topleft-tri<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>      <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>below-rotate <span style="color: #51afef;">(</span>beside
<span class="linenr">20: </span>                        topleft-tri
<span class="linenr">21: </span>                        <span style="color: #c678dd;">(</span>rotate90 topleft-tri<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span>                       <span style="color: #51afef;">(</span>beside
<span class="linenr">23: </span>                        <span style="color: #c678dd;">(</span>rotate180 topleft-tri<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>                        <span style="color: #c678dd;">(</span>rotate270 topleft-tri<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>  <span style="color: #c678dd;">(</span>pict-&gt;file <span style="color: #99bb66;">(</span>paint-lines <span style="color: #a9a1e1;">(</span>beside p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>              <span style="color: #99bb66;">"2/pict/rotate3.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org5924a45" class="figure">
<p><img src="2/pict/rotate3.png" alt="rotate3.png" />
</p>
</div>

<p>
An aside: I&rsquo;m beginning to see what makes Lisp-style programming different from
C style. In C, the pictures would be described with separate data structures
specified up front, but in Lisp you can use the code to create the data
structure. Off the top of my head, the biggest players here would be first-level
functions, and how statements evaluate to specific values rather than being
imperative commands that cause something to happen elsewhere.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc6da3f2" class="outline-3">
<h3 id="orgc6da3f2"><span class="section-number-3">3.58.</span> 2.2.4 continued</h3>
<div class="outline-text-3" id="text-3-58">
<dl class="org-dl">
<dt>stratified design</dt><dd>is the notion that complex systems should be structured
as a sequence of levels with a sequence of languages. See how electronic
components are described in EE terms, the binary gates they form are described
in digital logic terms, the programs they run described in programming
language terms, the networks of programs described in network architecture
terms, etc.</dd>
</dl>

<p>
This stratified design can be seen in our picture language. We use lines and
points to specify painters, use painters to make arrangements with beside/below,
arrange these arrangements into higher-level arrangements like
<code class="src src-scheme">up-split</code>.
</p>
</div>
</div>

<div id="outline-container-org194d56c" class="outline-3">
<h3 id="org194d56c"><span class="section-number-3">3.59.</span> Exercise 2.52</h3>
<div class="outline-text-3" id="text-3-59">
</div>

<div id="outline-container-org0ac277b" class="outline-4">
<h4 id="org0ac277b"><span class="section-number-4">3.59.1.</span> Question A</h4>
<div class="outline-text-4" id="text-3-59-1">
<p>
Make changes to the square limit of <code class="src src-scheme">wave</code> shown in Figure 2.9 by
working at each of the levels described above. In particular:
</p>

<ul class="org-ul">
<li>Add some segments to the primitive <code class="src src-scheme">wave</code> painter of Exercise 2.49 (to add a smile, for example).</li>
</ul>
</div>
</div>

<div id="outline-container-orgf25157e" class="outline-4">
<h4 id="orgf25157e"><span class="section-number-4">3.59.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-3-59-2">
<p>
I need to do what I&rsquo;ve been slacking off on: actually making the <code class="src src-scheme">wave</code> painter.
First, I want a helper function to make inputting shapes easier.
</p>


<div class="org-src-container">
<pre class="src src-scheme" id="org826af90"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">unwrap-if-needed</span> args<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">commonly needed in vararg functions</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>length args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>           <span style="color: #a9a1e1;">(</span>list? <span style="color: #51afef;">(</span>car args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>car args<span style="color: #99bb66;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">assume we were passed a list, unwrap it</span>
<span class="linenr">6: </span>      args<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org32ad47d"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;unwrap-if-needed&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">continuous-lines</span> . vectors<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">Given a list of vectors, return a series of line segments</span>
<span class="linenr"> 4: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">that continuously follow the vectors until there are no more,</span>
<span class="linenr"> 5: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">at which point connect the last vector to the first.</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> vecs lines<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>length vecs<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        lines
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>first <span style="color: #99bb66;">(</span>car vecs<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>               <span style="color: #c678dd;">(</span>rest <span style="color: #99bb66;">(</span>cdr vecs<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>               <span style="color: #c678dd;">(</span>second <span style="color: #99bb66;">(</span>car rest<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>               <span style="color: #c678dd;">(</span>new-line <span style="color: #99bb66;">(</span>make-segment first second<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>          <span style="color: #51afef;">(</span>iter rest <span style="color: #c678dd;">(</span>cons new-line lines<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>input <span style="color: #51afef;">(</span>unwrap-if-needed vectors<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>    <span style="color: #99bb66;">(</span>iter <span style="color: #a9a1e1;">(</span>append input <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>car input<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">Connect to start</span>
<span class="linenr">16: </span>          '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">numbers-to-vectors</span> . numbers<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> input output<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>length input<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>        output
<span class="linenr">21: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>first <span style="color: #99bb66;">(</span>car input<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>              <span style="color: #c678dd;">(</span>d <span style="color: #99bb66;">(</span>cdr input<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>              <span style="color: #c678dd;">(</span>second <span style="color: #99bb66;">(</span>car d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>              <span style="color: #c678dd;">(</span>dd <span style="color: #99bb66;">(</span>cdr d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span>          <span style="color: #51afef;">(</span>iter dd
<span class="linenr">26: </span>                <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>make-vect first second<span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>                      output<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>  <span style="color: #c678dd;">(</span>reverse <span style="color: #99bb66;">(</span>iter numbers '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">topleft-tri</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>list
<span class="linenr"> 8: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>                      <span style="color: #a9a1e1;">(</span>make-segment <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                                    <span style="color: #51afef;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">topleft-tri2</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>continuous-lines
<span class="linenr">16: </span>                      <span style="color: #a9a1e1;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>                      <span style="color: #a9a1e1;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>                      <span style="color: #a9a1e1;">(</span>make-vect <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">topleft-tri3</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter <span style="color: #99bb66;">(</span>continuous-lines
<span class="linenr">21: </span>                      <span style="color: #a9a1e1;">(</span>numbers-to-vectors
<span class="linenr">22: </span>                       <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">23: </span>                       <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.4</span>
<span class="linenr">24: </span>                       <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>below <span style="color: #51afef;">(</span>beside topleft-tri topleft-tri2<span style="color: #51afef;">)</span>
<span class="linenr">26: </span>                 <span style="color: #51afef;">(</span>beside topleft-tri topleft-tri3<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>  <span style="color: #c678dd;">(</span>pict-&gt;file <span style="color: #99bb66;">(</span>paint-lines p1<span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>              <span style="color: #99bb66;">"2/pict/cl-test.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org7a51b9d" class="figure">
<p><img src="2/pict/cl-test.png" alt="cl-test.png" />
</p>
</div>

<p>
Now, let&rsquo;s write the wave painter.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org3d926b2"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Should be raising their left hand and</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">lowering their right. (I screwed up the axes)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">wave</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>segments-&gt;painter
<span class="linenr"> 6: </span>   <span style="color: #99bb66;">(</span>continuous-lines
<span class="linenr"> 7: </span>    <span style="color: #a9a1e1;">(</span>numbers-to-vectors
<span class="linenr"> 8: </span>    <span style="color: #dd8844; font-weight: bold;">0.55</span> <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr"> 9: </span>    <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">0.15</span> <span style="color: #525252;">;; </span><span style="color: #525252;">center-left side of head</span>
<span class="linenr">10: </span>    <span style="color: #dd8844; font-weight: bold;">0.55</span> <span style="color: #dd8844; font-weight: bold;">0.3</span>
<span class="linenr">11: </span>    <span style="color: #dd8844; font-weight: bold;">0.45</span> <span style="color: #dd8844; font-weight: bold;">0.275</span>
<span class="linenr">12: </span>    <span style="color: #dd8844; font-weight: bold;">0.25</span> <span style="color: #dd8844; font-weight: bold;">0.35</span>
<span class="linenr">13: </span>    <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.25</span>
<span class="linenr">14: </span>    <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0.3</span>
<span class="linenr">15: </span>    <span style="color: #dd8844; font-weight: bold;">0.25</span> <span style="color: #dd8844; font-weight: bold;">0.45</span>
<span class="linenr">16: </span>    <span style="color: #dd8844; font-weight: bold;">0.45</span> <span style="color: #dd8844; font-weight: bold;">0.35</span>
<span class="linenr">17: </span>    <span style="color: #dd8844; font-weight: bold;">0.5</span> <span style="color: #dd8844; font-weight: bold;">0.65</span>
<span class="linenr">18: </span>    <span style="color: #dd8844; font-weight: bold;">0.4</span> <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">19: </span>    <span style="color: #dd8844; font-weight: bold;">0.45</span> <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">20: </span>    <span style="color: #dd8844; font-weight: bold;">0.6</span> <span style="color: #dd8844; font-weight: bold;">0.7</span>
<span class="linenr">21: </span>    <span style="color: #dd8844; font-weight: bold;">0.75</span> <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">22: </span>    <span style="color: #dd8844; font-weight: bold;">0.8</span> <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">23: </span>    <span style="color: #dd8844; font-weight: bold;">0.7</span> <span style="color: #dd8844; font-weight: bold;">0.65</span>
<span class="linenr">24: </span>    <span style="color: #dd8844; font-weight: bold;">0.75</span> <span style="color: #dd8844; font-weight: bold;">0.35</span>
<span class="linenr">25: </span>    <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0.675</span>
<span class="linenr">26: </span>    <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0.6</span>
<span class="linenr">27: </span>    <span style="color: #dd8844; font-weight: bold;">0.75</span> <span style="color: #dd8844; font-weight: bold;">0.275</span>
<span class="linenr">28: </span>    <span style="color: #dd8844; font-weight: bold;">0.65</span> <span style="color: #dd8844; font-weight: bold;">0.3</span>
<span class="linenr">29: </span>    <span style="color: #dd8844; font-weight: bold;">0.7</span> <span style="color: #dd8844; font-weight: bold;">0.15</span> <span style="color: #525252;">;; </span><span style="color: #525252;">center-right side of head</span>
<span class="linenr">30: </span>    <span style="color: #dd8844; font-weight: bold;">0.65</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr">5: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr">6: </span><span style="color: #ECBE7B;">&lt;&lt;wave-painter&gt;&gt;</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>beside wave <span style="color: #51afef;">(</span>flip-vert wave<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>pict-&gt;file <span style="color: #99bb66;">(</span>paint-lines p1<span style="color: #99bb66;">)</span>
<span class="linenr">9: </span>              <span style="color: #99bb66;">"2/pict/wave-test.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
The question needs me to overlay something new. So I need some way to add more
segments to a painter after it&rsquo;s already been written.
</p>


<div id="org606bf82" class="figure">
<p><img src="2/pict/wave-test.png" alt="wave-test.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org502c8dc"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;unwrap-if-needed&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">append-painters-rec</span> . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>frame<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">rec</span> painters<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>null? painters<span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>          '<span style="color: #51afef;">()</span>
<span class="linenr"> 7: </span>          <span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>car painters<span style="color: #99bb66;">)</span> frame<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>                  <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>cdr painters<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span>rec <span style="color: #a9a1e1;">(</span>unwrap-if-needed args<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">append-painters</span> . args<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>frame<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">iter</span> segments to-paint<span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>null? to-paint<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>          segments
<span class="linenr">15: </span>          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>append <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>car to-paint<span style="color: #a9a1e1;">)</span> frame<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>                      segments<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                      <span style="color: #c678dd;">(</span>cdr to-paint<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>    <span style="color: #99bb66;">(</span>iter '<span style="color: #a9a1e1;">()</span>
<span class="linenr">19: </span>          <span style="color: #a9a1e1;">(</span>unwrap-if-needed args<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;painters&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;wave-painter&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;append-painters&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>append-painters
<span class="linenr">10: </span>           <span style="color: #51afef;">(</span>beside wave <span style="color: #c678dd;">(</span>flip-vert wave<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>           frame-X
<span class="linenr">12: </span>           outline<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>pict-&gt;file <span style="color: #99bb66;">(</span>paint-lines p1<span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>              <span style="color: #99bb66;">"2/pict/append-test.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org6bf6461" class="figure">
<p><img src="2/pict/append-test.png" alt="append-test.png" />
</p>
</div>

<p>
Now let&rsquo;s (try to) add a smile.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org0788b4b"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;wave-painter&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;append-painters&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">wave-smile</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>append-painters
<span class="linenr"> 5: </span>   wave
<span class="linenr"> 6: </span>   <span style="color: #99bb66;">(</span>segments-&gt;painter
<span class="linenr"> 7: </span>    <span style="color: #a9a1e1;">(</span>continuous-lines
<span class="linenr"> 8: </span>     <span style="color: #51afef;">(</span>numbers-to-vectors
<span class="linenr"> 9: </span>      <span style="color: #dd8844; font-weight: bold;">0.55</span> <span style="color: #dd8844; font-weight: bold;">0.2</span>
<span class="linenr">10: </span>      <span style="color: #dd8844; font-weight: bold;">0.6</span> <span style="color: #dd8844; font-weight: bold;">0.225</span>
<span class="linenr">11: </span>      <span style="color: #dd8844; font-weight: bold;">0.65</span> <span style="color: #dd8844; font-weight: bold;">0.2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr">3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr">4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr">5: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr">6: </span><span style="color: #ECBE7B;">&lt;&lt;wave-smile&gt;&gt;</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span>pict-&gt;file <span style="color: #c678dd;">(</span>paint-lines wave-smile<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>            <span style="color: #99bb66;">"2/pict/wave-smile-test.svg"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org7dc14f2" class="figure">
<p><img src="2/pict/wave-smile-test.png" alt="wave-smile-test.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgfee2890" class="outline-4">
<h4 id="orgfee2890"><span class="section-number-4">3.59.3.</span> Question B</h4>
<div class="outline-text-4" id="text-3-59-3">
<p>
Change the pattern constructed by <code class="src src-scheme">corner-split</code> (for example, by
using only one copy of the <code class="src src-scheme">up-split</code> and <code class="src src-scheme">right-split</code>
images instead of two).
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgf3f4186"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">corner-split</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      painter
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>up <span style="color: #c678dd;">(</span>up-split painter <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>            <span style="color: #51afef;">(</span>right <span style="color: #c678dd;">(</span>right-split painter 
<span class="linenr"> 6: </span>                                <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>top-left <span style="color: #99bb66;">(</span>beside up up<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>              <span style="color: #c678dd;">(</span>bottom-right <span style="color: #99bb66;">(</span>below right 
<span class="linenr"> 9: </span>                                   right<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>              <span style="color: #c678dd;">(</span>corner <span style="color: #99bb66;">(</span>corner-split painter 
<span class="linenr">11: </span>                                    <span style="color: #a9a1e1;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>          <span style="color: #51afef;">(</span>beside <span style="color: #c678dd;">(</span>below painter top-left<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>                  <span style="color: #c678dd;">(</span>below bottom-right 
<span class="linenr">14: </span>                         corner<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">corner-split-mine</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>      painter
<span class="linenr">19: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>up <span style="color: #c678dd;">(</span>up-split painter <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span>            <span style="color: #51afef;">(</span>right <span style="color: #c678dd;">(</span>right-split painter 
<span class="linenr">21: </span>                                <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>top-left up<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>              <span style="color: #c678dd;">(</span>bottom-right right<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>              <span style="color: #c678dd;">(</span>corner <span style="color: #99bb66;">(</span>corner-split-mine painter 
<span class="linenr">25: </span>                                    <span style="color: #a9a1e1;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">26: </span>          <span style="color: #51afef;">(</span>beside <span style="color: #c678dd;">(</span>below painter top-left<span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>                  <span style="color: #c678dd;">(</span>below bottom-right 
<span class="linenr">28: </span>                         corner<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;painters&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;wave-smile&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;append-painters&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;splits-generalized&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;corner-split&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 <span style="color: #a9a1e1;">(</span>beside <span style="color: #51afef;">(</span>flip-horiz <span style="color: #c678dd;">(</span>corner-split wave-smile <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>                  <span style="color: #51afef;">(</span>corner-split-mine wave-smile <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span><span style="color: #525252;">;</span><span style="color: #525252;">(let ((p1 (up-split frame-X 5)))</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>pict-&gt;file <span style="color: #99bb66;">(</span>paint-lines p1<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>              <span style="color: #99bb66;">"2/pict/corner-splits.svg"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org3fc7e07" class="figure">
<p><img src="2/pict/corner-splits.png" alt="corner-splits.png" />
</p>
</div>

<p>
So my modified version doesn&rsquo;t split at the <code class="src src-scheme">corner-split</code> level, as
predicted. However <code class="src src-scheme">up-split</code> and <code class="src src-scheme">right-split</code> do, so the
effect is only delayed by one level. But more importantly:
</p>

<p>
<i>Why does it go down instead of up? I don&rsquo;t get it.</i>
</p>

<p>
<code class="src src-scheme">corner-split</code> and <code class="src src-scheme">up-split</code> are even the same code as
every answer online. Could my <code class="src src-scheme">paint-lines</code> procedure be what&rsquo;s
causing issues?
</p>
</div>
</div>

<div id="outline-container-org887b8b9" class="outline-4">
<h4 id="org887b8b9"><span class="section-number-4">3.59.4.</span> Question C</h4>
<div class="outline-text-4" id="text-3-59-4">
<blockquote>
<p>
Modify the version of <code class="src src-scheme">square-limit</code> that uses <code class="src src-scheme">square-of-four</code> so as
to assemble the corners in a different pattern.  (For example, you might make
the big Mr. Rogers look outward from each corner of the square.)
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org270f296" class="outline-4">
<h4 id="org270f296"><span class="section-number-4">3.59.5.</span> Textbook Definitions</h4>
<div class="outline-text-4" id="text-3-59-5">
<div class="org-src-container">
<pre class="src src-scheme" id="org9034bdb"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-of-four</span> tl tr bl br<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>painter<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>top <span style="color: #c678dd;">(</span>beside <span style="color: #99bb66;">(</span>tl painter<span style="color: #99bb66;">)</span> 
<span class="linenr"> 4: </span>                       <span style="color: #99bb66;">(</span>tr painter<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>          <span style="color: #51afef;">(</span>bottom <span style="color: #c678dd;">(</span>beside <span style="color: #99bb66;">(</span>bl painter<span style="color: #99bb66;">)</span> 
<span class="linenr"> 6: </span>                          <span style="color: #99bb66;">(</span>br painter<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #a9a1e1;">(</span>below bottom top<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-limit</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>combine4 
<span class="linenr">10: </span>         <span style="color: #51afef;">(</span>square-of-four flip-horiz 
<span class="linenr">11: </span>                         identity
<span class="linenr">12: </span>                         rotate180 
<span class="linenr">13: </span>                         flip-vert<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>    <span style="color: #99bb66;">(</span>combine4 <span style="color: #a9a1e1;">(</span>corner-split painter n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org28058fc" class="outline-4">
<h4 id="org28058fc"><span class="section-number-4">3.59.6.</span> Answer C</h4>
<div class="outline-text-4" id="text-3-59-6">
<div class="org-src-container">
<pre class="src src-scheme" id="org2737c73"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-limit-mine</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>combine4 
<span class="linenr">3: </span>         <span style="color: #51afef;">(</span>square-of-four identity
<span class="linenr">4: </span>                         flip-horiz
<span class="linenr">5: </span>                         flip-vert 
<span class="linenr">6: </span>                         rotate180<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>    <span style="color: #99bb66;">(</span>combine4 <span style="color: #a9a1e1;">(</span>corner-split painter n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;wave-smile&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;splits-generalized&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;corner-split&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;square-of-four-txt&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;square-limit-mine&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>pict-&gt;file <span style="color: #c678dd;">(</span>paint-lines <span style="color: #99bb66;">(</span>beside <span style="color: #a9a1e1;">(</span>square-limit wave-smile <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>                                 <span style="color: #a9a1e1;">(</span>square-limit-mine wave-smile <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>            <span style="color: #99bb66;">"2/pict/square-limits.svg"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orga7c548c" class="figure">
<p><img src="2/pict/square-limits.png" alt="square-limits.png" />
</p>
</div>

<p>
Ok, I&rsquo;m confused. Shouldn&rsquo;t the shape of <code class="src src-scheme">square-limit</code> be the same
regardless of the operators passed to it? It looks like the operators effect
each chunk separately.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;linepainter-pict&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;frame-transforms-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;flip-rotate2&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;below&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;continuous-lines&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;wave-smile&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;splits-generalized&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;corner-split&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;square-of-four-txt&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-limit-mine</span> painter n<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>combine4 
<span class="linenr">12: </span>         <span style="color: #51afef;">(</span>square-of-four identity
<span class="linenr">13: </span>                         identity
<span class="linenr">14: </span>                         identity
<span class="linenr">15: </span>                         identity<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>    <span style="color: #99bb66;">(</span>combine4 <span style="color: #a9a1e1;">(</span>corner-split painter n<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>pict-&gt;file <span style="color: #c678dd;">(</span>paint-lines <span style="color: #99bb66;">(</span>square-limit-mine wave-smile <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>            <span style="color: #99bb66;">"2/pict/square-limit-identity.svg"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgbdf3b88" class="figure">
<p><img src="2/pict/square-limit-identity.png" alt="square-limit-identity.png" />
</p>
</div>

<p>
I expected the operators would change the <i>image orientation</i>, not the
<i>structure</i>. Maybe this is because my <code class="src src-scheme">draw-lines</code> makes recursively
nested stacks of painter objects, rather than imperative calls to drawing
procedures? Looking on the internet I see <a href="http://pipecode.blogspot.com/2013/04/sicp-exercise-252.html">someone else having the same
results.</a><sup><a id="fnr.5" class="footref" href="#fn.5" role="doc-backlink">5</a></sup>
</p>
</div>
</div>
</div>

<div id="outline-container-orgbf2be52" class="outline-3">
<h3 id="orgbf2be52"><span class="section-number-3">3.60.</span> 2.3.1: Quotation</h3>
<div class="outline-text-3" id="text-3-60">
<p>
Syntactic vs semantic use in Lisp:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">dog</span> <span style="color: #dd8844; font-weight: bold;">123</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>+ dog dog<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">semantic usage</span>
<span style="color: #51afef;">(</span>quote dog<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">syntactic usage</span>
</pre>
</div>

<p>
This was introduced by famous LISP scientists, Abbott and Costello.
</p>
</div>
</div>

<div id="outline-container-org06b4cef" class="outline-3">
<h3 id="org06b4cef"><span class="section-number-3">3.61.</span> Exercise 2.53</h3>
<div class="outline-text-3" id="text-3-61">
</div>

<div id="outline-container-orgdd5c8e3" class="outline-4">
<h4 id="orgdd5c8e3"><span class="section-number-4">3.61.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-61-1">
<blockquote>
<p>
What would the interpreter print
in response to evaluating each of the following expressions?
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>list 'a 'b 'c<span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>list 'george<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>cdr '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x1 x2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>y1 y2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>cadr '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x1 x2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>y1 y2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span>pair? <span style="color: #c678dd;">(</span>car '<span style="color: #99bb66;">(</span>a short list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>memq 'red '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>red shoes<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>blue socks<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span>memq 'red '<span style="color: #c678dd;">(</span>red shoes blue socks<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c80e05" class="outline-4">
<h4 id="org4c80e05"><span class="section-number-4">3.61.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-61-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>list 'a 'b 'c<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">(a b c)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>list 'george<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">((george))</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>cdr '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x1 x2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>y1 y2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">((y1 y2))</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>cadr '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x1 x2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>y1 y2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">(y1 y2)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span>pair? <span style="color: #c678dd;">(</span>car '<span style="color: #99bb66;">(</span>a short list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">false</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>memq 'red '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>red shoes<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>blue socks<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">false</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span>memq 'red '<span style="color: #c678dd;">(</span>red shoes blue socks<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">(red shoes blue socks)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0384e6e" class="outline-3">
<h3 id="org0384e6e"><span class="section-number-3">3.62.</span> Exercise 2.54</h3>
<div class="outline-text-3" id="text-3-62">
<blockquote>
<p>
Two lists are said to be <code class="src src-scheme">equal?</code> if they contain equal elements
arranged in the same order. For example,
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>equal? '<span style="color: #c678dd;">(</span>this is a list<span style="color: #c678dd;">)</span> '<span style="color: #c678dd;">(</span>this is a list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
is true, but
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>equal? '<span style="color: #c678dd;">(</span>this is a list<span style="color: #c678dd;">)</span> '<span style="color: #c678dd;">(</span>this <span style="color: #99bb66;">(</span>is a<span style="color: #99bb66;">)</span> list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
is false. To be more precise, we can define <code class="src src-scheme">equal?</code> recursively in
terms of the basic <code class="src src-scheme">eq?</code> equality of symbols by saying that
<code class="src src-scheme">a</code> and <code class="src src-scheme">b</code> are <code class="src src-scheme">equal?</code> if they are both symbols
and the symbols are <code class="src src-scheme">eq?</code>, or if they are both lists such that
<code class="src src-scheme"><span style="color: #51afef;">(</span>car a<span style="color: #51afef;">)</span></code> is <code class="src src-scheme">equal?</code> to <code class="src src-scheme"><span style="color: #51afef;">(</span>car b<span style="color: #51afef;">)</span></code> and
<code class="src src-scheme"><span style="color: #51afef;">(</span>cdr a<span style="color: #51afef;">)</span></code> is <code class="src src-scheme">equal?</code> to <code class="src src-scheme"><span style="color: #51afef;">(</span>cdr b<span style="color: #51afef;">)</span></code>. Using this
idea, implement <code class="src src-scheme">equal?</code> as a procedure.
</p>
</blockquote>
</div>

<div id="outline-container-org00b0978" class="outline-4">
<h4 id="org00b0978"><span class="section-number-4">3.62.1.</span> Answer</h4>
<div class="outline-text-4" id="text-3-62-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org561f344"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equal?</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>symbol? a<span style="color: #51afef;">)</span>
<span class="linenr">3: </span>              <span style="color: #51afef;">(</span>symbol? b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>         <span style="color: #a9a1e1;">(</span>eq? a b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>list? a<span style="color: #51afef;">)</span>
<span class="linenr">6: </span>              <span style="color: #51afef;">(</span>list? b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">7: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>equal? <span style="color: #c678dd;">(</span>car a<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">8: </span>              <span style="color: #51afef;">(</span>equal? <span style="color: #c678dd;">(</span>cdr a<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">9: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> #f<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>a '<span style="color: #a9a1e1;">(</span>this is a list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      <span style="color: #99bb66;">(</span>aa '<span style="color: #a9a1e1;">(</span>this is a list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>b '<span style="color: #a9a1e1;">(</span>this <span style="color: #51afef;">(</span>quote is a<span style="color: #51afef;">)</span> list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"equal? true"</span>
<span class="linenr"> 6: </span>             <span style="color: #99bb66;">(</span>equal? a a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"equal? trick question"</span>
<span class="linenr"> 8: </span>             <span style="color: #99bb66;">(</span>equal? a a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"equal? false"</span>
<span class="linenr">10: </span>             <span style="color: #99bb66;">(</span>equal? a b<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>             #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgba94ff2">
SUCCEED at equal? true
SUCCEED at equal? trick question
SUCCEED at equal? false
</pre>
</div>
</div>
</div>

<div id="outline-container-org406b915" class="outline-3">
<h3 id="org406b915"><span class="section-number-3">3.63.</span> Exercise 2.55</h3>
<div class="outline-text-3" id="text-3-63">
</div>

<div id="outline-container-orgedb50be" class="outline-4">
<h4 id="orgedb50be"><span class="section-number-4">3.63.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-63-1">
<p>
Eva Lu Ator types to the interpreter the expression
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>car ''abracadabra<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
To her surprise, the interpreter prints back <code class="src src-scheme">quote</code>. Explain.
</p>
</div>
</div>

<div id="outline-container-org87deecc" class="outline-4">
<h4 id="org87deecc"><span class="section-number-4">3.63.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-63-2">
<p>
You&rsquo;re quoting quote, silly! Who&rsquo;s on first?
</p>
</div>
</div>
</div>

<div id="outline-container-org39d83e7" class="outline-3">
<h3 id="org39d83e7"><span class="section-number-3">3.64.</span> 2.3.2: Example: Symbolic differentiator</h3>
<div class="outline-text-3" id="text-3-64">
<p>
I needed to get some help, but I think I have some understanding now.
</p>

<p>
The <b>derivative</b> of an expression \(E\), relative to the variable \(x\),
describes the rate of change (or \(\delta\) <b>delta</b>) of that expression with
relation to \(x\). Mathematicians symbolize it like this:
</p>

<p>
\[\frac{dE}{dx}\]
</p>

<p>
Two stumbling blocks about this notation:
</p>
<ol class="org-ol">
<li>This is not division. I understand why this notation would make sense to an
experienced mathematician, since you factor out things by dividing an
expression. For example:
\[\frac{3x}{x} = 3\]
\[\frac{3x}{3} = x\]
But it&rsquo;s still confusing.</li>
<li>\(dx\) is not some variable \(d\) times some variable \(x\).
\(\frac{d(x+3)}{dx}\) means &ldquo;the derivative of \(x+3\) with respect to
\(x\).&rdquo;</li>
</ol>

<p>
The process of finding the derivative is called <b>differentiation</b>.
</p>

<p>
The rules the book puts forward, rephrased in plain English, are these:
</p>

<ul class="org-ul">
<li>If the expression is a constant, the derivative must be 0.</li>
<li>If the expression is \(x\), the derivative must be 1.</li>
<li>If the expression is \(u + v\), the derivative is the sum of two
derivatives:
<ol class="org-ol">
<li>The derivative of \(u\) with respect to \(x\).</li>
<li>The derivative of \(v\) with respect to \(x\).</li>
</ol></li>
<li>If the expression is \(u \times v\), the derivative is the sum of:
<ol class="org-ol">
<li>\(u\) times the derivative of \(v\) with respect to \(x\)</li>
<li>\(v\) times the derivative of \(u\) with respect to \(x\)</li>
</ol></li>
</ul>

<p>
Later:
</p>
<ul class="org-ul">
<li>If the expression is \(u^0\), the result is 1, which is a constant, so the
rate of change is 0.</li>
<li>If the expression is \(u^1\), the result is u, so the rate of change is 1.</li>
<li>Else, if the expression is \(u^n\), the derivative is the product of these:
<ol class="org-ol">
<li>\(n\)</li>
<li>\(u\) to the power of \(n-1\)</li>
<li>The derivative of \(u\) with respect to \(x\).</li>
</ol></li>
</ul>
</div>
</div>

<div id="outline-container-org793b4e3" class="outline-3">
<h3 id="org793b4e3"><span class="section-number-3">3.65.</span> Exercise 2.56: Differentiating exponentiation</h3>
<div class="outline-text-3" id="text-3-65">
</div>

<div id="outline-container-org49087a2" class="outline-4">
<h4 id="org49087a2"><span class="section-number-4">3.65.1.</span> Text definitions</h4>
<div class="outline-text-4" id="text-3-65-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org45a5aa3"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>car x<span style="color: #a9a1e1;">)</span> '+<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">addend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>caddr s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>car x<span style="color: #a9a1e1;">)</span> '*<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplier</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplicand</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>caddr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sum</span> a1 a2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? a1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? a2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=number?</span> exp num<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>number? exp<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>= exp num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-product</span> m1 m2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? m1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? m2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>sum? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>addend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
                              <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>augend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? exp<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>make-sum
           <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>multiplier exp<span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplicand exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplier exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">(</span>multiplicand exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
         <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"unknown expression type: DERIV"</span> exp<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org079876a" class="outline-4">
<h4 id="org079876a"><span class="section-number-4">3.65.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-65-2">
<blockquote>
<p>
Show how to extend the basic differentiator to handle more kinds of expressions.
For instance, implement the differentiation rule
</p>

<p>
\[ \frac{\it d\,(u^n\,)}{\it dx} = nu^{n-1} \frac{\it du}{\it dx} \]
</p>

<p>
by adding a new clause to the <code class="src src-scheme">deriv</code> program and defining appropriate
procedures <code class="src src-scheme">exponentiation?</code>, <code class="src src-scheme">base</code>, <code class="src src-scheme">exponent</code>,
and <code class="src src-scheme">make-exponentiation</code>. (You may use the symbol <code class="src src-scheme">**</code> to
denote exponentiation.) Build in the rules that anything raised to the power 0
is 1 and anything raised to the power 1 is the thing itself.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgabb2209" class="outline-4">
<h4 id="orgabb2209"><span class="section-number-4">3.65.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-65-3">
<div class="org-src-container">
<pre class="src src-scheme" id="orga1bed1b"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">exponentiation?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>car x<span style="color: #a9a1e1;">)</span> '**<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">base</span> e<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr e<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">exponent</span> e<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>caddr e<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-exponentiation</span> b e<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? b <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? e <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? e <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> b<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? b<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? e<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>expt b e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '** b e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>sum? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>addend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
                              <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>augend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? exp<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>make-sum
          <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>multiplier exp<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplicand exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplier exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span>multiplicand exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>exponentiation? exp<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>make-product  
          <span style="color: #51afef;">(</span>make-product  
           <span style="color: #c678dd;">(</span>exponent exp<span style="color: #c678dd;">)</span> 
           <span style="color: #c678dd;">(</span>make-exponentiation <span style="color: #99bb66;">(</span>base exp<span style="color: #99bb66;">)</span> 
                                <span style="color: #99bb66;">(</span>make-sum <span style="color: #a9a1e1;">(</span>exponent exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>                                                                                               
          <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>base exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
         <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"unknown expression type: DERIV"</span> exp<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
First I&rsquo;ll make sure the textbook examples work as expected.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;deriv-basic-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;deriv-exp&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>* x y<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           'y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: bad simplification"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>* x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>* x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* y <span style="color: #a9a1e1;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">Now, did I do my job right?</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">Checking against this guy's results:</span>
<span style="color: #525252;">;;   </span><span style="color: #525252;">http://jots-jottings.blogspot.com/2011/11/sicp-exercise-256-differentiating.html</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-exponentiation 1"</span>
           <span style="color: #c678dd;">(</span>make-exponentiation <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">12</span><span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-exponentiation 2"</span>
           <span style="color: #c678dd;">(</span>make-exponentiation <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">12</span><span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">4096</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"make-exponentiation 3"</span>
           <span style="color: #c678dd;">(</span>make-exponentiation 'x <span style="color: #dd8844; font-weight: bold;">12</span><span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>** x <span style="color: #dd8844; font-weight: bold;">12</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: exponentiation 1"</span>
           <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>make-exponentiation 'a <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> 'a<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #99bb66;">(</span>** a <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: exponentiation 2"</span>
           <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>make-exponentiation 'a 'b<span style="color: #99bb66;">)</span> 'a<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>* b <span style="color: #99bb66;">(</span>** a <span style="color: #a9a1e1;">(</span>+ b <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org08a8da2">
SUCCEED at deriv: basic addition
SUCCEED at deriv: basic multiplication
SUCCEED at deriv: bad simplification
SUCCEED at make-exponentiation 1
SUCCEED at make-exponentiation 2
SUCCEED at make-exponentiation 3
SUCCEED at deriv: exponentiation 1
SUCCEED at deriv: exponentiation 2
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5745f1" class="outline-3">
<h3 id="orga5745f1"><span class="section-number-3">3.66.</span> Exercise 2.57: Differentiating arbitrary-length expressions</h3>
<div class="outline-text-3" id="text-3-66">
</div>

<div id="outline-container-org5834099" class="outline-4">
<h4 id="org5834099"><span class="section-number-4">3.66.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-66-1">
<p>
Extend the differentiation program to handle sums and products of arbitrary
numbers of (two or more) terms. Then the last example above could be expressed
as
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>deriv '<span style="color: #c678dd;">(</span>* x y <span style="color: #99bb66;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> 'x<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Try to do this by changing only the representation for sums and products,
without changing the <code class="src src-scheme">deriv</code> procedure at all. For example, the
<code class="src src-scheme">addend</code> of a sum would be the first term, and the <code class="src src-scheme">augend</code>
would be the sum of the rest of the terms.
</p>
</div>
</div>

<div id="outline-container-org76b6db4" class="outline-4">
<h4 id="org76b6db4"><span class="section-number-4">3.66.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-66-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org6f44f2b"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>car x<span style="color: #a9a1e1;">)</span> '+<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">addend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cddr s<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>car rest<span style="color: #a9a1e1;">)</span>
<span style="color: #525252;">;        </span><span style="color: #525252;">(make-sum (addend rest)</span>
<span style="color: #525252;">;                  </span><span style="color: #525252;">(augend (cons '+ rest))))))</span>
        <span style="color: #a9a1e1;">(</span>cons '+ rest<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>car x<span style="color: #a9a1e1;">)</span> '*<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplier</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplicand</span> p<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cddr p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>car rest<span style="color: #a9a1e1;">)</span>
<span style="color: #525252;">;        </span><span style="color: #525252;">(make-product (multiplier rest)</span>
<span style="color: #525252;">;                      </span><span style="color: #525252;">(multiplicand (cons '* rest))))))</span>
        <span style="color: #a9a1e1;">(</span>cons '* rest<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sum</span> a1 a2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? a1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? a2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-product</span> m1 m2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? m1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? m2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;deriv-basic-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;deriv-exp&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;deriv-longer&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: longer addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">6</span> z<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: longer multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>* x y <span style="color: #a9a1e1;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>* x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* y <span style="color: #a9a1e1;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgb8d6082">
SUCCEED at deriv: longer addition
SUCCEED at deriv: longer multiplication
</pre>

<p>
I had to look up the solution for this one. The commented sections in
<code class="src src-scheme">augend</code> and <code class="src src-scheme">multiplicand</code> were the answers I was trying to
make work:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cddr s<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>car rest<span style="color: #a9a1e1;">)</span>
<span style="color: #525252;">;        </span><span style="color: #525252;">(make-sum (addend rest)</span>
<span style="color: #525252;">;                  </span><span style="color: #525252;">(augend (cons '+ rest))))))</span>
        <span style="color: #a9a1e1;">(</span>cons '+ rest<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
It&rsquo;s taking a bunch of steps that weren&rsquo;t ultimately helping, but it didn&rsquo;t
occur to me that the solution was to go simpler rather than more complicated.
I&rsquo;ll have to keep watch for problem-solving dead-ends like this.
</p>
</div>
</div>
</div>

<div id="outline-container-orgfea6ad2" class="outline-3">
<h3 id="orgfea6ad2"><span class="section-number-3">3.67.</span> Exercise 2.58: Processing expressions with infix notation</h3>
<div class="outline-text-3" id="text-3-67">
</div>

<div id="outline-container-org1435f14" class="outline-4">
<h4 id="org1435f14"><span class="section-number-4">3.67.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-67-1">
<p>
Suppose we want to modify the differentiation program so that it works with
ordinary mathematical notation, in which <code class="src src-scheme">+</code> and <code class="src src-scheme">*</code> are
infix rather than prefix operators. Since the differentiation program is defined
in terms of abstract data, we can modify it to work with different
representations of expressions solely by changing the predicates, selectors, and
constructors that define the representation of the algebraic expressions on
which the differentiator is to operate.
</p>
</div>
</div>

<div id="outline-container-org0536a8f" class="outline-4">
<h4 id="org0536a8f"><span class="section-number-4">3.67.2.</span> Part 1</h4>
<div class="outline-text-4" id="text-3-67-2">
<p>
Show how to do this in order to differentiate algebraic expressions presented
in infix form, such as <code class="src src-scheme"><span style="color: #51afef;">(</span>x + <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> * <span style="color: #99bb66;">(</span>x + <span style="color: #a9a1e1;">(</span>y + <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>.  To simplify the task,
assume that <code class="src src-scheme">+</code> and <code class="src src-scheme">*</code> always take two arguments and that
expressions are fully parenthesized.
</p>
</div>
</div>

<div id="outline-container-orga1b3300" class="outline-4">
<h4 id="orga1b3300"><span class="section-number-4">3.67.3.</span> Answer 1</h4>
<div class="outline-text-4" id="text-3-67-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org5a6310e"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>cadr x<span style="color: #a9a1e1;">)</span> '+<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">addend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>caddr s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>cadr x<span style="color: #a9a1e1;">)</span> '*<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplier</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplicand</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>caddr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sum</span> a1 a2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? a1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? a2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list a1 '+ a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=number?</span> exp num<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>number? exp<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>= exp num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-product</span> m1 m2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? m1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? m2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list m1 '* m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>sum? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>addend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
                              <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>augend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? exp<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>make-sum
           <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>multiplier exp<span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplicand exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplier exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">(</span>multiplicand exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
         <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"unknown expression type: DERIV"</span> exp<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;deriv-infix&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           'y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: bad simplification"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>x * y<span style="color: #a9a1e1;">)</span> * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgb907623">
SUCCEED at deriv: basic addition
SUCCEED at deriv: basic multiplication
SUCCEED at deriv: bad simplification
</pre>
</div>
</div>

<div id="outline-container-org51cdf37" class="outline-4">
<h4 id="org51cdf37"><span class="section-number-4">3.67.4.</span> Part 2</h4>
<div class="outline-text-4" id="text-3-67-4">
<p>
The problem becomes substantially harder if we allow standard algebraic
notation, such as <code class="src src-scheme"><span style="color: #51afef;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span> * <span style="color: #c678dd;">(</span>x + y + <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>, which drops unnecessary
parentheses and assumes that multiplication is done before addition. Can you
design appropriate predicates, selectors, and constructors for this notation
such that our derivative program still works?
</p>
</div>
</div>

<div id="outline-container-org8af7435" class="outline-4">
<h4 id="org8af7435"><span class="section-number-4">3.67.5.</span> Answer 2</h4>
<div class="outline-text-4" id="text-3-67-5">
<p>
Ok, I think I can do the long-form list objective, since that would be a
combination of two earlier exercises. But as I write I feel clueless how to
make multiplication happen before addition &#x2013; my first impulse is that this
would mean I would need to either:
</p>
<ol class="org-ol">
<li>Change how Lisp&rsquo;s evaluation works (obviously overkill)</li>
<li>Make statements be evaluated twice, once for multiplication and then once for
addition. And I think that would require modifications to <code class="src src-scheme">deriv</code>.</li>
</ol>

<p>
I&rsquo;ll just start working on the long-form feature and see if I can think of
anything.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org6a9fbdf"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>cadr x<span style="color: #a9a1e1;">)</span> '+<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">addend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cddr s<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>car rest<span style="color: #a9a1e1;">)</span>
        rest<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>cadr x<span style="color: #a9a1e1;">)</span> '*<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplier</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplicand</span> p<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cddr p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>car rest<span style="color: #a9a1e1;">)</span>
        rest<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sum</span> a1 a2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? a1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? a2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? a2<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>list a1 '+ <span style="color: #525252;">;; </span><span style="color: #525252;">cross your fingers!</span>
               <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>multiplier a2<span style="color: #c678dd;">)</span>
                             <span style="color: #c678dd;">(</span>multiplicand a2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list a1 '+ a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=number?</span> exp num<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>number? exp<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>= exp num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-product</span> m1 m2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? m1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? m2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list m1 '* m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>sum? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>addend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
                              <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>augend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? exp<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>make-sum
          <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>multiplier exp<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplicand exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplier exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span>multiplicand exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
         <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"unknown expression type: DERIV"</span> exp<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;deriv-algebraic&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           'y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: bad simplification"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>x * y<span style="color: #a9a1e1;">)</span> * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: longer addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span> + <span style="color: #dd8844; font-weight: bold;">6</span> + z<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: longer multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x * y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">;; </span><span style="color: #525252;">Test cases from:</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">http://community.schemewiki.org/?sicp-ex-2.58</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 1"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span> * <span style="color: #a9a1e1;">(</span>x + y + <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 2"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x * <span style="color: #a9a1e1;">(</span>y * <span style="color: #51afef;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 3"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>x * y<span style="color: #a9a1e1;">)</span> * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">Checks from "future Matt"</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 4a"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span> + x + y * <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 4b"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>y * <span style="color: #dd8844; font-weight: bold;">2</span> + x + <span style="color: #dd8844; font-weight: bold;">3</span> + x<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org3c3adfb">
&lt;unknown-location&gt;: warning: possibly unbound variable `mattcheck'
SUCCEED at deriv: basic addition
SUCCEED at deriv: basic multiplication
SUCCEED at deriv: bad simplification
SUCCEED at deriv: longer addition
SUCCEED at deriv: longer multiplication
SUCCEED at deriv: mult prioritization 1
SUCCEED at deriv: mult prioritization 2
SUCCEED at deriv: mult prioritization 3
SUCCEED at deriv: mult prioritization 4a
FAIL at deriv: mult prioritization 4b
expected: 2
returned: (y * 2)
</pre>

<p>
Above is my first solution. I modified <code class="src src-scheme">make-sum</code> to
check the operator after the current one, see if it was a multiplication, and
if so to evaluate it with <code class="src src-scheme">make-product</code> before doing the current
addition. The &ldquo;immutable variable&rdquo; ways of problem solving makes this pretty
easy:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">I want to do f to the first item of x, unless some-condition? in the second</span>
<span class="linenr">2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">item, in which case do g to the 2nd item before x to the first</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">foo</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>some-condition? <span style="color: #a9a1e1;">(</span>cdr x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>car x<span style="color: #51afef;">)</span>
<span class="linenr">6: </span>               <span style="color: #51afef;">(</span>g <span style="color: #c678dd;">(</span>cdr x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">7: </span>      <span style="color: #99bb66;">(</span>f x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
If I were doing this with mutable variables, where I needed to perform these
modifications in-place in one data structure, I might not have the tools to
solve that problem.
</p>

<p>
However, I came back to this problem after continuing on ahead so far as <a href="#org9617225">Exercise 2.91: division of polynomials</a>, when someone on the
Discord asked for help. Upon re-examination I realized that this first solution
does <i>not</i> solve the problem in an algebraically equivalent way, as you can see
by the last two tests I added above. I had assumed that because addition and
multiplication were commutative, that I only needed to account for immediately
adjacent operations. This was not the case. I must solve the higher-priority
operations in a list first before starting any of the lower ones.
</p>

<p>
TODO:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orge322666"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">func-list</span> '<span style="color: #c678dd;">(</span>product? sum?<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">priority-list</span> '<span style="color: #c678dd;">(</span>* +<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">solve-in-order</span> exp func-list<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>length exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
      '<span style="color: #99bb66;">()</span>
      <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>list-index <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>i<span style="color: #c678dd;">)(</span>eqv? i <span style="color: #99bb66;">(</span>cadr exp<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                        priority-list<span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span>find-solution-order <span style="color: #51afef;">(</span>cddr exp<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sum?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>cadr x<span style="color: #a9a1e1;">)</span> '+<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">addend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cddr s<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>car rest<span style="color: #a9a1e1;">)</span>
        rest<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">product?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? <span style="color: #a9a1e1;">(</span>cadr x<span style="color: #a9a1e1;">)</span> '*<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplier</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplicand</span> p<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cddr p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? <span style="color: #51afef;">(</span>cdr rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>car rest<span style="color: #a9a1e1;">)</span>
        rest<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sum</span> a1 a2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? a1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? a2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? a2<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>list a1 '+ <span style="color: #525252;">;; </span><span style="color: #525252;">cross your fingers!</span>
               <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>multiplier a2<span style="color: #c678dd;">)</span>
                             <span style="color: #c678dd;">(</span>multiplicand a2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list a1 '+ a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=number?</span> exp num<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>number? exp<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>= exp num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-product</span> m1 m2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m1<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? m1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? m2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list m1 '* m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>sum? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>addend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
                              <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>augend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? exp<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>make-sum
          <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>multiplier exp<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplicand exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>make-product <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplier exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span>multiplicand exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
         <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"unknown expression type: DERIV"</span> exp<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;deriv-algebraic-fixed&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           'y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: bad simplification"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>x * y<span style="color: #a9a1e1;">)</span> * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: longer addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span> + <span style="color: #dd8844; font-weight: bold;">6</span> + z<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: longer multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x * y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #525252;">;; </span><span style="color: #525252;">Test cases from:</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">http://community.schemewiki.org/?sicp-ex-2.58</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 1"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span> * <span style="color: #a9a1e1;">(</span>x + y + <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 2"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x * <span style="color: #a9a1e1;">(</span>y * <span style="color: #51afef;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 3"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>x * y<span style="color: #a9a1e1;">)</span> * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x * y<span style="color: #99bb66;">)</span> + <span style="color: #99bb66;">(</span>y * <span style="color: #a9a1e1;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #525252;">;; </span><span style="color: #525252;">Checks from "future Matt"</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 4a"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>x + <span style="color: #dd8844; font-weight: bold;">3</span> + x + y * <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: mult prioritization 4b"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>y * <span style="color: #dd8844; font-weight: bold;">2</span> + x + <span style="color: #dd8844; font-weight: bold;">3</span> + x<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3c4ae4b" class="outline-3">
<h3 id="org3c4ae4b"><span class="section-number-3">3.68.</span> Exercise 2.59: Representing sets</h3>
<div class="outline-text-3" id="text-3-68">
</div>

<div id="outline-container-org64d988e" class="outline-4">
<h4 id="org64d988e"><span class="section-number-4">3.68.1.</span> Text definitions</h4>
<div class="outline-text-4" id="text-3-68-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org0351eb0"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">element-of-set?-manual</span> x set<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set<span style="color: #a9a1e1;">)</span> #f<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>equal? x <span style="color: #51afef;">(</span>car set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> #t<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>element-of-set? x <span style="color: #51afef;">(</span>cdr set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">element-of-set?</span> member<span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">builtins are faster :)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-set</span> x set<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>element-of-set? x set<span style="color: #99bb66;">)</span>
      set
      <span style="color: #99bb66;">(</span>cons x set<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">intersection-set</span> set1 set2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>null? set1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>null? set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> 
         '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>element-of-set? <span style="color: #51afef;">(</span>car set1<span style="color: #51afef;">)</span> set2<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>car set1<span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span>intersection-set <span style="color: #c678dd;">(</span>cdr set1<span style="color: #c678dd;">)</span> 
                                 set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>intersection-set <span style="color: #51afef;">(</span>cdr set1<span style="color: #51afef;">)</span> 
                                set2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org24f42c8" class="outline-4">
<h4 id="org24f42c8"><span class="section-number-4">3.68.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-68-2">
<p>
Implement the <code class="src src-scheme">union-set</code> operation for the unordered-list representation of sets.
</p>
</div>
</div>

<div id="outline-container-org2780aff" class="outline-4">
<h4 id="org2780aff"><span class="section-number-4">3.68.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-68-3">
<p>
<code class="src src-scheme">union-set</code> at a first glance looks like the opposite of
<code class="src src-scheme">intersection-set</code>, since the logic looks like &ldquo;merge two sets, and if
an element exists in both than don&rsquo;t include it&rdquo;. However it&rsquo;s actually just
avoiding putting a symbol in twice.
</p>


<div class="org-src-container">
<pre class="src src-scheme" id="orgb8f7e78"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-rec</span> set1 set2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>null? set1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>null? set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         set2<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>element-of-set? <span style="color: #51afef;">(</span>car set1<span style="color: #51afef;">)</span> set2<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>union-set-rec <span style="color: #51afef;">(</span>cdr set1<span style="color: #51afef;">)</span>
                        set2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>car set1<span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span>union-set-rec <span style="color: #c678dd;">(</span>cdr set1<span style="color: #c678dd;">)</span>
                                   set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set</span> set1 set2<span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> s result<span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? s<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>reverse result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>element-of-set? <span style="color: #c678dd;">(</span>car s<span style="color: #c678dd;">)</span> set2<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>cdr s<span style="color: #c678dd;">)</span> result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span>
             <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>cdr s<span style="color: #c678dd;">)</span>
                   <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>car s<span style="color: #99bb66;">)</span>
                         result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span>append <span style="color: #99bb66;">(</span>iter set1 '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
            set2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;union-set&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set2 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set-union <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"union-set-rec"</span>
             <span style="color: #99bb66;">(</span>union-set-rec set1 set2<span style="color: #99bb66;">)</span>
             set-union<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"union-set"</span>
             <span style="color: #99bb66;">(</span>union-set set1 set2<span style="color: #99bb66;">)</span>
             set-union<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgf6e9ff5">
SUCCEED at union-set-rec
SUCCEED at union-set
</pre>

<div class="org-src-container">
<pre class="src src-scheme" id="org78900ec"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;union-set&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span>set2 <span style="color: #a9a1e1;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">500</span> <span style="color: #dd8844; font-weight: bold;">1500</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">test</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;recursive union-sets: ~a"</span>
<span class="linenr">10: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set-rec set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;iterative union-sets: ~a"</span>
<span class="linenr">12: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>test<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgab634e2">
recursive union-sets: 4704343.6974
iterative union-sets: 4755592.2304
</pre>

<p>
Man, my &ldquo;optimized&rdquo; versions never work. I would blame it on the Scheme compiler
but I&rsquo;m a new programmer so it&rsquo;s probably a skill issue.
</p>
</div>
</div>
</div>

<div id="outline-container-org3972c2a" class="outline-3">
<h3 id="org3972c2a"><span class="section-number-3">3.69.</span> Exercise 2.59: Sets with duplicates</h3>
<div class="outline-text-3" id="text-3-69">
</div>

<div id="outline-container-org02c2c8e" class="outline-4">
<h4 id="org02c2c8e"><span class="section-number-4">3.69.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-69-1">
<p>
We specified that a set would be represented as a list with no duplicates. Now
suppose we allow duplicates. For instance, the set \(\{1, 2, 3\}\) could be
represented as the list <code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span></code>. Design procedures
<code class="src src-scheme">element-of-set?</code>, <code class="src src-scheme">adjoin-set</code>, <code class="src src-scheme">union-set</code>, and
<code class="src src-scheme">intersection-set</code> that operate on this representation. How does the
efficiency of each compare with the corresponding procedure for the
non-duplicate representation? Are there applications for which you would use
this representation in preference to the non-duplicate one?
</p>
</div>
</div>

<div id="outline-container-orgf14e285" class="outline-4">
<h4 id="orgf14e285"><span class="section-number-4">3.69.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-69-2">
<p>
<code class="src src-scheme">element-of-set</code> can be left unchanged. The others are a matter of
getting sloppy: <code class="src src-scheme">adjoin-set</code> can just be a <code class="src src-scheme">cons</code>, and
<code class="src src-scheme">union-set</code> can be an append. Now the remaining question is, how to
make <code class="src src-scheme">intersection-set</code> keep the duplicates?
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org4c588c2"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-set-dupes</span> x set<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cons x set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-dupes</span> set1 set2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>append set1 set2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">intersection-set-dupes</span> set1 set2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>inter <span style="color: #51afef;">(</span>intersection-set set1 set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">yes, we're calling the non-duplicate version</span>
        <span style="color: #a9a1e1;">(</span>union <span style="color: #51afef;">(</span>union-set-dupes set1 set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>filter <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>element-of-set? x inter<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            union<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">intersection-set-dupes2</span> set1 set2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>inter <span style="color: #51afef;">(</span>intersection-set set1 set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">yes, we're calling the non-duplicate version</span>
        <span style="color: #a9a1e1;">(</span>inter2 <span style="color: #51afef;">(</span>intersection-set set2 set1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span>append inter inter2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;union-set&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;set-dupes&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set2 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set-union <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set-union-dupes
       <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set-intersection <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set-intersection-dupes
       <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"union-set-dupes"</span>
             <span style="color: #99bb66;">(</span>union-set-dupes set1 set2<span style="color: #99bb66;">)</span>
             set-union-dupes<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"union-set"</span>
             <span style="color: #99bb66;">(</span>union-set set1 set2<span style="color: #99bb66;">)</span>
             set-union<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"intersection-set"</span>
             <span style="color: #99bb66;">(</span>intersection-set set1 set2<span style="color: #99bb66;">)</span>
             set-intersection<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"intersection-set-dupes"</span>
             <span style="color: #99bb66;">(</span>intersection-set-dupes set1 set2<span style="color: #99bb66;">)</span>
             set-intersection-dupes<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"intersection-set-dupes2"</span>
             <span style="color: #99bb66;">(</span>intersection-set-dupes2 set1 set2<span style="color: #99bb66;">)</span>
             set-intersection-dupes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org3d89594">
SUCCEED at union-set-dupes
SUCCEED at union-set
SUCCEED at intersection-set
SUCCEED at intersection-set-dupes
SUCCEED at intersection-set-dupes2
</pre>

<div class="org-src-container">
<pre class="src src-scheme" id="org0497e1a"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;union-set&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;set-dupes&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>      <span style="color: #99bb66;">(</span>set2 <span style="color: #a9a1e1;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">500</span> <span style="color: #dd8844; font-weight: bold;">1500</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">test</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-sets: ~a"</span>
<span class="linenr">12: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-sets-dupes: ~a"</span>
<span class="linenr">14: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set-dupes set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;intersection-set: ~a"</span>
<span class="linenr">16: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>intersection-set set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;intersection-set-dupes: ~a"</span>
<span class="linenr">18: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>intersection-set-dupes set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;intersection-set-dupes2: ~a"</span>
<span class="linenr">20: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>intersection-set-dupes2 set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>    <span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span>test<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org9a0776a">
union-sets: 4734892.3798
union-sets-dupes: 40132.52
intersection-set: 4673425.9196
intersection-set-dupes: 10325053.8432
intersection-set-dupes2: 10872996.2555
</pre>

<p>
So for <code class="src src-scheme">union-sets</code> a significant speedup, while in algorithms that
need to check for duplicates like <code class="src src-scheme">intersection-set</code> it&rsquo;s much more
time. Also, in a no-duplicate implementation <code class="src src-scheme">element-of-set</code>, it
wouldn&rsquo;t be wasting time checking duplicates.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf469ab8" class="outline-3">
<h3 id="orgf469ab8"><span class="section-number-3">3.70.</span> Exercise 2.61: Ordered sets</h3>
<div class="outline-text-3" id="text-3-70">
</div>

<div id="outline-container-org5c48a78" class="outline-4">
<h4 id="org5c48a78"><span class="section-number-4">3.70.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-70-1">
<p>
Give an implementation of <code class="src src-scheme">adjoin-set</code> using the ordered
representation. By analogy with <code class="src src-scheme">element-of-set?</code> show how to take
advantage of the ordering to produce a procedure that requires on the average
about half as many steps as with the unordered representation.
</p>
</div>
</div>

<div id="outline-container-org2900f90" class="outline-4">
<h4 id="org2900f90"><span class="section-number-4">3.70.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-70-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgfb6ac52"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">element-of-set?-ordered</span> x set<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set<span style="color: #a9a1e1;">)</span> #f<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= x <span style="color: #51afef;">(</span>car set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> #t<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; x <span style="color: #51afef;">(</span>car set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> #f<span style="color: #99bb66;">)</span>
        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>element-of-set?-ordered x <span style="color: #51afef;">(</span>cdr set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-set-ordered</span> x set<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> checked rest<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? rest<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>append checked <span style="color: #c678dd;">(</span>list x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= x <span style="color: #c678dd;">(</span>car rest<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> set<span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&gt; x <span style="color: #c678dd;">(</span>car rest<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>car rest<span style="color: #99bb66;">)</span>
                       checked<span style="color: #c678dd;">)</span>
                 <span style="color: #c678dd;">(</span>cdr rest<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span>reverse checked<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span>cons x rest<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>iter '<span style="color: #99bb66;">()</span> set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;union-set&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;set-ordered&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>answer <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"adjoin-set-ordered"</span>
             <span style="color: #99bb66;">(</span>adjoin-set-ordered <span style="color: #dd8844; font-weight: bold;">3</span> set<span style="color: #99bb66;">)</span>
             answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org3440fdd">
SUCCEED at adjoin-set-ordered
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb42eb5f" class="outline-3">
<h3 id="orgb42eb5f"><span class="section-number-3">3.71.</span> Exercise 2.62: <code>union-set</code> ordered</h3>
<div class="outline-text-3" id="text-3-71">
</div>

<div id="outline-container-orgd76d13a" class="outline-4">
<h4 id="orgd76d13a"><span class="section-number-4">3.71.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-71-1">
<p>
Give a \(\Theta(n)\) implementation of <code class="src src-scheme">union-set</code> for sets
represented as ordered lists.
</p>
</div>
</div>

<div id="outline-container-orgb7ee896" class="outline-4">
<h4 id="orgb7ee896"><span class="section-number-4">3.71.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-71-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org1ef9904"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-ordered</span> set1 set2<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> s1 s2 result<span style="color: #99bb66;">)</span>
    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? s1<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span>reverse result<span style="color: #c678dd;">)</span> s2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? s2<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span>reverse result<span style="color: #c678dd;">)</span> s1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>s1a <span style="color: #a9a1e1;">(</span>car s1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                 <span style="color: #99bb66;">(</span>s2a <span style="color: #a9a1e1;">(</span>car s2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= s1a s2a<span style="color: #a9a1e1;">)</span>
                    <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cdr s1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>cdr s2<span style="color: #51afef;">)</span>
                          <span style="color: #51afef;">(</span>cons s1a result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                   <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; s1a s2a<span style="color: #a9a1e1;">)</span>
                    <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cdr s1<span style="color: #51afef;">)</span> s2
                          <span style="color: #51afef;">(</span>cons s1a result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
                   <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; s1a s2a<span style="color: #a9a1e1;">)</span>
                    <span style="color: #a9a1e1;">(</span>iter s1 <span style="color: #51afef;">(</span>cdr s2<span style="color: #51afef;">)</span>
                          <span style="color: #51afef;">(</span>cons s2a result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>iter set1 set2 '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;union-set&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;set-ordered&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;union-set-ordered&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>set2 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
      <span style="color: #99bb66;">(</span>answer <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"union-set-ordered"</span>
             <span style="color: #99bb66;">(</span>union-set-ordered set1 set2<span style="color: #99bb66;">)</span>
             answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org4998233">
SUCCEED at union-set-ordered
</pre>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;union-set&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;union-set-ordered&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #525252;">;; </span><span style="color: #525252;">http://community.schemewiki.org/?sicp-ex-2.62</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-alt</span> set1 set2<span style="color: #c678dd;">)</span> 
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span>  <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set1<span style="color: #a9a1e1;">)</span> set2<span style="color: #99bb66;">)</span> 
<span class="linenr">11: </span>         <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set2<span style="color: #a9a1e1;">)</span> set1<span style="color: #99bb66;">)</span> 
<span class="linenr">12: </span>         <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>  
<span class="linenr">13: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x1 <span style="color: #99bb66;">(</span>car set1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> 
<span class="linenr">14: </span>                <span style="color: #c678dd;">(</span>x2 <span style="color: #99bb66;">(</span>car set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> 
<span class="linenr">15: </span>            <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>= x1 x2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons x1 <span style="color: #a9a1e1;">(</span>union-set-alt <span style="color: #51afef;">(</span>cdr set1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>cdr set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> 
<span class="linenr">16: </span>                  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>&lt; x1 x2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons x1 <span style="color: #a9a1e1;">(</span>union-set-alt <span style="color: #51afef;">(</span>cdr set1<span style="color: #51afef;">)</span> set2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> 
<span class="linenr">17: </span>                  <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span> <span style="color: #99bb66;">(</span>cons x2 <span style="color: #a9a1e1;">(</span>union-set-alt set1 <span style="color: #51afef;">(</span>cdr set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-alt2</span> set1 set2<span style="color: #c678dd;">)</span> 
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set1<span style="color: #a9a1e1;">)</span> set2<span style="color: #99bb66;">)</span> 
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set2<span style="color: #a9a1e1;">)</span> set1<span style="color: #99bb66;">)</span> 
<span class="linenr">21: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> 
<span class="linenr">22: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x1 <span style="color: #99bb66;">(</span>car set1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> 
<span class="linenr">23: </span>               <span style="color: #c678dd;">(</span>x2 <span style="color: #99bb66;">(</span>car set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> 
<span class="linenr">24: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>min x1 x2<span style="color: #c678dd;">)</span> 
<span class="linenr">25: </span>                 <span style="color: #c678dd;">(</span>union-set-alt2 <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; x1 x2<span style="color: #a9a1e1;">)</span> 
<span class="linenr">26: </span>                                     set1 
<span class="linenr">27: </span>                                     <span style="color: #a9a1e1;">(</span>cdr set1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> 
<span class="linenr">28: </span>                                 <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; x2 x1<span style="color: #a9a1e1;">)</span> 
<span class="linenr">29: </span>                                     set2 
<span class="linenr">30: </span>                                     <span style="color: #a9a1e1;">(</span>cdr set2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">31: </span>
<span class="linenr">32: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">33: </span>      <span style="color: #99bb66;">(</span>set2 <span style="color: #a9a1e1;">(</span>enumerate-interval <span style="color: #dd8844; font-weight: bold;">500</span> <span style="color: #dd8844; font-weight: bold;">1500</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">34: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">test</span><span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-set: ~a"</span>
<span class="linenr">36: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">37: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-set-ordered: ~a"</span>
<span class="linenr">38: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set-ordered set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">50000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">39: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-set-alt: ~a"</span>
<span class="linenr">40: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set-alt set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">500000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">41: </span>    <span style="color: #99bb66;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-set-alt2: ~a"</span>
<span class="linenr">42: </span>            <span style="color: #a9a1e1;">(</span>cadr <span style="color: #51afef;">(</span>mattbench2 <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()(</span>union-set-alt2 set1 set2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">500000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">43: </span>    <span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>
<span class="linenr">45: </span>  <span style="color: #c678dd;">(</span>test<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org5dcc3d8">
union-set: 4758999.4984
union-set-ordered: 107784.3673
union-set-alt: 45441.7717
union-set-alt2: 66262.4295
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc782fc7" class="outline-3">
<h3 id="orgc782fc7"><span class="section-number-3">3.72.</span> Exercise 2.63: binary trees</h3>
<div class="outline-text-3" id="text-3-72">
</div>

<div id="outline-container-org00436e2" class="outline-4">
<h4 id="org00436e2"><span class="section-number-4">3.72.1.</span> Text definitions</h4>
<div class="outline-text-4" id="text-3-72-1">
<div class="org-src-container">
<pre class="src src-scheme" id="orgf14273e"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">entry</span> tree<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">left-branch</span> tree<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">right-branch</span> tree<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>caddr tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-tree</span> entry left right<span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>  <span style="color: #c678dd;">(</span>list entry left right<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4916d1e" class="outline-4">
<h4 id="org4916d1e"><span class="section-number-4">3.72.2.</span> Question A</h4>
<div class="outline-text-4" id="text-3-72-2">
<p>
Each of the following two
procedures converts a binary tree to a list.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgd9857df"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;make-tree&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tree-&gt;list-1</span> tree<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? tree<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      '<span style="color: #99bb66;">()</span>
<span class="linenr"> 5: </span>      <span style="color: #99bb66;">(</span>append <span style="color: #a9a1e1;">(</span>tree-&gt;list-1 <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>              <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>entry tree<span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>                    <span style="color: #51afef;">(</span>tree-&gt;list-1
<span class="linenr"> 8: </span>                      <span style="color: #c678dd;">(</span>right-branch tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tree-&gt;list-2</span> tree<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">copy-to-list</span> tree result-list<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? tree<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>        result-list
<span class="linenr">13: </span>        <span style="color: #a9a1e1;">(</span>copy-to-list <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                      <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                            <span style="color: #c678dd;">(</span>copy-to-list
<span class="linenr">16: </span>                              <span style="color: #99bb66;">(</span>right-branch tree<span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>                              result-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>copy-to-list tree '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<ol class="org-ol">
<li>Do the two procedures produce the same result for every tree? If not, how do
the results differ? What lists do the two procedures produce for the trees in
Figure 2.16?</li>
</ol>
</div>
</div>

<div id="outline-container-org38c0be4" class="outline-4">
<h4 id="org38c0be4"><span class="section-number-4">3.72.3.</span> Answer A</h4>
<div class="outline-text-4" id="text-3-72-3">
<p>
First let&rsquo;s check whether the arrangement of the input tree impacts the output
list. I&rsquo;d like a couple functions for generating lists.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org7240ecb"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rightward-tree</span> list<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? list<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      '<span style="color: #99bb66;">()</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>make-tree <span style="color: #a9a1e1;">(</span>car list<span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">()</span>
<span class="linenr"> 5: </span>                 <span style="color: #a9a1e1;">(</span>rightward-tree <span style="color: #51afef;">(</span>cdr list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">leftward-tree</span> list<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> list<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>        '<span style="color: #a9a1e1;">()</span>
<span class="linenr">10: </span>        <span style="color: #a9a1e1;">(</span>make-tree <span style="color: #51afef;">(</span>car list<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>rec <span style="color: #c678dd;">(</span>cdr list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                   '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>rec list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">nested-tree</span> list<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> list<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span>length list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>           <span style="color: #51afef;">(</span>make-tree <span style="color: #c678dd;">(</span>car list<span style="color: #c678dd;">)</span> '<span style="color: #c678dd;">()</span> '<span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>length list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>           <span style="color: #51afef;">(</span>make-tree <span style="color: #c678dd;">(</span>cadr list<span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>                      <span style="color: #c678dd;">(</span>make-tree <span style="color: #99bb66;">(</span>car list<span style="color: #99bb66;">)</span> '<span style="color: #99bb66;">()</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>                      '<span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">22: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>halfway <span style="color: #a9a1e1;">(</span>truncate/ <span style="color: #51afef;">(</span>length list<span style="color: #51afef;">)</span>
<span class="linenr">23: </span>                                     <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>                 <span style="color: #c678dd;">(</span>make-tree <span style="color: #99bb66;">(</span>list-ref list halfway<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>                            <span style="color: #99bb66;">(</span>rec <span style="color: #a9a1e1;">(</span>list-head list halfway<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>                            <span style="color: #99bb66;">(</span>rec <span style="color: #a9a1e1;">(</span>list-tail list <span style="color: #51afef;">(</span>1+ halfway<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>  <span style="color: #c678dd;">(</span>rec list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;tree-to-list&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;tree-makers&gt;&gt;</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>nil '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       <span style="color: #99bb66;">(</span>1-to-4 <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span>tree-right
<span class="linenr"> 8: </span>        <span style="color: #a9a1e1;">(</span>rightward-tree 1-to-4<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>       <span style="color: #99bb66;">(</span>tree-left
<span class="linenr">10: </span>        <span style="color: #a9a1e1;">(</span>leftward-tree 1-to-4<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>       <span style="color: #99bb66;">(</span>tree-middle
<span class="linenr">12: </span>        <span style="color: #a9a1e1;">(</span>nested-tree <span style="color: #51afef;">(</span>iota <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-right:"</span> tree-right<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-right list 1:"</span> <span style="color: #99bb66;">(</span>tree-&gt;list-1 tree-right<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-right list 2:"</span> <span style="color: #99bb66;">(</span>tree-&gt;list-2 tree-right<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-left:"</span> tree-left<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-left list 1:"</span> <span style="color: #99bb66;">(</span>tree-&gt;list-1 tree-left<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-left list 2:"</span> <span style="color: #99bb66;">(</span>tree-&gt;list-2 tree-left<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-middle:"</span> tree-middle<span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-middle list 1:"</span> <span style="color: #99bb66;">(</span>tree-&gt;list-1 tree-middle<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"tree-middle list 2:"</span> <span style="color: #99bb66;">(</span>tree-&gt;list-2 tree-middle<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgf6586e9">
tree-right: (1 () (2 () (3 () (4 () ())))) 
tree-right list 1: (1 2 3 4) 
tree-right list 2: (1 2 3 4) 

tree-left: (1 (2 (3 (4 () ()) ()) ()) ()) 
tree-left list 1: (4 3 2 1) 
tree-left list 2: (4 3 2 1) 

tree-middle: (5 (2 (1 (0 () ()) ()) (4 (3 () ()) ())) (8 (7 (6 () ()) ()) (9 () ()))) 
tree-middle list 1: (0 1 2 3 4 5 6 7 8 9) 
tree-middle list 2: (0 1 2 3 4 5 6 7 8 9) 
</pre>

<p>
So, the lists are the same for both.
</p>

<p>
Fun fact: Emacs org-babel has suddenly stopped accepting the &lambda; character
in source code.
</p>
</div>
</div>

<div id="outline-container-orgb622cfb" class="outline-4">
<h4 id="orgb622cfb"><span class="section-number-4">3.72.4.</span> Question B</h4>
<div class="outline-text-4" id="text-3-72-4">
<p>
Do the two procedures have the same order of growth in the number of steps
required to convert a balanced tree with \(n\) elements to a list? If not, which
one grows more slowly?
</p>
</div>
</div>

<div id="outline-container-orge364bf9" class="outline-4">
<h4 id="orge364bf9"><span class="section-number-4">3.72.5.</span> Answer B</h4>
<div class="outline-text-4" id="text-3-72-5">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">tree-&gt;list-1 evaluating the following tree:</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;;     </span><span style="color: #525252;">7</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;;    </span><span style="color: #525252;">/ \</span>
<span class="linenr"> 4: </span><span style="color: #525252;">;;   </span><span style="color: #525252;">3   9</span>
<span class="linenr"> 5: </span><span style="color: #525252;">;;  </span><span style="color: #525252;">/ \   \</span>
<span class="linenr"> 6: </span><span style="color: #525252;">;; </span><span style="color: #525252;">1   5   11</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span>append <span style="color: #99bb66;">(</span>append nil
<span class="linenr"> 8: </span>                        <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr"> 9: </span>                              nil<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>                <span style="color: #99bb66;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span>
<span class="linenr">11: </span>                      <span style="color: #a9a1e1;">(</span>append nil
<span class="linenr">12: </span>                              <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">5</span>
<span class="linenr">13: </span>                                    nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>        <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">7</span>
<span class="linenr">15: </span>              <span style="color: #99bb66;">(</span>append nil
<span class="linenr">16: </span>                      <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">9</span>
<span class="linenr">17: </span>                            <span style="color: #51afef;">(</span>append nil
<span class="linenr">18: </span>                                    <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">11</span>
<span class="linenr">19: </span>                                          nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #525252;">;; </span><span style="color: #525252;">holy cow that is wasteful. So many appends of nothing.</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #525252;">;; </span><span style="color: #525252;">tree-&gt;list-2 evaluation (iterative)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>copy-to-list <span style="color: #c678dd;">[</span>full tree<span style="color: #c678dd;">]</span> nil<span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>copy-to-list <span style="color: #c678dd;">[</span>tree <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">]</span>
<span class="linenr">25: </span>              <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">7</span>
<span class="linenr">26: </span>                    <span style="color: #99bb66;">(</span>copy-to-list
<span class="linenr">27: </span>                     <span style="color: #a9a1e1;">[</span>tree <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #a9a1e1;">]</span>
<span class="linenr">28: </span>                     nil<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">29: </span><span style="color: #51afef;">(</span>copy-to-list <span style="color: #c678dd;">[</span>tree <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">]</span>
<span class="linenr">30: </span>              <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">7</span>
<span class="linenr">31: </span>                    <span style="color: #99bb66;">(</span>copy-to-list
<span class="linenr">32: </span>                     nil
<span class="linenr">33: </span>                     <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">9</span>
<span class="linenr">34: </span>                           <span style="color: #51afef;">(</span>copy-to-list
<span class="linenr">35: </span>                            <span style="color: #c678dd;">[</span>tree <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #c678dd;">]</span>
<span class="linenr">36: </span>                            nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">37: </span><span style="color: #51afef;">(</span>copy-to-list <span style="color: #c678dd;">[</span>tree <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">]</span>
<span class="linenr">38: </span>              <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">7</span>
<span class="linenr">39: </span>                    <span style="color: #99bb66;">(</span>copy-to-list
<span class="linenr">40: </span>                     nil
<span class="linenr">41: </span>                     <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">9</span>
<span class="linenr">42: </span>                           <span style="color: #51afef;">(</span>copy-to-list
<span class="linenr">43: </span>                            nil
<span class="linenr">44: </span>                            <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">11</span>
<span class="linenr">45: </span>                                  <span style="color: #99bb66;">(</span>copy-to-list nil nil<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">46: </span><span style="color: #51afef;">(</span>copy-to-list <span style="color: #c678dd;">[</span>tree <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">]</span>
<span class="linenr">47: </span>              '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">48: </span><span style="color: #51afef;">(</span>copy-to-list <span style="color: #c678dd;">[</span>tree <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">]</span>
<span class="linenr">49: </span>              <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span>
<span class="linenr">50: </span>                    <span style="color: #99bb66;">(</span>copy-to-list
<span class="linenr">51: </span>                     nil
<span class="linenr">52: </span>                     <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">5</span>
<span class="linenr">53: </span>                           <span style="color: #51afef;">(</span>copy-to-list
<span class="linenr">54: </span>                            nil
<span class="linenr">55: </span>                            '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">56: </span><span style="color: #51afef;">(</span>copy-to-list
<span class="linenr">57: </span> nil
<span class="linenr">58: </span> <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">59: </span>       <span style="color: #99bb66;">(</span>copy-to-list
<span class="linenr">60: </span>        nil
<span class="linenr">61: </span>        '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">62: </span>'<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
So, assuming the evaluation isn&rsquo;t as slow as operations like <code class="src src-scheme">append</code>,
the second is definitely faster &#x2013; it&rsquo;s basically just evaluating to a series of
<code class="src src-scheme">cons</code> statements. The internet suggests that the first is
\(\Theta(n\log{n})\) while the second is \(\Theta(n)\).
</p>
</div>
</div>
</div>

<div id="outline-container-org39999d8" class="outline-3">
<h3 id="org39999d8"><span class="section-number-3">3.73.</span> Exercise 2.64: Making a balanced binary tree</h3>
<div class="outline-text-3" id="text-3-73">
<p>
The following procedure <code class="src src-scheme">list-&gt;tree</code> converts an ordered list to a
balanced binary tree. The helper procedure <code class="src src-scheme">partial-tree</code> takes as
arguments an integer \(n\) and list of at least \(n\) elements and constructs a
balanced tree containing the first \(n\) elements of the list. The result
returned by <code class="src src-scheme">partial-tree</code> is a pair (formed with <code class="src src-scheme">cons</code>)
whose <code class="src src-scheme">car</code> is the constructed tree and whose <code class="src src-scheme">cdr</code> is the
list of elements not included in the tree.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org17ad06f"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;make-tree&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">list-&gt;tree</span> elements<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>car <span style="color: #99bb66;">(</span>partial-tree elements <span style="color: #a9a1e1;">(</span>length elements<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">partial-tree</span> elts n<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">(</span>cons '<span style="color: #a9a1e1;">()</span> elts<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>left-size <span style="color: #c678dd;">(</span>quotient <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>left-result
<span class="linenr"> 9: </span>               <span style="color: #99bb66;">(</span>partial-tree elts left-size<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>left-tree <span style="color: #a9a1e1;">(</span>car left-result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>                <span style="color: #99bb66;">(</span>non-left-elts <span style="color: #a9a1e1;">(</span>cdr left-result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>                <span style="color: #99bb66;">(</span>right-size <span style="color: #a9a1e1;">(</span>- n <span style="color: #51afef;">(</span>+ left-size <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>            <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>this-entry <span style="color: #51afef;">(</span>car non-left-elts<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">14: </span>                  <span style="color: #a9a1e1;">(</span>right-result
<span class="linenr">15: </span>                   <span style="color: #51afef;">(</span>partial-tree
<span class="linenr">16: </span>                    <span style="color: #c678dd;">(</span>cdr non-left-elts<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                    right-size<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>              <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>right-tree <span style="color: #c678dd;">(</span>car right-result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>                    <span style="color: #51afef;">(</span>remaining-elts
<span class="linenr">20: </span>                     <span style="color: #c678dd;">(</span>cdr right-result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>make-tree this-entry
<span class="linenr">22: </span>                                 left-tree
<span class="linenr">23: </span>                                 right-tree<span style="color: #51afef;">)</span>
<span class="linenr">24: </span>                      remaining-elts<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>

<div id="outline-container-org1a7d45b" class="outline-4">
<h4 id="org1a7d45b"><span class="section-number-4">3.73.1.</span> Question A</h4>
<div class="outline-text-4" id="text-3-73-1">
<p>
Write a short paragraph explaining as clearly as you can how
<code class="src src-scheme">partial-tree</code> works. Draw the tree produced by <code class="src src-scheme">list-&gt;tree</code>
for the list <code class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span></code>.
</p>
</div>
</div>

<div id="outline-container-orgcd6d942" class="outline-4">
<h4 id="orgcd6d942"><span class="section-number-4">3.73.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-3-73-2">
<p>
For my own sake, I&rsquo;ll reorganize this with <code class="src src-scheme">let*</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">partial-tree</span> elts n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= n <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      <span style="color: #99bb66;">(</span>cons '<span style="color: #a9a1e1;">()</span> elts<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>left-size <span style="color: #c678dd;">(</span>quotient <span style="color: #99bb66;">(</span>- n <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>            <span style="color: #51afef;">(</span>left-result <span style="color: #c678dd;">(</span>partial-tree
<span class="linenr"> 6: </span>                          elts
<span class="linenr"> 7: </span>                          left-size<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>            <span style="color: #51afef;">(</span>left-tree <span style="color: #c678dd;">(</span>car left-result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>            <span style="color: #51afef;">(</span>non-left-elts <span style="color: #c678dd;">(</span>cdr left-result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>            <span style="color: #51afef;">(</span>right-size <span style="color: #c678dd;">(</span>- n <span style="color: #99bb66;">(</span>+ left-size <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>            <span style="color: #51afef;">(</span>this-entry <span style="color: #c678dd;">(</span>car non-left-elts<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>            <span style="color: #51afef;">(</span>right-result <span style="color: #c678dd;">(</span>partial-tree
<span class="linenr">13: </span>                           <span style="color: #99bb66;">(</span>cdr non-left-elts<span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>                           right-size<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>            <span style="color: #51afef;">(</span>right-tree <span style="color: #c678dd;">(</span>car right-result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>            <span style="color: #51afef;">(</span>remaining-elts <span style="color: #c678dd;">(</span>cdr right-result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>        <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>make-tree this-entry
<span class="linenr">18: </span>                         left-tree
<span class="linenr">19: </span>                         right-tree<span style="color: #51afef;">)</span>
<span class="linenr">20: </span>              remaining-elts<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>
</pre>
</div>

<p>
Say we&rsquo;re evaluating <code class="src src-scheme">'<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span></code>. We define
<code class="src src-scheme">left-size</code> as \(\lfloor n/2 \rfloor\). <code class="src src-scheme">partial-tree</code> recurses
until hitting \(n=0\), at which point it returns the starting list with
<code class="src src-scheme">'<span style="color: #51afef;">()</span></code> prepended to it. This is used as the empty left branch for the
second-to-the-bottom row of the tree, in this case for the tree node of
<code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">1</span></code>. That empty tree branch is saved in <code class="src src-scheme">left-tree</code>,
<code class="src src-scheme">this-entry</code> (<code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">1</span></code>) is defined, then we recurse to the right
branch, finding a bottom to place <code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">3</span></code>. Finally, the tree with only 3
is returned, it becomes the right branch off <code class="src src-scheme"><span style="color: #dd8844; font-weight: bold;">1</span></code>, making
<code class="src src-scheme"><span style="color: #51afef;">(</span>make-tree <span style="color: #dd8844; font-weight: bold;">1</span> '<span style="color: #c678dd;">()</span> <span style="color: #c678dd;">(</span>make-tree <span style="color: #dd8844; font-weight: bold;">3</span> '<span style="color: #99bb66;">()</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span></code>. This gets
<code class="src src-scheme">cons</code>&rsquo;d to the remaining list, <code class="src src-scheme">'<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span></code>. Upon
returning the new list, this will become the <code class="src src-scheme">left-tree</code> of its parent
process. All in all, this is a recursive algorithm that kind of solves itself
with minimal logic. Note its evaluation always comes back to <code class="src src-scheme">cons</code>
operations.
</p>

<p>
This is very elegant. However, I am left wondering how clear this is in
comparison with some C routine that does the same thing.
</p>


<div id="org9288d50" class="figure">
<p><img src="2/fig/Ex64.png" alt="Ex64.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org974dac7" class="outline-4">
<h4 id="org974dac7"><span class="section-number-4">3.73.3.</span> Question B</h4>
<div class="outline-text-4" id="text-3-73-3">
<p>
What is the order of growth in the number of steps required by
<code class="src src-scheme">list-&gt;tree</code> to convert a list of \(n\) elements?
</p>
</div>
</div>

<div id="outline-container-org505c5d4" class="outline-4">
<h4 id="org505c5d4"><span class="section-number-4">3.73.4.</span> Answer B</h4>
<div class="outline-text-4" id="text-3-73-4">
<p>
I&rsquo;m going to estimate that it&rsquo;s \(\Theta(n)\) because of the <code class="src src-scheme">cons</code>
operations being the cornerstone of the procedure. The internet appears to agree
in this case.
</p>
</div>
</div>
</div>

<div id="outline-container-org74e5b4e" class="outline-3">
<h3 id="org74e5b4e"><span class="section-number-3">3.74.</span> Exercise 2.65: Sets as binary trees</h3>
<div class="outline-text-3" id="text-3-74">
</div>

<div id="outline-container-org6e8166b" class="outline-4">
<h4 id="org6e8166b"><span class="section-number-4">3.74.1.</span> Textbook Definitions</h4>
<div class="outline-text-4" id="text-3-74-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org7b86082"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">element-of-set?-tree</span> x set<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set<span style="color: #a9a1e1;">)</span> #f<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= x <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> #t<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; x <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span>element-of-set?-tree
<span class="linenr"> 6: </span>          x 
<span class="linenr"> 7: </span>          <span style="color: #51afef;">(</span>left-branch set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; x <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>         <span style="color: #a9a1e1;">(</span>element-of-set?-tree
<span class="linenr">10: </span>          x 
<span class="linenr">11: </span>          <span style="color: #51afef;">(</span>right-branch set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-set-tree</span> x set<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>make-tree x '<span style="color: #51afef;">()</span> '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= x <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> set<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; x <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>         <span style="color: #a9a1e1;">(</span>make-tree 
<span class="linenr">17: </span>          <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span>
<span class="linenr">18: </span>          <span style="color: #51afef;">(</span>adjoin-set-tree x <span style="color: #c678dd;">(</span>left-branch set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>          <span style="color: #51afef;">(</span>right-branch set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; x <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>         <span style="color: #a9a1e1;">(</span>make-tree
<span class="linenr">22: </span>          <span style="color: #51afef;">(</span>entry set<span style="color: #51afef;">)</span>
<span class="linenr">23: </span>          <span style="color: #51afef;">(</span>left-branch set<span style="color: #51afef;">)</span>
<span class="linenr">24: </span>          <span style="color: #51afef;">(</span>adjoin-set-tree x <span style="color: #c678dd;">(</span>right-branch set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf81863f" class="outline-4">
<h4 id="orgf81863f"><span class="section-number-4">3.74.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-74-2">
<p>
Use the results of Exercise 2.63 and Exercise 2.64 to give \(\Theta(n)\)
implementations of <code class="src src-scheme">union-set</code> and <code class="src src-scheme">intersection-set</code> for
sets implemented as (balanced) binary trees.
</p>
</div>
</div>

<div id="outline-container-org9272135" class="outline-4">
<h4 id="org9272135"><span class="section-number-4">3.74.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-74-3">
<p>
Ok, now that&rsquo;s stretching my brain for sure. Hmm&#x2026;
</p>

<p>
I think I need to look closer at how <code class="src src-scheme">tree-&gt;list</code> works.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tree-&gt;list-debug</span> tree<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">copy-to-list</span> tree result-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? tree<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>        result-list
<span class="linenr"> 5: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>result
<span class="linenr"> 6: </span>               <span style="color: #99bb66;">(</span><span style="color: #51afef;">begin</span> <span style="color: #a9a1e1;">(</span>echo <span style="color: #99bb66;">"&gt;&gt; entering tree at"</span> <span style="color: #51afef;">(</span>entry tree<span style="color: #51afef;">)</span> <span style="color: #99bb66;">"results"</span> result-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>                      <span style="color: #a9a1e1;">(</span>copy-to-list <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>                                    <span style="color: #51afef;">(</span><span style="color: #51afef;">begin</span> <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"we'll cons"</span> <span style="color: #99bb66;">(</span>entry tree<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>                                           <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>pair
<span class="linenr">10: </span>                                                  <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                                                        <span style="color: #c678dd;">(</span>copy-to-list
<span class="linenr">12: </span>                                                         <span style="color: #99bb66;">(</span>right-branch tree<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                                                         result-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>                                             <span style="color: #99bb66;">(</span>echo <span style="color: #99bb66;">"  cons'd"</span> pair<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                                             pair<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>          <span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"&lt;&lt; leaving tree at"</span> <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span> <span style="color: #99bb66;">"results"</span> result-list<span style="color: #51afef;">)</span>
<span class="linenr">17: </span>          result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>copy-to-list tree '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org80c9d0f">
&gt;&gt; entering tree at 5 results ()
we'll cons 5
&gt;&gt; entering tree at 9 results ()
we'll cons 9
&gt;&gt; entering tree at 11 results ()
we'll cons 11
  cons'd (11)
&lt;&lt; leaving tree at 11 results ()
  cons'd (9 11)
&gt;&gt; entering tree at 7 results (9 11)
we'll cons 7
  cons'd (7 9 11)
&lt;&lt; leaving tree at 7 results (9 11)
&lt;&lt; leaving tree at 9 results ()
  cons'd (5 7 9 11)
&gt;&gt; entering tree at 1 results (5 7 9 11)
we'll cons 1
&gt;&gt; entering tree at 3 results (5 7 9 11)
we'll cons 3
  cons'd (3 5 7 9 11)
&lt;&lt; leaving tree at 3 results (5 7 9 11)
  cons'd (1 3 5 7 9 11)
&lt;&lt; leaving tree at 1 results (5 7 9 11)
&lt;&lt; leaving tree at 5 results ()
(1 3 5 7 9 11)
</pre>

<p>
What&rsquo;s really holding me up is the \(\Theta(n)\) complexity. Since I&rsquo;m probably
not going to figure this out easily, let&rsquo;s try doing it the &ldquo;wrong&rdquo; way first,
by using previously made algorithms.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org80e5cb0"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;make-tree&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;list-to-tree&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;tree-to-list&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;tree-sets-txt&gt;&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tree-&gt;list-debug</span> tree<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">copy-to-list</span> tree result-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? tree<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>        result-list
<span class="linenr">10: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>result
<span class="linenr">11: </span>               <span style="color: #99bb66;">(</span><span style="color: #51afef;">begin</span> <span style="color: #a9a1e1;">(</span>echo <span style="color: #99bb66;">"&gt;&gt; entering tree at"</span> <span style="color: #51afef;">(</span>entry tree<span style="color: #51afef;">)</span> <span style="color: #99bb66;">"results"</span> result-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>                      <span style="color: #a9a1e1;">(</span>copy-to-list <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                                    <span style="color: #51afef;">(</span><span style="color: #51afef;">begin</span> <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"we'll cons"</span> <span style="color: #99bb66;">(</span>entry tree<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                                           <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>pair
<span class="linenr">15: </span>                                                  <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>                                                        <span style="color: #c678dd;">(</span>copy-to-list
<span class="linenr">17: </span>                                                         <span style="color: #99bb66;">(</span>right-branch tree<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>                                                         result-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>                                             <span style="color: #99bb66;">(</span>echo <span style="color: #99bb66;">"  cons'd"</span> pair<span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>                                             pair<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>          <span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"&lt;&lt; leaving tree at"</span> <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span> <span style="color: #99bb66;">"results"</span> result-list<span style="color: #51afef;">)</span>
<span class="linenr">22: </span>          result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span>copy-to-list tree '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-tree-wrong1</span> set1 set2<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">copy-to-list</span> tree held-tree result-list<span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">swap-trees</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>      <span style="color: #a9a1e1;">(</span>copy-to-list held-tree tree result-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">advance-tree-no-cons</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">30: </span>      <span style="color: #a9a1e1;">(</span>copy-to-list <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span>
<span class="linenr">31: </span>                    held-tree
<span class="linenr">32: </span>                    <span style="color: #51afef;">(</span>copy-to-list
<span class="linenr">33: </span>                     <span style="color: #c678dd;">(</span>right-branch tree<span style="color: #c678dd;">)</span>
<span class="linenr">34: </span>                     held-tree
<span class="linenr">35: </span>                     result-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">36: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">advance-tree-cons</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">37: </span>      <span style="color: #a9a1e1;">(</span>copy-to-list <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span>
<span class="linenr">38: </span>                    held-tree
<span class="linenr">39: </span>                    <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">40: </span>                          <span style="color: #c678dd;">(</span>copy-to-list
<span class="linenr">41: </span>                           <span style="color: #99bb66;">(</span>right-branch tree<span style="color: #99bb66;">)</span>
<span class="linenr">42: </span>                           held-tree
<span class="linenr">43: </span>                           result-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">44: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">advance-both-cons</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">45: </span>      <span style="color: #a9a1e1;">(</span>copy-to-list <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span>
<span class="linenr">46: </span>                    held-tree
<span class="linenr">47: </span>                    <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">48: </span>                          <span style="color: #c678dd;">(</span>copy-to-list
<span class="linenr">49: </span>                           <span style="color: #99bb66;">(</span>right-branch tree<span style="color: #99bb66;">)</span>
<span class="linenr">50: </span>                           held-tree
<span class="linenr">51: </span>                           result-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">52: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>null? tree<span style="color: #c678dd;">)</span>
<span class="linenr">53: </span>                <span style="color: #c678dd;">(</span>null? held-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">54: </span>           result-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">55: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? tree<span style="color: #51afef;">)</span>
<span class="linenr">56: </span>           <span style="color: #51afef;">(</span>swap-trees<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">57: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">58: </span>              <span style="color: #c678dd;">(</span>car result-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">59: </span>           <span style="color: #51afef;">(</span>advance-tree-no-cons<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">60: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>entry held-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">61: </span>           <span style="color: #51afef;">(</span>advance-both-cons<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">62: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&lt; <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>entry held-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">63: </span>           <span style="color: #51afef;">(</span>advance-tree-cons<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">64: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&gt; <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>entry held-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">65: </span>           <span style="color: #51afef;">(</span>swap-trees<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">66: </span>  <span style="color: #c678dd;">(</span>copy-to-list set1 set2 '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">67: </span>
<span class="linenr">68: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-tree-wrong2</span> set1 set2<span style="color: #c678dd;">)</span>
<span class="linenr">69: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">copy-to-tree</span> tree result-tree<span style="color: #99bb66;">)</span>
<span class="linenr">70: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? tree<span style="color: #a9a1e1;">)</span>
<span class="linenr">71: </span>        result-tree
<span class="linenr">72: </span>        <span style="color: #a9a1e1;">(</span>copy-to-tree <span style="color: #51afef;">(</span>left-branch tree<span style="color: #51afef;">)</span>
<span class="linenr">73: </span>                      <span style="color: #51afef;">(</span>adjoin-set-tree <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">74: </span>                                       <span style="color: #c678dd;">(</span>copy-to-tree
<span class="linenr">75: </span>                                        <span style="color: #99bb66;">(</span>right-branch tree<span style="color: #99bb66;">)</span>
<span class="linenr">76: </span>                                        result-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">77: </span>  <span style="color: #c678dd;">(</span>copy-to-tree set1 set2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">78: </span>
<span class="linenr">79: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">intersection-set-tree-wrong1</span> set1 set2<span style="color: #c678dd;">)</span>
<span class="linenr">80: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">copy-to-tree</span> tree result-tree<span style="color: #99bb66;">)</span>
<span class="linenr">81: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? tree<span style="color: #a9a1e1;">)</span>
<span class="linenr">82: </span>        result-tree
<span class="linenr">83: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>adjoin-or-not
<span class="linenr">84: </span>               <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>rest<span style="color: #a9a1e1;">)</span>
<span class="linenr">85: </span>                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>element-of-set?-tree <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">86: </span>                                           set2<span style="color: #51afef;">)</span>
<span class="linenr">87: </span>                     <span style="color: #51afef;">(</span>adjoin-set-tree <span style="color: #c678dd;">(</span>entry tree<span style="color: #c678dd;">)</span>
<span class="linenr">88: </span>                                      rest<span style="color: #51afef;">)</span>
<span class="linenr">89: </span>                     rest<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">90: </span>          <span style="color: #51afef;">(</span>copy-to-tree <span style="color: #c678dd;">(</span>left-branch tree<span style="color: #c678dd;">)</span>
<span class="linenr">91: </span>                        <span style="color: #c678dd;">(</span>adjoin-or-not
<span class="linenr">92: </span>                         <span style="color: #99bb66;">(</span>copy-to-tree
<span class="linenr">93: </span>                          <span style="color: #a9a1e1;">(</span>right-branch tree<span style="color: #a9a1e1;">)</span>
<span class="linenr">94: </span>                          result-tree<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">95: </span>    <span style="color: #c678dd;">(</span>copy-to-tree set1 '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;sets-as-trees&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>list-&gt;tree '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span><span style="color: #525252;">;; </span><span style="color: #525252;">(5 (1 () (3 () ())) (9 (7 () ()) (11 () ())))</span>
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">(</span>set2 <span style="color: #a9a1e1;">(</span>list-&gt;tree '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span><span style="color: #525252;">;; </span><span style="color: #525252;">(6 (2 () (4 () ())) (8 (7 () ()) (11 () ())))</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>union <span style="color: #a9a1e1;">(</span>list-&gt;tree '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span><span style="color: #525252;">;; </span><span style="color: #525252;">(5 (2 (1 () ()) (3 () (4 () ()))) (8 (6 () (7 () ())) (9 () (11 () ()))))</span>
<span class="linenr">10: </span>      <span style="color: #99bb66;">(</span>union-unbal '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">6</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">()</span> <span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #99bb66;">()</span> <span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">11</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>      <span style="color: #99bb66;">(</span>int-unbal '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">11</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #c678dd;">()</span> <span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>      <span style="color: #99bb66;">(</span>int <span style="color: #a9a1e1;">(</span>list-&gt;tree '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span><span style="color: #525252;">;; </span><span style="color: #525252;">(7 () (11 () ()))</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"element-of-set?-tree true"</span>
<span class="linenr">15: </span>             <span style="color: #99bb66;">(</span>element-of-set?-tree <span style="color: #dd8844; font-weight: bold;">1</span> set1<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>             #t<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"element-of-set?-tree true"</span>
<span class="linenr">18: </span>             <span style="color: #99bb66;">(</span>element-of-set?-tree <span style="color: #dd8844; font-weight: bold;">7</span> set1<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>             #t<span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"element-of-set?-tree false"</span>
<span class="linenr">21: </span>             <span style="color: #99bb66;">(</span>element-of-set?-tree <span style="color: #dd8844; font-weight: bold;">2</span> set1<span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>             #f<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"union-set-tree-wrong2"</span>
<span class="linenr">24: </span>             <span style="color: #99bb66;">(</span>union-set-tree-wrong2 set1 set2<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>             union-unbal<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"intersection-set-tree-wrong1"</span>
<span class="linenr">27: </span>             <span style="color: #99bb66;">(</span>intersection-set-tree-wrong1 set1 set2<span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>             int-unbal<span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">(</span>tree-&gt;list-debug set1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0dff6b8">
SUCCEED at element-of-set?-tree true
SUCCEED at element-of-set?-tree true
SUCCEED at element-of-set?-tree false
SUCCEED at union-set-tree-wrong2
SUCCEED at intersection-set-tree-wrong1
</pre>

<p>
I can&rsquo;t really think of a better way to do it. Time to look up the answer!
</p>

<p>
And&#x2026; To my surprise, the answer most internet people have given is what I
called the &ldquo;wrong&rdquo; one. In their case, using <code class="src src-scheme">tree-&gt;list</code> and
<code class="src src-scheme">list-&gt;tree</code> to apply the list-based <code class="src src-scheme">union-set</code> and
<code class="src src-scheme">intersection-set</code>, saying it&rsquo;s \(\Theta(n)\). I also notice that they
didn&rsquo;t use <code class="src src-scheme">element-of-set?</code> and <code class="src src-scheme">adjoin-to-set</code> like I did.
</p>

<p>
Let&rsquo;s compare.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">use-modules</span> <span style="color: #c678dd;">(</span>ice-9 format<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattbench.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sets-txt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;sets-as-trees&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;enumerate-interval&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tree-&gt;list</span> tree-&gt;list-2<span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set</span> set1 set2<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>null? set1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>null? set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>         set2<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>element-of-set? <span style="color: #51afef;">(</span>car set1<span style="color: #51afef;">)</span> set2<span style="color: #a9a1e1;">)</span>
<span class="linenr">11: </span>         <span style="color: #a9a1e1;">(</span>union-set <span style="color: #51afef;">(</span>cdr set1<span style="color: #51afef;">)</span>
<span class="linenr">12: </span>                        set2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>car set1<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                    <span style="color: #51afef;">(</span>union-set <span style="color: #c678dd;">(</span>cdr set1<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                                   set2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #525252;">;; </span><span style="color: #525252;">from http://community.schemewiki.org/?sicp-ex-2.65</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">union-set-l2t</span> set1 set2<span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set1<span style="color: #a9a1e1;">)</span> set2<span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set2<span style="color: #a9a1e1;">)</span> set1<span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list-&gt;tree <span style="color: #51afef;">(</span>union-set <span style="color: #c678dd;">(</span>tree-&gt;list set1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>tree-&gt;list set2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">intersection-set-l2t</span> set1 set2<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set1<span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set2<span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list-&gt;tree <span style="color: #51afef;">(</span>intersection-set <span style="color: #c678dd;">(</span>tree-&gt;list set1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>tree-&gt;list set2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">27: </span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-2sets</span> max<span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>a-start <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">30: </span>         <span style="color: #a9a1e1;">(</span>a-end <span style="color: #dd8844; font-weight: bold;">0.6</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>         <span style="color: #a9a1e1;">(</span>b-start <span style="color: #dd8844; font-weight: bold;">0.4</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">32: </span>         <span style="color: #a9a1e1;">(</span>b-end <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">33: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>list-&gt;tree
<span class="linenr">34: </span>           <span style="color: #51afef;">(</span>enumerate-interval
<span class="linenr">35: </span>            <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">36: </span>            <span style="color: #c678dd;">(</span>inexact-&gt;exact <span style="color: #99bb66;">(</span>* a-end max<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">37: </span>          <span style="color: #a9a1e1;">(</span>list-&gt;tree
<span class="linenr">38: </span>           <span style="color: #51afef;">(</span>enumerate-interval
<span class="linenr">39: </span>            <span style="color: #c678dd;">(</span>inexact-&gt;exact <span style="color: #99bb66;">(</span>* b-start max<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">40: </span>            <span style="color: #c678dd;">(</span>inexact-&gt;exact <span style="color: #99bb66;">(</span>* b-end max<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">41: </span>
<span class="linenr">42: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">test-with</span> 2sets repeats<span style="color: #c678dd;">)</span>
<span class="linenr">43: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-set-tree-wrong2: ~a"</span>
<span class="linenr">44: </span>          <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2
<span class="linenr">45: </span>                 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()(</span>union-set-tree-wrong2
<span class="linenr">46: </span>                      <span style="color: #99bb66;">(</span>car 2sets<span style="color: #99bb66;">)</span>
<span class="linenr">47: </span>                      <span style="color: #99bb66;">(</span>cdr 2sets<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">48: </span>                 repeats<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">49: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;union-set-l2t: ~a"</span>
<span class="linenr">50: </span>          <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2
<span class="linenr">51: </span>                 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()(</span>union-set-l2t <span style="color: #99bb66;">(</span>car 2sets<span style="color: #99bb66;">)</span>
<span class="linenr">52: </span>                                    <span style="color: #99bb66;">(</span>cdr 2sets<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">53: </span>                 repeats<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">54: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;intersection-set-tree-wrong1: ~a"</span>
<span class="linenr">55: </span>          <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2
<span class="linenr">56: </span>                 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()(</span>intersection-set-tree-wrong1
<span class="linenr">57: </span>                      <span style="color: #99bb66;">(</span>car 2sets<span style="color: #99bb66;">)</span>
<span class="linenr">58: </span>                      <span style="color: #99bb66;">(</span>cdr 2sets<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">59: </span>                 repeats<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">60: </span>  <span style="color: #c678dd;">(</span>format #t <span style="color: #99bb66;">"~&amp;intersection-set-l2t: ~a"</span>
<span class="linenr">61: </span>          <span style="color: #99bb66;">(</span>cadr <span style="color: #a9a1e1;">(</span>mattbench2
<span class="linenr">62: </span>                 <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">()(</span>intersection-set-l2t <span style="color: #99bb66;">(</span>car 2sets<span style="color: #99bb66;">)</span>
<span class="linenr">63: </span>                                           <span style="color: #99bb66;">(</span>cdr 2sets<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">64: </span>                 repeats<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">65: </span><span style="color: #51afef;">(</span>format #t <span style="color: #99bb66;">"~&amp;~a"</span> <span style="color: #c678dd;">(</span>make-2sets <span style="color: #dd8844; font-weight: bold;">10</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">66: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">base-repeats</span> <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>
<span class="linenr">67: </span><span style="color: #51afef;">(</span>test-with <span style="color: #c678dd;">(</span>make-2sets <span style="color: #dd8844; font-weight: bold;">100</span><span style="color: #c678dd;">)</span>
<span class="linenr">68: </span>           base-repeats<span style="color: #51afef;">)</span>
<span class="linenr">69: </span><span style="color: #51afef;">(</span>test-with <span style="color: #c678dd;">(</span>make-2sets <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #c678dd;">)</span>
<span class="linenr">70: </span>           <span style="color: #c678dd;">(</span>/ base-repeats <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">71: </span><span style="color: #51afef;">(</span>test-with <span style="color: #c678dd;">(</span>make-2sets <span style="color: #dd8844; font-weight: bold;">10000</span><span style="color: #c678dd;">)</span>
<span class="linenr">72: </span>           <span style="color: #c678dd;">(</span>/ base-repeats <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orge3aea51">
union-set-tree-wrong2: 159831.3273
union-set-l2t: 49633.5962
intersection-set-tree-wrong1: 42577.4905
intersection-set-l2t: 33261.5268
union-set-tree-wrong2: 12648028.8732
union-set-l2t: 2196015.1536
intersection-set-tree-wrong1: 3165935.4476
intersection-set-l2t: 2015603.052
union-set-tree-wrong2: 1393227860.116
union-set-l2t: 195546567.7616
intersection-set-tree-wrong1: 361923468.7844
intersection-set-l2t: 195366120.9524
</pre>


<div id="org1820e59" class="figure">
<p><img src="2/fig/2-65.png" alt="2-65.png" />
</p>
</div>

<p>
Not really enough datapoints, but you can at least see that the <code>l2t</code> variants
are faster.
</p>
</div>
</div>
</div>

<div id="outline-container-org0558a3d" class="outline-3">
<h3 id="org0558a3d"><span class="section-number-3">3.75.</span> Exercise 2.66: binary tree <code>lookup</code></h3>
<div class="outline-text-3" id="text-3-75">
</div>

<div id="outline-container-org5705fcb" class="outline-4">
<h4 id="org5705fcb"><span class="section-number-4">3.75.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-75-1">
<p>
Implement the <code class="src src-scheme">lookup</code> procedure for the case where the set of records
is structured as a binary tree, ordered by the numerical values of the keys.
</p>
</div>
</div>

<div id="outline-container-orgfaea506" class="outline-4">
<h4 id="orgfaea506"><span class="section-number-4">3.75.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-75-2">
<p>
First let&rsquo;s define what these records look like.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org5ad93ab"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-record</span> key value<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span>cons key value<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">key</span> record<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>car record<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">value</span> record<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>cdr record<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgba38a8f"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;make-tree&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;make-record&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">lookup</span> given-key tree-of-records<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? tree-of-records<span style="color: #a9a1e1;">)</span> #f<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= given-key
<span class="linenr"> 6: </span>            <span style="color: #51afef;">(</span>key <span style="color: #c678dd;">(</span>entry tree-of-records<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>         <span style="color: #a9a1e1;">(</span>entry tree-of-records<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; given-key
<span class="linenr"> 9: </span>            <span style="color: #51afef;">(</span>key <span style="color: #c678dd;">(</span>entry tree-of-records<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span>lookup
<span class="linenr">11: </span>          given-key 
<span class="linenr">12: </span>          <span style="color: #51afef;">(</span>left-branch tree-of-records<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; given-key
<span class="linenr">14: </span>            <span style="color: #51afef;">(</span>key <span style="color: #c678dd;">(</span>entry tree-of-records<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>         <span style="color: #a9a1e1;">(</span>lookup
<span class="linenr">16: </span>          given-key 
<span class="linenr">17: </span>          <span style="color: #51afef;">(</span>right-branch tree-of-records<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;lookup-tree&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;list-to-tree&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>set1 <span style="color: #a9a1e1;">(</span>list-&gt;tree
<span class="linenr"> 6: </span>             <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>make-record <span style="color: #dd8844; font-weight: bold;">1</span> 'a<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>                   <span style="color: #c678dd;">(</span>make-record <span style="color: #dd8844; font-weight: bold;">3</span> 'b<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>                   <span style="color: #c678dd;">(</span>make-record <span style="color: #dd8844; font-weight: bold;">5</span> 'c<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>                   <span style="color: #c678dd;">(</span>make-record <span style="color: #dd8844; font-weight: bold;">7</span> 'd<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>                   <span style="color: #c678dd;">(</span>make-record <span style="color: #dd8844; font-weight: bold;">9</span> 'e<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                   <span style="color: #c678dd;">(</span>make-record <span style="color: #dd8844; font-weight: bold;">11</span> 'f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"lookup retrieves correct record"</span>
<span class="linenr">13: </span>             <span style="color: #99bb66;">(</span>lookup <span style="color: #dd8844; font-weight: bold;">9</span> set1<span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>             <span style="color: #99bb66;">(</span>make-record <span style="color: #dd8844; font-weight: bold;">9</span> 'e<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org5c250d7">
SUCCEED at lookup retrieves correct record
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ed18d3" class="outline-3">
<h3 id="org8ed18d3"><span class="section-number-3">3.76.</span> Exercise 2.67: decoding Huffman tree messages</h3>
<div class="outline-text-3" id="text-3-76">
</div>

<div id="outline-container-org0e53b04" class="outline-4">
<h4 id="org0e53b04"><span class="section-number-4">3.76.1.</span> Text definitions</h4>
<div class="outline-text-4" id="text-3-76-1">
<div class="org-src-container">
<pre class="src src-scheme" id="org2e7b14d"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">huffman-trees-txt</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-leaf</span> symbol weight<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>list 'leaf
<span class="linenr"> 4: </span>        symbol
<span class="linenr"> 5: </span>        weight<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">leaf?</span> object<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>eq? <span style="color: #99bb66;">(</span>car object<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       'leaf<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">symbol-leaf</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>cadr x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">weight-leaf</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>caddr x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-code-tree</span> left right<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>list left
<span class="linenr">16: </span>        right
<span class="linenr">17: </span>        <span style="color: #99bb66;">(</span>append <span style="color: #a9a1e1;">(</span>symbols left<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>symbols right<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>        <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>weight left<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>weight right<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">left-branch</span>  tree<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #c678dd;">(</span>car tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">right-branch</span> tree<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span>cadr tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">symbols</span> tree<span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>leaf? tree<span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>      <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>symbol-leaf tree<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>      <span style="color: #99bb66;">(</span>caddr tree<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">weight</span> tree<span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>leaf? tree<span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>      <span style="color: #99bb66;">(</span>weight-leaf tree<span style="color: #99bb66;">)</span>
<span class="linenr">31: </span>      <span style="color: #99bb66;">(</span>cadddr tree<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">32: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">decode</span> bits tree<span style="color: #c678dd;">)</span>
<span class="linenr">33: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">decode-1</span> bits current-branch<span style="color: #99bb66;">)</span>
<span class="linenr">34: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? bits<span style="color: #a9a1e1;">)</span>
<span class="linenr">35: </span>        '<span style="color: #a9a1e1;">()</span>
<span class="linenr">36: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>next-branch
<span class="linenr">37: </span>               <span style="color: #99bb66;">(</span>choose-branch <span style="color: #a9a1e1;">(</span>car bits<span style="color: #a9a1e1;">)</span> current-branch<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">38: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>leaf? next-branch<span style="color: #c678dd;">)</span>
<span class="linenr">39: </span>              <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>symbol-leaf next-branch<span style="color: #99bb66;">)</span>
<span class="linenr">40: </span>                    <span style="color: #99bb66;">(</span>decode-1 <span style="color: #a9a1e1;">(</span>cdr bits<span style="color: #a9a1e1;">)</span> tree<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">41: </span>              <span style="color: #c678dd;">(</span>decode-1 <span style="color: #99bb66;">(</span>cdr bits<span style="color: #99bb66;">)</span> next-branch<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">42: </span>  <span style="color: #c678dd;">(</span>decode-1 bits tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">43: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">choose-branch</span> bit branch<span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= bit <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>left-branch branch<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">45: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>= bit <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>right-branch branch<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">46: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"bad bit: CHOOSE-BRANCH"</span> bit<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">47: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-set</span> x set<span style="color: #c678dd;">)</span>
<span class="linenr">48: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>list x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">49: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; <span style="color: #51afef;">(</span>weight x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>weight <span style="color: #c678dd;">(</span>car set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cons x set<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">50: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>car set<span style="color: #51afef;">)</span>
<span class="linenr">51: </span>                    <span style="color: #51afef;">(</span>adjoin-set x <span style="color: #c678dd;">(</span>cdr set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">52: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-leaf-set</span> pairs<span style="color: #c678dd;">)</span>
<span class="linenr">53: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? pairs<span style="color: #99bb66;">)</span>
<span class="linenr">54: </span>      '<span style="color: #99bb66;">()</span>
<span class="linenr">55: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>pair <span style="color: #c678dd;">(</span>car pairs<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">56: </span>        <span style="color: #a9a1e1;">(</span>adjoin-set <span style="color: #51afef;">(</span>make-leaf <span style="color: #c678dd;">(</span>car pair<span style="color: #c678dd;">)</span>
<span class="linenr">57: </span>                               <span style="color: #c678dd;">(</span>cadr pair<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">58: </span>                    <span style="color: #51afef;">(</span>make-leaf-set <span style="color: #c678dd;">(</span>cdr pairs<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3c4ec8" class="outline-4">
<h4 id="orgf3c4ec8"><span class="section-number-4">3.76.2.</span> Question</h4>
<div class="outline-text-4" id="text-3-76-2">
<p>
Define an encoding tree and a sample message. Use the <code class="src src-scheme">decode</code>
procedure to decode the message, and give the result.
</p>
</div>
</div>

<div id="outline-container-org6c77772" class="outline-4">
<h4 id="org6c77772"><span class="section-number-4">3.76.3.</span> Answer</h4>
<div class="outline-text-4" id="text-3-76-3">
<div class="org-src-container">
<pre class="src src-scheme" id="orgd9f0f5f"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;huffman-trees-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">sample-tree</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>make-code-tree <span style="color: #99bb66;">(</span>make-leaf 'A <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>                  <span style="color: #99bb66;">(</span>make-code-tree
<span class="linenr"> 6: </span>                   <span style="color: #a9a1e1;">(</span>make-leaf 'B <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>                   <span style="color: #a9a1e1;">(</span>make-code-tree
<span class="linenr"> 8: </span>                    <span style="color: #51afef;">(</span>make-leaf 'D <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>                    <span style="color: #51afef;">(</span>make-leaf 'C <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">whos-on-first-tree</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>make-code-tree
<span class="linenr">12: </span>   <span style="color: #99bb66;">(</span>make-leaf 'who <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                  <span style="color: #99bb66;">(</span>make-code-tree
<span class="linenr">14: </span>                   <span style="color: #a9a1e1;">(</span>make-leaf 'what <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>                   <span style="color: #a9a1e1;">(</span>make-code-tree
<span class="linenr">16: </span>                    <span style="color: #51afef;">(</span>make-leaf 'Idontknow <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>                    <span style="color: #51afef;">(</span>make-leaf 'why <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">sample-message</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">whos-on-first-message</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>echo <span style="color: #c678dd;">(</span>decode sample-message sample-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>echo <span style="color: #c678dd;">(</span>decode whos-on-first-message whos-on-first-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org83a1854">
(A D A B B C A) 
(who what Idontknow why) 
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b28c20" class="outline-3">
<h3 id="org5b28c20"><span class="section-number-3">3.77.</span> Exercise 2.68: encoding Huffman tree messages</h3>
<div class="outline-text-3" id="text-3-77">
</div>

<div id="outline-container-orgee20f31" class="outline-4">
<h4 id="orgee20f31"><span class="section-number-4">3.77.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-77-1">
<p>
The <code class="src src-scheme">encode</code> procedure takes as arguments a message and a tree and
produces the list of bits that gives the encoded message.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org0936ed5"><span class="linenr">1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">encode-txt</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">encode</span> message tree<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? message<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>      '<span style="color: #99bb66;">()</span>
<span class="linenr">5: </span>      <span style="color: #99bb66;">(</span>append <span style="color: #a9a1e1;">(</span>encode-symbol <span style="color: #51afef;">(</span>car message<span style="color: #51afef;">)</span> tree<span style="color: #a9a1e1;">)</span>
<span class="linenr">6: </span>              <span style="color: #a9a1e1;">(</span>encode <span style="color: #51afef;">(</span>cdr message<span style="color: #51afef;">)</span> tree<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code class="src src-scheme">encode-symbol</code> is a procedure, which you must write, that returns the
list of bits that encodes a given symbol according to a given tree. You should
design <code class="src src-scheme">encode-symbol</code> so that it signals an error if the symbol is
not in the tree at all. Test your procedure by encoding the result you obtained
in Exercise 2.67 with the sample tree and seeing whether it is the same as the
original sample message.
</p>
</div>
</div>

<div id="outline-container-org599fd1e" class="outline-4">
<h4 id="org599fd1e"><span class="section-number-4">3.77.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-77-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org1834792"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">encode-symbol</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">element-of-set?</span> member<span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">encode-symbol</span> symbol tree<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> t<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>leaf? t<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>                <span style="color: #c678dd;">(</span>eq? <span style="color: #99bb66;">(</span>symbol-leaf t<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>                     symbol<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>           '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>element-of-set? symbol
<span class="linenr">10: </span>                            <span style="color: #c678dd;">(</span>symbols <span style="color: #99bb66;">(</span>left-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">12: </span>                 <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>left-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>element-of-set? symbol
<span class="linenr">14: </span>                            <span style="color: #c678dd;">(</span>symbols <span style="color: #99bb66;">(</span>right-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span>
<span class="linenr">16: </span>                 <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>right-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"encode-symbol: logic error"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>element-of-set? symbol <span style="color: #a9a1e1;">(</span>symbols tree<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>      <span style="color: #99bb66;">(</span>rec tree<span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"encode-symbol: symbol not in tree"</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org79aae93"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;huffman-trees-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;encode-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;encode-symbol&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">sample-tree</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>make-code-tree <span style="color: #99bb66;">(</span>make-leaf 'A <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>                  <span style="color: #99bb66;">(</span>make-code-tree
<span class="linenr"> 8: </span>                   <span style="color: #a9a1e1;">(</span>make-leaf 'B <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>                   <span style="color: #a9a1e1;">(</span>make-code-tree
<span class="linenr">10: </span>                    <span style="color: #51afef;">(</span>make-leaf 'D <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                    <span style="color: #51afef;">(</span>make-leaf 'C <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">whos-on-first-tree</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>make-code-tree
<span class="linenr">14: </span>   <span style="color: #99bb66;">(</span>make-leaf 'who <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                  <span style="color: #99bb66;">(</span>make-code-tree
<span class="linenr">16: </span>                   <span style="color: #a9a1e1;">(</span>make-leaf 'what <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>                   <span style="color: #a9a1e1;">(</span>make-code-tree
<span class="linenr">18: </span>                    <span style="color: #51afef;">(</span>make-leaf 'Idontknow <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>                    <span style="color: #51afef;">(</span>make-leaf 'why <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">sample-message</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">whos-on-first-message</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"sample encoded message"</span>
<span class="linenr">23: </span>           sample-message
<span class="linenr">24: </span>           <span style="color: #c678dd;">(</span>encode '<span style="color: #99bb66;">(</span>A D A B B C A<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>                   sample-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">26: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"who's on first encoded message"</span>
<span class="linenr">27: </span>           whos-on-first-message
<span class="linenr">28: </span>           <span style="color: #c678dd;">(</span>encode '<span style="color: #99bb66;">(</span>who what Idontknow why<span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>                   whos-on-first-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org31a0080">
SUCCEED at sample encoded message
SUCCEED at who's on first encoded message
</pre>
</div>
</div>
</div>

<div id="outline-container-org36d6254" class="outline-3">
<h3 id="org36d6254"><span class="section-number-3">3.78.</span> Exercise 2.69: Generating Huffman trees</h3>
<div class="outline-text-3" id="text-3-78">
</div>

<div id="outline-container-orgb948896" class="outline-4">
<h4 id="orgb948896"><span class="section-number-4">3.78.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-78-1">
<p>
The following procedure takes as its argument a list of symbol-frequency pairs
(where no symbol appears in more than one pair) and generates a Huffman encoding
tree according to the Huffman algorithm.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">generate-huffman-tree</span> pairs<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>successive-merge <span style="color: #99bb66;">(</span>make-leaf-set pairs<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code class="src src-scheme">make-leaf-set</code> is the procedure given above that transforms the list
of pairs into an ordered set of leaves. <code class="src src-scheme">successive-merge</code> is the
procedure you must write, using <code class="src src-scheme">make-code-tree</code> to successively merge
the smallest-weight elements of the set until there is only one element left,
which is the desired Huffman tree. (This procedure is slightly tricky, but not
really complicated. If you find yourself designing a complex procedure, then you
are almost certainly doing something wrong. You can take significant advantage
of the fact that we are using an ordered set representation.)
</p>
</div>
</div>

<div id="outline-container-orgd3c0078" class="outline-4">
<h4 id="orgd3c0078"><span class="section-number-4">3.78.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-78-2">
<p>
This one took a while. The whole in-place-reorganization of the list seems
tricky, since adding branches together makes a new branch which is higher value
than the later entries. In a C language I&rsquo;d be solving the problem by &ldquo;moving&rdquo; a
play-head forward and back, but here I&rsquo;ll have to coerce the evaluator into
doing it.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org7c7eaef"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">generate-huffman-tree</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">element-of-set?</span> member<span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">generate-huffman-tree</span> pairs<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>successive-merge <span style="color: #99bb66;">(</span>make-leaf-set pairs<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">successivemerge-iter</span> delayed leaves<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>dl <span style="color: #51afef;">(</span>length delayed<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span>ll <span style="color: #51afef;">(</span>length leaves<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= ll <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>           <span style="color: #51afef;">(</span>successivemerge-iter '<span style="color: #c678dd;">()</span>
<span class="linenr">12: </span>                                 delayed<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= dl <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= ll <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>               <span style="color: #c678dd;">(</span>car leaves<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>               <span style="color: #c678dd;">(</span>successivemerge-iter <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>car leaves<span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>                                     <span style="color: #99bb66;">(</span>cdr leaves<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>= ll <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>                <span style="color: #c678dd;">(</span>= dl <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span>           <span style="color: #51afef;">(</span>make-code-tree <span style="color: #c678dd;">(</span>car delayed<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>                           <span style="color: #c678dd;">(</span>car leaves<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&lt;= <span style="color: #c678dd;">(</span>weight <span style="color: #99bb66;">(</span>car delayed<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>               <span style="color: #c678dd;">(</span>weight <span style="color: #99bb66;">(</span>car leaves<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span>           <span style="color: #51afef;">(</span>successivemerge-iter <span style="color: #c678dd;">(</span>cdr delayed<span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>                                 <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>make-code-tree <span style="color: #a9a1e1;">(</span>car delayed<span style="color: #a9a1e1;">)</span>
<span class="linenr">26: </span>                                                       <span style="color: #a9a1e1;">(</span>car leaves<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>                                       <span style="color: #99bb66;">(</span>cdr leaves<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&gt; <span style="color: #c678dd;">(</span>weight <span style="color: #99bb66;">(</span>car delayed<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>              <span style="color: #c678dd;">(</span>weight <span style="color: #99bb66;">(</span>car leaves<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">30: </span>           <span style="color: #51afef;">(</span>successivemerge-iter <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>car leaves<span style="color: #99bb66;">)</span>
<span class="linenr">31: </span>                                       delayed<span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>                                 <span style="color: #c678dd;">(</span>cdr leaves<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">33: </span>
<span class="linenr">34: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">successive-merge</span> leaves<span style="color: #c678dd;">)</span>
<span class="linenr">35: </span>    <span style="color: #c678dd;">(</span>successivemerge-iter <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>car leaves<span style="color: #a9a1e1;">)</span> '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
<span class="linenr">36: </span>                          <span style="color: #99bb66;">(</span>cdr leaves<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org46d520c"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;huffman-trees-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;encode-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;encode-symbol&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;generate-huffman-tree&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>pairs
<span class="linenr"> 9: </span>       <span style="color: #a9a1e1;">(</span>make-leaf-set '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>A <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #c678dd;">)(</span>B <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)(</span>C <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)(</span>D <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>                        <span style="color: #c678dd;">(</span>E <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)(</span>F <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)(</span>G <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)(</span>H <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>      <span style="color: #99bb66;">(</span>answer
<span class="linenr">12: </span>       <span style="color: #a9a1e1;">(</span>make-code-tree <span style="color: #51afef;">(</span>make-leaf 'A <span style="color: #dd8844; font-weight: bold;">8</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                       <span style="color: #51afef;">(</span>make-code-tree
<span class="linenr">14: </span>                        <span style="color: #c678dd;">(</span>make-code-tree
<span class="linenr">15: </span>                         <span style="color: #99bb66;">(</span>make-leaf 'B <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>                         <span style="color: #99bb66;">(</span>make-code-tree
<span class="linenr">17: </span>                          <span style="color: #a9a1e1;">(</span>make-leaf 'C <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>                          <span style="color: #a9a1e1;">(</span>make-leaf 'D <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>                        <span style="color: #c678dd;">(</span>make-code-tree
<span class="linenr">20: </span>                         <span style="color: #99bb66;">(</span>make-code-tree
<span class="linenr">21: </span>                          <span style="color: #a9a1e1;">(</span>make-leaf 'E <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>                          <span style="color: #a9a1e1;">(</span>make-leaf 'F <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>                         <span style="color: #99bb66;">(</span>make-code-tree
<span class="linenr">24: </span>                          <span style="color: #a9a1e1;">(</span>make-leaf 'G <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">25: </span>                          <span style="color: #a9a1e1;">(</span>make-leaf 'H <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"successive-merge"</span>
<span class="linenr">27: </span>             <span style="color: #99bb66;">(</span>successive-merge pairs<span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>             answer<span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">(</span>successive-merge pairs<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org9721aef">
FAIL at successive-merge
expected: ((leaf A 8) (((leaf B 3) ((leaf C 1) (leaf D 1) (C D) 2) (B C D) 5) (# …) …) …)
returned: (((((leaf H 1) (leaf G 1) (H G) 2) ((leaf F 1) (leaf E 1) (F E) 2) (…) …) …) …)
(((((leaf H 1) (leaf G 1) (H G) 2) ((leaf F 1) (leaf E 1) (F E) 2) (H G F E) 4)
  (((leaf D 1) (leaf C 1) (D C) 2) (leaf B 3) (D C B) 5) (H G F E D C B) 9)
    (leaf A 8) (H G F E D C B A) 17) 
</pre>

<p>
And the tree is <i>backwards</i>. But it is correct. \begin{tiny}Sigh.\end{tiny}
</p>

<p>
Time to be embarrassed by the internet&rsquo;s solution.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgedcd80f"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">see 2.67</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-set</span> x set<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>null? set<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>list x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; <span style="color: #51afef;">(</span>weight x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>weight <span style="color: #c678dd;">(</span>car set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>         <span style="color: #a9a1e1;">(</span>cons x set<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>car set<span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>                    <span style="color: #51afef;">(</span>adjoin-set x <span style="color: #c678dd;">(</span>cdr set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #525252;">;; </span><span style="color: #525252;">for my own edification</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-set-iter</span> x set<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> less more<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? more<span style="color: #51afef;">)</span>
<span class="linenr">12: </span>           <span style="color: #51afef;">(</span>reverse <span style="color: #c678dd;">(</span>cons x less<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&lt; <span style="color: #c678dd;">(</span>weight x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>weight <span style="color: #99bb66;">(</span>car more<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>           <span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span>reverse <span style="color: #99bb66;">(</span>cons x less<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                   more<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>adjoin-set-iter <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>car more<span style="color: #99bb66;">)</span> less<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                                 <span style="color: #c678dd;">(</span>cdr more<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>iter '<span style="color: #99bb66;">()</span> set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #525252;">;; </span><span style="color: #525252;">https://codereview.stackexchange.com/a/117980</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">successive-merge-small</span> leaves<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>cdr leaves<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>      <span style="color: #99bb66;">(</span>car leaves<span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>      <span style="color: #99bb66;">(</span>successive-merge-small
<span class="linenr">26: </span>       <span style="color: #a9a1e1;">(</span>adjoin-set
<span class="linenr">27: </span>        <span style="color: #51afef;">(</span>make-code-tree <span style="color: #c678dd;">(</span>car leaves<span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>                        <span style="color: #c678dd;">(</span>cadr leaves<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">29: </span>        <span style="color: #51afef;">(</span>cddr leaves<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Comparing my above code with the code for <code class="src src-scheme">adjoin-set</code>, mine is
definitely unnecessarily complicated. How does the performance stack up?
</p>

<pre class="example" id="org40dbabd">
Mine: 4453.0773347
Theirs: 4554.0141235
</pre>

<p>
So for all that unnecessary complexity it&rsquo;s still about the same.
</p>

<p>
The lesson I keep failing to learn is remembering past work (i.e.
<code class="src src-scheme">adjoin-set</code>), since this book loves to integrate past exercises.
</p>
</div>
</div>
</div>

<div id="outline-container-org6b19201" class="outline-3">
<h3 id="org6b19201"><span class="section-number-3">3.79.</span> Exercise 2.70: encoding 1950s rock songs</h3>
<div class="outline-text-3" id="text-3-79">
</div>

<div id="outline-container-org0f8c057" class="outline-4">
<h4 id="org0f8c057"><span class="section-number-4">3.79.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-79-1">
<p>
The following eight-symbol alphabet with associated relative frequencies was
designed to efficiently encode the lyrics of 1950s rock songs. (Note that the
“symbols” of an “alphabet” need not be individual letters.)
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-right">2</td>
<td class="org-left">NA</td>
<td class="org-right">16</td>
</tr>

<tr>
<td class="org-left">BOOM</td>
<td class="org-right">1</td>
<td class="org-left">SHA</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">GET</td>
<td class="org-right">2</td>
<td class="org-left">YIP</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-left">JOB</td>
<td class="org-right">2</td>
<td class="org-left">WAH</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>

<p>
Use <code class="src src-scheme">generate-huffman-tree</code> to generate a corresponding Huffman tree,
and use <code class="src src-scheme">encode</code> to encode the following message:
</p>

<pre class="example" id="orgdeec876">
Get a job
Sha na na na na na na na na

Get a job
Sha na na na na na na na na

Wah yip yip yip yip 
yip yip yip yip yip
Sha boom
</pre>

<p>
How many bits are required for the encoding? What is the smallest number of bits
that would be needed to encode this song if we used a fixed-length code for the
eight-symbol alphabet?
</p>
</div>
</div>

<div id="outline-container-org06c2875" class="outline-4">
<h4 id="org06c2875"><span class="section-number-4">3.79.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-79-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org2c7bee9"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">hippie-set</span>
<span class="linenr"> 2: </span>  '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>NA <span style="color: #dd8844; font-weight: bold;">16</span><span style="color: #99bb66;">)(</span>YIP <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #99bb66;">)(</span>SHA <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)(</span>A <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span>GET <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span>JOB <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span>BOOM <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span>WAH <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">hippie-tree</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>generate-huffman-tree hippie-set<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">hippie-plaintext</span>
<span class="linenr"> 7: </span>  '<span style="color: #c678dd;">(</span>GET A JOB
<span class="linenr"> 8: </span>    SHA NA NA NA NA NA NA NA NA
<span class="linenr"> 9: </span>    GET A JOB
<span class="linenr">10: </span>    SHA NA NA NA NA NA NA NA NA
<span class="linenr">11: </span>    WAH YIP YIP YIP YIP
<span class="linenr">12: </span>    YIP YIP YIP YIP YIP
<span class="linenr">13: </span>    SHA BOOM<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">hippie-encoded</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span>encode hippie-plaintext
<span class="linenr">16: </span>          hippie-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org97bc154"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;huffman-trees-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;encode-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;encode-symbol&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;generate-huffman-tree&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">successive-merge</span> leaves<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>cdr leaves<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span>car leaves<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>successive-merge
<span class="linenr"> 9: </span>       <span style="color: #a9a1e1;">(</span>adjoin-set
<span class="linenr">10: </span>        <span style="color: #51afef;">(</span>make-code-tree <span style="color: #c678dd;">(</span>car leaves<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                        <span style="color: #c678dd;">(</span>cadr leaves<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>        <span style="color: #51afef;">(</span>cddr leaves<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;hippie-trees&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"Length of unencoded message is"</span> <span style="color: #c678dd;">(</span>length hippie-plaintext<span style="color: #c678dd;">)</span> <span style="color: #99bb66;">"words."</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"Length of encoded message is"</span> <span style="color: #c678dd;">(</span>length hippie-encoded<span style="color: #c678dd;">)</span> <span style="color: #99bb66;">"bits"</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"Unencoded message (newlines added):"</span> <span style="color: #c678dd;">(</span>decode hippie-encoded hippie-tree<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgffaec2f">
Length of unencoded message is 36 words. 
Length of encoded message is 84 bits 
Unencoded message (newlines added):
(GET A JOB
SHA NA NA NA NA NA NA NA NA
GET A JOB SHA NA NA NA NA NA NA NA NA
WAH YIP YIP YIP YIP
YIP YIP YIP YIP YIP
SHA BOOM) 
</pre>

<p>
A fixed-length alphabet would take 3 bits per word, or 108 bits. So the VLE is
77% the size of anything else.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgea600b0"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;huffman-trees-txt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;encode-txt&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;encode-symbol&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;generate-huffman-tree&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">successive-merge</span> leaves<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>cdr leaves<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span>car leaves<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>successive-merge
<span class="linenr"> 9: </span>       <span style="color: #a9a1e1;">(</span>adjoin-set
<span class="linenr">10: </span>        <span style="color: #51afef;">(</span>make-code-tree <span style="color: #c678dd;">(</span>car leaves<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                        <span style="color: #c678dd;">(</span>cadr leaves<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>        <span style="color: #51afef;">(</span>cddr leaves<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;hippie-trees&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">split-list-every-x</span> list x<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> ll<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&lt; <span style="color: #51afef;">(</span>length ll<span style="color: #51afef;">)</span> x<span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>        <span style="color: #a9a1e1;">(</span>cons ll '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>        <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>list-head ll x<span style="color: #51afef;">)</span>
<span class="linenr">19: </span>              <span style="color: #51afef;">(</span>rec <span style="color: #c678dd;">(</span>list-tail ll x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>rec list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>split-list-every-x hippie-encoded <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>



<div id="orgea9362f" class="figure">
<p><img src="2/fig/2-70.png" alt="2-70.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org496dad8" class="outline-3">
<h3 id="org496dad8"><span class="section-number-3">3.80.</span> Exercise 2.71</h3>
<div class="outline-text-3" id="text-3-80">
</div>

<div id="outline-container-orgcea1061" class="outline-4">
<h4 id="orgcea1061"><span class="section-number-4">3.80.1.</span> Questions</h4>
<div class="outline-text-4" id="text-3-80-1">
<p>
Suppose we have a Huffman tree for an alphabet of \(n\) symbols, and that the
relative frequencies of the symbols are \(1, 2, 4, \dots, 2^{n-1}\). Sketch the
tree for \(n=5\); for \(n=10\). In such a tree (for general \(n\)) how many bits
are required to encode the most frequent symbol? The least frequent symbol?
</p>
</div>
</div>

<div id="outline-container-orgf5744bd" class="outline-4">
<h4 id="orgf5744bd"><span class="section-number-4">3.80.2.</span> Answers</h4>
<div class="outline-text-4" id="text-3-80-2">
<p>
In this type of tree, the most frequent symbol takes 1 bit. The \(n\)th symbol
takes \(n\) bits. If it&rsquo;s the least frequent symbol and \(n\) is even, it takes
\(n-1\) bits.
</p>
</div>
</div>
</div>

<div id="outline-container-org687b5e1" class="outline-3">
<h3 id="org687b5e1"><span class="section-number-3">3.81.</span> Exercise 2.72: order of growth of <code>encode</code></h3>
<div class="outline-text-3" id="text-3-81">
<p>
Let&rsquo;s take a look at <code class="src src-scheme">encode-symbol</code>. 
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">encode-symbol</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">encode-symbol</span> symbol tree<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rec</span> t<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">rec is O(log n)</span>
<span class="linenr"> 4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>leaf? t<span style="color: #c678dd;">)</span> 
<span class="linenr"> 5: </span>                <span style="color: #c678dd;">(</span>eq? <span style="color: #99bb66;">(</span>symbol-leaf t<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>                     symbol<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">O(1)</span>
<span class="linenr"> 7: </span>           '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>element-of-set? symbol <span style="color: #525252;">; </span><span style="color: #525252;">O(symbols of left-branch)</span>
<span class="linenr"> 9: </span>                            <span style="color: #c678dd;">(</span>symbols <span style="color: #99bb66;">(</span>left-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #525252;">;; </span><span style="color: #525252;">O(1)</span>
<span class="linenr">11: </span>                 <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>left-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">rec is O(log symbols)</span>
<span class="linenr">12: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>element-of-set? symbol <span style="color: #525252;">; </span><span style="color: #525252;">O(symbols of right-branch)</span>
<span class="linenr">13: </span>                            <span style="color: #c678dd;">(</span>symbols <span style="color: #99bb66;">(</span>right-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #525252;">;; </span><span style="color: #525252;">O(1)</span>
<span class="linenr">15: </span>                 <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>right-branch t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">rec is O(log symbols)</span>
<span class="linenr">16: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"encode-symbol: logic error"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>element-of-set? symbol <span style="color: #a9a1e1;">(</span>symbols tree<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">O(symbols)</span>
<span class="linenr">18: </span>      <span style="color: #99bb66;">(</span>rec tree<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">rec is O(log n)</span>
<span class="linenr">19: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"encode-symbol: symbol not in tree"</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I&rsquo;m not expecting to get a correct answer,but here&rsquo;s what I&rsquo;m able to derive.
<code class="src src-scheme">encode-symbol</code> uses binary search to find the symbol, which is
\(\Theta(\log{n})\). However, at each step it needs to perform a \(\Theta(n)\)
search of the left branch. If the symbol isn&rsquo;t found, it will execute a
\(\Theta(n)\) search of the right branch. So these searches have a varying cost
depending on if the tree is biased to the left or the right. So in the worst
case of being right-biased, the searches will incur an order of \(\Theta(n2)\),
while doing the overall binary search of \(\Theta(\log{n})\). So I think this
simplifies to \(\Theta(n \log{n})\). Time to check my answer&#x2026;
</p>

<p>
While I see a couple answers<sup><a id="fnr.6" class="footref" href="#fn.6" role="doc-backlink">6</a></sup> agreeing with mine, I see more saying that
<code>encode-symbol</code> is \(\Theta(1)\) for the most frequent symbol, and \(\Theta(n)\)
for the average case. Some also say<sup><a id="fnr.7" class="footref" href="#fn.7" role="doc-backlink">7</a></sup> that in the worst case (the least
frequent symbol), you may have to visit every non-leaf node for a complexity of
\(\Theta(n^2)\).
</p>
</div>
</div>

<div id="outline-container-orgf2c6518" class="outline-3">
<h3 id="orgf2c6518"><span class="section-number-3">3.82.</span> 2.4: Multiple Representations for Abstract Data</h3>
<div class="outline-text-3" id="text-3-82">
<p>
We have learned how to abstract &ldquo;higher&rdquo; and &ldquo;lower&rdquo; parts of a system. Now we
will talk about having multiple simultaneous representations of data in the same
system. This could be considered &ldquo;side-by-side&rdquo; abstraction. The authors tout
the 
</p>

<p>
To allow programmers to add and remove representations at will without modifying
the original code, the authors suggest using a table lookup system to keep track
of representations and their related methods. For example:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Operations</th>
<th scope="col" class="org-left">Polar Type</th>
<th scope="col" class="org-left">Rectangular Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">real-part</td>
<td class="org-left">real-part-polar</td>
<td class="org-left">real-part-rectangular</td>
</tr>

<tr>
<td class="org-left">imag-part</td>
<td class="org-left">imag-part-polar</td>
<td class="org-left">imag-part-rectangular</td>
</tr>

<tr>
<td class="org-left">magnitude</td>
<td class="org-left">magnitude-polar</td>
<td class="org-left">magnitude-rectangular</td>
</tr>

<tr>
<td class="org-left">angle</td>
<td class="org-left">angle-polar</td>
<td class="org-left">angle-rectangular</td>
</tr>
</tbody>
</table>

<dl class="org-dl">
<dt>data-directed programming</dt><dd>designing programs to organize their behaviors
by a table of operations like the one above.</dd>
<dt>principle of least commitment</dt><dd>abstracting a system so it can work with</dd>
</dl>
<p>
many possible representations of data without being rewritten.
</p>

<p>
The book introduces two methods, <code class="src src-scheme"><span style="color: #51afef;">(</span>put 'operation 'type lambda<span style="color: #51afef;">)</span></code> to
add such a method to the table, and <code class="src src-scheme"><span style="color: #51afef;">(</span>get 'operation 'type<span style="color: #51afef;">)</span></code> to fetch
the saved lambda. I&rsquo;ll use Guile&rsquo;s native <a href="https://www.gnu.org/software/guile/manual/html_node/Hash-Table-Reference.html">hash tables</a><sup><a id="fnr.8" class="footref" href="#fn.8" role="doc-backlink">8</a></sup>
to implement this.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org38b3b86"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">op-table</span> <span style="color: #c678dd;">(</span>make-hash-table<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">put</span> operation type f<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>hash-set! op-table <span style="color: #99bb66;">(</span>cons operation type<span style="color: #99bb66;">)</span> f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">get</span> operation type<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>hash-ref op-table <span style="color: #99bb66;">(</span>cons operation type<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">basic test of lambda storage</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>put 'A 'X <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()</span>'AX<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>put 'B 'Y <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()</span>'BY<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span>put 'C 'Z <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">()</span>'CZ<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>echo <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'A 'X<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>      <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'B 'Y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>      <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'C 'Z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org021c201">
AX BY CZ 
</pre>

<p>
One method to distinguish these types of items is called <b>type tagging</b>. Take this code as an example:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org06ed0de"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">attach-tag</span> type-tag contents<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>cons type-tag contents<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">type-tag</span> datum<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>pair? datum<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">(</span>car datum<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Bad tagged datum: </span>
<span class="linenr"> 8: </span><span style="color: #99bb66;">              TYPE-TAG"</span> datum<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">contents</span> datum<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>pair? datum<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>      <span style="color: #99bb66;">(</span>cdr datum<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Bad tagged datum: </span>
<span class="linenr">14: </span><span style="color: #99bb66;">              CONTENTS"</span> datum<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge735143" class="outline-3">
<h3 id="orge735143"><span class="section-number-3">3.83.</span> Exercise 2.73: Data-driven symbolic differentiator</h3>
<div class="outline-text-3" id="text-3-83">
<p>
<a href="#org39d83e7">2.3.2: Example: Symbolic differentiator</a> described a program that performs
symbolic differentiation:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>sum? exp<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>         <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>addend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>                   <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>augend exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>product? exp<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>         <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>make-product
<span class="linenr">10: </span>                    <span style="color: #c678dd;">(</span>multiplier exp<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>                    <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplicand exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>                   <span style="color: #51afef;">(</span>make-product
<span class="linenr">13: </span>                    <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>multiplier exp<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                    <span style="color: #c678dd;">(</span>multiplicand exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>        <span style="color: #525252;">;; </span><span style="color: #525252;">more rules can be added here</span>
<span class="linenr">16: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"unknown expression type:</span>
<span class="linenr">17: </span><span style="color: #99bb66;">                      DERIV"</span> exp<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
We can regard this program as performing a dispatch on the type of the
expression to be differentiated. In this situation the &rsquo;&rsquo;type tag&rsquo;&rsquo; of the datum
is the algebraic operator symbol (such as <code class="src src-scheme">+</code>) and the operation being
performed is <code class="src src-scheme">deriv</code>. We can transform this program into data-directed
style by rewriting the basic derivative procedure as
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'deriv <span style="color: #c678dd;">(</span>operator exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span>               <span style="color: #51afef;">(</span>operands exp<span style="color: #51afef;">)</span> var<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">operator</span> exp<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">operands</span> exp<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>

<div id="outline-container-org3ddd59c" class="outline-4">
<h4 id="org3ddd59c"><span class="section-number-4">3.83.1.</span> Question A</h4>
<div class="outline-text-4" id="text-3-83-1">
<p>
Explain what was done above. Why can&rsquo;t we assimilate the predicates
<code class="src src-scheme">number?</code> and <code class="src src-scheme">variable?</code> into the data-directed dispatch?
</p>
</div>
</div>

<div id="outline-container-orgf2aa731" class="outline-4">
<h4 id="orgf2aa731"><span class="section-number-4">3.83.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-3-83-2">
<p>
This rewrite removes the predicate-based tests for sums, products, etc,
replacing them with the <code class="src src-scheme">get</code>-based lookup system explained earlier.
</p>

<p>
The call to <code>get</code> requires using the <code>operator</code> procedures on <code>exp</code>, which would
fail on a single-item <code>exp</code>. So it is necessary to handle the number and
variable checks before calling <code>deriv</code>.
</p>
</div>
</div>

<div id="outline-container-orgd487c2b" class="outline-4">
<h4 id="orgd487c2b"><span class="section-number-4">3.83.3.</span> Questions B and C</h4>
<div class="outline-text-4" id="text-3-83-3">
<ul class="org-ul">
<li>Write the procedures for derivatives of sums and products, and the auxiliary
code required to install them in the table used by the program above.</li>
<li>Choose any additional differentiation rule that you like, such as the one for
exponents (<a href="#org793b4e3">Exercise 2.56: Differentiating exponentiation</a>), and install it in
this data-directed system.</li>
</ul>
</div>
</div>

<div id="outline-container-org2a70602" class="outline-4">
<h4 id="org2a70602"><span class="section-number-4">3.83.4.</span> Answer B &amp; C version 1</h4>
<div class="outline-text-4" id="text-3-83-4">
<p>
Here&rsquo;s my first solution, which is functional, but not at all idiomatic like the textbook&rsquo;s examples of such a system.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org3c34ca5"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">operator</span> exp<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">operands</span> exp<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #525252;">;; </span><span style="color: #525252;">old ^^ vv new</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'deriv <span style="color: #c678dd;">(</span>operator exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>               <span style="color: #51afef;">(</span>operands exp<span style="color: #51afef;">)</span> var<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #525252;">;; </span><span style="color: #525252;">vv old</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">addend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">these and similar procedures</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;; </span><span style="color: #525252;">modified for 2-item lists of operands</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplier</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">multiplicand</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sum</span> a1 a2<span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a2<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? a2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> a1<span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? a1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? a2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>         <span style="color: #a9a1e1;">(</span>+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '+ a1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=number?</span> exp num<span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>number? exp<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>= exp num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-product</span> m1 m2<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m2<span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> m1<span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? m1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? m2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '* m1 m2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">31: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">base</span> e<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car e<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">32: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">exponent</span> e<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cadr e<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">33: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-exponentiation</span> b e<span style="color: #c678dd;">)</span>
<span class="linenr">34: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? b <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? e <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">36: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>=number? e <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> b<span style="color: #99bb66;">)</span>
<span class="linenr">37: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>number? b<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>number? e<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>expt b e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>list '** b e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">39: </span><span style="color: #525252;">;; </span><span style="color: #525252;">new table-entered functions</span>
<span class="linenr">40: </span><span style="color: #51afef;">(</span>put 'deriv '+
<span class="linenr">41: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>ops var<span style="color: #99bb66;">)</span>
<span class="linenr">42: </span>       <span style="color: #99bb66;">(</span>make-sum <span style="color: #a9a1e1;">(</span>deriv <span style="color: #51afef;">(</span>addend ops<span style="color: #51afef;">)</span> var<span style="color: #a9a1e1;">)</span>
<span class="linenr">43: </span>                 <span style="color: #a9a1e1;">(</span>deriv <span style="color: #51afef;">(</span>augend ops<span style="color: #51afef;">)</span> var<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">44: </span><span style="color: #51afef;">(</span>put 'deriv '*
<span class="linenr">45: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>ops var<span style="color: #99bb66;">)</span>
<span class="linenr">46: </span>       <span style="color: #99bb66;">(</span>make-sum <span style="color: #a9a1e1;">(</span>make-product
<span class="linenr">47: </span>                  <span style="color: #51afef;">(</span>multiplier ops<span style="color: #51afef;">)</span>
<span class="linenr">48: </span>                  <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>multiplicand ops<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">49: </span>                 <span style="color: #a9a1e1;">(</span>make-product
<span class="linenr">50: </span>                  <span style="color: #51afef;">(</span>deriv <span style="color: #c678dd;">(</span>multiplier ops<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
<span class="linenr">51: </span>                  <span style="color: #51afef;">(</span>multiplicand ops<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">52: </span><span style="color: #51afef;">(</span>put 'deriv '**
<span class="linenr">53: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>ops var<span style="color: #99bb66;">)</span>
<span class="linenr">54: </span>         <span style="color: #99bb66;">(</span>make-product  
<span class="linenr">55: </span>          <span style="color: #a9a1e1;">(</span>make-product  
<span class="linenr">56: </span>           <span style="color: #51afef;">(</span>exponent ops<span style="color: #51afef;">)</span> 
<span class="linenr">57: </span>           <span style="color: #51afef;">(</span>make-exponentiation <span style="color: #c678dd;">(</span>base ops<span style="color: #c678dd;">)</span> 
<span class="linenr">58: </span>                                <span style="color: #c678dd;">(</span>make-sum <span style="color: #99bb66;">(</span>exponent ops<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>                                                                                               
<span class="linenr">59: </span>          <span style="color: #a9a1e1;">(</span>deriv <span style="color: #51afef;">(</span>base ops<span style="color: #51afef;">)</span> var<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;deriv-datadriven&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>* x y<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           'y<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: exponentiation 1"</span>
           <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>make-exponentiation 'a <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> 'a<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #99bb66;">(</span>** a <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: exponentiation 2"</span>
           <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>make-exponentiation 'a 'b<span style="color: #99bb66;">)</span> 'a<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>* b <span style="color: #99bb66;">(</span>** a <span style="color: #a9a1e1;">(</span>+ b <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgd9795d7">
SUCCEED at deriv: basic addition
SUCCEED at deriv: basic multiplication
SUCCEED at deriv: exponentiation 1
SUCCEED at deriv: exponentiation 2
</pre>
</div>
</div>

<div id="outline-container-org5405a0d" class="outline-4">
<h4 id="org5405a0d"><span class="section-number-4">3.83.5.</span> Answer B &amp; C version 2</h4>
<div class="outline-text-4" id="text-3-83-5">
<div class="org-src-container">
<pre class="src src-scheme" id="orgb8a95ca"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">deriv</span> exp var<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>symbol? x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>variable? v1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable? v2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>eq? v1 v2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">operator</span> exp<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>type-tag exp<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">use type tags</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">operands</span> exp<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>contents exp<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>variable? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>same-variable? exp var<span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'deriv <span style="color: #c678dd;">(</span>operator exp<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>               <span style="color: #51afef;">(</span>operands exp<span style="color: #51afef;">)</span> var<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-deriv-package</span> choice<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #525252;">;;</span><span style="color: #525252;">shared procedures</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">=number?</span> exp num<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>number? exp<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= exp num<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-sum</span> a1 a2<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>=number? a1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> a2<span style="color: #a9a1e1;">)</span>
<span class="linenr">19: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>=number? a2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> a1<span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>number? a1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>number? a2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>           <span style="color: #51afef;">(</span>+ a1 a2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>attach-tag '+ <span style="color: #c678dd;">(</span>list a1 a2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-product</span> m1 m2<span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">25: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>=number? m1 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> m2<span style="color: #a9a1e1;">)</span>
<span class="linenr">26: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>=number? m2 <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> m1<span style="color: #a9a1e1;">)</span>
<span class="linenr">27: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>number? m1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>number? m2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>* m1 m2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>attach-tag '* <span style="color: #c678dd;">(</span>list m1 m2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-exponentiation</span> b e<span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>=number? b <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>=number? e <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">32: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>=number? e <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> b<span style="color: #a9a1e1;">)</span>
<span class="linenr">33: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>number? b<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>number? e<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>expt b e<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">34: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>attach-tag '** <span style="color: #c678dd;">(</span>list b e<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">35: </span>
<span class="linenr">36: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">packages</span>
<span class="linenr">37: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">install-sum-package</span><span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">addend</span> s<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>car s<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">39: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">augend</span> s<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cadr s<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">40: </span>    <span style="color: #99bb66;">(</span>put 'deriv '+
<span class="linenr">41: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>ops var<span style="color: #51afef;">)</span>
<span class="linenr">42: </span>           <span style="color: #51afef;">(</span>make-sum <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>addend ops<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span>
<span class="linenr">43: </span>                     <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>augend ops<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>
<span class="linenr">45: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">install-mult-package</span><span style="color: #99bb66;">)</span>
<span class="linenr">46: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">multiplier</span> p<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>car p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">47: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">multiplicand</span> p<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cadr p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">48: </span>    <span style="color: #99bb66;">(</span>put 'deriv '*
<span class="linenr">49: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>ops var<span style="color: #51afef;">)</span>
<span class="linenr">50: </span>           <span style="color: #51afef;">(</span>make-sum <span style="color: #c678dd;">(</span>make-product
<span class="linenr">51: </span>                      <span style="color: #99bb66;">(</span>multiplier ops<span style="color: #99bb66;">)</span>
<span class="linenr">52: </span>                      <span style="color: #99bb66;">(</span>deriv <span style="color: #a9a1e1;">(</span>multiplicand ops<span style="color: #a9a1e1;">)</span> var<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">53: </span>                     <span style="color: #c678dd;">(</span>make-product
<span class="linenr">54: </span>                      <span style="color: #99bb66;">(</span>deriv <span style="color: #a9a1e1;">(</span>multiplier ops<span style="color: #a9a1e1;">)</span> var<span style="color: #99bb66;">)</span>
<span class="linenr">55: </span>                      <span style="color: #99bb66;">(</span>multiplicand ops<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">56: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">install-exp-package</span><span style="color: #99bb66;">)</span>
<span class="linenr">57: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">base</span> e<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>car e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">58: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">exponent</span> e<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cadr e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">59: </span>    <span style="color: #99bb66;">(</span>put 'deriv '**
<span class="linenr">60: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>ops var<span style="color: #51afef;">)</span>
<span class="linenr">61: </span>           <span style="color: #51afef;">(</span>make-product  
<span class="linenr">62: </span>            <span style="color: #c678dd;">(</span>make-product  
<span class="linenr">63: </span>             <span style="color: #99bb66;">(</span>exponent ops<span style="color: #99bb66;">)</span> 
<span class="linenr">64: </span>             <span style="color: #99bb66;">(</span>make-exponentiation <span style="color: #a9a1e1;">(</span>base ops<span style="color: #a9a1e1;">)</span> 
<span class="linenr">65: </span>                                  <span style="color: #a9a1e1;">(</span>make-sum <span style="color: #51afef;">(</span>exponent ops<span style="color: #51afef;">)</span>
<span class="linenr">66: </span>                                            <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">67: </span>            <span style="color: #c678dd;">(</span>deriv <span style="color: #99bb66;">(</span>base ops<span style="color: #99bb66;">)</span> var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">68: </span>
<span class="linenr">69: </span>  <span style="color: #525252;">;;</span><span style="color: #525252;">body</span>
<span class="linenr">70: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>eqv? choice 'sum<span style="color: #a9a1e1;">)</span>
<span class="linenr">71: </span>         <span style="color: #a9a1e1;">(</span>install-sum-package<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">72: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>eqv? choice 'mult<span style="color: #a9a1e1;">)</span>
<span class="linenr">73: </span>         <span style="color: #a9a1e1;">(</span>install-mult-package<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">74: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>eqv? choice 'exp<span style="color: #a9a1e1;">)</span>
<span class="linenr">75: </span>         <span style="color: #a9a1e1;">(</span>install-exp-package<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;type-tagging&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;deriv-datadriven2&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>install-deriv-package 'sum<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>install-deriv-package 'mult<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>install-deriv-package 'exp<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic addition"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>+ x <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: basic multiplication"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>* x y<span style="color: #99bb66;">)</span> 'x<span style="color: #c678dd;">)</span>
           'y<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: exponentiation 1"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>** a <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> 'a<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">no more external access</span>
           '<span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #99bb66;">(</span>** a <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"deriv: exponentiation 2"</span>
           <span style="color: #c678dd;">(</span>deriv '<span style="color: #99bb66;">(</span>** a b<span style="color: #99bb66;">)</span> 'a<span style="color: #c678dd;">)</span>
           '<span style="color: #c678dd;">(</span>* b <span style="color: #99bb66;">(</span>** a <span style="color: #a9a1e1;">(</span>+ b <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org3334ca2">
SUCCEED at deriv: basic addition
SUCCEED at deriv: basic multiplication
SUCCEED at deriv: exponentiation 1
SUCCEED at deriv: exponentiation 2
</pre>

<p>
It&rsquo;s notable that Scheme doesn&rsquo;t let you access the sub-definitions inside
definitions, so I had to change my tests above. It makes me miss the dot
notation that future languages would use for accessing children of objects. It
also makes debugging processes less informative, not showing entries in the
<code class="src src-scheme">,trace foo</code> system call.
</p>
</div>
</div>

<div id="outline-container-org98c6437" class="outline-4">
<h4 id="org98c6437"><span class="section-number-4">3.83.6.</span> Question D</h4>
<div class="outline-text-4" id="text-3-83-6">
<p>
In this simple algebraic manipulator the type of an expression is the algebraic
operator that binds it together. Suppose, however, we indexed the procedures in
the opposite way, so that the dispatch line in <code class="src src-scheme">deriv</code> looked like
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>get <span style="color: #99bb66;">(</span>operator exp<span style="color: #99bb66;">)</span> 'deriv<span style="color: #c678dd;">)</span>
 <span style="color: #c678dd;">(</span>operands exp<span style="color: #c678dd;">)</span> var<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
What corresponding changes to the derivative system are required?
</p>
</div>
</div>

<div id="outline-container-org37272dc" class="outline-4">
<h4 id="org37272dc"><span class="section-number-4">3.83.7.</span> Answer D</h4>
<div class="outline-text-4" id="text-3-83-7">
<p>
Besides the change given in the example above, all the <code class="src src-scheme">put</code> calls would need their arguments switched.
</p>
</div>
</div>
</div>

<div id="outline-container-org351a867" class="outline-3">
<h3 id="org351a867"><span class="section-number-3">3.84.</span> Exercise 2.74: Multi-division record storage</h3>
<div class="outline-text-3" id="text-3-84">
</div>

<div id="outline-container-org30b353d" class="outline-4">
<h4 id="org30b353d"><span class="section-number-4">3.84.1.</span> Questions ABC</h4>
<div class="outline-text-4" id="text-3-84-1">
<p>
Insatiable Enterprises, Inc., is a highly decentralized conglomerate company
consisting of a large number of independent divisions located all over the
world. The company&rsquo;s computer facilities have just been interconnected by means
of a clever network-interfacing scheme that makes the entire network appear to
any user to be a single computer. Insatiable&rsquo;s president, in her first attempt
to exploit the ability of the network to extract administrative information from
division files, is dismayed to discover that, although all the division files
have been implemented as data structures in Scheme, the particular data
structure used varies from division to division. A meeting of division managers
is hastily called to search for a strategy to integrate the files that will
satisfy headquarters&rsquo; needs while preserving the existing autonomy of the
divisions.
</p>

<p>
Show how such a strategy can be implemented with data-directed programming. As
an example, suppose that each division&rsquo;s personnel records consist of a single
file, which contains a set of records keyed on employees&rsquo; names. The structure
of the set varies from division to division. Furthermore, each employee&rsquo;s record
is itself a set (structured differently from division to division) that contains
information keyed under identifiers such as <code class="src src-scheme">address</code> and
<code class="src src-scheme">salary</code>. In particular:
</p>

<ol class="org-ol">
<li>Implement for headquarters a <code class="src src-scheme">get-record</code> procedure that retrieves
a specified employee&rsquo;s record from a specified personnel file. The procedure
should be applicable to any division&rsquo;s file. Explain how the individual
divisions&rsquo; files should be structured. In particular, what type information
must be supplied?</li>

<li>Implement for headquarters a <code class="src src-scheme">get-salary</code> procedure that returns
the salary information from a given employee&rsquo;s record from any division&rsquo;s
personnel file. How should the record be structured in order to make this
operation work?</li>

<li>Implement for headquarters a <code class="src src-scheme">find-employee-record</code> procedure. This
should search all the divisions&rsquo; files for the record of a given employee and
return the record. Assume that this procedure takes as arguments an
employee&rsquo;s name and a list of all the divisions&rsquo; files.</li>
</ol>
</div>
</div>

<div id="outline-container-org066b786" class="outline-4">
<h4 id="org066b786"><span class="section-number-4">3.84.2.</span> Answers ABC</h4>
<div class="outline-text-4" id="text-3-84-2">
<p>
Let&rsquo;s talk assumptions:
</p>
<ul class="org-ul">
<li>Assume every division has one file</li>
<li>Assume HQ wants a consistent schema returned</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme" id="orgcab7f28"><span class="linenr">  1: </span><span style="color: #ECBE7B;">&lt;&lt;make-tree&gt;&gt;</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;make-record&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find</span> x ll<span style="color: #c678dd;">)</span>
<span class="linenr">  5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">iter</span> ll<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">aka SRFI-1 'find'</span>
<span class="linenr">  6: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? ll<span style="color: #51afef;">)</span>
<span class="linenr">  7: </span>           #f<span style="color: #a9a1e1;">)</span>
<span class="linenr">  8: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>equal? id <span style="color: #c678dd;">(</span>employee-id-east <span style="color: #99bb66;">(</span>car ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  9: </span>           <span style="color: #51afef;">(</span>car ll<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 10: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>cdr ll<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 11: </span>  <span style="color: #c678dd;">(</span>iter ll<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 12: </span>
<span class="linenr"> 13: </span><span style="color: #525252;">;; </span><span style="color: #525252;">East: records as named cdr aliases</span>
<span class="linenr"> 14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-east-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-employee-east</span> id salary<span style="color: #99bb66;">)</span>
<span class="linenr"> 16: </span>    <span style="color: #99bb66;">(</span>cons id <span style="color: #a9a1e1;">(</span>/ salary <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">East keeps salary in thousands</span>
<span class="linenr"> 17: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">employee-id-east</span> record<span style="color: #99bb66;">)</span>
<span class="linenr"> 18: </span>    <span style="color: #99bb66;">(</span>car record<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 19: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">employee-salary-east</span> record<span style="color: #99bb66;">)</span>
<span class="linenr"> 20: </span>    <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>cdr record<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 21: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">East-Employee-List</span>
<span class="linenr"> 22: </span>    <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>make-employee-east <span style="color: #dd8844; font-weight: bold;">101</span> <span style="color: #dd8844; font-weight: bold;">37000</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">bob</span>
<span class="linenr"> 23: </span>          <span style="color: #a9a1e1;">(</span>make-employee-east <span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">48000</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">linda</span>
<span class="linenr"> 24: </span>          <span style="color: #a9a1e1;">(</span>make-employee-east <span style="color: #dd8844; font-weight: bold;">103</span> <span style="color: #dd8844; font-weight: bold;">29000</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">john</span>
<span class="linenr"> 25: </span>          <span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 26: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">find-employee-east</span> id<span style="color: #99bb66;">)</span>
<span class="linenr"> 27: </span>    <span style="color: #99bb66;">(</span>find id East-Employee-List<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 28: </span>  <span style="color: #c678dd;">(</span>put 'employee-record 'East
<span class="linenr"> 29: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>id<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 30: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>e <span style="color: #99bb66;">(</span>find-employee-east id<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> e
<span class="linenr"> 32: </span>               <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list 'id id<span style="color: #99bb66;">)</span>
<span class="linenr"> 33: </span>                     <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>employee-salary-east e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 34: </span>               #f<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 35: </span>  <span style="color: #c678dd;">(</span>put 'employee-salary 'East
<span class="linenr"> 36: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>id<span style="color: #a9a1e1;">)</span> 
<span class="linenr"> 37: </span>         <span style="color: #a9a1e1;">(</span>employee-salary-east <span style="color: #51afef;">(</span>find-employee-east id<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 38: </span>
<span class="linenr"> 39: </span><span style="color: #525252;">;; </span><span style="color: #525252;">records as lookup trees (Ex 2.66)</span>
<span class="linenr"> 40: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-west-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 41: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">maketree</span> . args<span style="color: #99bb66;">)</span>
<span class="linenr"> 42: </span>    <span style="color: #99bb66;">(</span>apply list-&gt;tree args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 43: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-employee-west</span> id name salary<span style="color: #99bb66;">)</span>
<span class="linenr"> 44: </span>    <span style="color: #99bb66;">(</span>make-record 'id
<span class="linenr"> 45: </span>                 <span style="color: #a9a1e1;">(</span>maketree <span style="color: #51afef;">(</span>make-record 'name name<span style="color: #51afef;">)</span>
<span class="linenr"> 46: </span>                           <span style="color: #51afef;">(</span>make-record 'salary salary<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 47: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">West-Record-File</span>
<span class="linenr"> 48: </span>    <span style="color: #99bb66;">(</span>maketree <span style="color: #a9a1e1;">(</span>make-employee-west <span style="color: #dd8844; font-weight: bold;">201</span> <span style="color: #99bb66;">"James"</span> <span style="color: #dd8844; font-weight: bold;">55000</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 49: </span>              <span style="color: #a9a1e1;">(</span>make-employee-west <span style="color: #dd8844; font-weight: bold;">202</span> <span style="color: #99bb66;">"Joy"</span> <span style="color: #dd8844; font-weight: bold;">45000</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 50: </span>              <span style="color: #a9a1e1;">(</span>make-employee-west <span style="color: #dd8844; font-weight: bold;">203</span> <span style="color: #99bb66;">"Richard"</span> <span style="color: #dd8844; font-weight: bold;">73000</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 51: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">employee-west</span> id<span style="color: #99bb66;">)</span>
<span class="linenr"> 52: </span>    <span style="color: #99bb66;">(</span>lookup id West-Record-File<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 53: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">employee-attrib-west</span> attrib record<span style="color: #99bb66;">)</span>
<span class="linenr"> 54: </span>    <span style="color: #99bb66;">(</span>lookup attrib record<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 55: </span>  <span style="color: #c678dd;">(</span>put 'employee-record 'West
<span class="linenr"> 56: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>id<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 57: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>e <span style="color: #99bb66;">(</span>employee-west id<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 58: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> e
<span class="linenr"> 59: </span>               <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list 'id id<span style="color: #99bb66;">)</span>
<span class="linenr"> 60: </span>                     <span style="color: #99bb66;">(</span>list 'name <span style="color: #a9a1e1;">(</span>employee-attrib-west 'name e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 61: </span>                     <span style="color: #99bb66;">(</span>list 'salary <span style="color: #a9a1e1;">(</span>employee-attrib-west 'salary e<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 62: </span>               #f<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 63: </span>  <span style="color: #c678dd;">(</span>put 'employee-salary 'West
<span class="linenr"> 64: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>id<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 65: </span>         <span style="color: #a9a1e1;">(</span>employee-attrib-west 'salary
<span class="linenr"> 66: </span>                               <span style="color: #51afef;">(</span>employee-west id<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 67: </span>
<span class="linenr"> 68: </span><span style="color: #525252;">;; </span><span style="color: #525252;">South: records as lambdas</span>
<span class="linenr"> 69: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-south-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 70: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-employee-south</span> id name salary<span style="color: #99bb66;">)</span>
<span class="linenr"> 71: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>value<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 72: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eqv? 'id<span style="color: #c678dd;">)</span> id<span style="color: #51afef;">)</span>
<span class="linenr"> 73: </span>            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eqv? 'name<span style="color: #c678dd;">)</span> name<span style="color: #51afef;">)</span>
<span class="linenr"> 74: </span>            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eqv? 'salary<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* <span style="color: #dd8844; font-weight: bold;">1000</span>
<span class="linenr"> 75: </span>                               <span style="color: #99bb66;">(</span>/ salary <span style="color: #dd8844; font-weight: bold;">1000</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 76: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">South-Employee-File</span>
<span class="linenr"> 77: </span>    <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>make-employee-south <span style="color: #dd8844; font-weight: bold;">301</span> <span style="color: #99bb66;">"Jacquelyn"</span> <span style="color: #dd8844; font-weight: bold;">49000</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 78: </span>          <span style="color: #a9a1e1;">(</span>make-employee-south <span style="color: #dd8844; font-weight: bold;">302</span> <span style="color: #99bb66;">"Mazie"</span> <span style="color: #dd8844; font-weight: bold;">66000</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 79: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">find-employee-south</span> id<span style="color: #99bb66;">)</span>
<span class="linenr"> 80: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">iter</span> ll<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 81: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>null? ll<span style="color: #c678dd;">)</span>
<span class="linenr"> 82: </span>             #f<span style="color: #51afef;">)</span>
<span class="linenr"> 83: </span>            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>equal? id <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>car ll<span style="color: #a9a1e1;">)</span> 'id<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 84: </span>             <span style="color: #c678dd;">(</span>car ll<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span>            <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>iter <span style="color: #99bb66;">(</span>cdr ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 86: </span>    <span style="color: #99bb66;">(</span>iter South-Employee-File<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 87: </span>  
<span class="linenr"> 88: </span>  <span style="color: #c678dd;">(</span>put 'employee-record 'West
<span class="linenr"> 89: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>id<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 90: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>e <span style="color: #99bb66;">(</span>find-employee-south id<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 91: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> e
<span class="linenr"> 92: </span>               <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list 'id id<span style="color: #99bb66;">)</span>
<span class="linenr"> 93: </span>                     <span style="color: #99bb66;">(</span>list 'name <span style="color: #a9a1e1;">(</span>e 'id<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 94: </span>                     <span style="color: #99bb66;">(</span>list 'salary <span style="color: #a9a1e1;">(</span>e 'salary<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 95: </span>               #f<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 96: </span>  <span style="color: #c678dd;">(</span>put 'employee-salary 'South
<span class="linenr"> 97: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>id<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 98: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>find-employee-west id<span style="color: #51afef;">)</span> 'salary<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 99: </span>
<span class="linenr">100: </span><span style="color: #525252;">;; </span><span style="color: #525252;">HQ record fetcher</span>
<span class="linenr">101: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">get-record</span> employee-id division<span style="color: #c678dd;">)</span>
<span class="linenr">102: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'employee-record division<span style="color: #99bb66;">)</span>
<span class="linenr">103: </span>   employee-id<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">104: </span>
<span class="linenr">105: </span><span style="color: #525252;">;; </span><span style="color: #525252;">HQ's salary fetcher</span>
<span class="linenr">106: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">get-salary</span> employee-id division<span style="color: #c678dd;">)</span>
<span class="linenr">107: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'employee-salary division<span style="color: #99bb66;">)</span>
<span class="linenr">108: </span>   employee-id<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">109: </span>
<span class="linenr">110: </span><span style="color: #525252;">;; </span><span style="color: #525252;">HQ's employee finder</span>
<span class="linenr">111: </span><span style="color: #525252;">;; </span><span style="color: #525252;">problem asks for "list of files" but since we're working with</span>
<span class="linenr">112: </span><span style="color: #525252;">;; </span><span style="color: #525252;">differently-structured files it must need the procs as well</span>
<span class="linenr">113: </span><span style="color: #525252;">;; </span><span style="color: #525252;">and there's one file per division</span>
<span class="linenr">114: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find-employee-record</span> id list-of-divisions<span style="color: #c678dd;">)</span>
<span class="linenr">115: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? list-of-divisions<span style="color: #99bb66;">)</span>
<span class="linenr">116: </span>      #f
<span class="linenr">117: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>get-record id <span style="color: #99bb66;">(</span>car list-of-divisions<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">118: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> result
<span class="linenr">119: </span>            result
<span class="linenr">120: </span>            <span style="color: #51afef;">(</span>find-employee-record <span style="color: #c678dd;">(</span>cdr list-of-divisions<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<p>
In retrospect I should have designed it so each file had a type tag for the division, methods took a file, and dispatch was made on the file&rsquo;s tag. This makes more sense in a real-world context.
</p>
</div>
</div>

<div id="outline-container-org03bd82d" class="outline-4">
<h4 id="org03bd82d"><span class="section-number-4">3.84.3.</span> Question D</h4>
<div class="outline-text-4" id="text-3-84-3">
<p>
When Insatiable takes over a new company, what changes must be made in order to
incorporate the new personnel information into the central system?
</p>
</div>
</div>

<div id="outline-container-org6935664" class="outline-4">
<h4 id="org6935664"><span class="section-number-4">3.84.4.</span> Answer D</h4>
<div class="outline-text-4" id="text-3-84-4">
<p>
The new division must provide appropriate methods for <code class="src src-scheme">get-record</code> and
<code class="src src-scheme">get-salary</code> to use.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd8f23ef" class="outline-3">
<h3 id="orgd8f23ef"><span class="section-number-3">3.85.</span> 2.4.3: Data-directed and message-passing programs</h3>
<div class="outline-text-3" id="text-3-85">
<p>
Altogether the book has introduced 3 ways to organize functions and data types:
</p>

<ol class="org-ol">
<li>Generic operations with explicit dispatch: functions which each include
<code class="src src-scheme">case</code> statements to dispatch depending on type of data provided.
Bulk of the book so far.</li>
<li>Data-directed style: given a tagged object and a desired operation, lookup
what function to call.</li>
<li>Message-passing style: package operations with their appropriate data
objects, then fetch those operations from the object.</li>
</ol>
</div>
</div>

<div id="outline-container-org33e8165" class="outline-3">
<h3 id="org33e8165"><span class="section-number-3">3.86.</span> Exercise 2.75: Message-passing styled imaginary numbers</h3>
<div class="outline-text-3" id="text-3-86">
</div>

<div id="outline-container-org6ccaffe" class="outline-4">
<h4 id="org6ccaffe"><span class="section-number-4">3.86.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-86-1">
<p>
Implement the constructor <code class="src src-scheme">make-from-mag-ang</code> in message-passing
style. This procedure should be analogous to the <code class="src src-scheme">make-from-real-imag</code>
procedure given above.
</p>
</div>
</div>

<div id="outline-container-org94df1e6" class="outline-4">
<h4 id="org94df1e6"><span class="section-number-4">3.86.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-86-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">dispatch</span> op<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>eq? op 'magnitude<span style="color: #51afef;">)</span> r<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>eq? op 'angle<span style="color: #51afef;">)</span> a<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>eq? op 'real-part<span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>           <span style="color: #51afef;">(</span>* r <span style="color: #c678dd;">(</span>cos a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>eq? op 'imag-part<span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>           <span style="color: #51afef;">(</span>* r <span style="color: #c678dd;">(</span>sin a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"Unknown op: MAKE-FROM-MAG-ANG"</span> op<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span>  dispatch<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5eee372" class="outline-3">
<h3 id="org5eee372"><span class="section-number-3">3.87.</span> Exercise 2.76: comparing generic operation solutions</h3>
<div class="outline-text-3" id="text-3-87">
</div>

<div id="outline-container-org48e6016" class="outline-4">
<h4 id="org48e6016"><span class="section-number-4">3.87.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-87-1">
<p>
As a large system with generic operations evolves, new types of data objects or
new operations may be needed. For each of the three strategies&#x2014;generic
operations with explicit dispatch, data-directed style, and
message-passing-style&#x2014;describe the changes that must be made to a system in
order to add new types or new operations. Which organization would be most
appropriate for a system in which new types must often be added? Which would be
most appropriate for a system in which new operations must often be added?
</p>
</div>
</div>

<div id="outline-container-org5ff264e" class="outline-4">
<h4 id="org5ff264e"><span class="section-number-4">3.87.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-87-2">
<p>
The most important part of this is where code <i>doesn&rsquo;t</i> need to be changed.
</p>

<dl class="org-dl">
<dt>Generic operations with explicit dispatch</dt><dd>let you add new functions without
changing existing code.</dd>
<dt>Message-passing style</dt><dd>let you add new data types without modifying existing
code.</dd>
<dt>Data-directed table-lookups</dt><dd>let you add new data types <i>and</i> functions
without modifying existing code.</dd>
</dl>

<p>
Let&rsquo;s be clear: this does not really save you much code, only the cognitive load
imposed when you have to enter old code to modify it. Let&rsquo;s say \(T\) is how
many data types you have, \(O\) is how many desired operations you have. All of
these are \(O\times T\), the key is where the code is being stored and what it
effects.
</p>

<p>
This issue of one change requiring traveling across your code to change dozens
of definitions is described as the <a href="http://c2.com/cgi/wiki?ExpressionProblem">Expression Problem</a><sup><a id="fnr.9" class="footref" href="#fn.9" role="doc-backlink">9</a></sup>. Data-directed table lookups appear to
solve the problem, as discussed by <a href="http://community.schemewiki.org/?sicp-ex-2.76">torinmr in this Scheme wiki solution</a><sup><a id="fnr.10" class="footref" href="#fn.10" role="doc-backlink">10</a></sup>.
</p>

<blockquote>
<p>
&ldquo;Old code should not stop working when you add new code.&rdquo; -Brian Harvey
</p>
</blockquote>

<p>
Also of note is that this kind of decision-making between generic operations and
generic datatypes is commonplace in modern OO programming. I wonder what the old
heads from this time period think about OO as it stands today.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd6e126b" class="outline-3">
<h3 id="orgd6e126b"><span class="section-number-3">3.88.</span> Exercise 2.77: generic arithmetic package</h3>
<div class="outline-text-3" id="text-3-88">
</div>

<div id="outline-container-orgdadea66" class="outline-4">
<h4 id="orgdadea66"><span class="section-number-4">3.88.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-88-1">
<p>
Louis Reasoner tries to evaluate the expression <code class="src src-scheme"><span style="color: #51afef;">(</span>magnitude z<span style="color: #51afef;">)</span></code> where
<code class="src src-scheme">z</code> is the object shown in Figure 2.24. To his surprise, instead of
the answer 5 he gets an error message from <code class="src src-scheme">apply-generic</code>, saying
there is no method for the operation <code class="src src-scheme">magnitude</code> on the types
<code class="src src-scheme"><span style="color: #51afef;">(</span>complex<span style="color: #51afef;">)</span></code>. He shows this interaction to Alyssa P. Hacker, who says
&ldquo;The problem is that the complex-number selectors were never defined for
<code class="src src-scheme">complex</code> numbers, just for <code class="src src-scheme">polar</code> and
<code class="src src-scheme">rectangular</code> numbers. All you have to do to make this work is add the
following to the <code class="src src-scheme">complex</code> package&rdquo;:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>put 'real-part '<span style="color: #c678dd;">(</span>complex<span style="color: #c678dd;">)</span> real-part<span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>put 'imag-part '<span style="color: #c678dd;">(</span>complex<span style="color: #c678dd;">)</span> imag-part<span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>put 'magnitude '<span style="color: #c678dd;">(</span>complex<span style="color: #c678dd;">)</span> magnitude<span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>put 'angle '<span style="color: #c678dd;">(</span>complex<span style="color: #c678dd;">)</span> angle<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Describe in detail why this works. As an example, trace through all the
procedures called in evaluating the expression <code class="src src-scheme"><span style="color: #51afef;">(</span>magnitude z<span style="color: #51afef;">)</span></code> where
<code class="src src-scheme">z</code> is the object shown in Figure 2.24. In particular, how many times
is <code class="src src-scheme">apply-generic</code> invoked? What procedure is dispatched to in each
case?
</p>
</div>
</div>

<div id="outline-container-org37f7c65" class="outline-4">
<h4 id="org37f7c65"><span class="section-number-4">3.88.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-88-2">
<p>
Surprised to find I never actually imported <code class="src src-scheme">apply-generic</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgdd0bd4e"><span class="linenr">1: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>type-tags <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>proc <span style="color: #c678dd;">(</span>get op type-tags<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> proc
<span class="linenr">6: </span>          <span style="color: #51afef;">(</span>apply proc <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span>          <span style="color: #51afef;">(</span>error
<span class="linenr">8: </span>            <span style="color: #99bb66;">"No method for these types: APPLY-GENERIC"</span>
<span class="linenr">9: </span>            <span style="color: #c678dd;">(</span>list op type-tags<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org0b710e8"><span class="linenr">  1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>* x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'add x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'sub x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'mul x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'div x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'magnitude z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'angle z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 10: </span>
<span class="linenr"> 11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rational-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 12: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr"> 13: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">numer</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">denom</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-rat</span> n d<span style="color: #99bb66;">)</span>
<span class="linenr"> 16: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>inexact? n<span style="color: #51afef;">)</span>
<span class="linenr"> 17: </span>            <span style="color: #51afef;">(</span>inexact? d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 18: </span>        <span style="color: #a9a1e1;">(</span>cons n d<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 19: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>g <span style="color: #99bb66;">(</span>gcd n d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 20: </span>          <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>/ n g<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>/ d g<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 21: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 22: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 23: </span>                 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 24: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 25: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 26: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 27: </span>                 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 28: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 29: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 30: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 31: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 32: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 33: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 34: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 35: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr"> 36: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rational x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 37: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 38: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 39: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 40: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 41: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 42: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 43: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 44: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 45: </span>  <span style="color: #c678dd;">(</span>put 'make 'rational
<span class="linenr"> 46: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>n d<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-rat n d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 47: </span>  <span style="color: #c678dd;">(</span>put 'numer '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> numer<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">my addition</span>
<span class="linenr"> 48: </span>  <span style="color: #c678dd;">(</span>put 'denom '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> denom<span style="color: #c678dd;">)</span>
<span class="linenr"> 49: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 50: </span>
<span class="linenr"> 51: </span><span style="color: #525252;">;; </span><span style="color: #525252;">for future use</span>
<span class="linenr"> 52: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">numer</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 53: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 54: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 55: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">denom</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 56: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 57: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 58: </span>
<span class="linenr"> 59: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rational</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr"> 60: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'rational<span style="color: #99bb66;">)</span> n d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 61: </span>
<span class="linenr"> 62: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rectangular-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 63: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr"> 64: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 65: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 66: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 67: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span>
<span class="linenr"> 68: </span>    <span style="color: #99bb66;">(</span>sqrt <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 69: </span>             <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 70: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span>
<span class="linenr"> 71: </span>    <span style="color: #99bb66;">(</span>atan <span style="color: #a9a1e1;">(</span>imag-part z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>real-part z<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 72: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr"> 73: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>* r <span style="color: #51afef;">(</span>cos a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* r <span style="color: #51afef;">(</span>sin a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 74: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr"> 75: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rectangular x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 76: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr"> 77: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr"> 78: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr"> 79: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr"> 80: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'rectangular
<span class="linenr"> 81: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 82: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'rectangular
<span class="linenr"> 83: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 84: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span>
<span class="linenr"> 86: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polar-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 87: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr"> 88: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 89: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 90: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 91: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cos <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 92: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>* <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>sin <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 93: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 94: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>sqrt <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>square x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>square y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 95: </span>          <span style="color: #a9a1e1;">(</span>atan y x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 96: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr"> 97: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'polar x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 98: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr"> 99: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">100: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">101: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">102: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'polar
<span class="linenr">103: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">104: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'polar
<span class="linenr">105: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">106: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">107: </span>
<span class="linenr">108: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-complex-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">109: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">imported procedures from rectangular and polar packages</span>
<span class="linenr">110: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr">111: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-real-imag 'rectangular<span style="color: #a9a1e1;">)</span> x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">112: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr">113: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-mag-ang 'polar<span style="color: #a9a1e1;">)</span> r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">114: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">115: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">116: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">117: </span>                         <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">118: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">119: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">120: </span>                         <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">121: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">122: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">123: </span>                       <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">124: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">125: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>/ <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">126: </span>                       <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">127: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">128: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'complex z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">129: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">130: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">131: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">132: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">133: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">134: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">135: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">136: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">137: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'complex
<span class="linenr">138: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">139: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'complex
<span class="linenr">140: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">141: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">142: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">143: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">144: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">145: </span>
<span class="linenr">146: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-real-imag</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">147: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-real-imag 'complex<span style="color: #99bb66;">)</span> x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">148: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-mag-ang</span> r a<span style="color: #c678dd;">)</span>
<span class="linenr">149: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-mag-ang 'complex<span style="color: #99bb66;">)</span> r a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org1cefcf4"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-scheme-number</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'scheme-number<span style="color: #99bb66;">)</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-scheme-number-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'scheme-number x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>+ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>- x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>* x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #c678dd;">(</span>put 'make 'scheme-number <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  'done<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
First I want to do sanity checks on the system.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #ECBE7B;">&lt;&lt;type-tagging&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>

<span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
</pre>
</div>

<pre class="example" id="org6a707e5">
5+5 = (scheme-number . 10) 
5-5 = (scheme-number . 0) 
5*5 = (scheme-number . 25) 
5/5 = (scheme-number . 1) 
1/2 + 1/2 = (rational 1 . 1) 
1/2 - 1/2 = (rational 0 . 1) 
1/2 * 1/2 = (rational 1 . 4) 
1/2 / 1/2 = (rational 1 . 1) 
3+4i + 3+4i = (complex rectangular 6 . 8) 
3+4i - 3+4i = (complex rectangular 0 . 0) 
3+4i * 3+4i = (complex polar 14.0 . 1.8545904360032244) 
3+4i / 3+4i = (complex polar 1.0 . 0.0) 
3m+4deg + 3m+4deg = (complex rectangular -3.921861725181672 . -4.540814971847569) 
3m+4deg - 3m+4deg = (complex rectangular 0.0 . 0.0) 
3m+4deg * 3m+4deg = (complex polar 9 . 8) 
3m+4deg / 3m+4deg = (complex polar 1 . 0) 
</pre>

<p>
Now let&rsquo;s run this:
</p>
<div class="org-src-container">
<pre class="src src-scheme">,trace <span style="color: #51afef;">(</span>magnitude <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I&rsquo;ve heavily pared down this from the real debug output.
</p>

<pre class="example" id="org45459c7">
(make-complex-from-real-imag 3 4)
|  (get make-from-real-imag complex)
|  #&lt;procedure 1ca8ad0 at &lt;unknown port&gt;:166:4 (x y)&gt;
(_ 3 4)
|  (get make-from-real-imag rectangular)
|  #&lt;procedure 1ca87e8 at &lt;unknown port&gt;:111:4 (x y)&gt;
|  (_ 3 4)
|  (attach-tag rectangular (3 . 4))
|  (rectangular 3 . 4)
(attach-tag complex (rectangular 3 . 4))
(complex rectangular 3 . 4) &lt;- now fully tagged
(magnitude (complex rectangular 3 . 4))
(apply-generic magnitude (complex rectangular 3 . 4)) &lt;- identifying complex number
|  (map #&lt;procedure type-tag (datum)&gt; ((complex rectangular 3 . 4)))
|  (complex)
|  (get magnitude (complex))
|  #&lt;procedure magnitude (z)&gt;
|  (map #&lt;procedure contents (datum)&gt; ((complex rectangular 3 . 4)))
|  ((rectangular 3 . 4))
(_ #&lt;procedure magnitude (z)&gt; ((rectangular 3 . 4))) &lt;- identifying rectangular number
(magnitude (rectangular 3 . 4))
(apply-generic magnitude (rectangular 3 . 4))
|  (map #&lt;procedure type-tag (datum)&gt; ((rectangular 3 . 4)))
|  (rectangular)
|  (get magnitude (rectangular))
|  #&lt;procedure magnitude (z)&gt;
|  (map #&lt;procedure contents (datum)&gt; ((rectangular 3 . 4)))
|  ((3 . 4))
(_ #&lt;procedure magnitude (z)&gt; ((3 . 4)))
(magnitude (3 . 4)) &lt;- finally applying native operations
|  (square 3)
|  6
|  (square 4)
|  8
3.7416573867739413
</pre>

<p>
The procedures in <code class="src src-scheme">apply-generic 'complex</code> are only proxies to other
procedures at the moment. However they could be useful for other procedures that
should need to know very little about the <code>complex</code> package.
</p>
</div>
</div>
</div>

<div id="outline-container-orga9f2204" class="outline-3">
<h3 id="orga9f2204"><span class="section-number-3">3.89.</span> Exercise 2.78: native scheme numbers</h3>
<div class="outline-text-3" id="text-3-89">
</div>

<div id="outline-container-org6c4abc6" class="outline-4">
<h4 id="org6c4abc6"><span class="section-number-4">3.89.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-89-1">
<p>
The internal procedures in the <code class="src src-scheme">scheme-number</code> package are essentially
nothing more than calls to the primitive procedures <code class="src src-scheme">+</code>,
<code class="src src-scheme">-</code>, etc. It was not possible to use the primitives of the language
directly because our type-tag system requires that each data object have a type
attached to it. In fact, however, all Lisp implementations do have a type
system, which they use internally. Primitive predicates such as
<code class="src src-scheme">symbol?</code> and <code class="src src-scheme">number?</code> determine whether data objects have
particular types. Modify the definitions of <code class="src src-scheme">type-tag</code>,
<code class="src src-scheme">contents</code>, and <code class="src src-scheme">attach-tag</code> from 2.4.2 so that our
generic system takes advantage of Scheme&rsquo;s internal type system. That is to say,
the system should work as before except that ordinary numbers should be
represented simply as Scheme numbers rather than as pairs whose <code class="src src-scheme">car</code>
is the symbol <code class="src src-scheme">scheme-number</code>.
</p>
</div>
</div>

<div id="outline-container-org85c4f34" class="outline-4">
<h4 id="org85c4f34"><span class="section-number-4">3.89.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-89-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgee3f11c"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">attach-tag</span> type-tag contents<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>number? contents<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      contents
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>cons type-tag contents<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">type-tag</span> datum<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>pair? datum<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>         <span style="color: #a9a1e1;">(</span>car datum<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? datum<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>         'scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"Bad tagged datum: </span>
<span class="linenr">12: </span><span style="color: #99bb66;">              TYPE-TAG"</span> datum<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">contents</span> datum<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>pair? datum<span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>         <span style="color: #a9a1e1;">(</span>cdr datum<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>number? datum<span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>         datum<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"Bad tagged datum: </span>
<span class="linenr">20: </span><span style="color: #99bb66;">              CONTENTS"</span> datum<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgc7f4497"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">msn</span> make-scheme-number<span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"5+5 ="</span> <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"5-5 ="</span> <span style="color: #c678dd;">(</span>sub <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"5*5 ="</span> <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"5/5 ="</span> <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>msn <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"1/2 + 1/2 ="</span> <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>                         <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"1/2 - 1/2 ="</span> <span style="color: #c678dd;">(</span>sub <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>                         <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"1/2 * 1/2 ="</span> <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>                         <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"1/2 / 1/2 ="</span> <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                         <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>r <span style="color: #a9a1e1;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>      <span style="color: #99bb66;">(</span>p <span style="color: #a9a1e1;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3+4i + 3+4i ="</span> <span style="color: #99bb66;">(</span>add r r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3+4i - 3+4i ="</span> <span style="color: #99bb66;">(</span>sub r r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3+4i * 3+4i ="</span> <span style="color: #99bb66;">(</span>mul r r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3+4i / 3+4i ="</span> <span style="color: #99bb66;">(</span>div r r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3m+4deg + 3m+4deg ="</span> <span style="color: #99bb66;">(</span>add p p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3m+4deg - 3m+4deg ="</span> <span style="color: #99bb66;">(</span>sub p p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3m+4deg * 3m+4deg ="</span> <span style="color: #99bb66;">(</span>mul p p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span>echo <span style="color: #99bb66;">"3m+4deg / 3m+4deg ="</span> <span style="color: #99bb66;">(</span>div p p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
</pre>
</div>

<pre class="example" id="orge510383">
5+5 = 10 
5-5 = 0 
5*5 = 25 
5/5 = 1 
1/2 + 1/2 = (rational 1 . 1) 
1/2 - 1/2 = (rational 0 . 1) 
1/2 * 1/2 = (rational 1 . 4) 
1/2 / 1/2 = (rational 1 . 1) 
3+4i + 3+4i = (complex rectangular 6 . 8) 
3+4i - 3+4i = (complex rectangular 0 . 0) 
3+4i * 3+4i = (complex polar 14.0 . 1.8545904360032244) 
3+4i / 3+4i = (complex polar 1.0 . 0.0) 
3m+4deg + 3m+4deg = (complex rectangular -3.921861725181672 . -4.540814971847569) 
3m+4deg - 3m+4deg = (complex rectangular 0.0 . 0.0) 
3m+4deg * 3m+4deg = (complex polar 9 . 8) 
3m+4deg / 3m+4deg = (complex polar 1 . 0) 
</pre>

<p>
Confirmed by debugging that these calls aren&rsquo;t adding any tags.
</p>
</div>
</div>
</div>

<div id="outline-container-org5a82483" class="outline-3">
<h3 id="org5a82483"><span class="section-number-3">3.90.</span> Exercise 2.79: generic equality</h3>
<div class="outline-text-3" id="text-3-90">
</div>

<div id="outline-container-org46a5f64" class="outline-4">
<h4 id="org46a5f64"><span class="section-number-4">3.90.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-90-1">
<p>
Define a generic equality predicate <code class="src src-scheme">equ?</code> that tests the equality of
two numbers, and install it in the generic arithmetic package. This operation
should work for ordinary numbers, rational numbers, and complex numbers.
</p>
</div>
</div>

<div id="outline-container-org2e78b8f" class="outline-4">
<h4 id="org2e78b8f"><span class="section-number-4">3.90.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-90-2">
<div class="org-src-container">
<pre class="src src-scheme" id="orgf5ce522"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'equ? x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-equ?</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1 <span style="color: #99bb66;">(</span>type-tag x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>               <span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>type-tag y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? t1 'polar<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                       <span style="color: #a9a1e1;">(</span>eqv? t2 'polar<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>                    <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>= <span style="color: #51afef;">(</span>apply-generic 'magnitude x<span style="color: #51afef;">)</span>
<span class="linenr">12: </span>                            <span style="color: #51afef;">(</span>apply-generic 'magnitude y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>                         <span style="color: #a9a1e1;">(</span>= <span style="color: #51afef;">(</span>apply-generic 'angle x<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                            <span style="color: #51afef;">(</span>apply-generic 'angle y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">16: </span>                    <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>= <span style="color: #51afef;">(</span>apply-generic 'real-part x<span style="color: #51afef;">)</span>
<span class="linenr">17: </span>                            <span style="color: #51afef;">(</span>apply-generic 'real-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>                         <span style="color: #a9a1e1;">(</span>= <span style="color: #51afef;">(</span>apply-generic 'imag-part x<span style="color: #51afef;">)</span>
<span class="linenr">19: </span>                            <span style="color: #51afef;">(</span>apply-generic 'imag-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">22: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span>              <span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"basic equ? true"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"basic equ? false"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rect equ? true"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>                                  <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rect equ? false"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>                                   <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polar equ? true"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>                                   <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polar equ? false"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>                                    <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
<span class="linenr">29: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational equ? true"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>                                      <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">31: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational equ? false"</span> <span style="color: #c678dd;">(</span>equ? <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>                                       <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org028fa80">
&lt;gen-math-tests output&gt;
SUCCEED at basic equ? true
SUCCEED at basic equ? false
SUCCEED at rect equ? true
SUCCEED at rect equ? false
SUCCEED at polar equ? true
SUCCEED at polar equ? false
SUCCEED at rational equ? true
SUCCEED at rational equ? false
</pre>
</div>
</div>
</div>

<div id="outline-container-org56b3232" class="outline-3">
<h3 id="org56b3232"><span class="section-number-3">3.91.</span> Exercise 2.80: Generic testing for zero</h3>
<div class="outline-text-3" id="text-3-91">
</div>

<div id="outline-container-org2fc4a17" class="outline-4">
<h4 id="org2fc4a17"><span class="section-number-4">3.91.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-91-1">
<p>
Define a generic predicate <code class="src src-scheme">=zero?</code> that tests if its argument is
zero, and install it in the generic arithmetic package. This operation should
work for ordinary numbers, rational numbers, and complex numbers.
</p>
</div>
</div>

<div id="outline-container-org3549b5e" class="outline-4">
<h4 id="org3549b5e"><span class="section-number-4">3.91.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-91-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org32edfc8"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=zero?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic '=zero? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-=zero?</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>put '=zero? '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>put '=zero? '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>         <span style="color: #a9a1e1;">(</span>apply-generic '=zero? x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>magnitude <span style="color: #51afef;">(</span>get 'magnitude '<span style="color: #c678dd;">(</span>polar<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span>put '=zero? '<span style="color: #a9a1e1;">(</span>polar<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span>
<span class="linenr">11: </span>           <span style="color: #51afef;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span>magnitude x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>real-part <span style="color: #51afef;">(</span>get 'real-part '<span style="color: #c678dd;">(</span>rectangular<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>        <span style="color: #a9a1e1;">(</span>imag-part <span style="color: #51afef;">(</span>get 'imag-part '<span style="color: #c678dd;">(</span>rectangular<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>    <span style="color: #99bb66;">(</span>put '=zero? '<span style="color: #a9a1e1;">(</span>rectangular<span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span>
<span class="linenr">16: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #99bb66;">(</span>real-part x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #99bb66;">(</span>imag-part x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>put '=zero? '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>             <span style="color: #51afef;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"basic =zero? true"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"basic =zero? false"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rect =zero? true"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rect =zero? false"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polar =zero? true"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polar =zero? false"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
<span class="linenr">26: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational =zero? true"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational =zero? false"</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org78a8d53">
&lt;gen-math-tests output&gt;

SUCCEED at basic =zero? true
SUCCEED at basic =zero? false
SUCCEED at rect =zero? true
SUCCEED at rect =zero? false
SUCCEED at polar =zero? true
SUCCEED at polar =zero? false
SUCCEED at rational =zero? true
SUCCEED at rational =zero? false
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfe088ce" class="outline-3">
<h3 id="orgfe088ce"><span class="section-number-3">3.92.</span> 2.4.3: Combining Data of Different Types</h3>
<div class="outline-text-3" id="text-3-92">
<p>
So far, the generic type system has had all types be completely independent.
However, all of these number systems have relations between each other,
specifically they can be converted in this order:
</p>

<p>
integers \rarrow rational \rarrow real \rarrow complex
</p>

<p>
Converting types to each other is called <b><b>coercion</b></b>. With changes to
<code class="src src-scheme">apply-generic</code>, the system can automatically find compatible
coercions and use them. For example, \(\frac{1}{3}\times3\) is now possible.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org4f5dee9"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>type-tags <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>proc <span style="color: #c678dd;">(</span>get op type-tags<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> proc
<span class="linenr"> 5: </span>          <span style="color: #51afef;">(</span>apply proc <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>length args<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>type1 <span style="color: #51afef;">(</span>car type-tags<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>                    <span style="color: #a9a1e1;">(</span>type2 <span style="color: #51afef;">(</span>cadr type-tags<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>                    <span style="color: #a9a1e1;">(</span>a1 <span style="color: #51afef;">(</span>car args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                    <span style="color: #a9a1e1;">(</span>a2 <span style="color: #51afef;">(</span>cadr args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t1-&gt;t2 
<span class="linenr">12: </span>                       <span style="color: #c678dd;">(</span>get-coercion type1
<span class="linenr">13: </span>                                     type2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">14: </span>                      <span style="color: #51afef;">(</span>t2-&gt;t1 
<span class="linenr">15: </span>                       <span style="color: #c678dd;">(</span>get-coercion type2 
<span class="linenr">16: </span>                                     type1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>                  <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span>t1-&gt;t2
<span class="linenr">18: </span>                         <span style="color: #c678dd;">(</span>apply-generic 
<span class="linenr">19: </span>                          op <span style="color: #99bb66;">(</span>t1-&gt;t2 a1<span style="color: #99bb66;">)</span> a2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span>                        <span style="color: #51afef;">(</span>t2-&gt;t1
<span class="linenr">21: </span>                         <span style="color: #c678dd;">(</span>apply-generic 
<span class="linenr">22: </span>                          op a1 <span style="color: #99bb66;">(</span>t2-&gt;t1 a2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span>                        <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">24: </span>                         <span style="color: #c678dd;">(</span>error 
<span class="linenr">25: </span>                          <span style="color: #99bb66;">"No method for </span>
<span class="linenr">26: </span><span style="color: #99bb66;">                           these types"</span>
<span class="linenr">27: </span>                          <span style="color: #99bb66;">(</span>list 
<span class="linenr">28: </span>                           op 
<span class="linenr">29: </span>                           type-tags<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">30: </span>              <span style="color: #c678dd;">(</span>error 
<span class="linenr">31: </span>               <span style="color: #99bb66;">"No method for these types"</span>
<span class="linenr">32: </span>               <span style="color: #99bb66;">(</span>list op type-tags<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This assumes <code class="src src-scheme">put-coercion</code> and <code class="src src-scheme">get-coercion</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org0b659f9"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">type-table</span> <span style="color: #c678dd;">(</span>make-hash-table<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">put-coercion</span> type1 type2 f<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span>hash-set! type-table <span style="color: #99bb66;">(</span>cons type1 type2<span style="color: #99bb66;">)</span> f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">get-coercion</span> type1 type2<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>  <span style="color: #c678dd;">(</span>hash-ref type-table <span style="color: #99bb66;">(</span>cons type1 type2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Authors observe that much work in programs using object-oriented languages is
around type coercion.
</p>

<p>
To write coercion procedures between every type would require \(n^2\) routines.
However, by keeping track of the relations between types (similarly to a tree or
graph), we can find paths through multiple coercion routines at once. i.e. we
can coerce type A to type D by coercion routines A-&gt;B, B-&gt;C, and C-&gt;D.
</p>
</div>
</div>

<div id="outline-container-org8c9afc4" class="outline-3">
<h3 id="org8c9afc4"><span class="section-number-3">3.93.</span> Exercise 2.81: Louis&rsquo; <code>apply-generic</code></h3>
<div class="outline-text-3" id="text-3-93">
<p>
Louis Reasoner has noticed that <code class="src src-scheme">apply-generic</code> may try to coerce the
arguments to each other&rsquo;s type even if they already have the same type.
Therefore, he reasons, we need to put procedures in the coercion table to coerce
arguments of each type to their own type. For example, in addition to the
<code class="src src-scheme">scheme-number-&gt;complex</code> coercion shown above, he would do:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgf8c4209"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">scheme-number-&gt;scheme-number</span> n<span style="color: #c678dd;">)</span> n<span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">complex-&gt;complex</span> z<span style="color: #c678dd;">)</span> z<span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span>put-coercion 'scheme-number
<span class="linenr">4: </span>              'scheme-number
<span class="linenr">5: </span>              scheme-number-&gt;scheme-number<span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #51afef;">(</span>put-coercion 'complex 'complex complex-&gt;complex<span style="color: #51afef;">)</span>
</pre>
</div>
</div>

<div id="outline-container-org1c2e37b" class="outline-4">
<h4 id="org1c2e37b"><span class="section-number-4">3.93.1.</span> Question A</h4>
<div class="outline-text-4" id="text-3-93-1">
<p>
With Louis&rsquo;s coercion procedures installed, what happens if
<code class="src src-scheme">apply-generic</code> is called with two arguments of type
<code class="src src-scheme">scheme-number</code> or two arguments of type <code class="src src-scheme">complex</code> for an
operation that is not found in the table for those types? For example, assume
that we&rsquo;ve defined a generic exponentiation operation:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org5dbd458"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">exp</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'exp x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
and have put a procedure for exponentiation in the Scheme-number package but not
in any other package:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org2f9057f"><span class="linenr">1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">following added to Scheme-number package</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>put 'exp '<span style="color: #c678dd;">(</span>scheme-number scheme-number<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>expt x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span>     <span style="color: #525252;">; </span><span style="color: #525252;">using primitive expt</span>
</pre>
</div>

<p>
What happens if we call <code class="src src-scheme">exp</code> with two complex numbers as arguments?
</p>
</div>
</div>

<div id="outline-container-org99d8670" class="outline-4">
<h4 id="org99d8670"><span class="section-number-4">3.93.2.</span> Answer A</h4>
<div class="outline-text-4" id="text-3-93-2">
<p>
I think it will loop infinitely at the first nested <code class="src src-scheme">apply-generic</code>
call, seen in the block after <code class="src src-scheme">t1-&gt;t2</code>.
</p>
</div>
</div>

<div id="outline-container-org8a93c0f" class="outline-4">
<h4 id="org8a93c0f"><span class="section-number-4">3.93.3.</span> Question B</h4>
<div class="outline-text-4" id="text-3-93-3">
<p>
Is Louis correct that something had to be done about coercion with arguments of
the same type, or does <code class="src src-scheme">apply-generic</code> work correctly as is?
</p>
</div>
</div>

<div id="outline-container-org37fdfc1" class="outline-4">
<h4 id="org37fdfc1"><span class="section-number-4">3.93.4.</span> Answer B</h4>
<div class="outline-text-4" id="text-3-93-4">
<p>
He is correct. The predicate which determines whether type coercion is attempted is only a check to if the requested procedure exists. This is a problem if, as seen in the last problem, the data types are compatible but the operation does not exist.
</p>
</div>
</div>

<div id="outline-container-org00940bd" class="outline-4">
<h4 id="org00940bd"><span class="section-number-4">3.93.5.</span> Question C</h4>
<div class="outline-text-4" id="text-3-93-5">
<p>
Modify <code class="src src-scheme">apply-generic</code> so that it doesn&rsquo;t try coercion if the two
arguments have the same type.
</p>
</div>
</div>

<div id="outline-container-org46350cf" class="outline-4">
<h4 id="org46350cf"><span class="section-number-4">3.93.6.</span> Answer C</h4>
<div class="outline-text-4" id="text-3-93-6">
<div class="org-src-container">
<pre class="src src-scheme" id="org861f72b"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>type-tags <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>proc <span style="color: #c678dd;">(</span>get op type-tags<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> proc
<span class="linenr"> 5: </span>          <span style="color: #51afef;">(</span>apply proc <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>length args<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>type1 <span style="color: #51afef;">(</span>car type-tags<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>                    <span style="color: #a9a1e1;">(</span>type2 <span style="color: #51afef;">(</span>cadr type-tags<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>                    <span style="color: #a9a1e1;">(</span>a1 <span style="color: #51afef;">(</span>car args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>                    <span style="color: #a9a1e1;">(</span>a2 <span style="color: #51afef;">(</span>cadr args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>equal? type1 type2<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>                  <span style="color: #525252;">;      </span><span style="color: #525252;">'failgood ; proving correct operation</span>
<span class="linenr">13: </span>                        <span style="color: #a9a1e1;">(</span>error 
<span class="linenr">14: </span>                     <span style="color: #99bb66;">"No method for this type"</span>
<span class="linenr">15: </span>                     <span style="color: #51afef;">(</span>list op type-tags<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>                    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1-&gt;t2 
<span class="linenr">17: </span>                           <span style="color: #99bb66;">(</span>get-coercion type1
<span class="linenr">18: </span>                                         type2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>                          <span style="color: #c678dd;">(</span>t2-&gt;t1 
<span class="linenr">20: </span>                           <span style="color: #99bb66;">(</span>get-coercion type2 
<span class="linenr">21: </span>                                         type1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span>                      <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span>t1-&gt;t2
<span class="linenr">23: </span>                             <span style="color: #99bb66;">(</span>apply-generic 
<span class="linenr">24: </span>                              op <span style="color: #a9a1e1;">(</span>t1-&gt;t2 a1<span style="color: #a9a1e1;">)</span> a2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>                            <span style="color: #c678dd;">(</span>t2-&gt;t1
<span class="linenr">26: </span>                             <span style="color: #99bb66;">(</span>apply-generic 
<span class="linenr">27: </span>                              op a1 <span style="color: #a9a1e1;">(</span>t2-&gt;t1 a2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>                            <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">29: </span>                             <span style="color: #99bb66;">(</span>error 
<span class="linenr">30: </span>                              <span style="color: #99bb66;">"No coercion method for these types"</span>
<span class="linenr">31: </span>                              <span style="color: #a9a1e1;">(</span>list 
<span class="linenr">32: </span>                               op 
<span class="linenr">33: </span>                               type-tags<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">34: </span>              <span style="color: #c678dd;">(</span>error 
<span class="linenr">35: </span>               <span style="color: #99bb66;">"No method for these types"</span>
<span class="linenr">36: </span>               <span style="color: #99bb66;">(</span>list op type-tags<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org58a2e55"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>put-coercion 'scheme-number 'rational
<span class="linenr"> 2: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>                <span style="color: #99bb66;">(</span>make-rational num <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;eqnumber&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>put-coercion 'rational 'complex
<span class="linenr"> 6: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>                <span style="color: #99bb66;">(</span>make-complex-from-real-imag
<span class="linenr"> 8: </span>                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>=number? <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">if rat could be integer</span>
<span class="linenr"> 9: </span>                     <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>get 'numer '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> num<span style="color: #51afef;">)</span>       <span style="color: #525252;">; </span><span style="color: #525252;">might as well simplify</span>
<span class="linenr">10: </span>                     num<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span>put-coercion 'scheme-number 'complex
<span class="linenr">12: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                <span style="color: #99bb66;">(</span>make-complex-from-real-imag num <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-coerce-fixed&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">22: </span><span style="color: #ECBE7B;">&lt;&lt;basic-coercions&gt;&gt;</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"good coercion test"</span>
<span class="linenr">25: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>                <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"bad coercion test"</span>
<span class="linenr">29: </span>           <span style="color: #c678dd;">(</span>apply-generic 'foobar <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">9</span><span style="color: #c678dd;">)</span>
<span class="linenr">30: </span>           'failgood<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org2dfa5e6">
SUCCEED at good coercion test
SUCCEED at bad coercion test
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbeda1a4" class="outline-3">
<h3 id="orgbeda1a4"><span class="section-number-3">3.94.</span> Exercise 2.82: <code>apply-generic</code> with multiple coerced arguments</h3>
<div class="outline-text-3" id="text-3-94">
</div>

<div id="outline-container-org21665c5" class="outline-4">
<h4 id="org21665c5"><span class="section-number-4">3.94.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-94-1">
<p>
Show how to generalize <code class="src src-scheme">apply-generic</code> to handle coercion in the
general case of multiple arguments. One strategy is to attempt to coerce all the
arguments to the type of the first argument, then to the type of the second
argument, and so on. Give an example of a situation where this strategy (and
likewise the two-argument version given above) is not sufficiently general.
(Hint: Consider the case where there are some suitable mixed-type operations
present in the table that will not be tried.)
</p>
</div>
</div>

<div id="outline-container-org62d6ad8" class="outline-4">
<h4 id="org62d6ad8"><span class="section-number-4">3.94.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-94-2">
<p>
These strategies are not sufficient when a path to the correct type will require
multiple coercions. Say you want to coerce arguments of types \(ABCD\). There
are coercions for \( A \rightarrow B \), \( B \rightarrow C \), \( A \rightarrow
D \), \( C \rightarrow A \) but <i>not</i> \( C \rightarrow D \). If fed arguments of
types \( ABCD \), <code>apply-generic</code> will first coerce A to B, then B to C, and
then fail to find a coercion from C to D despite a path \( C \rightarrow A
\rightarrow D \) existing.
</p>

<p>
The other scenario is if there is a different type not included in the original
set which all types could convert to. For example if coercions to \(E\) exist
for all \(ABCD\), this would not be checked for.
</p>

<p>
Here&rsquo;s an implementation of the first strategy, which is a mess:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgdeb448f"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Version of apply-generic that look for coercion functions</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">that work for the entire list</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">types</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">coercions-for-list</span> ll target<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>item<span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">find coercion functions, if identical type return id func</span>
<span class="linenr"> 8: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>type <span style="color: #a9a1e1;">(</span>type-tag item<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>             <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>equal? type target<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>                 <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>x<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>                 <span style="color: #99bb66;">(</span>get-coercion type target<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>         args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">map-coercions: list of types -&gt; list of tagged numbers.</span>
<span class="linenr">14: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">find one type which all items can be coerced to,</span>
<span class="linenr">15: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">then do all coercions and return as list</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">map-coercions</span> ll<span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? ll<span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">exhausted possibilities</span>
<span class="linenr">18: </span>        <span style="color: #a9a1e1;">(</span>error
<span class="linenr">19: </span>         <span style="color: #99bb66;">"No method between all these types"</span>
<span class="linenr">20: </span>         <span style="color: #51afef;">(</span>list op types<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>tries <span style="color: #99bb66;">(</span>coercions-for-list ll <span style="color: #a9a1e1;">(</span>car ll<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>every procedure? tries<span style="color: #c678dd;">)</span><span style="color: #525252;">; </span><span style="color: #525252;">if all coercions found, apply them</span>
<span class="linenr">23: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>f x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>f x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>  
<span class="linenr">24: </span>                   tries args<span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>              <span style="color: #c678dd;">(</span>map-coercions <span style="color: #99bb66;">(</span>cdr ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">else keep trying</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>proc <span style="color: #51afef;">(</span>get op types<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> proc
<span class="linenr">28: </span>        <span style="color: #a9a1e1;">(</span>apply proc <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">29: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>coerced <span style="color: #99bb66;">(</span>map-coercions types<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">30: </span>          <span style="color: #51afef;">(</span>apply <span style="color: #c678dd;">(</span>get op <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag coerced<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents coerced<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Testing my code:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-coerce-varargs-naive&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">22: </span><span style="color: #ECBE7B;">&lt;&lt;basic-coercions&gt;&gt;</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"num -&gt; frac coercion test"</span>
<span class="linenr">25: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>                <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"num -&gt; complex coercion test"</span>
<span class="linenr">29: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>                <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgba92e94">
SUCCEED at num -&gt; frac coercion test
SUCCEED at num -&gt; complex coercion test
</pre>

<p>
The strategy I implemented was &ldquo;search the list and find one type which all
others coerce to.&rdquo; However, a superior strategy, <a href="https://github.com/danielpi/SICP-Exercises/blob/46a6b38fd83faae21db239f40d913ff24062d2e6/Racket/Ex%202.82%20Generalized%20apply-generic.rkt#L269">as implemented by danielpi on
GitHub</a><sup><a id="fnr.11" class="footref" href="#fn.11" role="doc-backlink">11</a></sup>
is to iterate through the list&rsquo;s types, attempting every coercion that works,
and leaving unmodified every number that doesn&rsquo;t have one. In a linear &ldquo;tower&rdquo;
structure, the types will raise as far as is necessary &#x2013; assuming the types are
ordered lowest-to-highest.
</p>

<p>
Here&rsquo;s my attempt at a much simplified version. 
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org223353c"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Version of apply-generic that tries to coerce each variable</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">into each type represebted in args.</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">types</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">map-coercion: type, list of tagged numbers -&gt; list of tagged numbers</span>
<span class="linenr"> 7: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">try to coerce all items in list to given type. If this isn't possible,</span>
<span class="linenr"> 8: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">leave the item alone. Meant for fold.</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">map-coercion</span> type-to-try items<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>item<span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">find and apply coercion functions,</span>
<span class="linenr">11: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>coerce <span style="color: #a9a1e1;">(</span>get-coercion <span style="color: #51afef;">(</span>type-tag item<span style="color: #51afef;">)</span> type-to-try<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>             <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>not coerce<span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                        <span style="color: #51afef;">(</span>equal? <span style="color: #c678dd;">(</span>type-tag item<span style="color: #c678dd;">)</span> type-to-try<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">14: </span>                    item<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                   <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>coerce item<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>         items<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>proc <span style="color: #51afef;">(</span>get op types<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> proc <span style="color: #525252;">; </span><span style="color: #525252;">is this already doable?</span>
<span class="linenr">20: </span>        <span style="color: #a9a1e1;">(</span>apply proc <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>        <span style="color: #525252;">; </span><span style="color: #525252;">if not, try type coercion</span>
<span class="linenr">22: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>coerced <span style="color: #99bb66;">(</span>fold map-coercion args types<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span>          <span style="color: #51afef;">(</span>apply <span style="color: #c678dd;">(</span>get op <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag coerced<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents coerced<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #525252;">;; </span><span style="color: #525252;">However this won't actually handle multiple arguments</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-coerce-less-naive&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">22: </span><span style="color: #ECBE7B;">&lt;&lt;basic-coercions&gt;&gt;</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"num -&gt; frac coercion test"</span>
<span class="linenr">25: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>                <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"num -&gt; complex coercion test"</span>
<span class="linenr">29: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>                <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">32: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"multiple arguments test"</span>
<span class="linenr">33: </span>           <span style="color: #c678dd;">(</span>false-if-exception <span style="color: #99bb66;">(</span>apply-generic 'add <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">34: </span>                                              <span style="color: #a9a1e1;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org208e846">
SUCCEED at num -&gt; frac coercion test
SUCCEED at num -&gt; complex coercion test
FAIL at multiple arguments test
expected: "boolean true"
returned: "boolean false"
</pre>
</div>
</div>

<div id="outline-container-org612b504" class="outline-4">
<h4 id="org612b504"><span class="section-number-4">3.94.3.</span> Answer with vararg support</h4>
<div class="outline-text-4" id="text-3-94-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org3d2950d"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Version of apply-generic that tries to coerce each variable</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">into each type represebted in args.</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">types</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">map-coercion: type, list of tagged numbers -&gt; list of tagged numbers</span>
<span class="linenr"> 7: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">try to coerce all items in list to given type. If this isn't possible,</span>
<span class="linenr"> 8: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">leave the item alone. Meant for fold.</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">map-coercion</span> type-to-try items<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>item<span style="color: #51afef;">)</span> <span style="color: #525252;">; </span><span style="color: #525252;">find and apply coercion functions,</span>
<span class="linenr">11: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>coerce <span style="color: #a9a1e1;">(</span>get-coercion <span style="color: #51afef;">(</span>type-tag item<span style="color: #51afef;">)</span> type-to-try<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>             <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>not coerce<span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                        <span style="color: #51afef;">(</span>equal? <span style="color: #c678dd;">(</span>type-tag item<span style="color: #c678dd;">)</span> type-to-try<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">14: </span>                    item<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                   <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>coerce item<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>         items<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>proc <span style="color: #51afef;">(</span>get op types<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> proc <span style="color: #525252;">; </span><span style="color: #525252;">is this already doable?</span>
<span class="linenr">20: </span>        <span style="color: #a9a1e1;">(</span>apply proc <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>        <span style="color: #525252;">; </span><span style="color: #525252;">if not, try type coercion</span>
<span class="linenr">22: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>coerced <span style="color: #99bb66;">(</span>fold map-coercion args types<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>&lt; <span style="color: #99bb66;">(</span>length args<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>              <span style="color: #525252;">;; </span><span style="color: #525252;">short args</span>
<span class="linenr">25: </span>              <span style="color: #c678dd;">(</span>apply <span style="color: #99bb66;">(</span>get op <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> type-tag coerced<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>                     <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> contents coerced<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>              <span style="color: #525252;">;; </span><span style="color: #525252;">long args</span>
<span class="linenr">28: </span>              <span style="color: #c678dd;">(</span>reduce <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>elem previous<span style="color: #a9a1e1;">)</span>
<span class="linenr">29: </span>                        <span style="color: #a9a1e1;">(</span>apply-generic op previous elem<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">30: </span>                      <span style="color: #99bb66;">"ERROR"</span> coerced<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-coerce-varargs&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #ECBE7B;">&lt;&lt;basic-coercions&gt;&gt;</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"multiple arguments test"</span>
<span class="linenr">24: </span>           <span style="color: #c678dd;">(</span>apply-generic 'add <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>           <span style="color: #dd8844; font-weight: bold;">13</span><span style="color: #51afef;">)</span>
<span class="linenr">26: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"multiple arguments test 2"</span>
<span class="linenr">27: </span>           <span style="color: #c678dd;">(</span>apply-generic 'add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>                          <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>                          <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">30: </span>           <span style="color: #c678dd;">(</span>cons 'complex
<span class="linenr">31: </span>                 <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr">32: </span>                       <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #dd8844; font-weight: bold;">15</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">33: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"multiple arguments coercion test"</span>
<span class="linenr">34: </span>           <span style="color: #c678dd;">(</span>false-if-exception
<span class="linenr">35: </span>            <span style="color: #99bb66;">(</span>apply-generic 'add <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">36: </span>            <span style="color: #a9a1e1;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgffc483b">
&lt;unknown-location&gt;: warning: possibly unbound variable `fold'
&lt;unknown-location&gt;: warning: possibly unbound variable `reduce'
&lt;unknown-location&gt;: warning: possibly unbound variable `mattcheck'
SUCCEED at multiple arguments test
SUCCEED at multiple arguments test 2
FAIL at multiple arguments coercion test
expected: "boolean true"
returned: "boolean false"
</pre>

<p>
The second test fails because of the rational being nested within the complex
number type. Taking this any further would involve reworking earlier procedures
(such as <code class="src src-scheme">add-complex</code>) and likely writing the future <code class="src src-scheme">drop</code>
procedure anyway.
</p>

<p>
So let&rsquo;s move on.
</p>
</div>
</div>
</div>

<div id="outline-container-org3f616d2" class="outline-3">
<h3 id="org3f616d2"><span class="section-number-3">3.95.</span> Exercise 2.83: <code>raise</code></h3>
<div class="outline-text-3" id="text-3-95">
</div>

<div id="outline-container-org9486f56" class="outline-4">
<h4 id="org9486f56"><span class="section-number-4">3.95.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-95-1">
<p>
Suppose you are designing a generic arithmetic system for dealing with the tower
of types shown in Figure 2.25: integer, rational, real, complex. For each type
(except complex), design a procedure that raises objects of that type one level
in the tower. Show how to install a generic <code class="src src-scheme">raise</code> operation that
will work for each type (except complex).
</p>
</div>
</div>

<div id="outline-container-orgbe41b31" class="outline-4">
<h4 id="orgbe41b31"><span class="section-number-4">3.95.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-95-2">
<p>
I&rsquo;m again getting the feeling that the authors are asking for a theoretical
exercise, but one that I&rsquo;m not satisfied leaving to theory. First we need a
structure to clarify the promotional possibilities of the tower. Then we need
coercions for each type which can be used when following the tower.
</p>

<p>
Something which I haven&rsquo;t defined before but will now is a <code class="src src-scheme">'real</code>
type. A real number is a superset of ints and rationals, but isn&rsquo;t fundamentally
different from these until a non-zero imaginary part is added. So my first
instinct was to make it an untagged type like <code class="src src-scheme">'scheme-number</code> that is
detected by <code class="src src-scheme">type-tag</code> with the builtin predicate <code class="src src-scheme">real?</code>.
However after thinking about it some more I think I&rsquo;ll just implement it in the
type table and have it pass its arguments off to the &ldquo;real&rdquo; types.
</p>

<p>
<code>Real numbers are a superset of integers, rationals, and **irrational** numbers,
which are not a part of this system yet. Also it turns out this module expected
a "real" number to be a decimal. -Matt</code>
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org0c4ff2e"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=number?</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>number? x<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>       <span style="color: #99bb66;">(</span>number? y<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>       <span style="color: #99bb66;">(</span>= x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=int?</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>number? x<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span>number? y<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>       <span style="color: #99bb66;">(</span>integer? x<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>       <span style="color: #99bb66;">(</span>integer? y<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>       <span style="color: #99bb66;">(</span>= x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org4176785"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tower</span>
<span class="linenr"> 2: </span>  '<span style="color: #c678dd;">(</span>scheme-number rational real complex<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">raise</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>type-tag x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">recurse</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>ll tower<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>car ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>cdr ll<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> #f<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>              <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>equal? t1 t2<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>               <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get-coercion t1 <span style="color: #51afef;">(</span>cadr ll<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>contents x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span> <span style="color: #99bb66;">(</span>recurse <span style="color: #a9a1e1;">(</span>cdr ll<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span>put-coercion 'scheme-number 'rational
<span class="linenr">14: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                <span style="color: #99bb66;">(</span>make-rational num <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #ECBE7B;">&lt;&lt;eqnumber&gt;&gt;</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>put-coercion 'rational 'real
<span class="linenr">18: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>                <span style="color: #99bb66;">(</span>make-real
<span class="linenr">20: </span>                 <span style="color: #a9a1e1;">(</span>exact-&gt;inexact <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>                                    <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>put-coercion 'real 'complex
<span class="linenr">23: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>                <span style="color: #99bb66;">(</span>make-complex-from-real-imag
<span class="linenr">25: </span>                 num <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org027f50c"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-real-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'real x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span>put 'make 'real
<span class="linenr">13: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag r<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-real</span> r<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'real<span style="color: #99bb66;">)</span> r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span> <span style="color: #525252;">;; </span><span style="color: #525252;">time travel due to numer/denom fixes</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-coerce-less-naive&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">15: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">26: </span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">recurse</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>x <span style="color: #dd8844; font-weight: bold;">42</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>x2 <span style="color: #51afef;">(</span>raise x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>eqv? #f x2<span style="color: #a9a1e1;">)</span>
<span class="linenr">30: </span>        <span style="color: #a9a1e1;">(</span>echo <span style="color: #99bb66;">"Done"</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">begin</span> <span style="color: #51afef;">(</span>echo x2<span style="color: #51afef;">)</span>
<span class="linenr">32: </span>               <span style="color: #51afef;">(</span>recurse x2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgfbd1e04">
&lt;unknown-location&gt;: warning: possibly unbound variable `fold'
5+5 = 10 
5-5 = 0 
5*5 = 25 
5/5 = 1 
1/2 + 1/2 = (rational 1 . 1) 
1/2 - 1/2 = (rational 0 . 1) 
1/2 * 1/2 = (rational 1 . 4) 
1/2 / 1/2 = (rational 1 . 1) 
3+4i + 3+4i = (complex rectangular 6 . 8) 
3+4i - 3+4i = (complex rectangular 0 . 0) 
3+4i * 3+4i = (complex polar 14.0 . 1.8545904360032244) 
3+4i / 3+4i = (complex polar 1.0 . 0.0) 
3m+4deg + 3m+4deg = (complex rectangular -3.921861725181672 . -4.540814971847569) 
3m+4deg - 3m+4deg = (complex rectangular 0.0 . 0.0) 
3m+4deg * 3m+4deg = (complex polar 9 . 8) 
3m+4deg / 3m+4deg = (complex polar 1 . 0) 
(rational 42 . 1) 
(real . 42.0) 
(complex rectangular (real . 42.0) . 0) 
Done 
</pre>
</div>
</div>
</div>

<div id="outline-container-orge34f8d4" class="outline-3">
<h3 id="orge34f8d4"><span class="section-number-3">3.96.</span> Exercise 2.84: <code>append-generic</code> with <code>raise</code></h3>
<div class="outline-text-3" id="text-3-96">
</div>

<div id="outline-container-orge5b53cd" class="outline-4">
<h4 id="orge5b53cd"><span class="section-number-4">3.96.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-96-1">
<p>
Using the <code class="src src-scheme">raise</code> operation of Exercise 2.83, modify the
<code class="src src-scheme">apply-generic</code> procedure so that it coerces its arguments to have the
same type by the method of successive raising, as discussed in this section. You
will need to devise a way to test which of two types is higher in the tower. Do
this in a manner that is ``compatible&rsquo;&rsquo; with the rest of the system and will not
lead to problems in adding new levels to the tower.
</p>
</div>
</div>

<div id="outline-container-org4d41a68" class="outline-4">
<h4 id="org4d41a68"><span class="section-number-4">3.96.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-96-2">
<p>
First some (unnecessarily general) ways to find items in a list.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org772b736"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">list, items to find -&gt; list of indices</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">example: (list-indices '(c b a) a b c z)</span>
<span class="linenr"> 4: </span><span style="color: #525252;">;;          </span><span style="color: #525252;">(2 1 0 #f)</span>
<span class="linenr"> 5: </span><span style="color: #525252;">;; </span><span style="color: #525252;">takes a list and items to find in the list</span>
<span class="linenr"> 6: </span><span style="color: #525252;">;; </span><span style="color: #525252;">returns the index of each or #f</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">list-indices</span> lst . items<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">folder: item, ongoing list of search results</span>
<span class="linenr"> 9: </span>  <span style="color: #525252;">;;             </span><span style="color: #525252;">-&gt; list of search results</span>
<span class="linenr">10: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">List of results is a list of #f for unfound items</span>
<span class="linenr">11: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">and indices for found ones. Take an item to be</span>
<span class="linenr">12: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">searched for in lst and prior search results. Check</span>
<span class="linenr">13: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">for each unfound item and if now found, mark index.</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">folder</span> x counters<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>1+ <span style="color: #51afef;">(</span>car counters<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">rec</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>il items<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                    <span style="color: #c678dd;">(</span>cl <span style="color: #99bb66;">(</span>cdr counters<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>            <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>equal? <span style="color: #51afef;">(</span>car cl<span style="color: #51afef;">)</span> #f<span style="color: #a9a1e1;">)</span>
<span class="linenr">19: </span>                           <span style="color: #a9a1e1;">(</span>equal? x <span style="color: #51afef;">(</span>car il<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>                      <span style="color: #99bb66;">(</span>car counters<span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>                      <span style="color: #99bb66;">(</span>car cl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>                  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>cdr il<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>                      '<span style="color: #99bb66;">()</span>
<span class="linenr">24: </span>                      <span style="color: #99bb66;">(</span>rec <span style="color: #a9a1e1;">(</span>cdr il<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cdr cl<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>length items<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">26: </span>      <span style="color: #525252;">;; </span><span style="color: #525252;">list-index is good enough</span>
<span class="linenr">27: </span>      <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>list-index <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>
<span class="linenr">28: </span>                          <span style="color: #c678dd;">(</span>equal? x <span style="color: #99bb66;">(</span>car items<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">29: </span>                        lst<span style="color: #a9a1e1;">)</span>
<span class="linenr">30: </span>            '<span style="color: #a9a1e1;">()</span><span style="color: #99bb66;">)</span>
<span class="linenr">31: </span>      <span style="color: #99bb66;">(</span>cdr <span style="color: #a9a1e1;">(</span>fold folder <span style="color: #51afef;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span>
<span class="linenr">32: </span>                              <span style="color: #c678dd;">(</span>make-list <span style="color: #99bb66;">(</span>length items<span style="color: #99bb66;">)</span> #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>    
<span class="linenr">33: </span>                 lst<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">34: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">max-index</span> lst<span style="color: #c678dd;">)</span>
<span class="linenr">35: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">folder</span> x result<span style="color: #99bb66;">)</span>
<span class="linenr">36: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>index <span style="color: #c678dd;">(</span>car result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">37: </span>          <span style="color: #51afef;">(</span>max-i <span style="color: #c678dd;">(</span>cadr result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">38: </span>          <span style="color: #51afef;">(</span>max-value <span style="color: #c678dd;">(</span>caddr result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">39: </span>    <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>1+ index<span style="color: #51afef;">)</span>
<span class="linenr">40: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>&gt; x max-value<span style="color: #c678dd;">)</span>
<span class="linenr">41: </span>              <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>1+ index<span style="color: #99bb66;">)</span>
<span class="linenr">42: </span>                    x<span style="color: #c678dd;">)</span>
<span class="linenr">43: </span>              <span style="color: #c678dd;">(</span>list max-i
<span class="linenr">44: </span>                    max-value<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">45: </span>
<span class="linenr">46: </span>  <span style="color: #c678dd;">(</span>cadr <span style="color: #99bb66;">(</span>fold folder <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">47: </span>               lst<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">48: </span>
<span class="linenr">49: </span><span style="color: #525252;">;; </span><span style="color: #525252;">My first definition for max-index was this under the</span>
<span class="linenr">50: </span><span style="color: #525252;">;; </span><span style="color: #525252;">assumption it would be faster, because the former</span>
<span class="linenr">51: </span><span style="color: #525252;">;; </span><span style="color: #525252;">makes variables for each fold. But they benchmarked</span>
<span class="linenr">52: </span><span style="color: #525252;">;; </span><span style="color: #525252;">identically.</span>
<span class="linenr">53: </span><span style="color: #525252;">;</span><span style="color: #525252;">(define (max-index lst)</span>
<span class="linenr">54: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(define index car)</span>
<span class="linenr">55: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(define max-i cadr)</span>
<span class="linenr">56: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(define max-value caddr)</span>
<span class="linenr">57: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(define (folder x result)</span>
<span class="linenr">58: </span><span style="color: #525252;">;    </span><span style="color: #525252;">(cons (1+ (index result))</span>
<span class="linenr">59: </span><span style="color: #525252;">;          </span><span style="color: #525252;">(if (&gt; x (max-value result))</span>
<span class="linenr">60: </span><span style="color: #525252;">;              </span><span style="color: #525252;">(list (1+ (index result))</span>
<span class="linenr">61: </span><span style="color: #525252;">;                    </span><span style="color: #525252;">x)</span>
<span class="linenr">62: </span><span style="color: #525252;">;              </span><span style="color: #525252;">(list (max-i result)</span>
<span class="linenr">63: </span><span style="color: #525252;">;                    </span><span style="color: #525252;">(max-value result)))))</span>
<span class="linenr">64: </span><span style="color: #525252;">;</span>
<span class="linenr">65: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(max-i (fold folder (list -1 0 0)</span>
<span class="linenr">66: </span><span style="color: #525252;">;               </span><span style="color: #525252;">lst)))</span>
</pre>
</div>

<p>
The new apply-generic and helper functions.
</p>
<div class="org-src-container">
<pre class="src src-scheme" id="org09a695e"><span class="linenr"> 1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">type, type -&gt; bool</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Return true if type a is the lowest, false otherwise.</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">is-earlier-in-tower?</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result <span style="color: #51afef;">(</span>list-indices tower a b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>any <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>eq? x #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> result<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"type missing from tower!"</span> result<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>        <span style="color: #a9a1e1;">(</span>apply &lt; result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #525252;">;; </span><span style="color: #525252;">types -&gt; type</span>
<span class="linenr"> 9: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Take types to check on tower. Finds the</span>
<span class="linenr">10: </span><span style="color: #525252;">;; </span><span style="color: #525252;">highest-ranked and returns it.</span>
<span class="linenr">11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">latest-in-tower</span> . args<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>types <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>length args<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                         <span style="color: #99bb66;">(</span>list? <span style="color: #a9a1e1;">(</span>car args<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>                    <span style="color: #c678dd;">(</span>car args<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                    args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>         <span style="color: #a9a1e1;">(</span>result <span style="color: #51afef;">(</span>apply list-indices
<span class="linenr">17: </span>                        tower types<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>any <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>eq? x #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> result<span style="color: #a9a1e1;">)</span>
<span class="linenr">19: </span>        <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"type missing from tower!"</span>
<span class="linenr">20: </span>               <span style="color: #99bb66;">"args"</span> args <span style="color: #99bb66;">"types"</span> types <span style="color: #99bb66;">"result"</span> result<span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>        <span style="color: #a9a1e1;">(</span>list-ref types <span style="color: #51afef;">(</span>max-index result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orge783f08"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Version of apply-generic that tries raising</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">its arguments.</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">types</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">map-raise</span> highest-type item<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>equal? <span style="color: #51afef;">(</span>type-tag item<span style="color: #51afef;">)</span> highest-type<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        item
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>raised <span style="color: #99bb66;">(</span>raise item<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>not raised<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>              <span style="color: #c678dd;">(</span>error <span style="color: #99bb66;">"map-raise: could not raise:"</span> item highest-type<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>              <span style="color: #c678dd;">(</span>map-raise highest-type raised<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>proc <span style="color: #51afef;">(</span>get op types<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> proc <span style="color: #525252;">; </span><span style="color: #525252;">is this already doable?</span>
<span class="linenr">16: </span>        <span style="color: #a9a1e1;">(</span>apply proc <span style="color: #51afef;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>                                        <span style="color: #525252;">; </span><span style="color: #525252;">if not, try type coercion</span>
<span class="linenr">18: </span>  
<span class="linenr">19: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>highest-type <span style="color: #99bb66;">(</span>apply latest-in-tower types<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>               <span style="color: #c678dd;">(</span>map-raise-prime <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>item<span style="color: #a9a1e1;">)(</span>map-raise highest-type item<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>               <span style="color: #c678dd;">(</span>raised <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> map-raise-prime args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>&lt; <span style="color: #99bb66;">(</span>length args<span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>              <span style="color: #525252;">;; </span><span style="color: #525252;">short args</span>
<span class="linenr">24: </span>              <span style="color: #c678dd;">(</span>apply <span style="color: #99bb66;">(</span>get op <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> type-tag raised<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">25: </span>                     <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> contents raised<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>              <span style="color: #525252;">;; </span><span style="color: #525252;">long args</span>
<span class="linenr">27: </span>              <span style="color: #c678dd;">(</span>reduce <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>elem previous<span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>                        <span style="color: #a9a1e1;">(</span>apply-generic op previous elem<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>                      <span style="color: #99bb66;">"ERROR"</span> raised<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I discovered that the prior method for avoiding tagging scheme-numbers also keeps you from tagging other things. Here&rsquo;s one that avoids the problem:
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgf7c142c"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">attach-tag</span> type-tag contents<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>eqv? type-tag 'scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>      contents
<span class="linenr">4: </span>      <span style="color: #99bb66;">(</span>cons type-tag contents<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-raise&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">15: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr">16: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">17: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">18: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr">26: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">29: </span>
<span class="linenr">30: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"is-earlier-in-tower? true"</span>
<span class="linenr">31: </span>           <span style="color: #c678dd;">(</span>is-earlier-in-tower? 'scheme-number 'real<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">32: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"is-earlier-in-tower? false"</span>
<span class="linenr">33: </span>           #f <span style="color: #c678dd;">(</span>is-earlier-in-tower? 'complex 'scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">34: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"max-index"</span>
<span class="linenr">35: </span>           <span style="color: #c678dd;">(</span>max-index <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>           <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span class="linenr">37: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"latest-in-tower"</span>
<span class="linenr">38: </span>           <span style="color: #c678dd;">(</span>apply latest-in-tower tower<span style="color: #c678dd;">)</span>
<span class="linenr">39: </span>           'complex<span style="color: #51afef;">)</span>
<span class="linenr">40: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"latest-in-tower reverse"</span>
<span class="linenr">41: </span>           <span style="color: #c678dd;">(</span>apply latest-in-tower <span style="color: #99bb66;">(</span>reverse tower<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">42: </span>           'complex<span style="color: #51afef;">)</span>
<span class="linenr">43: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"latest-in-tower 2 args"</span>
<span class="linenr">44: </span>           <span style="color: #c678dd;">(</span>apply latest-in-tower '<span style="color: #99bb66;">(</span>scheme-number real<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">45: </span>           'real<span style="color: #51afef;">)</span>
<span class="linenr">46: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"latest-in-tower 1 arg"</span>
<span class="linenr">47: </span>           <span style="color: #c678dd;">(</span>apply latest-in-tower '<span style="color: #99bb66;">(</span>real<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">48: </span>           'real<span style="color: #51afef;">)</span>
<span class="linenr">49: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr">50: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr">51: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">52: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr">53: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">54: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr">55: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr">56: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">57: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">58: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr">59: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr">60: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">61: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org104f4c4">
5+5 = 10 
5-5 = 0 
5*5 = 25 
5/5 = 1 
1/2 + 1/2 = (rational 1 . 1) 
1/2 - 1/2 = (rational 0 . 1) 
1/2 * 1/2 = (rational 1 . 4) 
1/2 / 1/2 = (rational 1 . 1) 
3+4i + 3+4i = (complex rectangular 6 . 8) 
3+4i - 3+4i = (complex rectangular 0 . 0) 
3+4i * 3+4i = (complex polar 14.0 . 1.8545904360032244) 
3+4i / 3+4i = (complex polar 1.0 . 0.0) 
3m+4deg + 3m+4deg = (complex rectangular -3.921861725181672 . -4.540814971847569) 
3m+4deg - 3m+4deg = (complex rectangular 0.0 . 0.0) 
3m+4deg * 3m+4deg = (complex polar 9 . 8) 
3m+4deg / 3m+4deg = (complex polar 1 . 0) 
SUCCEED at is-earlier-in-tower? true
SUCCEED at is-earlier-in-tower? false
SUCCEED at max-index
SUCCEED at latest-in-tower
SUCCEED at latest-in-tower reverse
SUCCEED at latest-in-tower 2 args
SUCCEED at latest-in-tower 1 arg
SUCCEED at raise success
SUCCEED at raise fail
SUCCEED at apply-generic 1
SUCCEED at apply-generic 2
</pre>

<p>
In this implementation, In order to add a new type, all that will be needed is
to replace the tower variable (the horrors of <code>setq</code>&#x2026;) and add a coercion to
the respective type.
</p>

<p>
My first attempt at this exercise had a problem from <code class="src src-scheme">'real</code> and above,
where numbers passed to math primitives would fail, because of receiving numbers tagged
<code class="src src-scheme">'real</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span>add <span style="color: #c678dd;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>     <span style="color: #c678dd;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">eventually reaches...</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>add-complex <span style="color: #c678dd;">(</span>rectangular <span style="color: #99bb66;">(</span>real . <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> . <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>             <span style="color: #c678dd;">(</span>polar <span style="color: #dd8844; font-weight: bold;">3</span> . <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #525252;">;; </span><span style="color: #525252;">which resulfs in...</span>
</pre>
</div>

<pre class="example" id="orgde7d07e">
ice-9/boot-9.scm:1685:16: In procedure raise-exception:
In procedure +: Wrong type argument in position 1: (real . 2)
</pre>

<p>
This issue was caused by not consuming the <code class="src src-scheme">'real</code> tag when being
coerced to a new type.
</p>

<p>
My code also had an issue where real numbers raised from rational couldn&rsquo;t be
operated on because they were always nested inside the real number. This is
solved by reducing the fraction to a decimal number, which fixes a few &ldquo;bugs&rdquo; in
the book&rsquo;s code as well.
</p>
</div>
</div>
</div>

<div id="outline-container-orgeebf7d1" class="outline-3">
<h3 id="orgeebf7d1"><span class="section-number-3">3.97.</span> Exercise 2.85: <code>append-generic</code> with <code>drop</code></h3>
<div class="outline-text-3" id="text-3-97">
</div>

<div id="outline-container-orgbdf9371" class="outline-4">
<h4 id="orgbdf9371"><span class="section-number-4">3.97.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-97-1">
<p>
This section mentioned a method for &ldquo;simplifying&rdquo; a data object by lowering it
in the tower of types as far as possible. Design a procedure <code class="src src-scheme">drop</code>
that accomplishes this for the tower described in Exercise 2.83. The key is to
decide, in some general way, whether an object can be lowered. For example, the
complex number \(1.5 + 0i\) can be lowered as far as <code class="src src-scheme">real</code>, the
complex number \(1 + 0i\) can be lowered as far as <code class="src src-scheme">integer</code>, and the
complex number \(2 + 3i\) cannot be lowered at all. Here is a plan for
determining whether an object can be lowered: Begin by defining a generic
operation <code class="src src-scheme">project</code> that &ldquo;pushes&rdquo; an object down in the tower. For
example, projecting a complex number would involve throwing away the imaginary
part. Then a number can be dropped if, when we <code class="src src-scheme">project</code> it and
<code class="src src-scheme">raise</code> the result back to the type we started with, we end up with
something equal to what we started with. Show how to implement this idea in
detail, by writing a <code class="src src-scheme">drop</code> procedure that drops an object as far as
possible. You will need to design the various projection operations<sup><a id="fnr.12" class="footref" href="#fn.12" role="doc-backlink">12</a></sup> and install
<code class="src src-scheme">project</code> as a generic operation in the system. You will also need to
make use of a generic equality predicate, such as described in Exercise 2.79.
Finally, use <code class="src src-scheme">drop</code> to rewrite <code class="src src-scheme">apply-generic</code> from Exercise
2.84 so that it &ldquo;simplifies&rdquo; its answers.
</p>
</div>
</div>

<div id="outline-container-orgcad04b4" class="outline-4">
<h4 id="orgcad04b4"><span class="section-number-4">3.97.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-97-2">
<p>
The question asks to install <code>project</code> as a generic operation in the system, and
I assume that means a <code>project</code> function in the ops table. At first I thought it
would be a function in the same way <code>raise</code> is, with coercions in the coercion
table. However upon consideration, it might be for the purpose of handling the type tags, as I encountered in previous exercises.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgb17c9a4"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">project</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>type-tag x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>get 'project t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> p
<span class="linenr"> 5: </span>          <span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>contents x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span>          #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">drop</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>pair? x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>      x
<span class="linenr">11: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>projected <span style="color: #c678dd;">(</span>project x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eqv? projected #f<span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>               x<span style="color: #51afef;">)</span>
<span class="linenr">14: </span>              <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>equ? x projected<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>               <span style="color: #c678dd;">(</span>drop projected<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>put 'project 'rational
<span class="linenr">19: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>       <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'numer '<span style="color: #51afef;">(</span>rational<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>        num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>put 'project 'real
<span class="linenr">23: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>       <span style="color: #99bb66;">(</span>round num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span>put 'project 'complex
<span class="linenr">26: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">27: </span>       <span style="color: #99bb66;">(</span>make-real
<span class="linenr">28: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'real-part '<span style="color: #c678dd;">(</span>complex<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> num<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org302e7eb"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Version of apply-generic that tries to drop its type</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">when returning</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">types</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">map-raise</span> highest-type item<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>equal? <span style="color: #51afef;">(</span>type-tag item<span style="color: #51afef;">)</span> highest-type<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        item
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>raised <span style="color: #99bb66;">(</span>raise item<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>not raised<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>              <span style="color: #c678dd;">(</span>error <span style="color: #99bb66;">"MAP-RAISE: could not raise"</span> item highest-type<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>              <span style="color: #c678dd;">(</span>map-raise highest-type raised<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>drop
<span class="linenr">15: </span>   <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>proc <span style="color: #c678dd;">(</span>get op types<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> proc <span style="color: #525252;">; </span><span style="color: #525252;">is this already doable?</span>
<span class="linenr">17: </span>         <span style="color: #51afef;">(</span>apply proc <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>                                        <span style="color: #525252;">; </span><span style="color: #525252;">if not, try type coercion</span>
<span class="linenr">19: </span>         
<span class="linenr">20: </span>         <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>highest-type <span style="color: #a9a1e1;">(</span>apply latest-in-tower types<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>                <span style="color: #99bb66;">(</span>map-raise-prime <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>item<span style="color: #51afef;">)(</span>map-raise highest-type item<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>                <span style="color: #99bb66;">(</span>raised <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> map-raise-prime args<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>           <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>length raised<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">short args</span>
<span class="linenr">25: </span>               <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>f <span style="color: #c678dd;">(</span>get op <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag raised<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">26: </span>                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>eqv? #f f<span style="color: #51afef;">)</span>
<span class="linenr">27: </span>                     <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"APPLY-GENERIC: could not find procedure for types"</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> type-tag raised<span style="color: #c678dd;">)</span> raised<span style="color: #51afef;">)</span>
<span class="linenr">28: </span>                     <span style="color: #51afef;">(</span>apply f <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents raised<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">long args</span>
<span class="linenr">30: </span>               <span style="color: #99bb66;">(</span>reduce <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>elem previous<span style="color: #51afef;">)</span>
<span class="linenr">31: </span>                         <span style="color: #51afef;">(</span>apply-generic op previous elem<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">32: </span>                       <span style="color: #99bb66;">"ERROR"</span> raised<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;square&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;drop-project&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-drop&gt;&gt;</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #ECBE7B;">&lt;&lt;scheme-number-package&gt;&gt;</span>
<span class="linenr">15: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">16: </span><span style="color: #ECBE7B;">&lt;&lt;equ?&gt;&gt;</span>
<span class="linenr">17: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">18: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">19: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">26: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">29: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr">32: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr">33: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">34: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr">35: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">36: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr">37: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr">38: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">39: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">40: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr">41: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr">42: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">43: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">44: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr">45: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">46: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">47: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr">48: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">49: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">50: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr">51: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">52: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgf14d09a">
5+5 = 10 
5-5 = 0 
5*5 = 25 
5/5 = 1 
1/2 + 1/2 = 1 
1/2 - 1/2 = 0 
1/2 * 1/2 = (rational 1 . 4) 
1/2 / 1/2 = 1 
3+4i + 3+4i = (complex rectangular 6 . 8) 
3+4i - 3+4i = 0 
3+4i * 3+4i = (complex polar 14.0 . 1.8545904360032244) 
3+4i / 3+4i = 1.0 
3m+4deg + 3m+4deg = (complex rectangular -3.921861725181672 . -4.540814971847569) 
3m+4deg - 3m+4deg = 0.0 
3m+4deg * 3m+4deg = (complex polar 9 . 8) 
3m+4deg / 3m+4deg = 1 
SUCCEED at raise success
SUCCEED at raise fail
SUCCEED at apply-generic 1
SUCCEED at apply-generic 2
SUCCEED at drop 1
SUCCEED at drop 2
SUCCEED at drop 3
</pre>

<p>
Compare the gen-math-tests output here with that of the <a href="#orga9f2204">first run in Ex 2.77</a>.
They are being correctly simplified.
</p>

<p>
After getting these solutions working, I have to say I&rsquo;m really reaping what
I&rsquo;ve sown. I&rsquo;ve been very inconsistent with my tagging and untagging. Some
functions in the type system expected tagged numbers, others expect untagged
<code class="src src-scheme">contents</code>, which means those functions cannot be used in the same
places. I&rsquo;ve had to run over the system and make sure I&rsquo;m doing it at the right
time.
</p>
</div>
</div>
</div>

<div id="outline-container-org736aa95" class="outline-3">
<h3 id="org736aa95"><span class="section-number-3">3.98.</span> Exercise 2.86: complex numbers with flexible types</h3>
<div class="outline-text-3" id="text-3-98">
</div>

<div id="outline-container-org59b1f12" class="outline-4">
<h4 id="org59b1f12"><span class="section-number-4">3.98.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-98-1">
<p>
Suppose we want to handle complex numbers whose real parts, imaginary parts,
magnitudes, and angles can be either ordinary numbers, rational numbers, or
other numbers we might wish to add to the system. Describe and implement the
changes to the system needed to accommodate this. You will have to define
operations such as <code class="src src-scheme">sine</code> and <code class="src src-scheme">cosine</code> that are generic over
ordinary numbers and rational numbers.
</p>
</div>
</div>

<div id="outline-container-org55d9ce7" class="outline-4">
<h4 id="org55d9ce7"><span class="section-number-4">3.98.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-98-2">
<p>
We&rsquo;ll need the internal procedures in the complex package to themselves be calls
to <code class="src src-scheme">apply-generic</code>, so that calculations with our new data types can
be handled.
</p>

<p>
In the real and complex parts of the tower, I had assumed that the return of
<code class="src src-scheme">real-part</code> would always be of tagged type <code class="src src-scheme">'real</code>. However,
in this version it may be either real or rational, so I&rsquo;ll want to adjust the
<code class="src src-scheme">project</code> procedures accordingly.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org8336daa"><span class="linenr">  1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'add x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'sub x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'mul x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'div x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'magnitude z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'angle z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  9: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Now we begin to change code for support</span>
<span class="linenr"> 10: </span><span style="color: #525252;">;; </span><span style="color: #525252;">These will be named slightly different so the primitive</span>
<span class="linenr"> 11: </span><span style="color: #525252;">;; </span><span style="color: #525252;">functions aren't shadowed</span>
<span class="linenr"> 12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>mul x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sine</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'sine x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">(sin)</span>
<span class="linenr"> 14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cosine</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'cosine x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">; </span><span style="color: #525252;">(cos)</span>
<span class="linenr"> 15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-root</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'square-root x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">(sqrt)</span>
<span class="linenr"> 16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">arctan</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'arctan x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">(atan)</span>
<span class="linenr"> 17: </span>
<span class="linenr"> 18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-scheme-number</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 19: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'scheme-number<span style="color: #99bb66;">)</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-scheme-number-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 21: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'scheme-number x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 22: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 23: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>+ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 24: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 25: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>- x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 26: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 27: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>* x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 28: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 29: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 30: </span>  <span style="color: #c678dd;">(</span>put 'sine '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 31: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sin x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 32: </span>  <span style="color: #c678dd;">(</span>put 'cosine '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 33: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>cos x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 34: </span>  <span style="color: #c678dd;">(</span>put 'square-root '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 35: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sqrt x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 36: </span>  <span style="color: #c678dd;">(</span>put 'arctan '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 37: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>atan x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 38: </span>  <span style="color: #c678dd;">(</span>put 'make 'scheme-number <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 39: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 40: </span>
<span class="linenr"> 41: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rational-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 42: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr"> 43: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">numer</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 44: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">denom</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 45: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-rat</span> n d<span style="color: #99bb66;">)</span>
<span class="linenr"> 46: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>inexact? n<span style="color: #51afef;">)</span>
<span class="linenr"> 47: </span>            <span style="color: #51afef;">(</span>inexact? d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 48: </span>        <span style="color: #a9a1e1;">(</span>cons n d<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 49: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>g <span style="color: #99bb66;">(</span>gcd n d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 50: </span>          <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>/ n g<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>/ d g<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 51: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 52: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>+ <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 53: </span>                 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 54: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 55: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 56: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 57: </span>                 <span style="color: #51afef;">(</span>* <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 58: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 59: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 60: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 61: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 62: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 63: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 64: </span>              <span style="color: #a9a1e1;">(</span>* <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 65: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr"> 66: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rational x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 67: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 68: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 69: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 70: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 71: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 72: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 73: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 74: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 75: </span>  <span style="color: #c678dd;">(</span>put 'make 'rational
<span class="linenr"> 76: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>n d<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-rat n d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 77: </span>  <span style="color: #c678dd;">(</span>put 'numer '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> numer<span style="color: #c678dd;">)</span>
<span class="linenr"> 78: </span>  <span style="color: #c678dd;">(</span>put 'denom '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> denom<span style="color: #c678dd;">)</span>
<span class="linenr"> 79: </span>  <span style="color: #c678dd;">(</span>put 'sine '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 80: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'sine '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 81: </span>                   <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 82: </span>  <span style="color: #c678dd;">(</span>put 'cosine '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 83: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'cosine '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 84: </span>                   <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 85: </span>  <span style="color: #c678dd;">(</span>put 'square-root '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 86: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'square-root '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 87: </span>                   <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 88: </span>  <span style="color: #c678dd;">(</span>put 'arctan '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 89: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r s<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'arctan '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 90: </span>                     <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span>numer s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 91: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 92: </span>
<span class="linenr"> 93: </span><span style="color: #525252;">;; </span><span style="color: #525252;">for future use</span>
<span class="linenr"> 94: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">numer</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 95: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 96: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 97: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">denom</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 98: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 99: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">100: </span>
<span class="linenr">101: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rational</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr">102: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'rational<span style="color: #99bb66;">)</span> n d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">103: </span>
<span class="linenr">104: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rectangular-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">105: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">106: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">107: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">108: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">109: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span>
<span class="linenr">110: </span>    <span style="color: #99bb66;">(</span>square-root <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">111: </span>                      <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">112: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span>
<span class="linenr">113: </span>    <span style="color: #99bb66;">(</span>arctan <span style="color: #a9a1e1;">(</span>imag-part z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>real-part z<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">114: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr">115: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>mul r <span style="color: #51afef;">(</span>cosine a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>mul r <span style="color: #51afef;">(</span>sine a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">116: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr">117: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rectangular x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">118: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">119: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">120: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">121: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">122: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'rectangular
<span class="linenr">123: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">124: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'rectangular
<span class="linenr">125: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">126: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">127: </span>
<span class="linenr">128: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polar-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">129: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">130: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">131: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">132: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">133: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cosine <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">134: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>sine <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">135: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr">136: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>sqrt <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>square x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>square y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">137: </span>          <span style="color: #a9a1e1;">(</span>atan y x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">138: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr">139: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'polar x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">140: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">141: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">142: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">143: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">144: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'polar
<span class="linenr">145: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">146: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'polar
<span class="linenr">147: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">148: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">149: </span>
<span class="linenr">150: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-complex-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">151: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr">152: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-real-imag 'rectangular<span style="color: #a9a1e1;">)</span> x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">153: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr">154: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-mag-ang 'polar<span style="color: #a9a1e1;">)</span> r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">155: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">let's make these generic</span>
<span class="linenr">156: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">157: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">158: </span>                         <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">159: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">160: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">161: </span>                         <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">162: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">163: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">164: </span>                       <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">165: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">166: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>div <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">167: </span>                       <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">168: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">169: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'complex z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">170: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">171: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">172: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">173: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">174: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">175: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">176: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">177: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">178: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'complex
<span class="linenr">179: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">180: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'complex
<span class="linenr">181: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">182: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">183: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">184: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">185: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">186: </span>
<span class="linenr">187: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-real-imag</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">188: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-real-imag 'complex<span style="color: #99bb66;">)</span> x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">189: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-mag-ang</span> r a<span style="color: #c678dd;">)</span>
<span class="linenr">190: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-mag-ang 'complex<span style="color: #99bb66;">)</span> r a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">191: </span>
<span class="linenr">192: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">project</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">193: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>type-tag x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">194: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>get 'project t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">195: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> p
<span class="linenr">196: </span>          <span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>contents x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">197: </span>          #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">198: </span>
<span class="linenr">199: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">drop</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">200: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>pair? x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">201: </span>      x
<span class="linenr">202: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>projected <span style="color: #c678dd;">(</span>project x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">203: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eqv? projected #f<span style="color: #c678dd;">)</span>
<span class="linenr">204: </span>               x<span style="color: #51afef;">)</span>
<span class="linenr">205: </span>              <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>equ? x projected<span style="color: #c678dd;">)</span>
<span class="linenr">206: </span>               <span style="color: #c678dd;">(</span>drop projected<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">207: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">208: </span>
<span class="linenr">209: </span><span style="color: #51afef;">(</span>put 'project 'rational
<span class="linenr">210: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">211: </span>       <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'numer '<span style="color: #51afef;">(</span>rational<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">212: </span>        num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">213: </span><span style="color: #51afef;">(</span>put 'project 'real
<span class="linenr">214: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">215: </span>       <span style="color: #99bb66;">(</span>round num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">216: </span><span style="color: #525252;">;; </span><span style="color: #525252;">projecting a complex number may return something other than a single number</span>
<span class="linenr">217: </span><span style="color: #51afef;">(</span>put 'project 'complex
<span class="linenr">218: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">219: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>r <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'real-part '<span style="color: #a9a1e1;">(</span>complex<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">220: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>number? <span style="color: #c678dd;">(</span>contents r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">221: </span>             <span style="color: #51afef;">(</span>make-real <span style="color: #c678dd;">(</span>contents r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">222: </span>             r<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">223: </span>
<span class="linenr">224: </span><span style="color: #525252;">;; </span><span style="color: #525252;">equality testing with complex numbers also changes</span>
<span class="linenr">225: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'equ? x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">226: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-equ?</span><span style="color: #c678dd;">)</span>
<span class="linenr">227: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr">228: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">229: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">230: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">231: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1 <span style="color: #99bb66;">(</span>type-tag x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">232: </span>               <span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>type-tag y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">233: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? t1 'polar<span style="color: #a9a1e1;">)</span>
<span class="linenr">234: </span>                       <span style="color: #a9a1e1;">(</span>eqv? t2 'polar<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">235: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'magnitude x<span style="color: #51afef;">)</span>
<span class="linenr">236: </span>                             <span style="color: #51afef;">(</span>apply-generic 'magnitude y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">237: </span>                       <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'angle x<span style="color: #51afef;">)</span>
<span class="linenr">238: </span>                             <span style="color: #51afef;">(</span>apply-generic 'angle y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">239: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">240: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'real-part x<span style="color: #51afef;">)</span>
<span class="linenr">241: </span>                             <span style="color: #51afef;">(</span>apply-generic 'real-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">242: </span>                       <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'imag-part x<span style="color: #51afef;">)</span>
<span class="linenr">243: </span>                             <span style="color: #51afef;">(</span>apply-generic 'imag-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">244: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr">245: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">246: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">247: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">248: </span>              <span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">249: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">250: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr">251: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-drop&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-complex-parts&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">15: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">19: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">26: </span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr">28: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr">29: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">30: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr">31: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr">33: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr">34: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">35: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">36: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr">37: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">39: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">40: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr">41: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">42: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">43: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr">44: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">45: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">46: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr">47: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">48: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">49: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr">50: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">51: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">52: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr">53: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">54: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">55: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr">56: </span>                 <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">57: </span>                       <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orga471f8c">
(etc)
SUCCEED at complex with nested rational
SUCCEED at math on complex with nested rational
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f41b95" class="outline-3">
<h3 id="org8f41b95"><span class="section-number-3">3.99.</span> 2.5: Symbolic Algebra</h3>
<div class="outline-text-3" id="text-3-99">
<p>
In this section, we implement an addition to the generic math system we have
been building by adding support for polynomials (with only addition and
multiplication involved) to start.
</p>

<p>
I&rsquo;m going to split the polynomial package into two blocks so I can insert code
inside without needing to copy the whole block again.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org481f2fd"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polynomial-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr"> 3: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">representation of poly</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-poly</span> variable term-list<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons variable term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">variable</span> p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">terms</span> p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">renamed from term-list since many procs happen</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>symbol? x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>  <span style="color: #525252;">; </span><span style="color: #525252;">to use "term-list" as an internal variable</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>variable? v1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable? v2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>eq? v1 v2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">representation of terms and term lists</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">adjoin-term</span> term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>=zero? <span style="color: #51afef;">(</span>coeff term<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>        term-list
<span class="linenr">14: </span>        <span style="color: #a9a1e1;">(</span>cons term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">the-empty-termlist</span><span style="color: #99bb66;">)</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">first-term</span> term-list<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rest-terms</span> term-list<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">empty-termlist?</span> term-list<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>null? term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-term</span> order coeff<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>list order coeff<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">order</span> term<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">coeff</span> term<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cadr term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-poly</span> p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">24: </span>        <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span>
<span class="linenr">25: </span>                   <span style="color: #51afef;">(</span>add-terms <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">26: </span>        <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"Polys not in same var: ADD-POLY"</span> <span style="color: #51afef;">(</span>list p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-poly</span> p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">29: </span>        <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span>
<span class="linenr">30: </span>                   <span style="color: #51afef;">(</span>mul-terms <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>        <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"Polys not in same var: MUL-POLY"</span> <span style="color: #51afef;">(</span>list p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-terms</span> L1 L2<span style="color: #99bb66;">)</span>
<span class="linenr">33: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>empty-termlist? L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span>
<span class="linenr">34: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>empty-termlist? L2<span style="color: #51afef;">)</span> L1<span style="color: #a9a1e1;">)</span>
<span class="linenr">35: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">36: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>t1 <span style="color: #a9a1e1;">(</span>first-term L1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">37: </span>                 <span style="color: #99bb66;">(</span>t2 <span style="color: #a9a1e1;">(</span>first-term L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">38: </span>             <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">39: </span>                    <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">40: </span>                     t1 <span style="color: #51afef;">(</span>add-terms <span style="color: #c678dd;">(</span>rest-terms L1<span style="color: #c678dd;">)</span> L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">41: </span>                   <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">42: </span>                    <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">43: </span>                     t2 <span style="color: #51afef;">(</span>add-terms L1 <span style="color: #c678dd;">(</span>rest-terms L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">44: </span>                   <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">45: </span>                    <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">46: </span>                     <span style="color: #51afef;">(</span>make-term <span style="color: #c678dd;">(</span>order t1<span style="color: #c678dd;">)</span>
<span class="linenr">47: </span>                                <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">48: </span>                     <span style="color: #51afef;">(</span>add-terms <span style="color: #c678dd;">(</span>rest-terms L1<span style="color: #c678dd;">)</span>
<span class="linenr">49: </span>                                <span style="color: #c678dd;">(</span>rest-terms L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">50: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-terms</span> L1 L2<span style="color: #99bb66;">)</span>
<span class="linenr">51: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? L1<span style="color: #a9a1e1;">)</span>
<span class="linenr">52: </span>        <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span>
<span class="linenr">53: </span>        <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>mul-term-by-all-terms <span style="color: #c678dd;">(</span>first-term L1<span style="color: #c678dd;">)</span> L2<span style="color: #51afef;">)</span>
<span class="linenr">54: </span>                   <span style="color: #51afef;">(</span>mul-terms <span style="color: #c678dd;">(</span>rest-terms L1<span style="color: #c678dd;">)</span> L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">55: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">56: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'polynomial p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">57: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>polynomial polynomial<span style="color: #99bb66;">)</span>
<span class="linenr">58: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p1 p2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-poly p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">59: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>polynomial polynomial<span style="color: #99bb66;">)</span>
<span class="linenr">60: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p1 p2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-poly p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">61: </span>  <span style="color: #c678dd;">(</span>put 'make 'polynomial
<span class="linenr">62: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>var terms<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-poly var terms<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">63: </span>  
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="orgd5d044b"><span class="linenr">1: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-term-by-all-terms</span> t1 L<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>        <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">5: </span>          <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">6: </span>           <span style="color: #51afef;">(</span>make-term <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>order t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">7: </span>                      <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">8: </span>           <span style="color: #51afef;">(</span>mul-term-by-all-terms t1 <span style="color: #c678dd;">(</span>rest-terms L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgf8ef3ef"><span class="linenr">1: </span>  'done<span style="color: #ff6655; font-weight: bold;">)</span>
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #ff6655; font-weight: bold;">(</span><span style="color: #51afef;">define</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">make-polynomial</span> var terms<span style="color: #51afef;">)</span>
<span class="linenr">4: </span>  <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>get 'make 'polynomial<span style="color: #c678dd;">)</span> var terms<span style="color: #51afef;">)</span><span style="color: #ff6655; font-weight: bold;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a2819d" class="outline-3">
<h3 id="org8a2819d"><span class="section-number-3">3.100.</span> Exercise 2.87: <code>=zero?</code> for polynomials</h3>
<div class="outline-text-3" id="text-3-100">
</div>

<div id="outline-container-org6fd40af" class="outline-4">
<h4 id="org6fd40af"><span class="section-number-4">3.100.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-100-1">
<p>
Install <code class="src src-scheme">=zero?</code> for polynomials in the generic arithmetic package.
This will allow <code class="src src-scheme">adjoin-term</code> to work for polynomials with
coefficients that are themselves polynomials.
</p>
</div>
</div>

<div id="outline-container-orgc3fff19" class="outline-4">
<h4 id="orgc3fff19"><span class="section-number-4">3.100.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-100-2">
<p>
After testing, I see a problem. <code class="src src-scheme">add</code>ing nested polynomials works
fine. However, when a coefficient is a polynomial,
<code class="src src-scheme">mul-term-by-all-terms</code> will call <code class="src src-scheme">mul</code> with the types
<code class="src src-scheme">'<span style="color: #51afef;">(</span>polynomial scheme-number<span style="color: #51afef;">)</span></code>. If I added polynomials to the type
tower and used <code class="src src-scheme">raise</code> to make it into a <code class="src src-scheme">'<span style="color: #51afef;">(</span>polynomial polynomial<span style="color: #51afef;">)</span></code> call, I then need to specify a matching variable for the raised
number, which is not available in <code class="src src-scheme">raise</code>. It seems like I&rsquo;ll need to
modify the <code class="src src-scheme">mul-term-by-all-terms</code> procedure to detect when one item
is a polynomial and the other isn&rsquo;t, and turn the non-polynomial entry into a
polynomial before calling <code class="src src-scheme">mul</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="orgd3d9bf2"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">if-1st-poly-make-2nd-poly</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? 'polynomial <span style="color: #51afef;">(</span>type-tag t1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 3: </span>           <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>eqv? 'polynomial <span style="color: #c678dd;">(</span>type-tag t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable <span style="color: #c678dd;">(</span>contents t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>make-term <span style="color: #dd8844; font-weight: bold;">0</span> t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>      t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-term-by-all-terms</span> t1 L<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">If one coeff is a poly, make the other a poly</span>
<span class="linenr">10: </span>             <span style="color: #51afef;">(</span>t1-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>             <span style="color: #51afef;">(</span>t2-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>        
<span class="linenr">13: </span>        <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">14: </span>         <span style="color: #51afef;">(</span>make-term <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>order t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                    <span style="color: #c678dd;">(</span>mul t1-coeff t2-coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>         <span style="color: #51afef;">(</span>mul-term-by-all-terms t1 <span style="color: #c678dd;">(</span>rest-terms L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org8412ce7"><span class="linenr">1: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">terms-=zero?</span> L<span style="color: #c678dd;">)</span>
<span class="linenr">2: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">3: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>=zero? <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">4: </span>             <span style="color: #a9a1e1;">(</span>terms-=zero? <span style="color: #51afef;">(</span>rest-terms L<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">5: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">poly-=zero?</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">6: </span>    <span style="color: #c678dd;">(</span>terms-=zero? <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">7: </span>  <span style="color: #51afef;">(</span>put '=zero? '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span> poly-=zero?<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-drop&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-complex-parts&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">15: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #ECBE7B;">&lt;&lt;polynomials-package-top&gt;&gt;</span>
<span class="linenr">18: </span><span style="color: #ECBE7B;">&lt;&lt;mul-term-by-all-terms-mine&gt;&gt;</span>
<span class="linenr">19: </span><span style="color: #ECBE7B;">&lt;&lt;poly-terms-eqzero&gt;&gt;</span>
<span class="linenr">20: </span><span style="color: #ECBE7B;">&lt;&lt;polynomials-package-bottom&gt;&gt;</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">23: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">26: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">29: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">30: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr">31: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr">32: </span>
<span class="linenr">33: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr">34: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr">35: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">36: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr">37: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">38: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr">39: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr">40: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">41: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">42: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr">43: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr">44: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">45: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">46: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr">47: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">48: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">49: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr">50: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">51: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">52: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr">53: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">54: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr">55: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr">56: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">57: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">58: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr">59: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">60: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">61: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr">62: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">63: </span>                                      <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">64: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr">65: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">66: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr">67: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">68: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">69: </span>      <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">70: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr">71: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">72: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">73: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">74: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr">75: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">76: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">77: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">78: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr">79: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr">80: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">81: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">82: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr">83: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr">84: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">85: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org076c033">
(etc...)
SUCCEED at polynomial = zero
SUCCEED at polynomial != zero
SUCCEED at polynomial addition
SUCCEED at polynomial multiplication
SUCCEED at nested polynomial addition
SUCCEED at nested polynomial mult
</pre>
</div>
</div>
</div>

<div id="outline-container-org60fae57" class="outline-3">
<h3 id="org60fae57"><span class="section-number-3">3.101.</span> Exercise 2.88: negation, subtracting polynomials</h3>
<div class="outline-text-3" id="text-3-101">
</div>

<div id="outline-container-org663fc42" class="outline-4">
<h4 id="org663fc42"><span class="section-number-4">3.101.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-101-1">
<p>
Extend the polynomial system to include subtraction of polynomials. (Hint: You
may find it helpful to define a generic negation operation.)
</p>
</div>
</div>

<div id="outline-container-org533fb32" class="outline-4">
<h4 id="org533fb32"><span class="section-number-4">3.101.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-101-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org50e8536"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>apply-generic 'neg x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-negation</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>put 'neg '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>- x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span>put 'neg '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>R<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #51afef;">(</span>neg <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> R<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>                                 <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>get 'denom '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> R<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>put 'neg '<span style="color: #99bb66;">(</span>real<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>get 'neg '<span style="color: #a9a1e1;">(</span>scheme-number<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>  <span style="color: #c678dd;">(</span>put 'neg '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>C<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>         <span style="color: #a9a1e1;">(</span>make-complex-from-real-imag <span style="color: #51afef;">(</span>neg <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'real-part '<span style="color: #a9a1e1;">(</span>rectangular<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> C<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                                      <span style="color: #51afef;">(</span>neg <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'imag-part '<span style="color: #a9a1e1;">(</span>rectangular<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> C<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>put 'neg '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>C<span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>         <span style="color: #a9a1e1;">(</span>make-complex-from-mag-ang <span style="color: #51afef;">(</span>neg <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'magnitude '<span style="color: #a9a1e1;">(</span>polar<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> C<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">17: </span>                                    <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>get 'angle '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> C<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>put 'neg '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>C<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>apply-generic 'neg C<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org2d78f92"><span class="linenr"> 1: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">inserted in install routine</span>
<span class="linenr"> 2: </span>    <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg-poly</span> p<span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #c678dd;">(</span>make-poly <span style="color: #99bb66;">(</span>variable p<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>t<span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>                        <span style="color: #51afef;">(</span>make-term <span style="color: #c678dd;">(</span>order t<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>coeff t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>                    <span style="color: #a9a1e1;">(</span>terms p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #51afef;">(</span>put 'neg '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>neg-poly p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span>add-poly p1 <span style="color: #a9a1e1;">(</span>neg-poly p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>        <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Polys not in same var: SUB-POLY"</span> <span style="color: #a9a1e1;">(</span>list p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>    <span style="color: #51afef;">(</span>put 'sub '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>        <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>sub-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-drop&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-complex-parts&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr"> 16: </span>
<span class="linenr"> 17: </span><span style="color: #ECBE7B;">&lt;&lt;polynomials-package-top&gt;&gt;</span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;mul-term-by-all-terms-mine&gt;&gt;</span>
<span class="linenr"> 19: </span><span style="color: #ECBE7B;">&lt;&lt;poly-terms-eqzero&gt;&gt;</span>
<span class="linenr"> 20: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-subtraction&gt;&gt;</span>
<span class="linenr"> 21: </span><span style="color: #ECBE7B;">&lt;&lt;polynomials-package-bottom&gt;&gt;</span>
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 24: </span>
<span class="linenr"> 25: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 26: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 27: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 33: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 34: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 35: </span>
<span class="linenr"> 36: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 37: </span>
<span class="linenr"> 38: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 39: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 40: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 41: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 42: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 43: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 44: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 45: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 46: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 47: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 48: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 49: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 50: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 51: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 52: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 53: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 54: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 55: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 56: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 57: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 58: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 59: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 60: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 61: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 62: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 63: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 64: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 65: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 66: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 67: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 68: </span>                                      <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 69: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 70: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 72: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 73: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 74: </span>      <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 75: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 76: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 77: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 78: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 79: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 80: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 81: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 82: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 83: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr"> 84: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 85: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 86: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 87: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr"> 88: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 89: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 90: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 91: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr"> 92: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 93: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr"> 94: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 95: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 96: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr"> 97: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 98: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 99: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">100: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">101: </span>           <span style="color: #c678dd;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">102: </span>
<span class="linenr">103: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">104: </span>      <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">105: </span>      <span style="color: #99bb66;">(</span>p3 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">106: </span>      <span style="color: #99bb66;">(</span>p4 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">107: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">108: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">109: </span>             <span style="color: #99bb66;">(</span>make-polynomial 'x p4<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">110: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">111: </span>             <span style="color: #99bb66;">(</span>sub <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">112: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p3<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">113: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0a7b428">
(etc...)
SUCCEED at negation scheme-number
SUCCEED at negation rational
SUCCEED at negation rectangular complex
SUCCEED at negation polar complex
SUCCEED at negation polynomials
SUCCEED at polynomial subtraction
</pre>
</div>
</div>
</div>

<div id="outline-container-org71e0abc" class="outline-3">
<h3 id="org71e0abc"><span class="section-number-3">3.102.</span> Exercise 2.89: an abstraction for dense polynomials</h3>
<div class="outline-text-3" id="text-3-102">
</div>

<div id="outline-container-org4bf09b0" class="outline-4">
<h4 id="org4bf09b0"><span class="section-number-4">3.102.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-102-1">
<p>
Define procedures that implement the term-list representation described above as
appropriate for dense polynomials.
</p>
</div>
</div>

<div id="outline-container-org0a6cb5d" class="outline-4">
<h4 id="org0a6cb5d"><span class="section-number-4">3.102.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-102-2">
<p>
At first I thought I needed to rewrite the <code>order</code> and <code>coeff</code> procedures. Then
I realized these are only called with one term, and thus don&rsquo;t have the term
list available, which means the order can&rsquo;t be learned. It&rsquo;s much simpler to
make a new <code>first-term</code> selector that gets the needed info and always returns
the sparse term format, so long as <code>adjoin-set</code> is modified so it will convert
back when adding to a sparse term list.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-termlist?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span>car term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>list? t<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>                <span style="color: #c678dd;">(</span>number? <span style="color: #99bb66;">(</span>first t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>                <span style="color: #c678dd;">(</span>number? <span style="color: #99bb66;">(</span>second t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> #t<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>number? t<span style="color: #51afef;">)</span> #f<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"badly formed term: SPARSE-TERMLIST?"</span> t term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sparse-term</span> order coeff<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span>list order coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span>make-term <span style="color: #99bb66;">(</span>car term-list<span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>             <span style="color: #99bb66;">(</span>1- <span style="color: #a9a1e1;">(</span>length term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>car term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>      <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>      <span style="color: #99bb66;">(</span>dense-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org518d3c5" class="outline-3">
<h3 id="org518d3c5"><span class="section-number-3">3.103.</span> Exercise 2.90: dense polynomials integrated into the system</h3>
<div class="outline-text-3" id="text-3-103">
</div>

<div id="outline-container-orgb713cdd" class="outline-4">
<h4 id="orgb713cdd"><span class="section-number-4">3.103.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-103-1">
<p>
Suppose we want to have a polynomial system that is efficient for both sparse
and dense polynomials. One way to do this is to allow both kinds of term-list
representations in our system. The situation is analogous to the complex-number
example of <a href="#orgf2c6518">2.4: Multiple Representations for Abstract Data</a>, where we allowed
both rectangular and polar representations. To do this we must distinguish
different types of term lists and make the operations on term lists generic.
Redesign the polynomial system to implement this generalization. This is a major
effort, not a local change.
</p>
</div>
</div>

<div id="outline-container-orgad919a8" class="outline-4">
<h4 id="orgad919a8"><span class="section-number-4">3.103.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-103-2">
<p>
Although I was debating using tags to distinguish the two types, it occurs to me
they can be told apart just by checking the contents. A valid coefficient is
either a number or a list for a nested type. If the first item of the list is a
list whose <code>car</code> is a number and whose <code>cadr</code> is a number or list, assume it&rsquo;s
sparse. On the other hand, if the first item is a number, or list that doesn&rsquo;t
match that previous description, assume it&rsquo;s dense. This format would <i>not</i> be
adequate if we had any potential nested types that happened to look similar, and
especially not if the term-lists were meant for external use.
</p>

<p>
The new implementations are abstracted such that average procedures using
<code class="src src-scheme">first-term</code>, <code class="src src-scheme">rest-term</code> and <code class="src src-scheme">adjoin-term</code> are
totally unaffected.
</p>

<p>
Whenever a procedure requests a <code>first-term</code>, a sparse representation is
returned (pair of <code class="src src-scheme"><span style="color: #51afef;">(</span>order coeff<span style="color: #51afef;">)</span></code>). Then, when <code>adjoin-term</code> is run,
the list is appended-to appropriately whether it is sparse or dense. When
<code class="src src-scheme">make-poly</code> is run, the statistics of the term list are measured to
decide which implementation should be used. If there are more zero-terms than
\(\frac{1}{2}\) of the highest order in the term, the sparse implementation is
used.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org35d1451"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polynomial-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">  3: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">  4: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">representation of poly</span>
<span class="linenr">  5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-poly</span> variable term-list<span style="color: #99bb66;">)</span>
<span class="linenr">  6: </span>    <span style="color: #99bb66;">(</span>cons variable
<span class="linenr">  7: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr">  8: </span>              term-list
<span class="linenr">  9: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>sparse-termlist? term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 10: </span>                          <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>should-be-sparse? term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 11: </span>                     <span style="color: #99bb66;">(</span>sparse-to-dense term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 12: </span>                    <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>sparse-termlist? term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 13: </span>                          <span style="color: #a9a1e1;">(</span>should-be-sparse? term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 14: </span>                     <span style="color: #99bb66;">(</span>dense-to-sparse term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 15: </span>                    <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span> term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 16: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">variable</span> p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 17: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">terms</span> p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 18: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>symbol? x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 19: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #99bb66;">)</span>
<span class="linenr"> 20: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>variable? v1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable? v2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>eq? v1 v2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 21: </span>  
<span class="linenr"> 22: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">representation of terms and term lists</span>
<span class="linenr"> 23: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sparse-termlist?</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 24: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t <span style="color: #c678dd;">(</span>car term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 25: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>list? t<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks like a sparse list</span>
<span class="linenr"> 26: </span>                  <span style="color: #99bb66;">(</span>number? <span style="color: #a9a1e1;">(</span>first t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 27: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span>list? <span style="color: #51afef;">(</span>second t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or sparse with nested poly</span>
<span class="linenr"> 28: </span>                      <span style="color: #a9a1e1;">(</span>number? <span style="color: #51afef;">(</span>second t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span>            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>number? t<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks dense</span>
<span class="linenr"> 30: </span>                 <span style="color: #99bb66;">(</span>list? t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or dense with a nested poly</span>
<span class="linenr"> 31: </span>            <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>error <span style="color: #99bb66;">"badly formed term: SPARSE-TERMLIST?"</span> t term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 32: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">should-be-sparse?</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 33: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">sparse or dense term-list -&gt; bool</span>
<span class="linenr"> 34: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if more than half of term-list is zeroes, return true</span>
<span class="linenr"> 35: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">reasoning:</span>
<span class="linenr"> 36: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for sparse list is (non-zero elements * 2)</span>
<span class="linenr"> 37: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for dense list is (highest order)</span>
<span class="linenr"> 38: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">count-zeroes</span> term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 39: </span>      <span style="color: #525252;">;; </span><span style="color: #525252;">term-list -&gt; (highest order, zeroes)</span>
<span class="linenr"> 40: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>length <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 41: </span>                 <span style="color: #c678dd;">(</span>zeroes <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 42: </span>                 <span style="color: #c678dd;">(</span>TL <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>sparse-termlist? term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 43: </span>                         <span style="color: #a9a1e1;">(</span>sparse-to-dense term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 44: </span>                         term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 45: </span>        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>empty-termlist? TL<span style="color: #c678dd;">)</span>
<span class="linenr"> 46: </span>            <span style="color: #c678dd;">(</span>list zeroes length<span style="color: #c678dd;">)</span>
<span class="linenr"> 47: </span>            <span style="color: #c678dd;">(</span>iter <span style="color: #99bb66;">(</span>1+ length<span style="color: #99bb66;">)</span>
<span class="linenr"> 48: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>=zero? <span style="color: #51afef;">(</span>car TL<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 49: </span>                      <span style="color: #a9a1e1;">(</span>1+ zeroes<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 50: </span>                      zeroes<span style="color: #99bb66;">)</span>
<span class="linenr"> 51: </span>                  <span style="color: #99bb66;">(</span>cdr TL<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 52: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>stats <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">do appropriate measurement</span>
<span class="linenr"> 53: </span>                     <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>1+ <span style="color: #c678dd;">(</span>order <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 54: </span>                              <span style="color: #51afef;">(</span>length term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 55: </span>                           <span style="color: #a9a1e1;">(</span>1+ <span style="color: #51afef;">(</span>order <span style="color: #c678dd;">(</span>sparse-first-term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 56: </span>                     <span style="color: #99bb66;">(</span>count-zeroes term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 57: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>zero-elements <span style="color: #99bb66;">(</span>first stats<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 58: </span>            <span style="color: #c678dd;">(</span>highest-order <span style="color: #99bb66;">(</span>second stats<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 59: </span>        <span style="color: #51afef;">(</span>&gt; <span style="color: #c678dd;">(</span>/ zero-elements highest-order<span style="color: #c678dd;">)</span>
<span class="linenr"> 60: </span>           <span style="color: #c678dd;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 61: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sparse-to-dense</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 62: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>old-list <span style="color: #c678dd;">(</span>reverse term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 63: </span>               <span style="color: #51afef;">(</span>new-list <span style="color: #c678dd;">(</span>the-empty-termlist<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 64: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 65: </span>          new-list
<span class="linenr"> 66: </span>          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>rest-terms old-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 67: </span>                <span style="color: #c678dd;">(</span>adjoin-term-dense <span style="color: #99bb66;">(</span>sparse-first-term old-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 68: </span>                                   new-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 69: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">dense-to-sparse</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 70: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>old-list <span style="color: #c678dd;">(</span>reverse term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span>               <span style="color: #51afef;">(</span>old-order <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 72: </span>               <span style="color: #51afef;">(</span>new-list <span style="color: #c678dd;">(</span>the-empty-termlist<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 73: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 74: </span>          new-list
<span class="linenr"> 75: </span>          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>rest-terms old-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 76: </span>                <span style="color: #c678dd;">(</span>1+ old-order<span style="color: #c678dd;">)</span>
<span class="linenr"> 77: </span>                <span style="color: #c678dd;">(</span>adjoin-term-sparse <span style="color: #99bb66;">(</span>make-sparse-term old-order
<span class="linenr"> 78: </span>                                                      <span style="color: #a9a1e1;">(</span>coeff <span style="color: #51afef;">(</span>dense-first-term old-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 79: </span>                                    new-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 80: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-sparse-term</span> order coeff<span style="color: #99bb66;">)</span>
<span class="linenr"> 81: </span>    <span style="color: #99bb66;">(</span>list order coeff<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 82: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">dense-termlist-order</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 83: </span>    <span style="color: #99bb66;">(</span>1- <span style="color: #a9a1e1;">(</span>length term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 84: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">dense-first-term</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 85: </span>    <span style="color: #99bb66;">(</span>make-sparse-term <span style="color: #a9a1e1;">(</span>dense-termlist-order term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 86: </span>                      <span style="color: #a9a1e1;">(</span>car term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 87: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sparse-first-term</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 88: </span>    <span style="color: #99bb66;">(</span>car term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 89: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">first-term</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 90: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>sparse-termlist? term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 91: </span>        <span style="color: #a9a1e1;">(</span>sparse-first-term term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 92: </span>        <span style="color: #a9a1e1;">(</span>dense-first-term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 93: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">adjoin-term-sparse</span> term term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 94: </span>    <span style="color: #99bb66;">(</span>cons term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 95: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">adjoin-term-dense</span> term term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 96: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if term is exactly 1 order above top of list, adjoin</span>
<span class="linenr"> 97: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if term is more than 1 order above, adjoin 0 and recurse</span>
<span class="linenr"> 98: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>top-order <span style="color: #c678dd;">(</span>dense-termlist-order term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 99: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>= <span style="color: #99bb66;">(</span>1+ top-order<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">100: </span>             <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>coeff term<span style="color: #99bb66;">)</span> term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">101: </span>            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>&lt;= top-order <span style="color: #99bb66;">(</span>order term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">102: </span>             <span style="color: #c678dd;">(</span>adjoin-term-dense term <span style="color: #99bb66;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span> term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">103: </span>            <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>error <span style="color: #99bb66;">"term is lower order than top of list: ADJOIN-TERM-DENSE"</span> term term-list top-order<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">104: </span>
<span class="linenr">105: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">;; I wrote the versions below which can insert into the middle of the list,</span>
<span class="linenr">106: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">;; before remembering that a footnote in the text excuses this.</span>
<span class="linenr">107: </span>  <span style="color: #525252;">;;</span>
<span class="linenr">108: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">(define (adjoin-term-sparse term term-list)</span>
<span class="linenr">109: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is higher order, cons to list</span>
<span class="linenr">110: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">111: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">(let ((top-order (order (sparse-first-term term-list))))</span>
<span class="linenr">112: </span>  <span style="color: #525252;">;;     </span><span style="color: #525252;">(cond ((&lt;= (1+ top-order) (order term))</span>
<span class="linenr">113: </span>  <span style="color: #525252;">;;            </span><span style="color: #525252;">(cons term term-list))</span>
<span class="linenr">114: </span>  <span style="color: #525252;">;;           </span><span style="color: #525252;">(else (adjoin-term-sparse (sparse-first-term term-list)</span>
<span class="linenr">115: </span>  <span style="color: #525252;">;;                                     </span><span style="color: #525252;">(adjoin-term-sparse term</span>
<span class="linenr">116: </span>  <span style="color: #525252;">;;                                                         </span><span style="color: #525252;">(rest-terms term-list)))))))</span>
<span class="linenr">117: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">(define (adjoin-term-dense term term-list)</span>
<span class="linenr">118: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is 1 order above top of list, adjoin</span>
<span class="linenr">119: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is more than 1 order above, adjoin 0 and recurse</span>
<span class="linenr">120: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">121: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">(let ((top-order (dense-termlist-order term-list)))</span>
<span class="linenr">122: </span>  <span style="color: #525252;">;;     </span><span style="color: #525252;">(cond ((= (1+ top-order) (order term))</span>
<span class="linenr">123: </span>  <span style="color: #525252;">;;            </span><span style="color: #525252;">(cons (coeff term) term-list))</span>
<span class="linenr">124: </span>  <span style="color: #525252;">;;           </span><span style="color: #525252;">((&lt;= top-order (order term))</span>
<span class="linenr">125: </span>  <span style="color: #525252;">;;            </span><span style="color: #525252;">(adjoin-term-dense term (cons 0 term-list)))</span>
<span class="linenr">126: </span>  <span style="color: #525252;">;;           </span><span style="color: #525252;">(else (adjoin-term-dense (dense-first-term term-list)</span>
<span class="linenr">127: </span>  <span style="color: #525252;">;;                                    </span><span style="color: #525252;">(adjoin-term-dense term</span>
<span class="linenr">128: </span>  <span style="color: #525252;">;;                                                       </span><span style="color: #525252;">(rest-terms term-list)))))))</span>
<span class="linenr">129: </span>
<span class="linenr">130: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">adjoin-term</span> term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">131: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>=zero? <span style="color: #51afef;">(</span>coeff term<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">132: </span>        term-list
<span class="linenr">133: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span>empty-termlist? term-list<span style="color: #c678dd;">)</span>
<span class="linenr">134: </span>                <span style="color: #c678dd;">(</span>sparse-termlist? term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">135: </span>            <span style="color: #51afef;">(</span>adjoin-term-sparse term term-list<span style="color: #51afef;">)</span>
<span class="linenr">136: </span>            <span style="color: #51afef;">(</span>adjoin-term-dense term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">137: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">the-empty-termlist</span><span style="color: #99bb66;">)</span> '<span style="color: #99bb66;">()</span><span style="color: #c678dd;">)</span>
<span class="linenr">138: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">rest-terms</span> term-list<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">139: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">empty-termlist?</span> term-list<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>null? term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">140: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">order</span> term<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>first term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">141: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">coeff</span> term<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>second term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">142: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-poly</span> p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">143: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">144: </span>        <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span>
<span class="linenr">145: </span>                   <span style="color: #51afef;">(</span>add-terms <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">146: </span>        <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"Polys not in same var: ADD-POLY"</span> <span style="color: #51afef;">(</span>list p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">147: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-poly</span> p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">148: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">149: </span>        <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span>
<span class="linenr">150: </span>                   <span style="color: #51afef;">(</span>mul-terms <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">151: </span>        <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"Polys not in same var: MUL-POLY"</span> <span style="color: #51afef;">(</span>list p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">152: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-terms</span> L1 L2<span style="color: #99bb66;">)</span>
<span class="linenr">153: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>empty-termlist? L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span>
<span class="linenr">154: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>empty-termlist? L2<span style="color: #51afef;">)</span> L1<span style="color: #a9a1e1;">)</span>
<span class="linenr">155: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">156: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>t1 <span style="color: #a9a1e1;">(</span>first-term L1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">157: </span>                 <span style="color: #99bb66;">(</span>t2 <span style="color: #a9a1e1;">(</span>first-term L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">158: </span>             <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">159: </span>                    <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">160: </span>                     t1 <span style="color: #51afef;">(</span>add-terms <span style="color: #c678dd;">(</span>rest-terms L1<span style="color: #c678dd;">)</span> L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">161: </span>                   <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&lt; <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">162: </span>                    <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">163: </span>                     t2 <span style="color: #51afef;">(</span>add-terms L1 <span style="color: #c678dd;">(</span>rest-terms L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">164: </span>                   <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">165: </span>                    <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">166: </span>                     <span style="color: #51afef;">(</span>make-sparse-term <span style="color: #c678dd;">(</span>order t1<span style="color: #c678dd;">)</span>
<span class="linenr">167: </span>                                       <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">168: </span>                     <span style="color: #51afef;">(</span>add-terms <span style="color: #c678dd;">(</span>rest-terms L1<span style="color: #c678dd;">)</span>
<span class="linenr">169: </span>                                <span style="color: #c678dd;">(</span>rest-terms L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">170: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-terms</span> L1 L2<span style="color: #99bb66;">)</span>
<span class="linenr">171: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? L1<span style="color: #a9a1e1;">)</span>
<span class="linenr">172: </span>        <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span>
<span class="linenr">173: </span>        <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>mul-term-by-all-terms <span style="color: #c678dd;">(</span>first-term L1<span style="color: #c678dd;">)</span> L2<span style="color: #51afef;">)</span>
<span class="linenr">174: </span>                   <span style="color: #51afef;">(</span>mul-terms <span style="color: #c678dd;">(</span>rest-terms L1<span style="color: #c678dd;">)</span> L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">175: </span>  
<span class="linenr">176: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">177: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'polynomial p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">178: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>polynomial polynomial<span style="color: #99bb66;">)</span>
<span class="linenr">179: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p1 p2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-poly p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">180: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>polynomial polynomial<span style="color: #99bb66;">)</span>
<span class="linenr">181: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p1 p2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-poly p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">182: </span>  <span style="color: #c678dd;">(</span>put 'make 'polynomial
<span class="linenr">183: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>var terms<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-poly var terms<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">184: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">if-1st-poly-make-2nd-poly</span> t1 t2<span style="color: #99bb66;">)</span>
<span class="linenr">185: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>eqv? 'polynomial <span style="color: #c678dd;">(</span>type-tag t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">186: </span>             <span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span>eqv? 'polynomial <span style="color: #99bb66;">(</span>type-tag t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">187: </span>        <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable <span style="color: #99bb66;">(</span>contents t1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>list t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">188: </span>        t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">189: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-term-by-all-terms</span> t1 L<span style="color: #99bb66;">)</span>
<span class="linenr">190: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? L<span style="color: #a9a1e1;">)</span>
<span class="linenr">191: </span>        <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span>
<span class="linenr">192: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>first-term L<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">If one coeff is a poly, make the other a poly</span>
<span class="linenr">193: </span>               <span style="color: #c678dd;">(</span>t1-coeff <span style="color: #99bb66;">(</span>if-1st-poly-make-2nd-poly <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">194: </span>               <span style="color: #c678dd;">(</span>t2-coeff <span style="color: #99bb66;">(</span>if-1st-poly-make-2nd-poly <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">195: </span>          
<span class="linenr">196: </span>          <span style="color: #51afef;">(</span>adjoin-term
<span class="linenr">197: </span>           <span style="color: #c678dd;">(</span>make-sparse-term <span style="color: #99bb66;">(</span>+ <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">198: </span>                             <span style="color: #99bb66;">(</span>mul t1-coeff t2-coeff<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">199: </span>           <span style="color: #c678dd;">(</span>mul-term-by-all-terms t1 <span style="color: #99bb66;">(</span>rest-terms L<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">200: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">terms-=zero?</span> L<span style="color: #99bb66;">)</span>
<span class="linenr">201: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span>empty-termlist? L<span style="color: #a9a1e1;">)</span>
<span class="linenr">202: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>=zero? <span style="color: #c678dd;">(</span>coeff <span style="color: #99bb66;">(</span>first-term L<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">203: </span>             <span style="color: #51afef;">(</span>terms-=zero? <span style="color: #c678dd;">(</span>rest-terms L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">204: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">poly-=zero?</span> p<span style="color: #99bb66;">)</span>
<span class="linenr">205: </span>    <span style="color: #99bb66;">(</span>terms-=zero? <span style="color: #a9a1e1;">(</span>terms p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">206: </span>  <span style="color: #c678dd;">(</span>put '=zero? '<span style="color: #99bb66;">(</span>polynomial<span style="color: #99bb66;">)</span> poly-=zero?<span style="color: #c678dd;">)</span>
<span class="linenr">207: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">neg-terms</span> TL<span style="color: #99bb66;">)</span>
<span class="linenr">208: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>negterm <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? TL<span style="color: #99bb66;">)</span>
<span class="linenr">209: </span>                       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>t<span style="color: #a9a1e1;">)</span>
<span class="linenr">210: </span>                         <span style="color: #a9a1e1;">(</span>make-sparse-term <span style="color: #51afef;">(</span>order t<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>neg <span style="color: #c678dd;">(</span>coeff t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">211: </span>                       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>t<span style="color: #a9a1e1;">)</span>
<span class="linenr">212: </span>                         <span style="color: #a9a1e1;">(</span>neg <span style="color: #51afef;">(</span>coeff t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">213: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> negterm TL<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">214: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-terms</span> T1 T2<span style="color: #99bb66;">)</span>
<span class="linenr">215: </span>    <span style="color: #99bb66;">(</span>add-terms T1 <span style="color: #a9a1e1;">(</span>neg-terms T2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">216: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">neg-poly</span> p<span style="color: #99bb66;">)</span>
<span class="linenr">217: </span>    <span style="color: #99bb66;">(</span>make-poly <span style="color: #a9a1e1;">(</span>variable p<span style="color: #a9a1e1;">)</span>
<span class="linenr">218: </span>               <span style="color: #a9a1e1;">(</span>neg-terms <span style="color: #51afef;">(</span>terms p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">219: </span>  <span style="color: #c678dd;">(</span>put 'neg '<span style="color: #99bb66;">(</span>polynomial<span style="color: #99bb66;">)</span>
<span class="linenr">220: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>neg-poly p1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">221: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-poly</span> p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">222: </span>    <span style="color: #99bb66;">(</span>add-poly p1 <span style="color: #a9a1e1;">(</span>neg-poly p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">223: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>polynomial polynomial<span style="color: #99bb66;">)</span>
<span class="linenr">224: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>p1 p2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-poly p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org272e74d"><span class="linenr">1: </span>  'done<span style="color: #ff6655; font-weight: bold;">)</span>
<span class="linenr">2: </span><span style="color: #ff6655; font-weight: bold;">(</span><span style="color: #51afef;">define</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">make-polynomial</span> var terms<span style="color: #51afef;">)</span>
<span class="linenr">3: </span>  <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>get 'make 'polynomial<span style="color: #c678dd;">)</span> var terms<span style="color: #51afef;">)</span><span style="color: #ff6655; font-weight: bold;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-drop&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-complex-parts&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr"> 16: </span>
<span class="linenr"> 17: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-sparse-dense-top&gt;&gt;</span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-sparse-dense-bottom&gt;&gt;</span>
<span class="linenr"> 19: </span>
<span class="linenr"> 20: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 21: </span>
<span class="linenr"> 22: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 23: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 24: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 25: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 26: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 27: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span>
<span class="linenr"> 33: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 34: </span>
<span class="linenr"> 35: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 36: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 37: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 38: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 39: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 40: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 41: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 42: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 43: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 44: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 45: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 46: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 47: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 48: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 49: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 50: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 51: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 52: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 53: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 54: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 55: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 56: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 57: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 58: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 59: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 60: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 61: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 62: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 63: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 64: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 65: </span>                                      <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 66: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 67: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 68: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 69: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 70: </span>
<span class="linenr"> 71: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 72: </span>      <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 73: </span>      <span style="color: #99bb66;">(</span>p3 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 74: </span>      <span style="color: #99bb66;">(</span>p4 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 75: </span>      <span style="color: #99bb66;">(</span>p5 '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 76: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 77: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 78: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 79: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 80: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 81: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 82: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 83: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 84: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr"> 85: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 86: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 87: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 88: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr"> 89: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 90: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 91: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 92: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr"> 93: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 94: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr"> 95: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 96: </span>             <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 97: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr"> 98: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 99: </span>             <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">100: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">101: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">102: </span>             <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">103: </span>
<span class="linenr">104: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">105: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">106: </span>             <span style="color: #99bb66;">(</span>make-polynomial 'x p4<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">107: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">108: </span>             <span style="color: #99bb66;">(</span>sub <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">109: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p3<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">110: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgb5a6200">
(etc...)
SUCCEED at negation polynomials
SUCCEED at polynomial subtraction
</pre>
</div>
</div>
</div>

<div id="outline-container-orge16d28a" class="outline-3">
<h3 id="orge16d28a"><span class="section-number-3">3.104.</span> Exercise 2.91: division of polynomials</h3>
<div class="outline-text-3" id="text-3-104">
</div>

<div id="outline-container-orgb7bcddd" class="outline-4">
<h4 id="orgb7bcddd"><span class="section-number-4">3.104.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-104-1">
<p>
A univariate polynomial can be divided by another one to produce a polynomial
quotient and a polynomial remainder. For example,
</p>

<p>
\(\frac{x^5 - 1}{x^2 - 1} = x^3 + x, \hbox{  remainder  } x - 1\)
</p>

<p>
Division can be performed via long division.  That is, divide the highest-order
term of the dividend by the highest-order term of the divisor.  The result is
the first term of the quotient.  Next, multiply the result by the divisor,
subtract that from the dividend, and produce the rest of the answer by
recursively dividing the difference by the divisor.  Stop when the order of the
divisor exceeds the order of the dividend and declare the dividend to be the
remainder.  Also, if the dividend ever becomes zero, return zero as both
quotient and remainder.
</p>

<p>
We can design a <code class="src src-scheme">div-poly</code> procedure on the model of
<code class="src src-scheme">add-poly</code> and <code class="src src-scheme">mul-poly</code>. The procedure checks to see if
the two polys have the same variable. If so, <code class="src src-scheme">div-poly</code> strips off the
variable and passes the problem to <code class="src src-scheme">div-terms</code>, which performs the
division operation on term lists. <code class="src src-scheme">div-poly</code> finally reattaches the
variable to the result supplied by <code class="src src-scheme">div-terms</code>. It is convenient to
design <code class="src src-scheme">div-terms</code> to compute both the quotient and the remainder of a
division. <code class="src src-scheme">div-terms</code> can take two term lists as arguments and return
a list of the quotient term list and the remainder term list.
</p>

<p>
Complete the following definition of <code class="src src-scheme">div-terms</code> by filling in the
missing expressions. Use this to implement <code class="src src-scheme">div-poly</code>, which takes two
polys as arguments and returns a list of the quotient and remainder polys.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L1<span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>      <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t1 <span style="color: #c678dd;">(</span>first-term L1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span>            <span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>&gt; <span style="color: #c678dd;">(</span>order t2<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>            <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>the-empty-termlist<span style="color: #c678dd;">)</span> L1<span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>            <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>new-c <span style="color: #a9a1e1;">(</span>div <span style="color: #51afef;">(</span>coeff t1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>coeff t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>                  <span style="color: #99bb66;">(</span>new-o <span style="color: #a9a1e1;">(</span>- <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest-of-result
<span class="linenr">11: </span>                     <span style="color: #525252;">;;</span><span style="color: #525252;">&lt;compute rest of result recursively&gt;</span>
<span class="linenr">12: </span>                     <span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>                <span style="color: #525252;">;;</span><span style="color: #525252;">&lt;form complete result&gt;</span>
<span class="linenr">14: </span>                <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org5196497" class="outline-4">
<h4 id="org5196497"><span class="section-number-4">3.104.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-104-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org9573bd8"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">termlist, termlist -&gt; list of two termlists</span>
<span class="linenr"> 3: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">returns quotient terms and remainder terms</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L1<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>      <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t1 <span style="color: #c678dd;">(</span>first-term L1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span>            <span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>&gt; <span style="color: #c678dd;">(</span>order t2<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span>            <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>the-empty-termlist<span style="color: #c678dd;">)</span> L1<span style="color: #51afef;">)</span>
<span class="linenr">10: </span>            <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>new-term <span style="color: #a9a1e1;">(</span>make-sparse-term <span style="color: #51afef;">(</span>- <span style="color: #c678dd;">(</span>order t1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">11: </span>                                               <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>coeff t1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>coeff t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>                   <span style="color: #99bb66;">(</span>rest-of-result
<span class="linenr">13: </span>                    <span style="color: #a9a1e1;">(</span>div-terms <span style="color: #51afef;">(</span>sub-terms L1
<span class="linenr">14: </span>                                          <span style="color: #c678dd;">(</span>mul-terms <span style="color: #99bb66;">(</span>list new-term<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                                                     L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span>                               L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>              <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>adjoin-term new-term
<span class="linenr">18: </span>                                 <span style="color: #a9a1e1;">(</span>car rest-of-result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>                    <span style="color: #99bb66;">(</span>cadr rest-of-result<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">poly, poly -&gt; list of 2 polys</span>
<span class="linenr">22: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">returns quotient poly and remainder poly</span>
<span class="linenr">23: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>div-terms <span style="color: #99bb66;">(</span>terms p1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>terms p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span>             <span style="color: #51afef;">(</span>quotient <span style="color: #c678dd;">(</span>car result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">26: </span>             <span style="color: #51afef;">(</span>remainder <span style="color: #c678dd;">(</span>cadr result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">27: </span>        <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span> quotient<span style="color: #51afef;">)</span>
<span class="linenr">28: </span>              <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span> remainder<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Polys not in same var: DIV-POLY"</span> <span style="color: #a9a1e1;">(</span>list p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">30: </span><span style="color: #51afef;">(</span>put 'div '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">31: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>div-poly p1 p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">33: </span>              <span style="color: #51afef;">(</span>quotient <span style="color: #c678dd;">(</span>car result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">34: </span>              <span style="color: #51afef;">(</span>remainder <span style="color: #c678dd;">(</span>cadr result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">35: </span>         <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>tag quotient<span style="color: #51afef;">)</span>
<span class="linenr">36: </span>               <span style="color: #51afef;">(</span>tag remainder<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-drop&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-complex-parts&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span><span style="color: #ECBE7B;">&lt;&lt;basic-tower-coercions&gt;&gt;</span>
<span class="linenr"> 16: </span>
<span class="linenr"> 17: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-sparse-dense-top&gt;&gt;</span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-division&gt;&gt;</span>
<span class="linenr"> 19: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-sparse-dense-bottom&gt;&gt;</span>
<span class="linenr"> 20: </span>
<span class="linenr"> 21: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 24: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 25: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 26: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 27: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 33: </span>
<span class="linenr"> 34: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 35: </span>
<span class="linenr"> 36: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 37: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 38: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 39: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 40: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 41: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 42: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 43: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 44: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 45: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 46: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 47: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 48: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 49: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 50: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 51: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 52: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 53: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 54: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 55: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 56: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 57: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 58: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 59: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 60: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 61: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 62: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 63: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 64: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 65: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 66: </span>                                      <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 67: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 68: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 69: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 70: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span>
<span class="linenr"> 72: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 73: </span>      <span style="color: #99bb66;">(</span>p2 <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 74: </span>      <span style="color: #99bb66;">(</span>p3 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 75: </span>      <span style="color: #99bb66;">(</span>p4 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 76: </span>      <span style="color: #99bb66;">(</span>p5 '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 77: </span>      <span style="color: #99bb66;">(</span>p7 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 78: </span>      <span style="color: #99bb66;">(</span>p6 '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 79: </span>      <span style="color: #99bb66;">(</span>p66 '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 80: </span>      <span style="color: #99bb66;">(</span>p77 '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 81: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 82: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 83: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 84: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 85: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 86: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 87: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 88: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 89: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr"> 90: </span>             <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 91: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 92: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 93: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr"> 94: </span>             <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>make-polynomial 'x p2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 95: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 96: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #51afef;">(</span>polynomial x <span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 97: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr"> 98: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 99: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr">100: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">101: </span>             <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">102: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr">103: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">104: </span>             <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">105: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">106: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">107: </span>             <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">108: </span>
<span class="linenr">109: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">110: </span>             <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">111: </span>             <span style="color: #99bb66;">(</span>make-polynomial 'x p4<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">112: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">113: </span>             <span style="color: #99bb66;">(</span>sub <span style="color: #a9a1e1;">(</span>make-polynomial 'x p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">114: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p3<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">115: </span>             '<span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">116: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 1"</span>
<span class="linenr">117: </span>             <span style="color: #99bb66;">(</span>div <span style="color: #a9a1e1;">(</span>make-polynomial 'x p6<span style="color: #a9a1e1;">)</span>
<span class="linenr">118: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p7<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">119: </span>             '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>polynomial x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">120: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 2"</span>
<span class="linenr">121: </span>             <span style="color: #99bb66;">(</span>div <span style="color: #a9a1e1;">(</span>make-polynomial 'x p7<span style="color: #a9a1e1;">)</span>
<span class="linenr">122: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p6<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">123: </span>             '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>polynomial x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">124: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 3"</span>
<span class="linenr">125: </span>             <span style="color: #99bb66;">(</span>div <span style="color: #a9a1e1;">(</span>make-polynomial 'x p66<span style="color: #a9a1e1;">)</span>
<span class="linenr">126: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'x p77<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">127: </span>             '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>polynomial x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgfc81701">
(etc...)
SUCCEED at polynomial division 1
SUCCEED at polynomial division 2
SUCCEED at polynomial division 3
</pre>
</div>
</div>
</div>

<div id="outline-container-org1306cf6" class="outline-3">
<h3 id="org1306cf6"><span class="section-number-3">3.105.</span> Exercise 2.92: operating on polys in different variables</h3>
<div class="outline-text-3" id="text-3-105">
</div>

<div id="outline-container-orgf3f5af5" class="outline-4">
<h4 id="orgf3f5af5"><span class="section-number-4">3.105.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-105-1">
<p>
By imposing an ordering on variables, extend the polynomial package so that
addition and multiplication of polynomials works for polynomials in different
variables. (This is not easy!)
</p>
</div>
</div>

<div id="outline-container-orgcbb35bd" class="outline-4">
<h4 id="orgcbb35bd"><span class="section-number-4">3.105.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-105-2">
<div class="org-center">
<p>
<i><i>Unfortunately, I&rsquo;ve spent a lot of time on this without making progress. For
some reason it&rsquo;s really screwed with my brain. I&rsquo;m going to move on to
<a href="#org767df2f">Exercise 2.93</a></i></i>
</p>
</div>

<p>
If I understand the previous section correctly, I need to change the polynomial
procedures so that when given two polys which include similar terms, say \(x\)
with coefficients in \(y\) and \(y\) with coefficients in \(x\), I need to pick
one variable to be priority, and convert the other expression to match that
priority. I suppose this would also need to work with multiple layers of
polynomials, say a poly of \(w\) with nested coefficients \(x^y^z\) and \(y\)
with \(w^z^y\).
</p>

<p>
I&rsquo;ve also decided to upgrade my <code class="src src-scheme">adjoin-terms</code> procedures so that they
can adjoin to the middle of lists, or attempt to add two coefficients of the
same order.
</p>

<p>
I&rsquo;ve <i>also</i> also decided to add polynomials to the type coercion tower. This
will require putting a variable on the new polynomial, but it will be a poly of
one term of the 0&rsquo;th order, which isn&rsquo;t really a polynomial. I&rsquo;ll need to add a
check, <code class="src src-scheme">trivial-poly?</code>, which will allow the procedures to ignore the
variable of such a polynomial.
</p>

<p>
My earlier choice to not tag sparse and dense lists may be coming back to bite
me, now that I&rsquo;m nesting items in the coefficients.
</p>

<p>
In the process of reorganizing polynomials, I&rsquo;ll make a hash table, and find the
terms in the poly which are not dependent on the top variable, and split them
into their own keys in the table. So for any terms of order 0, if it&rsquo;s a poly
it&rsquo;ll get keyed to the variable of the poly, and if it&rsquo;s not it&rsquo;ll be keyed to
the symbol <code class="src src-scheme">'ZEROTH</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org4e90d77"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tower</span>
<span class="linenr"> 2: </span>  '<span style="color: #c678dd;">(</span>scheme-number rational real complex polynomial<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">raise</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>type-tag x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">recurse</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>ll tower<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>car ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>cdr ll<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> #f<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>              <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>equal? t1 t2<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>               <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get-coercion t1 <span style="color: #51afef;">(</span>cadr ll<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>contents x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span> <span style="color: #99bb66;">(</span>recurse <span style="color: #a9a1e1;">(</span>cdr ll<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span>put-coercion 'scheme-number 'rational
<span class="linenr">14: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">15: </span>                <span style="color: #99bb66;">(</span>make-rational num <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #ECBE7B;">&lt;&lt;eqnumber&gt;&gt;</span>
<span class="linenr">17: </span><span style="color: #51afef;">(</span>put-coercion 'rational 'real
<span class="linenr">18: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>                <span style="color: #99bb66;">(</span>make-real
<span class="linenr">20: </span>                 <span style="color: #a9a1e1;">(</span>exact-&gt;inexact <span style="color: #51afef;">(</span>/ <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span>
<span class="linenr">21: </span>                                    <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">22: </span><span style="color: #51afef;">(</span>put-coercion 'real 'complex
<span class="linenr">23: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>                <span style="color: #99bb66;">(</span>make-complex-from-real-imag
<span class="linenr">25: </span>                 num <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">26: </span><span style="color: #51afef;">(</span>put-coercion 'complex 'polynomial
<span class="linenr">27: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>                <span style="color: #525252;">;; </span><span style="color: #525252;">poly wants tagged numbers but (put-coercion) strips tags</span>
<span class="linenr">29: </span>                <span style="color: #525252;">;; </span><span style="color: #525252;">also, might as well drop since it makes sense</span>
<span class="linenr">30: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>dropped-num <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>attach-tag 'complex num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">31: </span>                  <span style="color: #a9a1e1;">(</span>make-polynomial 'DISCARD-ME
<span class="linenr">32: </span>                                   <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">0</span> dropped-num<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org2bd5c92"><span class="linenr">1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mem-index</span> item ll<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span>list-index <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)(</span>equal? item x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">4: </span>              ll<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org800cda7"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polynomial-package</span><span style="color: #c678dd;">)</span> 'no<span style="color: #51afef;">)</span>
<span class="linenr">  3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">  4: </span><span style="color: #525252;">;; </span><span style="color: #525252;">representation of poly</span>
<span class="linenr">  5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-poly</span> variable term-list<span style="color: #c678dd;">)</span>
<span class="linenr">  6: </span>  <span style="color: #c678dd;">(</span>cons variable
<span class="linenr">  7: </span>        <span style="color: #99bb66;">(</span>convert-termlist-if-reasonable term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  9: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">terms</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 11: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
<span class="linenr"> 12: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">is-poly?</span> list<span style="color: #c678dd;">)</span>
<span class="linenr"> 14: </span>  <span style="color: #c678dd;">(</span>eqv? 'polynomial <span style="color: #99bb66;">(</span>type-tag list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span><span style="color: #525252;">;; </span><span style="color: #525252;">representation of terms and term lists</span>
<span class="linenr"> 17: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">the-empty-termlist</span><span style="color: #c678dd;">)</span> '<span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span>
<span class="linenr"> 18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rest-terms</span> term-list<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">empty-termlist?</span> term-list<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>null? term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">order</span> term<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>first term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 21: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">coeff</span> term<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>second term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 22: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sparse-term</span> order coeff<span style="color: #c678dd;">)</span>
<span class="linenr"> 23: </span>  <span style="color: #c678dd;">(</span>list order coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 24: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-termlist?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 25: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span>car term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 26: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>pair? t<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks like a sparse list</span>
<span class="linenr"> 27: </span>                <span style="color: #c678dd;">(</span>number? <span style="color: #99bb66;">(</span>first t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 28: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>pair? <span style="color: #a9a1e1;">(</span>second t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or sparse with nested poly</span>
<span class="linenr"> 29: </span>                    <span style="color: #99bb66;">(</span>number? <span style="color: #a9a1e1;">(</span>second t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 30: </span>                    <span style="color: #99bb66;">(</span>empty-termlist? <span style="color: #a9a1e1;">(</span>second t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> #t<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 31: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span>number? t<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks dense</span>
<span class="linenr"> 32: </span>               <span style="color: #c678dd;">(</span>pair? t<span style="color: #c678dd;">)</span>
<span class="linenr"> 33: </span>               <span style="color: #c678dd;">(</span>empty-termlist? term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> #f<span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or dense with a nested poly</span>
<span class="linenr"> 34: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"badly formed term: SPARSE-TERMLIST?"</span> t term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 35: </span><span style="color: #525252;">;; </span><span style="color: #525252;">term and termlist procedures</span>
<span class="linenr"> 36: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">should-be-sparse?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 37: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">sparse or dense term-list -&gt; bool</span>
<span class="linenr"> 38: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if more than half of term-list is zeroes, return true</span>
<span class="linenr"> 39: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">reasoning:</span>
<span class="linenr"> 40: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for sparse list is (non-zero elements * 2)</span>
<span class="linenr"> 41: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for dense list is (highest order)</span>
<span class="linenr"> 42: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">also, if term-list is 1 non-number element, make a sparse term for clarity</span>
<span class="linenr"> 43: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">count-zeroes</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 44: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">term-list -&gt; (highest order, zeroes)</span>
<span class="linenr"> 45: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>length <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 46: </span>               <span style="color: #51afef;">(</span>zeroes <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 47: </span>               <span style="color: #51afef;">(</span>TL <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 48: </span>                       <span style="color: #99bb66;">(</span>sparse-to-dense term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 49: </span>                       term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 50: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? TL<span style="color: #51afef;">)</span>
<span class="linenr"> 51: </span>          <span style="color: #51afef;">(</span>list zeroes length<span style="color: #51afef;">)</span>
<span class="linenr"> 52: </span>          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>1+ length<span style="color: #c678dd;">)</span>
<span class="linenr"> 53: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>car TL<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 54: </span>                    <span style="color: #99bb66;">(</span>1+ zeroes<span style="color: #99bb66;">)</span>
<span class="linenr"> 55: </span>                    zeroes<span style="color: #c678dd;">)</span>
<span class="linenr"> 56: </span>                <span style="color: #c678dd;">(</span>cdr TL<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 57: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>stats <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>sparse-termlist? term-list<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">do appropriate measurement</span>
<span class="linenr"> 58: </span>                   <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>1+ <span style="color: #51afef;">(</span>order <span style="color: #c678dd;">(</span>sparse-first-term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 59: </span>                            <span style="color: #a9a1e1;">(</span>length term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 60: </span>                         <span style="color: #99bb66;">(</span>1+ <span style="color: #a9a1e1;">(</span>order <span style="color: #51afef;">(</span>sparse-first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 61: </span>                   <span style="color: #c678dd;">(</span>count-zeroes term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 62: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>zero-elements <span style="color: #c678dd;">(</span>first stats<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 63: </span>          <span style="color: #51afef;">(</span>highest-order <span style="color: #c678dd;">(</span>second stats<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 64: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>length term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 65: </span>               <span style="color: #c678dd;">(</span>not <span style="color: #99bb66;">(</span>number? <span style="color: #a9a1e1;">(</span>first-term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 66: </span>          <span style="color: #51afef;">(</span>&gt; <span style="color: #c678dd;">(</span>/ zero-elements highest-order<span style="color: #c678dd;">)</span>
<span class="linenr"> 67: </span>             <span style="color: #c678dd;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 68: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">convert-termlist-if-reasonable</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 69: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 70: </span>      term-list
<span class="linenr"> 71: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>sparse-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr"> 72: </span>             <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>tl <span style="color: #a9a1e1;">(</span>sort-sparse-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 73: </span>               <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>should-be-sparse? tl<span style="color: #99bb66;">)</span>
<span class="linenr"> 74: </span>                   tl
<span class="linenr"> 75: </span>                   <span style="color: #99bb66;">(</span>sparse-to-dense tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 76: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>should-be-sparse? term-list<span style="color: #51afef;">)</span>
<span class="linenr"> 77: </span>             <span style="color: #51afef;">(</span>dense-to-sparse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 78: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 79: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-to-dense</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 80: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>old-list <span style="color: #51afef;">(</span>reverse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 81: </span>             <span style="color: #a9a1e1;">(</span>new-list <span style="color: #51afef;">(</span>the-empty-termlist<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 82: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? old-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 83: </span>        new-list
<span class="linenr"> 84: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>rest-terms old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span>              <span style="color: #51afef;">(</span>adjoin-term-dense <span style="color: #c678dd;">(</span>sparse-first-term old-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 86: </span>                                 new-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 87: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-to-sparse</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 88: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>old-list <span style="color: #51afef;">(</span>reverse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 89: </span>             <span style="color: #a9a1e1;">(</span>old-order <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 90: </span>             <span style="color: #a9a1e1;">(</span>new-list <span style="color: #51afef;">(</span>the-empty-termlist<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 91: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? old-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 92: </span>        new-list
<span class="linenr"> 93: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>rest-terms old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 94: </span>              <span style="color: #51afef;">(</span>1+ old-order<span style="color: #51afef;">)</span>
<span class="linenr"> 95: </span>              <span style="color: #51afef;">(</span>adjoin-term-sparse <span style="color: #c678dd;">(</span>make-sparse-term old-order
<span class="linenr"> 96: </span>                                                    <span style="color: #99bb66;">(</span>coeff <span style="color: #a9a1e1;">(</span>dense-first-term old-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 97: </span>                                  new-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 98: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-termlist-order</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 99: </span>  <span style="color: #c678dd;">(</span>1- <span style="color: #99bb66;">(</span>length term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">100: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">101: </span>  <span style="color: #c678dd;">(</span>make-sparse-term <span style="color: #99bb66;">(</span>dense-termlist-order term-list<span style="color: #99bb66;">)</span>
<span class="linenr">102: </span>                    <span style="color: #99bb66;">(</span>car term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">103: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">104: </span>  <span style="color: #c678dd;">(</span>car term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">105: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">106: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">107: </span>      <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">108: </span>      <span style="color: #99bb66;">(</span>dense-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">109: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term-sparse</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">110: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if term is higher order, cons to list</span>
<span class="linenr">111: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if equal, replace or add</span>
<span class="linenr">112: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">113: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span>  <span style="color: #99bb66;">(</span>empty-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">114: </span>       <span style="color: #99bb66;">(</span>cons term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">115: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>top-order <span style="color: #c678dd;">(</span>order <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">116: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>&lt;= <span style="color: #99bb66;">(</span>1+ top-order<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">117: </span>                <span style="color: #c678dd;">(</span>cons term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">118: </span>               <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>= top-order <span style="color: #99bb66;">(</span>order term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">119: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>coeff <span style="color: #51afef;">(</span>sparse-first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">120: </span>                    <span style="color: #525252;">;; </span><span style="color: #525252;">replace if it's zero</span>
<span class="linenr">121: </span>                    <span style="color: #99bb66;">(</span>cons term <span style="color: #a9a1e1;">(</span>rest-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">122: </span>                    <span style="color: #525252;">;; </span><span style="color: #525252;">and add if it's not</span>
<span class="linenr">123: </span>                    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>add-sparse-term-to-sparse-term term
<span class="linenr">124: </span>                                                                  <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">125: </span>                      <span style="color: #a9a1e1;">(</span>cons result
<span class="linenr">126: </span>                            <span style="color: #51afef;">(</span>rest-terms term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> 
<span class="linenr">127: </span>               <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>adjoin-term-sparse <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">128: </span>                                         <span style="color: #99bb66;">(</span>adjoin-term-sparse term
<span class="linenr">129: </span>                                                             <span style="color: #a9a1e1;">(</span>rest-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">130: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term-dense</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">131: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">132: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>top-order <span style="color: #51afef;">(</span>dense-termlist-order term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">133: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span>1+ top-order<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">134: </span>           <span style="color: #525252;">;; </span><span style="color: #525252;">if term is 1 order above top of list, adjoin</span>
<span class="linenr">135: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>coeff term<span style="color: #c678dd;">)</span> term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">136: </span>          <span style="color: #525252;">;; </span><span style="color: #525252;">if term shares order with top of list, </span>
<span class="linenr">137: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= top-order <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">138: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>coeff <span style="color: #a9a1e1;">(</span>dense-first-term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">139: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">replace if it's zero</span>
<span class="linenr">140: </span>               <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>coeff term<span style="color: #99bb66;">)</span>
<span class="linenr">141: </span>                     <span style="color: #99bb66;">(</span>rest-terms term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">142: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">and add if it's not</span>
<span class="linenr">143: </span>               <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result <span style="color: #51afef;">(</span>add-sparse-term-to-sparse-term term
<span class="linenr">144: </span>                                                             <span style="color: #c678dd;">(</span>dense-first-term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">145: </span>                 <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>coeff result<span style="color: #a9a1e1;">)</span>
<span class="linenr">146: </span>                       <span style="color: #a9a1e1;">(</span>rest-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">147: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&lt; top-order <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">148: </span>           <span style="color: #51afef;">(</span>adjoin-term-dense term <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span> term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">149: </span>          <span style="color: #525252;">;; </span><span style="color: #525252;">if term is more than 1 order above, adjoin 0 and recurse</span>
<span class="linenr">150: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>adjoin-term-dense <span style="color: #c678dd;">(</span>dense-first-term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">151: </span>                                   <span style="color: #c678dd;">(</span>adjoin-term-dense term
<span class="linenr">152: </span>                                                      <span style="color: #99bb66;">(</span>rest-terms term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">153: </span>
<span class="linenr">154: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">155: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>coeff term<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">156: </span>      term-list
<span class="linenr">157: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>empty-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr">158: </span>              <span style="color: #51afef;">(</span>sparse-termlist? term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">159: </span>          <span style="color: #a9a1e1;">(</span>adjoin-term-sparse term term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">160: </span>          <span style="color: #a9a1e1;">(</span>adjoin-term-dense term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">161: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">merge-terms</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">162: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? t2<span style="color: #a9a1e1;">)</span>
<span class="linenr">163: </span>         t1<span style="color: #99bb66;">)</span>
<span class="linenr">164: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? t1<span style="color: #a9a1e1;">)</span>
<span class="linenr">165: </span>         t2<span style="color: #99bb66;">)</span>
<span class="linenr">166: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>&gt;= <span style="color: #51afef;">(</span>order <span style="color: #c678dd;">(</span>first-term t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>order <span style="color: #c678dd;">(</span>first-term t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">167: </span>         <span style="color: #a9a1e1;">(</span>adjoin-term <span style="color: #51afef;">(</span>first-term t1<span style="color: #51afef;">)</span>
<span class="linenr">168: </span>                      <span style="color: #51afef;">(</span>merge-terms <span style="color: #c678dd;">(</span>rest-terms t1<span style="color: #c678dd;">)</span> t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">169: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>adjoin-term <span style="color: #51afef;">(</span>first-term t2<span style="color: #51afef;">)</span>
<span class="linenr">170: </span>                           <span style="color: #51afef;">(</span>merge-terms t1 <span style="color: #c678dd;">(</span>rest-terms t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">171: </span><span style="color: #525252;">; </span><span style="color: #525252;">;; this second version is way simpler and way slower.</span>
<span class="linenr">172: </span><span style="color: #525252;">; </span><span style="color: #525252;">(define (merge-terms-abstracted t1 t2)</span>
<span class="linenr">173: </span><span style="color: #525252;">;   </span><span style="color: #525252;">(if (empty-termlist? t2)</span>
<span class="linenr">174: </span><span style="color: #525252;">;       </span><span style="color: #525252;">t1</span>
<span class="linenr">175: </span><span style="color: #525252;">;       </span><span style="color: #525252;">(merge-terms-abstracted (adjoin-term (first-term t2) t1)</span>
<span class="linenr">176: </span><span style="color: #525252;">;                                   </span><span style="color: #525252;">(rest-terms t2))))</span>
<span class="linenr">177: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map-terms</span> f tl<span style="color: #c678dd;">)</span>
<span class="linenr">178: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">f is called (f order coeff)</span>
<span class="linenr">179: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">180: </span>             <span style="color: #a9a1e1;">(</span>term-list tl<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">181: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">182: </span>        <span style="color: #a9a1e1;">(</span>reverse result<span style="color: #a9a1e1;">)</span>
<span class="linenr">183: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span>first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">184: </span>                      <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>order t<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">185: </span>                    result<span style="color: #51afef;">)</span>
<span class="linenr">186: </span>              <span style="color: #51afef;">(</span>rest-terms term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">187: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map2-terms</span> f tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr">188: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">189: </span>             <span style="color: #a9a1e1;">(</span>term-list1 tl1<span style="color: #a9a1e1;">)</span>
<span class="linenr">190: </span>             <span style="color: #a9a1e1;">(</span>term-list2 tl2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">191: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>empty-termlist? term-list1<span style="color: #51afef;">)</span>
<span class="linenr">192: </span>            <span style="color: #51afef;">(</span>empty-termlist? term-list2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">193: </span>        <span style="color: #a9a1e1;">(</span>reverse result<span style="color: #a9a1e1;">)</span>
<span class="linenr">194: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">195: </span>                          <span style="color: #a9a1e1;">(</span>t2 <span style="color: #51afef;">(</span>first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">196: </span>                      <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span>
<span class="linenr">197: </span>                         <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">198: </span>                    result<span style="color: #51afef;">)</span>
<span class="linenr">199: </span>              <span style="color: #51afef;">(</span>rest-terms term-list1<span style="color: #51afef;">)</span>
<span class="linenr">200: </span>              <span style="color: #51afef;">(</span>rest-terms term-list2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">201: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?-terms</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">202: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>= <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span>
<span class="linenr">203: </span>          <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">204: </span>       <span style="color: #99bb66;">(</span>equ? <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span>
<span class="linenr">205: </span>             <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">206: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sort-sparse-terms</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">207: </span>  <span style="color: #c678dd;">(</span>sort term-list <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>t1 t2<span style="color: #a9a1e1;">)</span>
<span class="linenr">208: </span>                    <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span>
<span class="linenr">209: </span>                       <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">210: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-sparse-term-to-sparse-term</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">211: </span>  <span style="color: #c678dd;">(</span>make-sparse-term <span style="color: #99bb66;">(</span>order t1<span style="color: #99bb66;">)</span>
<span class="linenr">212: </span>                    <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">213: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr">214: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? L1<span style="color: #a9a1e1;">)</span> L2<span style="color: #99bb66;">)</span>
<span class="linenr">215: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? L2<span style="color: #a9a1e1;">)</span> L1<span style="color: #99bb66;">)</span>
<span class="linenr">216: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">217: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1 <span style="color: #99bb66;">(</span>first-term L1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">218: </span>               <span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>first-term L2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">219: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>&gt; <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">220: </span>                  <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">221: </span>                   t1 <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">222: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">223: </span>                  <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">224: </span>                   t2 <span style="color: #a9a1e1;">(</span>add-terms L1 <span style="color: #51afef;">(</span>rest-terms L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">225: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">226: </span>                  <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">227: </span>                   <span style="color: #a9a1e1;">(</span>add-sparse-term-to-sparse-term t1 t2<span style="color: #a9a1e1;">)</span>
<span class="linenr">228: </span>                   <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span>
<span class="linenr">229: </span>                              <span style="color: #51afef;">(</span>rest-terms L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">230: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr">231: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L1<span style="color: #99bb66;">)</span>
<span class="linenr">232: </span>      <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr">233: </span>      <span style="color: #99bb66;">(</span>add-terms <span style="color: #a9a1e1;">(</span>mul-term-by-all-terms <span style="color: #51afef;">(</span>first-term L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span>
<span class="linenr">234: </span>                 <span style="color: #a9a1e1;">(</span>mul-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">235: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">terms-=zero?</span> L<span style="color: #c678dd;">)</span>
<span class="linenr">236: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">237: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>=zero? <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">238: </span>           <span style="color: #a9a1e1;">(</span>terms-=zero? <span style="color: #51afef;">(</span>rest-terms L<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">239: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg-terms</span> TL<span style="color: #c678dd;">)</span>
<span class="linenr">240: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>negterm <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>sparse-termlist? TL<span style="color: #c678dd;">)</span>
<span class="linenr">241: </span>                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>t<span style="color: #99bb66;">)</span>
<span class="linenr">242: </span>                       <span style="color: #99bb66;">(</span>make-sparse-term <span style="color: #a9a1e1;">(</span>order t<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>neg <span style="color: #51afef;">(</span>coeff t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">243: </span>                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>t<span style="color: #99bb66;">)</span>
<span class="linenr">244: </span>                       <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>coeff t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">245: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> negterm TL<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">246: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-terms</span> T1 T2<span style="color: #c678dd;">)</span>
<span class="linenr">247: </span>  <span style="color: #c678dd;">(</span>add-terms T1 <span style="color: #99bb66;">(</span>neg-terms T2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">248: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr">249: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">termlist, termlist -&gt; list of two termlists</span>
<span class="linenr">250: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">returns quotient terms and remainder terms</span>
<span class="linenr">251: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L1<span style="color: #99bb66;">)</span>
<span class="linenr">252: </span>      <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">253: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t1 <span style="color: #c678dd;">(</span>first-term L1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">254: </span>            <span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">255: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>&gt; <span style="color: #c678dd;">(</span>order t2<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">256: </span>            <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>the-empty-termlist<span style="color: #c678dd;">)</span> L1<span style="color: #51afef;">)</span>
<span class="linenr">257: </span>            <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>new-term <span style="color: #a9a1e1;">(</span>make-sparse-term <span style="color: #51afef;">(</span>- <span style="color: #c678dd;">(</span>order t1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">258: </span>                                               <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>coeff t1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>coeff t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">259: </span>                   <span style="color: #99bb66;">(</span>rest-of-result
<span class="linenr">260: </span>                    <span style="color: #a9a1e1;">(</span>div-terms <span style="color: #51afef;">(</span>sub-terms L1
<span class="linenr">261: </span>                                          <span style="color: #c678dd;">(</span>mul-terms <span style="color: #99bb66;">(</span>list new-term<span style="color: #99bb66;">)</span>
<span class="linenr">262: </span>                                                     L2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">263: </span>                               L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">264: </span>              <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>adjoin-term new-term
<span class="linenr">265: </span>                                 <span style="color: #a9a1e1;">(</span>car rest-of-result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">266: </span>                    <span style="color: #99bb66;">(</span>cadr rest-of-result<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">267: </span><span style="color: #525252;">;; </span><span style="color: #525252;">polynomial procedures</span>
<span class="linenr">268: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">trivial-poly?</span> poly<span style="color: #c678dd;">)</span>
<span class="linenr">269: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>length <span style="color: #51afef;">(</span>terms poly<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">270: </span>       <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #a9a1e1;">(</span>order <span style="color: #51afef;">(</span>first-term <span style="color: #c678dd;">(</span>terms poly<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">271: </span><span style="color: #525252;">;;; </span><span style="color: #ECBE7B; font-weight: bold;">TODO:</span><span style="color: #525252;"> get working once cross-variable comparisons can be done</span>
<span class="linenr">272: </span><span style="color: #51afef;">(</span>put 'project 'polynomial
<span class="linenr">273: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p<span style="color: #99bb66;">)</span>
<span class="linenr">274: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>trivial-poly? p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">275: </span>           #f
<span class="linenr">276: </span>           <span style="color: #a9a1e1;">(</span>coeff <span style="color: #51afef;">(</span>first-term <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">277: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?-poly</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr">278: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>trivial-poly? p<span style="color: #51afef;">)</span>
<span class="linenr">279: </span>              <span style="color: #51afef;">(</span>trivial-poly? q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">280: </span>         <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">281: </span>               <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term <span style="color: #99bb66;">(</span>terms q<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">282: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">283: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>term-list1 <span style="color: #99bb66;">(</span>reverse tl1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">284: </span>                    <span style="color: #c678dd;">(</span>term-list2 <span style="color: #99bb66;">(</span>reverse tl2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">285: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>empty-termlist? term-list1<span style="color: #a9a1e1;">)</span>
<span class="linenr">286: </span>                       <span style="color: #a9a1e1;">(</span>empty-termlist? term-list2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">287: </span>                  #t<span style="color: #c678dd;">)</span>
<span class="linenr">288: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span>empty-termlist? term-list1<span style="color: #a9a1e1;">)</span>
<span class="linenr">289: </span>                      <span style="color: #a9a1e1;">(</span>empty-termlist? term-list2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">290: </span>                  #f<span style="color: #c678dd;">)</span>
<span class="linenr">291: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>equ?-terms <span style="color: #a9a1e1;">(</span>first-term term-list1<span style="color: #a9a1e1;">)</span>
<span class="linenr">292: </span>                              <span style="color: #a9a1e1;">(</span>first-term term-list2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">293: </span>                  <span style="color: #99bb66;">(</span>iter <span style="color: #a9a1e1;">(</span>rest-terms term-list1<span style="color: #a9a1e1;">)</span>
<span class="linenr">294: </span>                        <span style="color: #a9a1e1;">(</span>rest-terms term-list2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">295: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span> #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">296: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"different vars not supported yet : EQU?-POLY"</span> p q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">297: </span><span style="color: #51afef;">(</span>put 'equ? '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">298: </span>     equ?-poly<span style="color: #51afef;">)</span>
<span class="linenr">299: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-variable-priority-list</span> poly<span style="color: #c678dd;">)</span>
<span class="linenr">300: </span>  <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>variable poly<span style="color: #99bb66;">)</span>
<span class="linenr">301: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">rec</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>term-list <span style="color: #c678dd;">(</span>terms poly<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">302: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr">303: </span>              '<span style="color: #51afef;">()</span>
<span class="linenr">304: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>t <span style="color: #a9a1e1;">(</span>first-term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">305: </span>                     <span style="color: #99bb66;">(</span>c <span style="color: #a9a1e1;">(</span>coeff t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">306: </span>                     <span style="color: #99bb66;">(</span>o <span style="color: #a9a1e1;">(</span>order t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">307: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>is-poly? c<span style="color: #a9a1e1;">)</span>
<span class="linenr">308: </span>                       <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>variable <span style="color: #c678dd;">(</span>contents c<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">309: </span>                             <span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>rest-terms term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">310: </span>                                     <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>terms <span style="color: #a9a1e1;">(</span>contents c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">311: </span>                      <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>rec <span style="color: #51afef;">(</span>rest-terms term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">312: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">merge-priority-lists</span> l1 l2<span style="color: #c678dd;">)</span>
<span class="linenr">313: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>null? l2<span style="color: #99bb66;">)</span>
<span class="linenr">314: </span>      l1
<span class="linenr">315: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">rec</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>to-check l1<span style="color: #51afef;">)</span>
<span class="linenr">316: </span>                <span style="color: #51afef;">(</span>checking <span style="color: #c678dd;">(</span>car l2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">317: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>null? to-check<span style="color: #c678dd;">)</span>
<span class="linenr">318: </span>               <span style="color: #c678dd;">(</span>merge-priority-lists <span style="color: #99bb66;">(</span>append l1 <span style="color: #a9a1e1;">(</span>list checking<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">319: </span>                                     <span style="color: #99bb66;">(</span>cdr l2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">320: </span>              <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>same-variable? checking <span style="color: #99bb66;">(</span>car to-check<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">321: </span>               <span style="color: #c678dd;">(</span>merge-priority-lists l1
<span class="linenr">322: </span>                                     <span style="color: #99bb66;">(</span>cdr l2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">323: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>cdr to-check<span style="color: #99bb66;">)</span> checking<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">324: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">poly-single-var?</span> wantedvar poly<span style="color: #c678dd;">)</span>
<span class="linenr">325: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable poly<span style="color: #a9a1e1;">)</span> wantedvar<span style="color: #99bb66;">)</span>
<span class="linenr">326: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">rec</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>term-list <span style="color: #c678dd;">(</span>terms poly<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">327: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr">328: </span>             #t
<span class="linenr">329: </span>             <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>c <span style="color: #a9a1e1;">(</span>coeff <span style="color: #51afef;">(</span>first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">330: </span>               <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>is-poly? c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">331: </span>                   <span style="color: #99bb66;">(</span>rec <span style="color: #a9a1e1;">(</span>rest-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">332: </span>                   <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>poly-single-var? wantedvar c<span style="color: #a9a1e1;">)</span>
<span class="linenr">333: </span>                        <span style="color: #a9a1e1;">(</span>rec <span style="color: #51afef;">(</span>rest-terms term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">334: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">Example of an inverted poly:</span>
<span class="linenr">335: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">(poly x (order 4, coeff (poly y (5 6)))</span>
<span class="linenr">336: </span><span style="color: #525252;">;;;         </span><span style="color: #525252;">(order 3, coeff (poly y (1 2)))</span>
<span class="linenr">337: </span><span style="color: #525252;">;;;         </span><span style="color: #525252;">(order 0, coeff 7))</span>
<span class="linenr">338: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">(poly y (order 5, coeff (poly x (4 6)))</span>
<span class="linenr">339: </span><span style="color: #525252;">;;;         </span><span style="color: #525252;">(order 1, coeff (poly x (3 2)))</span>
<span class="linenr">340: </span><span style="color: #525252;">;;;         </span><span style="color: #525252;">(order 0, coeff 7))</span>
<span class="linenr">341: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">(make-poly sub-var (list (make-sparse-term subO (make-polynomial super-var (list (make-sparse-term superO subC))))))</span>
<span class="linenr">342: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">(poly x (1, (poly y (2, (poly z (3, 4))))))</span>
<span class="linenr">343: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">(poly x (1, (poly z (3, (poly y (2, 4))))))</span>
<span class="linenr">344: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">(poly z (3, (poly x (1, (poly y (2, 4)))))</span>
<span class="linenr">345: </span><span style="color: #525252;">;;; </span><span style="color: #525252;">(poly z (3, (poly y (2, (poly x (1, 4))))))</span>
<span class="linenr">346: </span>
<span class="linenr">347: </span><span style="color: #525252;">;; </span><span style="color: #525252;">This isn't good enough, it doesn't invert the poly and also it needs to</span>
<span class="linenr">348: </span><span style="color: #525252;">;; </span><span style="color: #525252;">produce multiple terms for one term with a poly with multiple terms</span>
<span class="linenr">349: </span><span style="color: #525252;">;</span><span style="color: #525252;">(define (invert-term parent-var parent-order term)</span>
<span class="linenr">350: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(let* ((child-order (order term))</span>
<span class="linenr">351: </span><span style="color: #525252;">;        </span><span style="color: #525252;">(child-coeff (coeff term)))</span>
<span class="linenr">352: </span><span style="color: #525252;">;    </span><span style="color: #525252;">(make-sparse-term child-order</span>
<span class="linenr">353: </span><span style="color: #525252;">;                      </span><span style="color: #525252;">(make-polynomial parent-var</span>
<span class="linenr">354: </span><span style="color: #525252;">;                                       </span><span style="color: #525252;">(list (make-sparse-term parent-order</span>
<span class="linenr">355: </span><span style="color: #525252;">;                                                               </span><span style="color: #525252;">child-coeff))))))</span>
<span class="linenr">356: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pad-term-if-needed</span> term parent-priority-list<span style="color: #c678dd;">)</span>
<span class="linenr">357: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">term with tagged poly, priority list -&gt; term</span>
<span class="linenr">358: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">parent-priority-list starts with the variable this term's order is in</span>
<span class="linenr">359: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">term: term with tagged poly inside</span>
<span class="linenr">360: </span>
<span class="linenr">361: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">pad term so that cross-variable functions will have equal structures</span>
<span class="linenr">362: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">to thoughtlessly work from. I.e. if your list is '(a b c d e) and</span>
<span class="linenr">363: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">your term is (5 (poly d (2 1))), we'll return</span>
<span class="linenr">364: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">'(5 (poly b (poly c (poly d (2 1))))) (nested polys representing dense terms)</span>
<span class="linenr">365: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>parent-var <span style="color: #51afef;">(</span>car parent-priority-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">366: </span>         <span style="color: #a9a1e1;">(</span>child-var <span style="color: #51afef;">(</span>variable <span style="color: #c678dd;">(</span>contents <span style="color: #99bb66;">(</span>coeff term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">367: </span>         <span style="color: #a9a1e1;">(</span>pri <span style="color: #51afef;">(</span>member parent-var parent-priority-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">368: </span>         <span style="color: #a9a1e1;">(</span>difference <span style="color: #51afef;">(</span>mem-index child-var pri<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">369: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= difference <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">370: </span>        term
<span class="linenr">371: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>rest-priorities <span style="color: #99bb66;">(</span>cdr pri<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">372: </span>               <span style="color: #c678dd;">(</span>next-var <span style="color: #99bb66;">(</span>car rest-priorities<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">373: </span>          <span style="color: #51afef;">(</span>make-sparse-term <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span>
<span class="linenr">374: </span>                            <span style="color: #c678dd;">(</span>make-polynomial next-var
<span class="linenr">375: </span>                                             <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>pad-term-if-needed <span style="color: #51afef;">(</span>make-sparse-term <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span>coeff term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">376: </span>                                                                       rest-priorities<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">377: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pad-poly-if-needed</span> poly parent-priority-list<span style="color: #c678dd;">)</span>
<span class="linenr">378: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">untagged poly -&gt; untagged poly</span>
<span class="linenr">379: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>child-var <span style="color: #51afef;">(</span>variable poly<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">380: </span>         <span style="color: #a9a1e1;">(</span>difference <span style="color: #51afef;">(</span>mem-index child-var parent-priority-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">381: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>&gt; difference <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">382: </span>        <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>car parent-priority-list<span style="color: #51afef;">)</span>
<span class="linenr">383: </span>                   <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>pad-term-if-needed <span style="color: #99bb66;">(</span>make-sparse-term <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #a9a1e1;">(</span>tag poly<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">384: </span>                                             parent-priority-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">385: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-empty-poly-in</span> var<span style="color: #c678dd;">)</span>
<span class="linenr">386: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>pair? var<span style="color: #99bb66;">)</span>
<span class="linenr">387: </span>      <span style="color: #99bb66;">(</span>make-poly <span style="color: #a9a1e1;">(</span>car var<span style="color: #a9a1e1;">)</span>
<span class="linenr">388: </span>                 <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>make-sparse-term
<span class="linenr">389: </span>                        <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span>tag <span style="color: #99bb66;">(</span>make-empty-poly-in
<span class="linenr">390: </span>                                <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>= <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span>length var<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">391: </span>                                    <span style="color: #51afef;">(</span>cadr var<span style="color: #51afef;">)</span>
<span class="linenr">392: </span>                                    <span style="color: #51afef;">(</span>cdr var<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">393: </span>      <span style="color: #99bb66;">(</span>make-poly var <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">394: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">priority-depth</span> var priority-list<span style="color: #c678dd;">)</span>
<span class="linenr">395: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">return how far in a list a var is</span>
<span class="linenr">396: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">0 is head, 2 means two vars ahead, etc</span>
<span class="linenr">397: </span>  <span style="color: #c678dd;">(</span>mem-index var priority-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">398: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">priority-diff</span> var1 var2 priority-list<span style="color: #c678dd;">)</span>
<span class="linenr">399: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">return how far ahead var2 is from var1</span>
<span class="linenr">400: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">so a child correctly nested in a parent is 1</span>
<span class="linenr">401: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if vars need to be swapped, this will be negative</span>
<span class="linenr">402: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>d1 <span style="color: #51afef;">(</span>mem-index var1 priority-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">403: </span>        <span style="color: #a9a1e1;">(</span>d2 <span style="color: #51afef;">(</span>mem-index var2 priority-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">404: </span>    <span style="color: #99bb66;">(</span>- d2 d1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">405: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">invert-nested-poly-terms</span> superVar superO term-list<span style="color: #c678dd;">)</span>
<span class="linenr">406: </span>  <span style="color: #525252;">;;  </span><span style="color: #525252;">-&gt; term-list</span>
<span class="linenr">407: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>tl term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">408: </span>             <span style="color: #a9a1e1;">(</span>done <span style="color: #51afef;">(</span>the-empty-termlist<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">409: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? tl<span style="color: #a9a1e1;">)</span>
<span class="linenr">410: </span>        done
<span class="linenr">411: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t <span style="color: #99bb66;">(</span>first-term tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">412: </span>               <span style="color: #c678dd;">(</span>new-t <span style="color: #99bb66;">(</span>make-sparse-term <span style="color: #a9a1e1;">(</span>order t<span style="color: #a9a1e1;">)</span>
<span class="linenr">413: </span>                                        <span style="color: #a9a1e1;">(</span>make-polynomial superVar
<span class="linenr">414: </span>                                                         <span style="color: #51afef;">(</span>make-sparse-term superO
<span class="linenr">415: </span>                                                                           <span style="color: #c678dd;">(</span>coeff t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">416: </span>          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>rest-terms tl<span style="color: #c678dd;">)</span>
<span class="linenr">417: </span>                <span style="color: #c678dd;">(</span>adjoin-term new-t done<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">418: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">poly-has-no-children?</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">419: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>tl <span style="color: #51afef;">(</span>terms p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">420: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>empty-termlist? tl<span style="color: #51afef;">)</span> #t<span style="color: #a9a1e1;">)</span>
<span class="linenr">421: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>pair? <span style="color: #99bb66;">(</span>coeff <span style="color: #a9a1e1;">(</span>first-term tl<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">422: </span>                <span style="color: #c678dd;">(</span>equal? 'polynomial <span style="color: #99bb66;">(</span>type-tag <span style="color: #a9a1e1;">(</span>coeff <span style="color: #51afef;">(</span>first-term tl<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> #f<span style="color: #a9a1e1;">)</span>
<span class="linenr">423: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>rest-terms tl<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">424: </span><span style="color: #525252;">;; </span><span style="color: #525252;">BIG PROBLEM: I NEED TO WORK OUT ORDERING OF TERMS VERSUS ORDERING OF POLY NESTING</span>
<span class="linenr">425: </span><span style="color: #525252;">;; </span><span style="color: #525252;">i.e.</span>
<span class="linenr">426: </span><span style="color: #525252;">;</span><span style="color: #525252;">(poly a (0</span>
<span class="linenr">427: </span><span style="color: #525252;">;         </span><span style="color: #525252;">(poly b (1 2)</span>
<span class="linenr">428: </span><span style="color: #525252;">;                 </span><span style="color: #525252;">(0</span>
<span class="linenr">429: </span><span style="color: #525252;">;                  </span><span style="color: #525252;">(poly c (3 4))))))</span>
<span class="linenr">430: </span><span style="color: #525252;">;</span><span style="color: #525252;">(poly a (0 (poly b (1 2)))</span>
<span class="linenr">431: </span><span style="color: #525252;">;        </span><span style="color: #525252;">(poly c (3 4)))</span>
<span class="linenr">432: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Maybe the only good choice is to have polys strictly nest linearly</span>
<span class="linenr">433: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reorganize-poly-if-needed</span> poly parent-priority-list<span style="color: #c678dd;">)</span>
<span class="linenr">434: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">untagged poly, pri list -&gt; untagged poly</span>
<span class="linenr">435: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">pri list should start with the variable you want the poly in,</span>
<span class="linenr">436: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">and contain all vars that the poly contains</span>
<span class="linenr">437: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">promote</span> p target-var<span style="color: #99bb66;">)</span>
<span class="linenr">438: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">p-rec</span> term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">439: </span>      <span style="color: #a9a1e1;">(</span>map-terms <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>t<span style="color: #c678dd;">)</span>
<span class="linenr">440: </span>                   <span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span>
<span class="linenr">441: </span>                 term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">442: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">descend into children until findng desired var, then ascend</span>
<span class="linenr">443: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">to bring it back to the parent while rearranging as needed</span>
<span class="linenr">444: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">receive</span> <span style="color: #99bb66;">(</span>cool uncool<span style="color: #99bb66;">)</span>
<span class="linenr">445: </span>        <span style="color: #99bb66;">(</span>partition <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>t<span style="color: #51afef;">)</span>
<span class="linenr">446: </span>                     <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>c <span style="color: #a9a1e1;">(</span>coeff t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">447: </span>                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? c<span style="color: #99bb66;">)</span>
<span class="linenr">448: </span>                          <span style="color: #99bb66;">(</span>equal? 'polynomial <span style="color: #a9a1e1;">(</span>type-tag c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">449: </span>                          <span style="color: #99bb66;">(</span>same-variable? target-var
<span class="linenr">450: </span>                                          <span style="color: #a9a1e1;">(</span>variable <span style="color: #51afef;">(</span>contents c<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">451: </span>                   <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>tl <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">452: </span>                     <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>sparse-termlist? tl<span style="color: #c678dd;">)</span>
<span class="linenr">453: </span>                         tl
<span class="linenr">454: </span>                         <span style="color: #c678dd;">(</span>dense-to-sparse tl<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">455: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>poly-has-no-children? p<span style="color: #51afef;">)</span> p<span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;;</span><span style="color: #525252;">dead end</span>
<span class="linenr">456: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>null? cool<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">var is below but not here yet, keep bubbling</span>
<span class="linenr">457: </span>             <span style="color: #a9a1e1;">)</span>
<span class="linenr">458: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>make-poly target-var
<span class="linenr">459: </span>                             <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">rec</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>tl cool<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">460: </span>                               <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? tl<span style="color: #a9a1e1;">)</span>
<span class="linenr">461: </span>                                   <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span>
<span class="linenr">462: </span>                                   <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t <span style="color: #99bb66;">(</span>first-term tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">463: </span>                                          <span style="color: #c678dd;">(</span>o <span style="color: #99bb66;">(</span>order t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">464: </span>                                          <span style="color: #c678dd;">(</span>c <span style="color: #99bb66;">(</span>coeff c<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">465: </span>                                          <span style="color: #c678dd;">(</span>child-poly <span style="color: #99bb66;">(</span>contents c<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">466: </span>                                     <span style="color: #51afef;">(</span>merge-termlists <span style="color: #c678dd;">(</span>invert-nested-poly-terms <span style="color: #99bb66;">(</span>variable p<span style="color: #99bb66;">)</span> o
<span class="linenr">467: </span>                                                                                <span style="color: #99bb66;">(</span>terms child-poly<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">468: </span>                                                      <span style="color: #c678dd;">(</span>rec <span style="color: #99bb66;">(</span>rest-terms tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">469: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">rec</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>p poly<span style="color: #a9a1e1;">)</span>
<span class="linenr">470: </span>            <span style="color: #a9a1e1;">(</span>pri parent-priority-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">471: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>null? pri<span style="color: #a9a1e1;">)</span>
<span class="linenr">472: </span>        p <span style="color: #525252;">;; </span><span style="color: #525252;">give up</span>
<span class="linenr">473: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>top-var <span style="color: #99bb66;">(</span>car pri<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">474: </span>               <span style="color: #c678dd;">(</span>var <span style="color: #99bb66;">(</span>variable p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">475: </span>               <span style="color: #c678dd;">(</span>tl <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">476: </span>               <span style="color: #c678dd;">(</span>child-descendants <span style="color: #99bb66;">(</span>make-variable-priority-list p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">477: </span>               <span style="color: #c678dd;">(</span>diff <span style="color: #99bb66;">(</span>priority-diff top-var var parent-priority-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">478: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>equal? child-descendants parent-priority-list<span style="color: #99bb66;">)</span>
<span class="linenr">479: </span>                 p<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">sort done</span>
<span class="linenr">480: </span>                <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>member top-var child-descendants<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">481: </span>                 <span style="color: #525252;">;; </span><span style="color: #525252;">we need to pad for this var</span>
<span class="linenr">482: </span>                 <span style="color: #99bb66;">(</span>make-poly top-var <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>rec p <span style="color: #c678dd;">(</span>cdr pri<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">483: </span>                <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> diff<span style="color: #99bb66;">)</span>
<span class="linenr">484: </span>                 <span style="color: #99bb66;">(</span>'todo<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">485: </span><span style="color: #525252;">;</span><span style="color: #525252;">(define (check-terms term-list)</span>
<span class="linenr">486: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(let iter ((remaining term-list)</span>
<span class="linenr">487: </span><span style="color: #525252;">;             </span><span style="color: #525252;">(done (the-empty-termlist)))</span>
<span class="linenr">488: </span><span style="color: #525252;">;    </span><span style="color: #525252;">(if (empty-termlist? remaining)</span>
<span class="linenr">489: </span><span style="color: #525252;">;        </span><span style="color: #525252;">done</span>
<span class="linenr">490: </span><span style="color: #525252;">;        </span><span style="color: #525252;">(let* ((t (first-term remaining))</span>
<span class="linenr">491: </span><span style="color: #525252;">;               </span><span style="color: #525252;">(c (coeff t))</span>
<span class="linenr">492: </span><span style="color: #525252;">;               </span><span style="color: #525252;">(o (order t))</span>
<span class="linenr">493: </span><span style="color: #525252;">;               </span><span style="color: #525252;">(new-t (make-sparse-term o</span>
<span class="linenr">494: </span><span style="color: #525252;">;                                        </span><span style="color: #525252;">(if (is-poly? c)</span>
<span class="linenr">495: </span><span style="color: #525252;">;                                            </span><span style="color: #525252;">(tag (reorganize-poly-if-needed (contents c) parent-priority-list))</span>
<span class="linenr">496: </span><span style="color: #525252;">;                                            </span><span style="color: #525252;">c))))</span>
<span class="linenr">497: </span><span style="color: #525252;">;          </span><span style="color: #525252;">(iter (rest-terms remaining)</span>
<span class="linenr">498: </span><span style="color: #525252;">;                </span><span style="color: #525252;">(adjoin-term new-t done))))))</span>
<span class="linenr">499: </span><span style="color: #525252;">;</span><span style="color: #525252;">(define (invert-this-poly poly new-var)</span>
<span class="linenr">500: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(let ((var (variable poly))</span>
<span class="linenr">501: </span><span style="color: #525252;">;        </span><span style="color: #525252;">(term-list (terms poly)))</span>
<span class="linenr">502: </span><span style="color: #525252;">;    </span><span style="color: #525252;">(let iter ((remaining term-list)</span>
<span class="linenr">503: </span><span style="color: #525252;">;               </span><span style="color: #525252;">(done (the-empty-termlist)))</span>
<span class="linenr">504: </span><span style="color: #525252;">;      </span><span style="color: #525252;">(if (empty-termlist? remaining)</span>
<span class="linenr">505: </span><span style="color: #525252;">;          </span><span style="color: #525252;">(make-poly new-var done)</span>
<span class="linenr">506: </span><span style="color: #525252;">;          </span><span style="color: #525252;">(let* ((t (first-term remaining))</span>
<span class="linenr">507: </span><span style="color: #525252;">;                 </span><span style="color: #525252;">(o (order t))</span>
<span class="linenr">508: </span><span style="color: #525252;">;                 </span><span style="color: #525252;">(c (coeff t)))</span>
<span class="linenr">509: </span><span style="color: #525252;">;            </span><span style="color: #525252;">(if (is-poly? c)</span>
<span class="linenr">510: </span><span style="color: #525252;">;                </span><span style="color: #525252;">(let ((child-var (variable (contents c)))</span>
<span class="linenr">511: </span><span style="color: #525252;">;                      </span><span style="color: #525252;">(child-terms (terms (contents c))))</span>
<span class="linenr">512: </span><span style="color: #525252;">;                  </span><span style="color: #525252;">(cond ((&gt; o 0) ;; if order is not 0, an inverted poly is needed</span>
<span class="linenr">513: </span><span style="color: #525252;">;                         </span><span style="color: #525252;">(iter (rest-terms remaining)</span>
<span class="linenr">514: </span><span style="color: #525252;">;                               </span><span style="color: #525252;">(merge-termlists done (invert-nested-poly-terms new-var o child-terms))))</span>
<span class="linenr">515: </span><span style="color: #525252;">;                        </span><span style="color: #525252;">((same-variable? var child-var)</span>
<span class="linenr">516: </span><span style="color: #525252;">;                         </span><span style="color: #525252;">(error "This shouldn't happen : INVERT-THIS-POLY :" remaining done))</span>
<span class="linenr">517: </span><span style="color: #525252;">;                                      </span><span style="color: #525252;">;(iter (merge-termlists child-terms (rest-terms remaining))</span>
<span class="linenr">518: </span><span style="color: #525252;">;                                      </span><span style="color: #525252;">;      done))</span>
<span class="linenr">519: </span><span style="color: #525252;">;                        </span><span style="color: #525252;">((same-variable? new-var child-var)</span>
<span class="linenr">520: </span><span style="color: #525252;">;                         </span><span style="color: #525252;">(iter (rest-terms remaining)</span>
<span class="linenr">521: </span><span style="color: #525252;">;                               </span><span style="color: #525252;">(merge-termlists done (check-terms child-terms))))</span>
<span class="linenr">522: </span><span style="color: #525252;">;                        </span><span style="color: #525252;">(else (error "WHAT TO HECK : INVERT-THIS-POLY :" remaining done))))</span>
<span class="linenr">523: </span><span style="color: #525252;">;                </span><span style="color: #525252;">(let ((new-t (make-sparse-term 0</span>
<span class="linenr">524: </span><span style="color: #525252;">;                                               </span><span style="color: #525252;">(make-polynomial var</span>
<span class="linenr">525: </span><span style="color: #525252;">;                                                                </span><span style="color: #525252;">(make-sparse-term o</span>
<span class="linenr">526: </span><span style="color: #525252;">;                                                                                  </span><span style="color: #525252;">c)))))</span>
<span class="linenr">527: </span><span style="color: #525252;">;                  </span><span style="color: #525252;">(iter (rest-terms remaining)</span>
<span class="linenr">528: </span><span style="color: #525252;">;                        </span><span style="color: #525252;">(adjoin-term new-t done)))))))))</span>
<span class="linenr">529: </span><span style="color: #525252;">;</span><span style="color: #525252;">(let* ((top-var (car parent-priority-list))</span>
<span class="linenr">530: </span><span style="color: #525252;">;       </span><span style="color: #525252;">(var (variable poly))</span>
<span class="linenr">531: </span><span style="color: #525252;">;       </span><span style="color: #525252;">(tl (terms poly))</span>
<span class="linenr">532: </span><span style="color: #525252;">;       </span><span style="color: #525252;">(child-descendants (make-variable-priority-list poly))</span>
<span class="linenr">533: </span><span style="color: #525252;">;       </span><span style="color: #525252;">(diff (priority-diff top-var var parent-priority-list)))</span>
<span class="linenr">534: </span><span style="color: #525252;">;  </span><span style="color: #525252;">(cond ((= 0 diff)</span>
<span class="linenr">535: </span><span style="color: #525252;">;         </span><span style="color: #525252;">;; if poly and top-var are the same, then keep terms how they are</span>
<span class="linenr">536: </span><span style="color: #525252;">;         </span><span style="color: #525252;">;; except for terms that have poly coeffs, which need to be checked</span>
<span class="linenr">537: </span><span style="color: #525252;">;         </span><span style="color: #525252;">(make-poly top-var (check-terms tl)))</span>
<span class="linenr">538: </span><span style="color: #525252;">;        </span><span style="color: #525252;">((&lt; 0 diff)</span>
<span class="linenr">539: </span><span style="color: #525252;">;         </span><span style="color: #525252;">(let ((reorganized-terms (check-terms tl)))</span>
<span class="linenr">540: </span><span style="color: #525252;">;           </span><span style="color: #525252;">(pad-poly-if-needed (make-poly var reorganized-terms)</span>
<span class="linenr">541: </span><span style="color: #525252;">;                               </span><span style="color: #525252;">parent-priority-list)))</span>
<span class="linenr">542: </span><span style="color: #525252;">;        </span><span style="color: #525252;">;; if var is 1 step of priority below in the list than top-var, then</span>
<span class="linenr">543: </span><span style="color: #525252;">;        </span><span style="color: #525252;">;; swap its terms with top-var terms</span>
<span class="linenr">544: </span><span style="color: #525252;">;        </span><span style="color: #525252;">((= 1 diff)</span>
<span class="linenr">545: </span><span style="color: #525252;">;         </span><span style="color: #525252;">(pad-poly-if-needed (invert-this-poly poly top-var)</span>
<span class="linenr">546: </span><span style="color: #525252;">;                             </span><span style="color: #525252;">parent-priority-list))</span>
<span class="linenr">547: </span><span style="color: #525252;">;        </span><span style="color: #525252;">;; if var is &gt;1 steps of priority below top-var, and top-var is known</span>
<span class="linenr">548: </span><span style="color: #525252;">;        </span><span style="color: #525252;">;; to be in the child's children, then reorganize the child poly's</span>
<span class="linenr">549: </span><span style="color: #525252;">;        </span><span style="color: #525252;">;; terms and try again</span>
<span class="linenr">550: </span><span style="color: #525252;">;        </span><span style="color: #525252;">((&lt; 1 diff)</span>
<span class="linenr">551: </span><span style="color: #525252;">;         </span><span style="color: #525252;">(if (member top-var child-descendants)</span>
<span class="linenr">552: </span><span style="color: #525252;">;             </span><span style="color: #525252;">(let ((reorganized-terms (check-terms tl)))</span>
<span class="linenr">553: </span><span style="color: #525252;">;               </span><span style="color: #525252;">(reorganize-poly-if-needed (make-poly var reorganized-terms)</span>
<span class="linenr">554: </span><span style="color: #525252;">;                                          </span><span style="color: #525252;">parent-priority-list))</span>
<span class="linenr">555: </span><span style="color: #525252;">;             </span><span style="color: #525252;">(error "expected child poly not found? : REORGANIZE-POLY-IF-NEEDED :"</span>
<span class="linenr">556: </span><span style="color: #525252;">;                    </span><span style="color: #525252;">parent-priority-list child-descendants)))</span>
<span class="linenr">557: </span><span style="color: #525252;">;        </span><span style="color: #525252;">(else "what the SCALLOP" child-descendants diff))))</span>
<span class="linenr">558: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">operate-on-polys</span> f p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">559: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">f is a function to operate on term-lists</span>
<span class="linenr">560: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">561: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span>
<span class="linenr">562: </span>                    <span style="color: #51afef;">(</span>f <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">563: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">564: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span>
<span class="linenr">565: </span>                    <span style="color: #51afef;">(</span>f <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">566: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? p2<span style="color: #a9a1e1;">)</span>
<span class="linenr">567: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span>
<span class="linenr">568: </span>                    <span style="color: #51afef;">(</span>f <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">569: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get '=zero? 'polynomial<span style="color: #51afef;">)</span> p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">570: </span>         p2<span style="color: #99bb66;">)</span>
<span class="linenr">571: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get '=zero? 'polynomial<span style="color: #51afef;">)</span> p2<span style="color: #a9a1e1;">)</span>
<span class="linenr">572: </span>         p1<span style="color: #99bb66;">)</span>
<span class="linenr">573: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">574: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>priorities <span style="color: #99bb66;">(</span>merge-priority-lists <span style="color: #a9a1e1;">(</span>make-variable-priority-list p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">575: </span>                                                  <span style="color: #a9a1e1;">(</span>make-variable-priority-list p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">576: </span>                <span style="color: #c678dd;">(</span>p1r <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>reorganize-poly-if-needed p1 priorities<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">577: </span>                <span style="color: #c678dd;">(</span>p2r <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>reorganize-poly-if-needed p2 priorities<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">578: </span>           <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p1r<span style="color: #c678dd;">)</span>
<span class="linenr">579: </span>                      <span style="color: #c678dd;">(</span>f <span style="color: #99bb66;">(</span>terms p1r<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>terms p2r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">580: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">581: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">triv</span>
<span class="linenr">582: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if a poly is trivial, return the opposite variable</span>
<span class="linenr">583: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>trivial-poly? p1<span style="color: #51afef;">)</span>
<span class="linenr">584: </span>           <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">585: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>trivial-poly? p2<span style="color: #51afef;">)</span>
<span class="linenr">586: </span>           <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">587: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">588: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>same-variable? <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>variable p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">589: </span>             triv<span style="color: #a9a1e1;">)</span>
<span class="linenr">590: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> triv
<span class="linenr">591: </span>                        triv
<span class="linenr">592: </span>                        <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">593: </span>                    <span style="color: #51afef;">(</span>add-terms <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">594: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">595: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>p2r <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>reorganize-poly-if-needed p2
<span class="linenr">596: </span>                                                <span style="color: #51afef;">(</span>make-variable-priority-list p1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">597: </span>           <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span>
<span class="linenr">598: </span>                      <span style="color: #c678dd;">(</span>add-terms <span style="color: #99bb66;">(</span>terms p1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>terms p2r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">599: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">600: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">triv</span>
<span class="linenr">601: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if a poly is trivial, return the opposite variable</span>
<span class="linenr">602: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>trivial-poly? p1<span style="color: #51afef;">)</span>
<span class="linenr">603: </span>           <span style="color: #51afef;">(</span>variable p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">604: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>trivial-poly? p2<span style="color: #51afef;">)</span>
<span class="linenr">605: </span>           <span style="color: #51afef;">(</span>variable p1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">606: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">607: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>same-variable? <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>variable p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">608: </span>             triv<span style="color: #a9a1e1;">)</span>
<span class="linenr">609: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> triv
<span class="linenr">610: </span>                        triv
<span class="linenr">611: </span>                        <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">612: </span>                    <span style="color: #51afef;">(</span>mul-terms <span style="color: #c678dd;">(</span>terms p1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">613: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"Polys not in same var: MUL-POLY"</span> <span style="color: #51afef;">(</span>list p1 p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">614: </span>
<span class="linenr">615: </span><span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">616: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tag</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>attach-tag 'polynomial p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">617: </span><span style="color: #51afef;">(</span>put 'add '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">618: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>add-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">619: </span><span style="color: #51afef;">(</span>put 'mul '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">620: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>mul-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">621: </span><span style="color: #51afef;">(</span>put 'make 'polynomial
<span class="linenr">622: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>var terms<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>make-poly var terms<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">623: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">if-1st-poly-make-2nd-poly</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">624: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? 'polynomial <span style="color: #51afef;">(</span>type-tag t1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">625: </span>           <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>eqv? 'polynomial <span style="color: #c678dd;">(</span>type-tag t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">626: </span>      <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable <span style="color: #c678dd;">(</span>contents t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">627: </span>      t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">628: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-term-by-all-terms</span> t1 L<span style="color: #c678dd;">)</span>
<span class="linenr">629: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">630: </span>      <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr">631: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">If one coeff is a poly, make the other a poly</span>
<span class="linenr">632: </span>             <span style="color: #51afef;">(</span>t1-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">633: </span>             <span style="color: #51afef;">(</span>t2-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">634: </span>        
<span class="linenr">635: </span>        <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">636: </span>         <span style="color: #51afef;">(</span>make-sparse-term <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>order t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">637: </span>                           <span style="color: #c678dd;">(</span>mul t1-coeff t2-coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">638: </span>         <span style="color: #51afef;">(</span>mul-term-by-all-terms t1 <span style="color: #c678dd;">(</span>rest-terms L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">639: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">poly-=zero?</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">640: </span>  <span style="color: #c678dd;">(</span>terms-=zero? <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">641: </span><span style="color: #51afef;">(</span>put '=zero? '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span> poly-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">642: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg-poly</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">643: </span>  <span style="color: #c678dd;">(</span>make-poly <span style="color: #99bb66;">(</span>variable p<span style="color: #99bb66;">)</span>
<span class="linenr">644: </span>             <span style="color: #99bb66;">(</span>neg-terms <span style="color: #a9a1e1;">(</span>terms p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">645: </span><span style="color: #51afef;">(</span>put 'neg '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">646: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>neg-poly p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">647: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">648: </span>  <span style="color: #c678dd;">(</span>add-poly p1 <span style="color: #99bb66;">(</span>neg-poly p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">649: </span><span style="color: #51afef;">(</span>put 'sub '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">650: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>sub-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">651: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">652: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">poly, poly -&gt; list of 2 polys</span>
<span class="linenr">653: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">returns quotient poly and remainder poly</span>
<span class="linenr">654: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">655: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>div-terms <span style="color: #99bb66;">(</span>terms p1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>terms p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">656: </span>             <span style="color: #51afef;">(</span>quotient <span style="color: #c678dd;">(</span>car result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">657: </span>             <span style="color: #51afef;">(</span>remainder <span style="color: #c678dd;">(</span>cadr result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">658: </span>        <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span> quotient<span style="color: #51afef;">)</span>
<span class="linenr">659: </span>              <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p1<span style="color: #c678dd;">)</span> remainder<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">660: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Polys not in same var: DIV-POLY"</span> <span style="color: #a9a1e1;">(</span>list p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">661: </span><span style="color: #51afef;">(</span>put 'div '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">662: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span>
<span class="linenr">663: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>div-poly p1 p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">664: </span>              <span style="color: #51afef;">(</span>quotient <span style="color: #c678dd;">(</span>car result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">665: </span>              <span style="color: #51afef;">(</span>remainder <span style="color: #c678dd;">(</span>cadr result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">666: </span>         <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>tag quotient<span style="color: #51afef;">)</span>
<span class="linenr">667: </span>               <span style="color: #51afef;">(</span>tag remainder<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orgfe415f1"><span class="linenr">1: </span><span style="color: #525252;">;  </span><span style="color: #525252;">'done)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-polynomial</span> var terms<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'polynomial<span style="color: #99bb66;">)</span> var terms<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"../mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-drop&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-complex-parts&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span><span style="color: #ECBE7B;">&lt;&lt;tower-coercions-polynomial&gt;&gt;</span>
<span class="linenr"> 16: </span>
<span class="linenr"> 17: </span><span style="color: #ECBE7B;">&lt;&lt;mem-index&gt;&gt;</span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-mixed-variables-top&gt;&gt;</span>
<span class="linenr"> 19: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-mixed-variables-bottom&gt;&gt;</span>
<span class="linenr"> 20: </span>
<span class="linenr"> 21: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 24: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 25: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 26: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 27: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 33: </span>
<span class="linenr"> 34: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 35: </span>
<span class="linenr"> 36: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 37: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 38: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 39: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 40: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 41: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 42: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 43: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 44: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 45: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 46: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 47: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 48: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 49: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 50: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 51: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 52: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 53: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 54: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 55: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 56: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 57: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 58: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 59: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 60: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 61: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 62: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 63: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 64: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 65: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 66: </span>                                      <span style="color: #51afef;">(</span>cons 'rational <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 67: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 68: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 69: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 70: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span>
<span class="linenr"> 72: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 73: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 74: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p3</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 75: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p4</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 76: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p5</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 77: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p7</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 78: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p6</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 79: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p66</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p77</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 81: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p8</span> <span style="color: #c678dd;">(</span>make-poly 'a
<span class="linenr"> 82: </span>                      <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #51afef;">(</span>make-polynomial 'b p3<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 83: </span>                            <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #51afef;">(</span>make-polynomial 'c p5<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 84: </span>                            <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>make-polynomial 'd <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #a9a1e1;">(</span>make-polynomial 'f '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 85: </span>                            <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #51afef;">(</span>make-polynomial 'e <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p9</span> <span style="color: #c678dd;">(</span>make-poly 'a
<span class="linenr"> 87: </span>                      <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>list <span style="color: #dd8844; font-weight: bold;">9</span>
<span class="linenr"> 88: </span>                                  <span style="color: #51afef;">(</span>make-polynomial
<span class="linenr"> 89: </span>                                   'b <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #a9a1e1;">(</span>make-polynomial
<span class="linenr"> 90: </span>                                                     'c <span style="color: #51afef;">(</span>list <span style="color: #c678dd;">(</span>list <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-polynomial
<span class="linenr"> 91: </span>                                                                       'd <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>list <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span>make-polynomial
<span class="linenr"> 92: </span>                                                                                         'e <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 93: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 94: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 95: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 96: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 97: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 98: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 99: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">100: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">101: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr">102: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr">103: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">104: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">105: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr">106: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr">107: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">108: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">109: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr">110: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span>
<span class="linenr">111: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr">112: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">113: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">114: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr">115: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">116: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">117: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">118: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">119: </span>           <span style="color: #c678dd;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">120: </span>
<span class="linenr">121: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">122: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">123: </span>           <span style="color: #c678dd;">(</span>make-polynomial 'x p4<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">124: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">125: </span>           <span style="color: #c678dd;">(</span>sub <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr">126: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p3<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">127: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">128: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 1"</span>
<span class="linenr">129: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span>
<span class="linenr">130: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">131: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">132: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 2"</span>
<span class="linenr">133: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span>
<span class="linenr">134: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">135: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">136: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 3"</span>
<span class="linenr">137: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p66<span style="color: #99bb66;">)</span>
<span class="linenr">138: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p77<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">139: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">140: </span>
<span class="linenr">141: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"poly projection good"</span>
<span class="linenr">142: </span>           <span style="color: #c678dd;">(</span>project <span style="color: #99bb66;">(</span>make-polynomial 'useless '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">143: </span>           <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span>
<span class="linenr">144: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"poly projection bad"</span>
<span class="linenr">145: </span>           <span style="color: #c678dd;">(</span>project <span style="color: #99bb66;">(</span>make-polynomial 'useless '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">146: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr">147: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise to poly"</span>
<span class="linenr">148: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">149: </span>           '<span style="color: #c678dd;">(</span>polynomial DISCARD-ME <span style="color: #99bb66;">(</span>complex polar <span style="color: #dd8844; font-weight: bold;">78</span> . <span style="color: #dd8844; font-weight: bold;">64</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">150: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"reorganize-poly-if-needed"</span>
<span class="linenr">151: </span>           <span style="color: #c678dd;">(</span>reorganize-poly-if-needed p8 '<span style="color: #99bb66;">(</span>f e d c b a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">152: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomials in multiple variables 1"</span>
<span class="linenr">153: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr">154: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'y p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">155: </span>           'unknown<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org767df2f" class="outline-3">
<h3 id="org767df2f"><span class="section-number-3">3.106.</span> Exercise 2.93: extending <code>make-rational</code> for rational functions</h3>
<div class="outline-text-3" id="text-3-106">
</div>

<div id="outline-container-org21214c9" class="outline-4">
<h4 id="org21214c9"><span class="section-number-4">3.106.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-106-1">
<p>
Modify the <code>rational-arithmetic</code> package to use generic operations, but change
<code class="src src-scheme">make-rat</code> so that it does not attempt to reduce fractions to lowest
terms. Test your system by calling <code class="src src-scheme">make-rational</code> on two polynomials
to produce a rational function:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">rf</span> <span style="color: #c678dd;">(</span>make-rational p2 p1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Now add <code class="src src-scheme">rf</code> to itself, using <code class="src src-scheme">add</code>. You will observe that
this addition procedure does not reduce fractions to lowest terms.
</p>
</div>
</div>

<div id="outline-container-orgedde683" class="outline-4">
<h4 id="orgedde683"><span class="section-number-4">3.106.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-106-2">
<p>
<code>raise</code>-ing a rational function doesn&rsquo;t work, so I&rsquo;ll need a way around that.
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org96eb72a"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tower</span>
<span class="linenr"> 2: </span>  '<span style="color: #c678dd;">(</span>scheme-number rational real complex polynomial<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">raise</span> x<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>type-tag x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">recurse</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>ll tower<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>car ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>null? <span style="color: #a9a1e1;">(</span>cdr ll<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> #f<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>              <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>equal? t1 t2<span style="color: #99bb66;">)</span>
<span class="linenr">10: </span>               <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get-coercion t1 <span style="color: #51afef;">(</span>cadr ll<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>contents x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span> <span style="color: #99bb66;">(</span>recurse <span style="color: #a9a1e1;">(</span>cdr ll<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">raise-to</span> x target<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">current-type</span> <span style="color: #99bb66;">(</span>type-tag x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">try-coerce</span> type-to-try<span style="color: #99bb66;">)</span>
<span class="linenr">16: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>up <span style="color: #c678dd;">(</span>get-coercion current-type type-to-try<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> up
<span class="linenr">18: </span>          <span style="color: #51afef;">(</span>up <span style="color: #c678dd;">(</span>contents x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">19: </span>          #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">20: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>tower-from-here <span style="color: #51afef;">(</span>member current-type tower<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>not tower-from-here<span style="color: #51afef;">)</span>
<span class="linenr">22: </span>            <span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span>member target tower-from-here<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">23: </span>        #f <span style="color: #525252;">;; </span><span style="color: #525252;">this raise can't happen</span>
<span class="linenr">24: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">rec</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>ll <span style="color: #99bb66;">(</span>cdr tower-from-here<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>eqv? target <span style="color: #99bb66;">(</span>car ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>              <span style="color: #c678dd;">(</span>try-coerce <span style="color: #99bb66;">(</span>car ll<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>try-harder
<span class="linenr">28: </span>                     <span style="color: #51afef;">(</span>rec <span style="color: #c678dd;">(</span>cdr ll<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> try-harder
<span class="linenr">30: </span>                    try-harder
<span class="linenr">31: </span>                    <span style="color: #a9a1e1;">(</span>try-coerce <span style="color: #51afef;">(</span>car ll<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">32: </span>
<span class="linenr">33: </span><span style="color: #51afef;">(</span>put-coercion 'scheme-number 'rational
<span class="linenr">34: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>                <span style="color: #99bb66;">(</span>make-rational num <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">36: </span><span style="color: #ECBE7B;">&lt;&lt;eqnumber&gt;&gt;</span>
<span class="linenr">37: </span><span style="color: #51afef;">(</span>put-coercion 'rational 'real
<span class="linenr">38: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">39: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'numer '<span style="color: #51afef;">(</span>rational<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> num<span style="color: #99bb66;">)</span>
<span class="linenr">40: </span>                                   <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'denom '<span style="color: #51afef;">(</span>rational<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">41: </span>                  <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>number? result<span style="color: #51afef;">)</span>
<span class="linenr">42: </span>                      <span style="color: #51afef;">(</span>make-real <span style="color: #c678dd;">(</span>exact-&gt;inexact result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">43: </span>                      #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">44: </span><span style="color: #51afef;">(</span>put-coercion 'real 'complex
<span class="linenr">45: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">46: </span>                <span style="color: #99bb66;">(</span>make-complex-from-real-imag
<span class="linenr">47: </span>                 num <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">48: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>raised-poly <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>num tag<span style="color: #51afef;">)</span>
<span class="linenr">49: </span>                       <span style="color: #51afef;">(</span>make-polynomial 'DISCARD-ME
<span class="linenr">50: </span>                                        <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #a9a1e1;">(</span>attach-tag tag num<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">51: </span>  <span style="color: #c678dd;">(</span>put-coercion 'scheme-number 'polynomial
<span class="linenr">52: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>num<span style="color: #a9a1e1;">)</span>
<span class="linenr">53: </span>                  <span style="color: #a9a1e1;">(</span>raised-poly num 'scheme-number<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">54: </span>  <span style="color: #c678dd;">(</span>put-coercion 'rational 'polynomial
<span class="linenr">55: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>num<span style="color: #a9a1e1;">)</span>
<span class="linenr">56: </span>                  <span style="color: #a9a1e1;">(</span>raised-poly num 'rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">57: </span>  <span style="color: #c678dd;">(</span>put-coercion 'real 'polynomial
<span class="linenr">58: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>num<span style="color: #a9a1e1;">)</span>
<span class="linenr">59: </span>                  <span style="color: #a9a1e1;">(</span>raised-poly num 'real<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">60: </span>  <span style="color: #c678dd;">(</span>put-coercion 'complex 'polynomial
<span class="linenr">61: </span>                <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>num<span style="color: #a9a1e1;">)</span>
<span class="linenr">62: </span>                  <span style="color: #a9a1e1;">(</span>raised-poly num 'complex<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orge2c0d80"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Version of apply-generic that tries to drop its type</span>
<span class="linenr"> 3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">when returning</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">apply-generic</span> op . args<span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">types</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag args<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">map-raise</span> highest-type item<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>equal? <span style="color: #51afef;">(</span>type-tag item<span style="color: #51afef;">)</span> highest-type<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>        item
<span class="linenr"> 9: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>raised <span style="color: #99bb66;">(</span>raise-to item highest-type<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>not raised<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>              <span style="color: #c678dd;">(</span>error <span style="color: #99bb66;">"MAP-RAISE: could not raise"</span> item highest-type<span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>              <span style="color: #c678dd;">(</span>map-raise highest-type raised<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">13: </span>  
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>drop
<span class="linenr">15: </span>   <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>proc <span style="color: #c678dd;">(</span>get op types<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">16: </span>     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> proc <span style="color: #525252;">; </span><span style="color: #525252;">is this already doable?</span>
<span class="linenr">17: </span>         <span style="color: #51afef;">(</span>apply proc <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents args<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span>                                        <span style="color: #525252;">; </span><span style="color: #525252;">if not, try type coercion</span>
<span class="linenr">19: </span>         
<span class="linenr">20: </span>         <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>highest-type <span style="color: #a9a1e1;">(</span>apply latest-in-tower types<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">21: </span>                <span style="color: #99bb66;">(</span>map-raise-prime <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>item<span style="color: #51afef;">)(</span>map-raise highest-type item<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>                <span style="color: #99bb66;">(</span>raised <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">map</span> map-raise-prime args<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">23: </span>           <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>length raised<span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span>
<span class="linenr">24: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">short args</span>
<span class="linenr">25: </span>               <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>f <span style="color: #c678dd;">(</span>get op <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> type-tag raised<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">26: </span>                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>eqv? #f f<span style="color: #51afef;">)</span>
<span class="linenr">27: </span>                     <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"APPLY-GENERIC: could not find procedure for types"</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> type-tag raised<span style="color: #c678dd;">)</span> raised<span style="color: #51afef;">)</span>
<span class="linenr">28: </span>                     <span style="color: #51afef;">(</span>apply f <span style="color: #c678dd;">(</span><span style="color: #51afef;">map</span> contents raised<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">long args</span>
<span class="linenr">30: </span>               <span style="color: #99bb66;">(</span>reduce <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>elem previous<span style="color: #51afef;">)</span>
<span class="linenr">31: </span>                         <span style="color: #51afef;">(</span>apply-generic op previous elem<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">32: </span>                       <span style="color: #99bb66;">"ERROR"</span> raised<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org58e2f4c"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polynomial-package</span><span style="color: #c678dd;">)</span> 'no<span style="color: #51afef;">)</span>
<span class="linenr">  3: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">  4: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">representation of poly</span>
<span class="linenr">  5: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-poly</span> variable term-list<span style="color: #c678dd;">)</span>
<span class="linenr">  6: </span>    <span style="color: #c678dd;">(</span>cons variable
<span class="linenr">  7: </span>          <span style="color: #99bb66;">(</span>convert-termlist-if-reasonable term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  8: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">convert-termlist-if-reasonable</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">  9: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 10: </span>        term-list
<span class="linenr"> 11: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>sparse-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr"> 12: </span>               <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>tl <span style="color: #a9a1e1;">(</span>sort-sparse-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 13: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>should-be-sparse? tl<span style="color: #99bb66;">)</span>
<span class="linenr"> 14: </span>                     tl
<span class="linenr"> 15: </span>                     <span style="color: #99bb66;">(</span>sparse-to-dense tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 16: </span>              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>should-be-sparse? term-list<span style="color: #51afef;">)</span>
<span class="linenr"> 17: </span>               <span style="color: #51afef;">(</span>dense-to-sparse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 18: </span>              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 19: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 20: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">terms</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 21: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 22: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
<span class="linenr"> 23: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 24: </span>  
<span class="linenr"> 25: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">representation of terms and term lists</span>
<span class="linenr"> 26: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-termlist?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 27: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span>car term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 28: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>pair? t<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks like a sparse list</span>
<span class="linenr"> 29: </span>                <span style="color: #c678dd;">(</span>number? <span style="color: #99bb66;">(</span>first t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 30: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>pair? <span style="color: #a9a1e1;">(</span>second t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or sparse with nested poly</span>
<span class="linenr"> 31: </span>                    <span style="color: #99bb66;">(</span>number? <span style="color: #a9a1e1;">(</span>second t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 32: </span>                    <span style="color: #99bb66;">(</span>empty-termlist? <span style="color: #a9a1e1;">(</span>second t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> #t<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 33: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span>number? t<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks dense</span>
<span class="linenr"> 34: </span>               <span style="color: #c678dd;">(</span>pair? t<span style="color: #c678dd;">)</span>
<span class="linenr"> 35: </span>               <span style="color: #c678dd;">(</span>empty-termlist? term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> #f<span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or dense with a nested poly</span>
<span class="linenr"> 36: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"badly formed term: SPARSE-TERMLIST?"</span> t term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 37: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sort-sparse-terms</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 38: </span>  <span style="color: #c678dd;">(</span>sort term-list <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>t1 t2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 39: </span>                    <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span>
<span class="linenr"> 40: </span>                       <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 41: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">should-be-sparse?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 42: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">sparse or dense term-list -&gt; bool</span>
<span class="linenr"> 43: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if more than half of term-list is zeroes, return true</span>
<span class="linenr"> 44: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">reasoning:</span>
<span class="linenr"> 45: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for sparse list is (non-zero elements * 2)</span>
<span class="linenr"> 46: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for dense list is (highest order)</span>
<span class="linenr"> 47: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">count-zeroes</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 48: </span>      <span style="color: #525252;">;; </span><span style="color: #525252;">term-list -&gt; (highest order, zeroes)</span>
<span class="linenr"> 49: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>length <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 50: </span>                 <span style="color: #51afef;">(</span>zeroes <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 51: </span>                 <span style="color: #51afef;">(</span>TL <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 52: </span>                         <span style="color: #99bb66;">(</span>sparse-to-dense term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 53: </span>                         term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 54: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? TL<span style="color: #51afef;">)</span>
<span class="linenr"> 55: </span>            <span style="color: #51afef;">(</span>list zeroes length<span style="color: #51afef;">)</span>
<span class="linenr"> 56: </span>            <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>1+ length<span style="color: #c678dd;">)</span>
<span class="linenr"> 57: </span>                  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>car TL<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 58: </span>                      <span style="color: #99bb66;">(</span>1+ zeroes<span style="color: #99bb66;">)</span>
<span class="linenr"> 59: </span>                      zeroes<span style="color: #c678dd;">)</span>
<span class="linenr"> 60: </span>                  <span style="color: #c678dd;">(</span>cdr TL<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 61: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>stats <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>sparse-termlist? term-list<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">do appropriate measurement</span>
<span class="linenr"> 62: </span>                     <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>1+ <span style="color: #51afef;">(</span>order <span style="color: #c678dd;">(</span>sparse-first-term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 63: </span>                              <span style="color: #a9a1e1;">(</span>length term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 64: </span>                           <span style="color: #99bb66;">(</span>1+ <span style="color: #a9a1e1;">(</span>order <span style="color: #51afef;">(</span>sparse-first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 65: </span>                     <span style="color: #c678dd;">(</span>count-zeroes term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 66: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>zero-elements <span style="color: #c678dd;">(</span>first stats<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 67: </span>            <span style="color: #51afef;">(</span>highest-order <span style="color: #c678dd;">(</span>second stats<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 68: </span>        <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>/ zero-elements highest-order<span style="color: #51afef;">)</span>
<span class="linenr"> 69: </span>           <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 70: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-to-dense</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 71: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>old-list <span style="color: #51afef;">(</span>reverse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 72: </span>               <span style="color: #a9a1e1;">(</span>new-list <span style="color: #51afef;">(</span>the-empty-termlist<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 73: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? old-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 74: </span>          new-list
<span class="linenr"> 75: </span>          <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>rest-terms old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 76: </span>                <span style="color: #51afef;">(</span>adjoin-term-dense <span style="color: #c678dd;">(</span>sparse-first-term old-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 77: </span>                                   new-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 78: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-to-sparse</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 79: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>old-list <span style="color: #51afef;">(</span>reverse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 80: </span>               <span style="color: #a9a1e1;">(</span>old-order <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 81: </span>               <span style="color: #a9a1e1;">(</span>new-list <span style="color: #51afef;">(</span>the-empty-termlist<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 82: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? old-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 83: </span>          new-list
<span class="linenr"> 84: </span>          <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>rest-terms old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span>                <span style="color: #51afef;">(</span>1+ old-order<span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span>                <span style="color: #51afef;">(</span>adjoin-term-sparse <span style="color: #c678dd;">(</span>make-sparse-term old-order
<span class="linenr"> 87: </span>                                                      <span style="color: #99bb66;">(</span>coeff <span style="color: #a9a1e1;">(</span>dense-first-term old-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 88: </span>                                    new-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 89: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sparse-term</span> order coeff<span style="color: #c678dd;">)</span>
<span class="linenr"> 90: </span>    <span style="color: #c678dd;">(</span>list order coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 91: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-termlist-order</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 92: </span>    <span style="color: #c678dd;">(</span>1- <span style="color: #99bb66;">(</span>length term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 93: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 94: </span>    <span style="color: #c678dd;">(</span>make-sparse-term <span style="color: #99bb66;">(</span>dense-termlist-order term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 95: </span>                      <span style="color: #99bb66;">(</span>car term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 96: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 97: </span>    <span style="color: #c678dd;">(</span>car term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 98: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 99: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">100: </span>        <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">101: </span>        <span style="color: #99bb66;">(</span>dense-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">102: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term-sparse</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">103: </span>    <span style="color: #c678dd;">(</span>cons term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">104: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term-dense</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">105: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if term is exactly 1 order above top of list, adjoin</span>
<span class="linenr">106: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">if term is more than 1 order above, adjoin 0 and recurse</span>
<span class="linenr">107: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>top-order <span style="color: #51afef;">(</span>dense-termlist-order term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">108: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span>1+ top-order<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">109: </span>             <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>coeff term<span style="color: #c678dd;">)</span> term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">110: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&lt;= top-order <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">111: </span>             <span style="color: #51afef;">(</span>adjoin-term-dense term <span style="color: #c678dd;">(</span>cons <span style="color: #dd8844; font-weight: bold;">0</span> term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">112: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"term is lower order than top of list: ADJOIN-TERM-DENSE"</span> term term-list top-order<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">113: </span>
<span class="linenr">114: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">;; I wrote the versions below which can insert into the middle of the list,</span>
<span class="linenr">115: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">;; before remembering that a footnote in the text excuses this.</span>
<span class="linenr">116: </span>  <span style="color: #525252;">;;</span>
<span class="linenr">117: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">(define (adjoin-term-sparse term term-list)</span>
<span class="linenr">118: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is higher order, cons to list</span>
<span class="linenr">119: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">120: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">(let ((top-order (order (sparse-first-term term-list))))</span>
<span class="linenr">121: </span>  <span style="color: #525252;">;;     </span><span style="color: #525252;">(cond ((&lt;= (1+ top-order) (order term))</span>
<span class="linenr">122: </span>  <span style="color: #525252;">;;            </span><span style="color: #525252;">(cons term term-list))</span>
<span class="linenr">123: </span>  <span style="color: #525252;">;;           </span><span style="color: #525252;">(else (adjoin-term-sparse (sparse-first-term term-list)</span>
<span class="linenr">124: </span>  <span style="color: #525252;">;;                                     </span><span style="color: #525252;">(adjoin-term-sparse term</span>
<span class="linenr">125: </span>  <span style="color: #525252;">;;                                                         </span><span style="color: #525252;">(rest-terms term-list)))))))</span>
<span class="linenr">126: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">(define (adjoin-term-dense term term-list)</span>
<span class="linenr">127: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is 1 order above top of list, adjoin</span>
<span class="linenr">128: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is more than 1 order above, adjoin 0 and recurse</span>
<span class="linenr">129: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">;; if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">130: </span>  <span style="color: #525252;">;;   </span><span style="color: #525252;">(let ((top-order (dense-termlist-order term-list)))</span>
<span class="linenr">131: </span>  <span style="color: #525252;">;;     </span><span style="color: #525252;">(cond ((= (1+ top-order) (order term))</span>
<span class="linenr">132: </span>  <span style="color: #525252;">;;            </span><span style="color: #525252;">(cons (coeff term) term-list))</span>
<span class="linenr">133: </span>  <span style="color: #525252;">;;           </span><span style="color: #525252;">((&lt;= top-order (order term))</span>
<span class="linenr">134: </span>  <span style="color: #525252;">;;            </span><span style="color: #525252;">(adjoin-term-dense term (cons 0 term-list)))</span>
<span class="linenr">135: </span>  <span style="color: #525252;">;;           </span><span style="color: #525252;">(else (adjoin-term-dense (dense-first-term term-list)</span>
<span class="linenr">136: </span>  <span style="color: #525252;">;;                                    </span><span style="color: #525252;">(adjoin-term-dense term</span>
<span class="linenr">137: </span>  <span style="color: #525252;">;;                                                       </span><span style="color: #525252;">(rest-terms term-list)))))))</span>
<span class="linenr">138: </span>
<span class="linenr">139: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">140: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>coeff term<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">141: </span>        term-list
<span class="linenr">142: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>empty-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr">143: </span>                <span style="color: #51afef;">(</span>sparse-termlist? term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">144: </span>            <span style="color: #a9a1e1;">(</span>adjoin-term-sparse term term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">145: </span>            <span style="color: #a9a1e1;">(</span>adjoin-term-dense term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">146: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">the-empty-termlist</span><span style="color: #c678dd;">)</span> '<span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span>
<span class="linenr">147: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rest-terms</span> term-list<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">148: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">empty-termlist?</span> term-list<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>null? term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">149: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">order</span> term<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>first term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">150: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">coeff</span> term<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>second term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">151: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">152: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">153: </span>        <span style="color: #99bb66;">(</span>make-poly <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">154: </span>                   <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>terms p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>terms p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">155: </span>        <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Polys not in same var: ADD-POLY"</span> <span style="color: #a9a1e1;">(</span>list p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">156: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">157: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">158: </span>        <span style="color: #99bb66;">(</span>make-poly <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">159: </span>                   <span style="color: #a9a1e1;">(</span>mul-terms <span style="color: #51afef;">(</span>terms p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>terms p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">160: </span>        <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Polys not in same var: MUL-POLY"</span> <span style="color: #a9a1e1;">(</span>list p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">161: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr">162: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? L1<span style="color: #a9a1e1;">)</span> L2<span style="color: #99bb66;">)</span>
<span class="linenr">163: </span>          <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? L2<span style="color: #a9a1e1;">)</span> L1<span style="color: #99bb66;">)</span>
<span class="linenr">164: </span>          <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">165: </span>           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1 <span style="color: #99bb66;">(</span>first-term L1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">166: </span>                 <span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>first-term L2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">167: </span>             <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>&gt; <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">168: </span>                    <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">169: </span>                     t1 <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">170: </span>                   <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">171: </span>                    <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">172: </span>                     t2 <span style="color: #a9a1e1;">(</span>add-terms L1 <span style="color: #51afef;">(</span>rest-terms L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">173: </span>                   <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">174: </span>                    <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">175: </span>                     <span style="color: #a9a1e1;">(</span>make-sparse-term <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span>
<span class="linenr">176: </span>                                       <span style="color: #51afef;">(</span>add <span style="color: #c678dd;">(</span>coeff t1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>coeff t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">177: </span>                     <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span>
<span class="linenr">178: </span>                                <span style="color: #51afef;">(</span>rest-terms L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">179: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr">180: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L1<span style="color: #99bb66;">)</span>
<span class="linenr">181: </span>        <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr">182: </span>        <span style="color: #99bb66;">(</span>add-terms <span style="color: #a9a1e1;">(</span>mul-term-by-all-terms <span style="color: #51afef;">(</span>first-term L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span>
<span class="linenr">183: </span>                   <span style="color: #a9a1e1;">(</span>mul-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">184: </span>  
<span class="linenr">185: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">186: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tag</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>attach-tag 'polynomial p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">187: </span>  <span style="color: #51afef;">(</span>put 'add '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">188: </span>       <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>add-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">189: </span>  <span style="color: #51afef;">(</span>put 'mul '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">190: </span>       <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>mul-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">191: </span>  <span style="color: #51afef;">(</span>put 'make 'polynomial
<span class="linenr">192: </span>       <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>var terms<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>make-poly var terms<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">193: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">if-1st-poly-make-2nd-poly</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">194: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? 'polynomial <span style="color: #51afef;">(</span>type-tag t1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">195: </span>             <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>eqv? 'polynomial <span style="color: #c678dd;">(</span>type-tag t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">196: </span>        <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable <span style="color: #c678dd;">(</span>contents t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">197: </span>        t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">198: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-term-by-all-terms</span> t1 L<span style="color: #c678dd;">)</span>
<span class="linenr">199: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">200: </span>        <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr">201: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">If one coeff is a poly, make the other a poly</span>
<span class="linenr">202: </span>               <span style="color: #51afef;">(</span>t1-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">203: </span>               <span style="color: #51afef;">(</span>t2-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">204: </span>          
<span class="linenr">205: </span>          <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">206: </span>           <span style="color: #51afef;">(</span>make-sparse-term <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>order t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">207: </span>                             <span style="color: #c678dd;">(</span>mul t1-coeff t2-coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">208: </span>           <span style="color: #51afef;">(</span>mul-term-by-all-terms t1 <span style="color: #c678dd;">(</span>rest-terms L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">209: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">terms-=zero?</span> L<span style="color: #c678dd;">)</span>
<span class="linenr">210: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">211: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>=zero? <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">212: </span>             <span style="color: #a9a1e1;">(</span>terms-=zero? <span style="color: #51afef;">(</span>rest-terms L<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">213: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">poly-=zero?</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">214: </span>    <span style="color: #c678dd;">(</span>terms-=zero? <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">215: </span>  <span style="color: #51afef;">(</span>put '=zero? '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span> poly-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">216: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg-terms</span> TL<span style="color: #c678dd;">)</span>
<span class="linenr">217: </span>    <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>negterm <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>sparse-termlist? TL<span style="color: #c678dd;">)</span>
<span class="linenr">218: </span>                       <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>t<span style="color: #99bb66;">)</span>
<span class="linenr">219: </span>                         <span style="color: #99bb66;">(</span>make-sparse-term <span style="color: #a9a1e1;">(</span>order t<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>neg <span style="color: #51afef;">(</span>coeff t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">220: </span>                       <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>t<span style="color: #99bb66;">)</span>
<span class="linenr">221: </span>                         <span style="color: #99bb66;">(</span>neg <span style="color: #a9a1e1;">(</span>coeff t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">222: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">map</span> negterm TL<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">223: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-terms</span> T1 T2<span style="color: #c678dd;">)</span>
<span class="linenr">224: </span>    <span style="color: #c678dd;">(</span>add-terms T1 <span style="color: #99bb66;">(</span>neg-terms T2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">225: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg-poly</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">226: </span>    <span style="color: #c678dd;">(</span>make-poly <span style="color: #99bb66;">(</span>variable p<span style="color: #99bb66;">)</span>
<span class="linenr">227: </span>               <span style="color: #99bb66;">(</span>neg-terms <span style="color: #a9a1e1;">(</span>terms p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">228: </span>  <span style="color: #51afef;">(</span>put 'neg '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">229: </span>       <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>neg-poly p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">230: </span>  <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">231: </span>    <span style="color: #c678dd;">(</span>add-poly p1 <span style="color: #99bb66;">(</span>neg-poly p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">232: </span>  <span style="color: #51afef;">(</span>put 'sub '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">233: </span>       <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>sub-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org888d998"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">trivial-poly?</span> poly<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>length <span style="color: #51afef;">(</span>terms poly<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 3: </span>       <span style="color: #99bb66;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #a9a1e1;">(</span>order <span style="color: #51afef;">(</span>first-term <span style="color: #c678dd;">(</span>terms poly<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 4: </span><span style="color: #525252;">;;; </span><span style="color: #ECBE7B; font-weight: bold;">TODO:</span><span style="color: #525252;"> get working once cross-variable comparisons can be done</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span>put 'project 'polynomial
<span class="linenr"> 6: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p<span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>trivial-poly? p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 8: </span>           #f
<span class="linenr"> 9: </span>           <span style="color: #a9a1e1;">(</span>coeff <span style="color: #51afef;">(</span>first-term <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">10: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?-terms</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">11: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>= <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>          <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">13: </span>       <span style="color: #99bb66;">(</span>equ? <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span>
<span class="linenr">14: </span>             <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?-termlists</span> tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr">16: </span>         <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>term-list1 tl1<span style="color: #a9a1e1;">)</span>
<span class="linenr">17: </span>                    <span style="color: #a9a1e1;">(</span>term-list2 tl2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">18: </span>           <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>empty-termlist? term-list1<span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>                       <span style="color: #c678dd;">(</span>empty-termlist? term-list2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">20: </span>                  #t<span style="color: #a9a1e1;">)</span>
<span class="linenr">21: </span>                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span>empty-termlist? term-list1<span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>                      <span style="color: #c678dd;">(</span>empty-termlist? term-list2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">23: </span>                  #f<span style="color: #a9a1e1;">)</span>
<span class="linenr">24: </span>                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>equ?-terms <span style="color: #c678dd;">(</span>first-term term-list1<span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>                              <span style="color: #c678dd;">(</span>first-term term-list2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">26: </span>                  <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>rest-terms term-list1<span style="color: #c678dd;">)</span>
<span class="linenr">27: </span>                        <span style="color: #c678dd;">(</span>rest-terms term-list2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">28: </span>                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">29: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?-poly</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr">30: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>trivial-poly? p<span style="color: #51afef;">)</span>
<span class="linenr">31: </span>              <span style="color: #51afef;">(</span>trivial-poly? q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">32: </span>         <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">33: </span>               <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term <span style="color: #99bb66;">(</span>terms q<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">34: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">35: </span>         <span style="color: #a9a1e1;">(</span>equ?-termlists <span style="color: #51afef;">(</span>terms p<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>terms q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">36: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? p<span style="color: #a9a1e1;">)</span>
<span class="linenr">37: </span>         <span style="color: #a9a1e1;">(</span>equ?-poly <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">38: </span>                    q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">39: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? q<span style="color: #a9a1e1;">)</span>
<span class="linenr">40: </span>         <span style="color: #a9a1e1;">(</span>equ?-poly p
<span class="linenr">41: </span>                    <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">42: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"different vars not supported yet : EQU?-POLY"</span> p q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">43: </span><span style="color: #51afef;">(</span>put 'equ? '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">44: </span>     equ?-poly<span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org9aa5fa6"><span class="linenr">1: </span><span style="color: #525252;">;; </span><span style="color: #525252;">polynomial procedures</span>
<span class="linenr">2: </span><span style="color: #525252;">;  </span><span style="color: #525252;">'done)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-polynomial</span> var terms<span style="color: #c678dd;">)</span>
<span class="linenr">4: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'polynomial<span style="color: #99bb66;">)</span> var terms<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org3201eca"><span class="linenr">  1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'add x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'sub x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'mul x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'div x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'magnitude z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'angle z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  9: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Now we begin to change code for support</span>
<span class="linenr"> 10: </span><span style="color: #525252;">;; </span><span style="color: #525252;">These will be named slightly different so the primitive</span>
<span class="linenr"> 11: </span><span style="color: #525252;">;; </span><span style="color: #525252;">functions aren't shadowed</span>
<span class="linenr"> 12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>mul x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sine</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'sine x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">(sin)</span>
<span class="linenr"> 14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cosine</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'cosine x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">; </span><span style="color: #525252;">(cos)</span>
<span class="linenr"> 15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-root</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'square-root x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">(sqrt)</span>
<span class="linenr"> 16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">arctan</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'arctan x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">(atan)</span>
<span class="linenr"> 17: </span>
<span class="linenr"> 18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-scheme-number</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 19: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'scheme-number<span style="color: #99bb66;">)</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-scheme-number-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 21: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'scheme-number x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 22: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 23: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>+ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 24: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 25: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>- x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 26: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 27: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>* x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 28: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 29: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 30: </span>  <span style="color: #c678dd;">(</span>put 'sine '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 31: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sin x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 32: </span>  <span style="color: #c678dd;">(</span>put 'cosine '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 33: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>cos x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 34: </span>  <span style="color: #c678dd;">(</span>put 'square-root '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 35: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sqrt x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 36: </span>  <span style="color: #c678dd;">(</span>put 'arctan '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 37: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>atan x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 38: </span>  <span style="color: #c678dd;">(</span>put 'make 'scheme-number <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 39: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 40: </span>
<span class="linenr"> 41: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rational-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 42: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr"> 43: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">numer</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>first x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 44: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">denom</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>second x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 45: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-rat</span> n d<span style="color: #99bb66;">)</span>
<span class="linenr"> 46: </span>    <span style="color: #99bb66;">(</span>list n d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 47: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 48: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 49: </span>                   <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 50: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 51: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 52: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 53: </span>                   <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 54: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 55: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 56: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 57: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 58: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 59: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 60: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 61: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr"> 62: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rational x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 63: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 64: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 65: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 66: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 67: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 68: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 69: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 70: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 71: </span>  <span style="color: #c678dd;">(</span>put 'make 'rational
<span class="linenr"> 72: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>n d<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-rat n d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 73: </span>  <span style="color: #c678dd;">(</span>put 'numer '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> numer<span style="color: #c678dd;">)</span>
<span class="linenr"> 74: </span>  <span style="color: #c678dd;">(</span>put 'denom '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> denom<span style="color: #c678dd;">)</span>
<span class="linenr"> 75: </span>  <span style="color: #c678dd;">(</span>put 'sine '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 76: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'sine '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 77: </span>                   <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 78: </span>  <span style="color: #c678dd;">(</span>put 'cosine '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 79: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'cosine '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span>                   <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 81: </span>  <span style="color: #c678dd;">(</span>put 'square-root '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 82: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'square-root '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 83: </span>                   <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 84: </span>  <span style="color: #c678dd;">(</span>put 'arctan '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 85: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r s<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'arctan '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span>                     <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 87: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 88: </span>
<span class="linenr"> 89: </span><span style="color: #525252;">;; </span><span style="color: #525252;">for future use</span>
<span class="linenr"> 90: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">numer</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 91: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 92: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 93: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">denom</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 94: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 95: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 96: </span>
<span class="linenr"> 97: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rational</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr"> 98: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'rational<span style="color: #99bb66;">)</span> n d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 99: </span>
<span class="linenr">100: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rectangular-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">101: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">102: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">103: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">104: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">105: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span>
<span class="linenr">106: </span>    <span style="color: #99bb66;">(</span>square-root <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">107: </span>                      <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">108: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span>
<span class="linenr">109: </span>    <span style="color: #99bb66;">(</span>arctan <span style="color: #a9a1e1;">(</span>imag-part z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>real-part z<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">110: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr">111: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>mul r <span style="color: #51afef;">(</span>cosine a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>mul r <span style="color: #51afef;">(</span>sine a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">112: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr">113: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rectangular x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">114: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">115: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">116: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">117: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">118: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'rectangular
<span class="linenr">119: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">120: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'rectangular
<span class="linenr">121: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">122: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">123: </span>
<span class="linenr">124: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polar-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">125: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">126: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">127: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">128: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">129: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cosine <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">130: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>sine <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">131: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr">132: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>sqrt <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>square x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>square y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">133: </span>          <span style="color: #a9a1e1;">(</span>atan y x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">134: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr">135: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'polar x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">136: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">137: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">138: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">139: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">140: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'polar
<span class="linenr">141: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">142: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'polar
<span class="linenr">143: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">144: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">145: </span>
<span class="linenr">146: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-complex-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">147: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr">148: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-real-imag 'rectangular<span style="color: #a9a1e1;">)</span> x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">149: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr">150: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-mag-ang 'polar<span style="color: #a9a1e1;">)</span> r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">151: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">let's make these generic</span>
<span class="linenr">152: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">153: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">154: </span>                         <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">155: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">156: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">157: </span>                         <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">158: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">159: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">160: </span>                       <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">161: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">162: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>div <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">163: </span>                       <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">164: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">165: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'complex z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">166: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">167: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">168: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">169: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">170: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">171: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">172: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">173: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">174: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'complex
<span class="linenr">175: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">176: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'complex
<span class="linenr">177: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">178: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">179: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">180: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">181: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">182: </span>
<span class="linenr">183: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-real-imag</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">184: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-real-imag 'complex<span style="color: #99bb66;">)</span> x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">185: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-mag-ang</span> r a<span style="color: #c678dd;">)</span>
<span class="linenr">186: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-mag-ang 'complex<span style="color: #99bb66;">)</span> r a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">187: </span>
<span class="linenr">188: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">project</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">189: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>type-tag x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">190: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>get 'project t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">191: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> p
<span class="linenr">192: </span>          <span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>contents x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">193: </span>          #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">194: </span>
<span class="linenr">195: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">drop</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">196: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>pair? x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">197: </span>      x
<span class="linenr">198: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>projected <span style="color: #c678dd;">(</span>project x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">199: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eqv? projected #f<span style="color: #c678dd;">)</span>
<span class="linenr">200: </span>               x<span style="color: #51afef;">)</span>
<span class="linenr">201: </span>              <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>equ? x projected<span style="color: #c678dd;">)</span>
<span class="linenr">202: </span>               <span style="color: #c678dd;">(</span>drop projected<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">203: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">204: </span>
<span class="linenr">205: </span><span style="color: #51afef;">(</span>put 'project 'rational
<span class="linenr">206: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">207: </span>       <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'numer '<span style="color: #51afef;">(</span>rational<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">208: </span>        num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">209: </span><span style="color: #51afef;">(</span>put 'project 'real
<span class="linenr">210: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">211: </span>       <span style="color: #99bb66;">(</span>round num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">212: </span><span style="color: #525252;">;; </span><span style="color: #525252;">projecting a complex number may return something other than a single number</span>
<span class="linenr">213: </span><span style="color: #51afef;">(</span>put 'project 'complex
<span class="linenr">214: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">215: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>r <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'real-part '<span style="color: #a9a1e1;">(</span>complex<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">216: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>number? <span style="color: #c678dd;">(</span>contents r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">217: </span>             <span style="color: #51afef;">(</span>make-real <span style="color: #c678dd;">(</span>contents r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">218: </span>             r<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">219: </span>
<span class="linenr">220: </span><span style="color: #525252;">;; </span><span style="color: #525252;">equality testing with complex numbers also changes</span>
<span class="linenr">221: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'equ? x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">222: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-equ?</span><span style="color: #c678dd;">)</span>
<span class="linenr">223: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr">224: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">225: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">226: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">227: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1 <span style="color: #99bb66;">(</span>type-tag x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">228: </span>               <span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>type-tag y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">229: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? t1 'polar<span style="color: #a9a1e1;">)</span>
<span class="linenr">230: </span>                       <span style="color: #a9a1e1;">(</span>eqv? t2 'polar<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">231: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'magnitude x<span style="color: #51afef;">)</span>
<span class="linenr">232: </span>                             <span style="color: #51afef;">(</span>apply-generic 'magnitude y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">233: </span>                       <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'angle x<span style="color: #51afef;">)</span>
<span class="linenr">234: </span>                             <span style="color: #51afef;">(</span>apply-generic 'angle y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">235: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">236: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'real-part x<span style="color: #51afef;">)</span>
<span class="linenr">237: </span>                             <span style="color: #51afef;">(</span>apply-generic 'real-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">238: </span>                       <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'imag-part x<span style="color: #51afef;">)</span>
<span class="linenr">239: </span>                             <span style="color: #51afef;">(</span>apply-generic 'imag-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">240: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr">241: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">242: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>equ? <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">243: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">244: </span>              <span style="color: #51afef;">(</span>equ? <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">245: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">246: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr">247: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org6f8b573"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=zero?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic '=zero? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-=zero?</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 3: </span>  <span style="color: #c678dd;">(</span>put '=zero? '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 4: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #c678dd;">(</span>put '=zero? '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>         <span style="color: #a9a1e1;">(</span>apply-generic '=zero? x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>magnitude <span style="color: #51afef;">(</span>get 'magnitude '<span style="color: #c678dd;">(</span>polar<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #99bb66;">(</span>put '=zero? '<span style="color: #a9a1e1;">(</span>polar<span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span>
<span class="linenr">11: </span>           <span style="color: #51afef;">(</span>= <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span>magnitude x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">12: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>real-part <span style="color: #51afef;">(</span>get 'real-part '<span style="color: #c678dd;">(</span>rectangular<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">13: </span>        <span style="color: #a9a1e1;">(</span>imag-part <span style="color: #51afef;">(</span>get 'imag-part '<span style="color: #c678dd;">(</span>rectangular<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>    <span style="color: #99bb66;">(</span>put '=zero? '<span style="color: #a9a1e1;">(</span>rectangular<span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>x<span style="color: #51afef;">)</span>
<span class="linenr">16: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>real-part x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>                <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>imag-part x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">18: </span>  <span style="color: #c678dd;">(</span>put '=zero? '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr">19: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>
<span class="linenr">20: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>=zero? <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>             <span style="color: #51afef;">(</span>=zero? <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-raiseto&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-rational-functions&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?-rf&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span><span style="color: #ECBE7B;">&lt;&lt;tower-coercions-rf&gt;&gt;</span>
<span class="linenr"> 17: </span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-rf-top&gt;&gt;</span>
<span class="linenr"> 19: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-projection&gt;&gt;</span>
<span class="linenr"> 20: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-division&gt;&gt;</span>
<span class="linenr"> 21: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-rf-bottom&gt;&gt;</span>
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 24: </span>
<span class="linenr"> 25: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 26: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 27: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 33: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 34: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 35: </span>
<span class="linenr"> 36: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 37: </span>
<span class="linenr"> 38: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 39: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 40: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 41: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 42: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 43: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 44: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 45: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 46: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 47: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 48: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 49: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 50: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 51: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 52: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 53: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 54: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 55: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 56: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 57: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 58: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 59: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 60: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 61: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 62: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 63: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 64: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 65: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 66: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 67: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 68: </span>                                      <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 69: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 70: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 72: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 73: </span>
<span class="linenr"> 74: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 75: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 76: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p3</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 77: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p4</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 78: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p5</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 79: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p7</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p6</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 81: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p66</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 82: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p77</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 83: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p8</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 84: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p9</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p98</span> <span style="color: #c678dd;">(</span>make-rational p9 p8<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 87: </span>             <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 88: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 89: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 90: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 91: </span>             <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 92: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 93: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 94: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr"> 95: </span>             <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr"> 96: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 97: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 98: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr"> 99: </span>             <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr">100: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">101: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">102: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr">103: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span>
<span class="linenr">104: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr">105: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">106: </span>             <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">107: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr">108: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">109: </span>             <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">110: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">111: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">112: </span>             <span style="color: #c678dd;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">113: </span>
<span class="linenr">114: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">115: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">116: </span>             <span style="color: #c678dd;">(</span>make-polynomial 'x p4<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">117: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">118: </span>             <span style="color: #c678dd;">(</span>sub <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr">119: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p3<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">120: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">121: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 1"</span>
<span class="linenr">122: </span>             <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span>
<span class="linenr">123: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">124: </span>             '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">125: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 2"</span>
<span class="linenr">126: </span>             <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span>
<span class="linenr">127: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">128: </span>             '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">129: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 3"</span>
<span class="linenr">130: </span>             <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p66<span style="color: #99bb66;">)</span>
<span class="linenr">131: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p77<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">132: </span>             '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">133: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational functions"</span>
<span class="linenr">134: </span>             <span style="color: #c678dd;">(</span>add p98 p98<span style="color: #c678dd;">)</span>
<span class="linenr">135: </span>             '<span style="color: #c678dd;">(</span>rational <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orga09a511">
&lt;...&gt;
SUCCEED at rational functions
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0aaf77" class="outline-3">
<h3 id="orge0aaf77"><span class="section-number-3">3.107.</span> Exercise 2.94: GCD of polynomials</h3>
<div class="outline-text-3" id="text-3-107">
</div>
<div id="outline-container-orga277635" class="outline-4">
<h4 id="orga277635"><span class="section-number-4">3.107.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-107-1">
<p>
Using <code class="src src-scheme">div-terms</code>, implement the procedure <code class="src src-scheme">remainder-terms</code>
and use this to define <code class="src src-scheme">gcd-terms</code> as above. Now write a procedure
<code class="src src-scheme">gcd-poly</code> that computes the polynomial GCD of two polys. (The
procedure should signal an error if the two polys are not in the same variable.)
Install in the system a generic operation <code class="src src-scheme">greatest-common-divisor</code>
that reduces to <code class="src src-scheme">gcd-poly</code> for polynomials and to ordinary
<code class="src src-scheme">gcd</code> for ordinary numbers. As a test, try
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> <span style="color: #c678dd;">(</span>make-polynomial
<span class="linenr">2: </span>            'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>greatest-common-divisor p1 p2<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
and check your result by hand.
</p>
</div>
</div>

<div id="outline-container-org86cbaa3" class="outline-4">
<h4 id="org86cbaa3"><span class="section-number-4">3.107.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-107-2">
<p>
An important change had to be made here. Dense termlists are padded with zeroes,
while sparse ones are not. This is fine for addition (and subtraction on the
right side) but it can be a problem otherwise. So <code>dense-first-term</code> needs to
find the first non-zero coefficient to return, <code>rest-terms</code> needs to chop off
leading zeroes for dense lists, and <code>adjoin-term-sparse</code> should probably be
amended to skip zeroes so this doesn&rsquo;t happen with sparse lists.
</p>

<p>
I&rsquo;ve also had to rescue some &ldquo;refugees&rdquo; from <a href="#org1306cf6">Exercise 2.92</a>, such as <code>map-terms</code>. 
</p>

<div class="org-src-container">
<pre class="src src-scheme" id="org2015dde"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>use-srfis '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polynomial-package</span><span style="color: #c678dd;">)</span> 'no<span style="color: #51afef;">)</span>
<span class="linenr">  3: </span><span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">  4: </span><span style="color: #525252;">;; </span><span style="color: #525252;">representation of poly</span>
<span class="linenr">  5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-poly</span> variable term-list<span style="color: #c678dd;">)</span>
<span class="linenr">  6: </span>  <span style="color: #c678dd;">(</span>cons variable
<span class="linenr">  7: </span>        <span style="color: #99bb66;">(</span>convert-termlist-if-reasonable term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">convert-termlist-if-reasonable</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">  9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 10: </span>      term-list
<span class="linenr"> 11: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>sparse-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr"> 12: </span>             <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>tl <span style="color: #a9a1e1;">(</span>sort-sparse-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 13: </span>               <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>should-be-sparse? tl<span style="color: #99bb66;">)</span>
<span class="linenr"> 14: </span>                   tl
<span class="linenr"> 15: </span>                   <span style="color: #99bb66;">(</span>sparse-to-dense tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 16: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>should-be-sparse? term-list<span style="color: #51afef;">)</span>
<span class="linenr"> 17: </span>             <span style="color: #51afef;">(</span>dense-to-sparse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 18: </span>            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 19: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>car p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">terms</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>cdr p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 21: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">variable?</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>symbol? x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 22: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">same-variable?</span> v1 v2<span style="color: #c678dd;">)</span>
<span class="linenr"> 23: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>variable? v1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>variable? v2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>eq? v1 v2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 24: </span>
<span class="linenr"> 25: </span><span style="color: #525252;">;; </span><span style="color: #525252;">representation of terms and term lists</span>
<span class="linenr"> 26: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-termlist?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 27: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 28: </span>      #t
<span class="linenr"> 29: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t <span style="color: #c678dd;">(</span>car term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 30: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #99bb66;">(</span>pair? t<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks like a sparse list</span>
<span class="linenr"> 31: </span>                    <span style="color: #99bb66;">(</span>number? <span style="color: #a9a1e1;">(</span>first t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 32: </span>                    <span style="color: #99bb66;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span>pair? <span style="color: #51afef;">(</span>second t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or sparse with nested poly</span>
<span class="linenr"> 33: </span>                        <span style="color: #a9a1e1;">(</span>number? <span style="color: #51afef;">(</span>second t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #t<span style="color: #51afef;">)</span>
<span class="linenr"> 34: </span>              <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>number? t<span style="color: #99bb66;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">looks dense</span>
<span class="linenr"> 35: </span>                   <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>pair? t<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 36: </span>                        <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>number? <span style="color: #c678dd;">(</span>first t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #525252;">;; </span><span style="color: #525252;">or dense with a nested poly</span>
<span class="linenr"> 37: </span>                   <span style="color: #99bb66;">(</span>eq? #f t<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span> #f<span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">or dense with an empty entry</span>
<span class="linenr"> 38: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>error <span style="color: #99bb66;">"badly formed term: SPARSE-TERMLIST?"</span> t term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 39: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sort-sparse-terms</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 40: </span>  <span style="color: #c678dd;">(</span>sort term-list <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>t1 t2<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 41: </span>                    <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span>
<span class="linenr"> 42: </span>                       <span style="color: #51afef;">(</span>order t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 43: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">should-be-sparse?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 44: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">sparse or dense term-list -&gt; bool</span>
<span class="linenr"> 45: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if more than half of term-list is zeroes, return true</span>
<span class="linenr"> 46: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">reasoning:</span>
<span class="linenr"> 47: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for sparse list is (non-zero elements * 2)</span>
<span class="linenr"> 48: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">- number of elements used for dense list is (highest order)</span>
<span class="linenr"> 49: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">count-zeroes</span> term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 50: </span>    <span style="color: #525252;">;; </span><span style="color: #525252;">term-list -&gt; (highest order, zeroes)</span>
<span class="linenr"> 51: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>length <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 52: </span>               <span style="color: #51afef;">(</span>zeroes <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
<span class="linenr"> 53: </span>               <span style="color: #51afef;">(</span>TL <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 54: </span>                       <span style="color: #99bb66;">(</span>sparse-to-dense term-list<span style="color: #99bb66;">)</span>
<span class="linenr"> 55: </span>                       term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 56: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>empty-termlist? TL<span style="color: #51afef;">)</span>
<span class="linenr"> 57: </span>          <span style="color: #51afef;">(</span>list zeroes length<span style="color: #51afef;">)</span>
<span class="linenr"> 58: </span>          <span style="color: #51afef;">(</span>iter <span style="color: #c678dd;">(</span>1+ length<span style="color: #c678dd;">)</span>
<span class="linenr"> 59: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>car TL<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 60: </span>                    <span style="color: #99bb66;">(</span>1+ zeroes<span style="color: #99bb66;">)</span>
<span class="linenr"> 61: </span>                    zeroes<span style="color: #c678dd;">)</span>
<span class="linenr"> 62: </span>                <span style="color: #c678dd;">(</span>cdr TL<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 63: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>stats <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>sparse-termlist? term-list<span style="color: #c678dd;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">do appropriate measurement</span>
<span class="linenr"> 64: </span>                   <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>- <span style="color: #a9a1e1;">(</span>1+ <span style="color: #51afef;">(</span>order <span style="color: #c678dd;">(</span>sparse-first-term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 65: </span>                            <span style="color: #a9a1e1;">(</span>length term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 66: </span>                         <span style="color: #99bb66;">(</span>1+ <span style="color: #a9a1e1;">(</span>order <span style="color: #51afef;">(</span>sparse-first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 67: </span>                   <span style="color: #c678dd;">(</span>count-zeroes term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 68: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>zero-elements <span style="color: #c678dd;">(</span>first stats<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 69: </span>          <span style="color: #51afef;">(</span>highest-order <span style="color: #c678dd;">(</span>second stats<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 70: </span>      <span style="color: #a9a1e1;">(</span>&gt; <span style="color: #51afef;">(</span>/ zero-elements highest-order<span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span>         <span style="color: #51afef;">(</span>/ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 72: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-to-dense</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 73: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>old-list <span style="color: #51afef;">(</span>reverse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 74: </span>             <span style="color: #a9a1e1;">(</span>new-list <span style="color: #51afef;">(</span>the-empty-termlist<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 75: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? old-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 76: </span>        new-list
<span class="linenr"> 77: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>rest-terms old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 78: </span>              <span style="color: #51afef;">(</span>adjoin-term-dense <span style="color: #c678dd;">(</span>sparse-first-term old-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 79: </span>                                 new-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-to-sparse</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 81: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>old-list <span style="color: #51afef;">(</span>reverse term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 82: </span>             <span style="color: #a9a1e1;">(</span>old-order <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 83: </span>             <span style="color: #a9a1e1;">(</span>new-list <span style="color: #51afef;">(</span>the-empty-termlist<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 84: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? old-list<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 85: </span>        new-list
<span class="linenr"> 86: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>rest-terms old-list<span style="color: #51afef;">)</span>
<span class="linenr"> 87: </span>              <span style="color: #51afef;">(</span>1+ old-order<span style="color: #51afef;">)</span>
<span class="linenr"> 88: </span>              <span style="color: #51afef;">(</span>adjoin-term-sparse <span style="color: #c678dd;">(</span>make-sparse-term old-order
<span class="linenr"> 89: </span>                                                    <span style="color: #99bb66;">(</span>coeff <span style="color: #a9a1e1;">(</span>dense-first-term old-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 90: </span>                                  new-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 91: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-sparse-term</span> order coeff<span style="color: #c678dd;">)</span>
<span class="linenr"> 92: </span>  <span style="color: #c678dd;">(</span>list order coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 93: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-rest-terms</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr"> 94: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>rest <span style="color: #51afef;">(</span>cdr term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 95: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? rest<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 96: </span>        <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 97: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>c <span style="color: #99bb66;">(</span>car rest<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 98: </span>          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>eq? #f c<span style="color: #c678dd;">)</span>
<span class="linenr"> 99: </span>              <span style="color: #c678dd;">(</span>dense-rest-terms rest<span style="color: #c678dd;">)</span>
<span class="linenr">100: </span>              rest<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">101: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">rest-terms</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">102: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">103: </span>      <span style="color: #99bb66;">(</span>cdr term-list<span style="color: #99bb66;">)</span>
<span class="linenr">104: </span>      <span style="color: #99bb66;">(</span>dense-rest-terms term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">105: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-termlist-order</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">106: </span>  <span style="color: #c678dd;">(</span>1- <span style="color: #99bb66;">(</span>length term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">107: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-termlist-order</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">108: </span>  <span style="color: #c678dd;">(</span>order <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">109: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">termlist-order</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">110: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">111: </span>      <span style="color: #99bb66;">(</span>sparse-termlist-order term-list<span style="color: #99bb66;">)</span>
<span class="linenr">112: </span>      <span style="color: #99bb66;">(</span>dense-termlist-order term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">113: </span><span style="color: #525252;">;; </span><span style="color: #525252;">always O(n)</span>
<span class="linenr">114: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dense-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">115: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>c <span style="color: #51afef;">(</span>car term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">116: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>eq? #f c<span style="color: #a9a1e1;">)</span>
<span class="linenr">117: </span>        <span style="color: #a9a1e1;">(</span>dense-first-term <span style="color: #51afef;">(</span>dense-rest-terms term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">118: </span>        <span style="color: #a9a1e1;">(</span>make-sparse-term <span style="color: #51afef;">(</span>dense-termlist-order term-list<span style="color: #51afef;">)</span> c<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">119: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sparse-first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">120: </span>  <span style="color: #c678dd;">(</span>car term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">121: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-sparse-term-to-sparse-term</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">122: </span>  <span style="color: #c678dd;">(</span>make-sparse-term <span style="color: #99bb66;">(</span>order t1<span style="color: #99bb66;">)</span>
<span class="linenr">123: </span>                    <span style="color: #99bb66;">(</span>add <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">124: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">first-term</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">125: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>sparse-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">126: </span>      <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">127: </span>      <span style="color: #99bb66;">(</span>dense-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">128: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term-sparse</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">129: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if term is higher order, cons to list</span>
<span class="linenr">130: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if equal, replace or add</span>
<span class="linenr">131: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">132: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span>  <span style="color: #99bb66;">(</span>empty-termlist? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">133: </span>       <span style="color: #99bb66;">(</span>cons term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">134: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>top-order <span style="color: #c678dd;">(</span>order <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">135: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>&lt;= <span style="color: #99bb66;">(</span>1+ top-order<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">136: </span>                <span style="color: #c678dd;">(</span>cons term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">137: </span>               <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>= top-order <span style="color: #99bb66;">(</span>order term<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">138: </span>                <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>coeff <span style="color: #51afef;">(</span>sparse-first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">139: </span>                    <span style="color: #525252;">;; </span><span style="color: #525252;">replace if it's zero</span>
<span class="linenr">140: </span>                    <span style="color: #99bb66;">(</span>cons term <span style="color: #a9a1e1;">(</span>rest-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">141: </span>                    <span style="color: #525252;">;; </span><span style="color: #525252;">and add if it's not</span>
<span class="linenr">142: </span>                    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>add-sparse-term-to-sparse-term term
<span class="linenr">143: </span>                                                                  <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">144: </span>                      <span style="color: #a9a1e1;">(</span>cons result
<span class="linenr">145: </span>                            <span style="color: #51afef;">(</span>rest-terms term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> 
<span class="linenr">146: </span>               <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>adjoin-term-sparse <span style="color: #99bb66;">(</span>sparse-first-term term-list<span style="color: #99bb66;">)</span>
<span class="linenr">147: </span>                                         <span style="color: #99bb66;">(</span>adjoin-term-sparse term
<span class="linenr">148: </span>                                                             <span style="color: #a9a1e1;">(</span>rest-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">149: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term-dense</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">150: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">if term is lower order than top of list, try to insert in the middle</span>
<span class="linenr">151: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>top-order <span style="color: #51afef;">(</span>dense-termlist-order term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">152: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= <span style="color: #c678dd;">(</span>1+ top-order<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">153: </span>           <span style="color: #525252;">;; </span><span style="color: #525252;">if term is 1 order above top of list, adjoin</span>
<span class="linenr">154: </span>           <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>coeff term<span style="color: #c678dd;">)</span> term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">155: </span>          <span style="color: #525252;">;; </span><span style="color: #525252;">if term shares order with top of list, </span>
<span class="linenr">156: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>= top-order <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">157: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>coeff <span style="color: #a9a1e1;">(</span>dense-first-term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">158: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">replace if it's zero</span>
<span class="linenr">159: </span>               <span style="color: #c678dd;">(</span>cons <span style="color: #99bb66;">(</span>coeff term<span style="color: #99bb66;">)</span>
<span class="linenr">160: </span>                     <span style="color: #99bb66;">(</span>rest-terms term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">161: </span>               <span style="color: #525252;">;; </span><span style="color: #525252;">and add if it's not</span>
<span class="linenr">162: </span>               <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result <span style="color: #51afef;">(</span>add-sparse-term-to-sparse-term term
<span class="linenr">163: </span>                                                             <span style="color: #c678dd;">(</span>dense-first-term term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">164: </span>                 <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>coeff result<span style="color: #a9a1e1;">)</span>
<span class="linenr">165: </span>                       <span style="color: #a9a1e1;">(</span>rest-terms term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">166: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>&lt; top-order <span style="color: #c678dd;">(</span>order term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">167: </span>           <span style="color: #51afef;">(</span>adjoin-term-dense term <span style="color: #c678dd;">(</span>cons #f term-list<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">168: </span>          <span style="color: #525252;">;; </span><span style="color: #525252;">if term is more than 1 order above, adjoin 0 and recurse</span>
<span class="linenr">169: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>adjoin-term-dense <span style="color: #c678dd;">(</span>dense-first-term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">170: </span>                                   <span style="color: #c678dd;">(</span>adjoin-term-dense term
<span class="linenr">171: </span>                                                      <span style="color: #99bb66;">(</span>rest-terms term-list<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">172: </span>
<span class="linenr">173: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">adjoin-term</span> term term-list<span style="color: #c678dd;">)</span>
<span class="linenr">174: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>=zero? <span style="color: #a9a1e1;">(</span>coeff term<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">175: </span>      term-list
<span class="linenr">176: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>empty-termlist? term-list<span style="color: #51afef;">)</span>
<span class="linenr">177: </span>              <span style="color: #51afef;">(</span>sparse-termlist? term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">178: </span>          <span style="color: #a9a1e1;">(</span>adjoin-term-sparse term term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">179: </span>          <span style="color: #a9a1e1;">(</span>adjoin-term-dense term term-list<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">180: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">the-empty-termlist</span><span style="color: #c678dd;">)</span> '<span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span>
<span class="linenr">181: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">empty-termlist?</span> term-list<span style="color: #c678dd;">)</span>
<span class="linenr">182: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>null? term-list<span style="color: #99bb66;">)</span>
<span class="linenr">183: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eq? #f <span style="color: #51afef;">(</span>car term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">184: </span>           <span style="color: #a9a1e1;">(</span>empty-termlist? <span style="color: #51afef;">(</span>cdr term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">185: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">order</span> term<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>first term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">186: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">coeff</span> term<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>second term<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">187: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map-terms</span> f tl<span style="color: #c678dd;">)</span>
<span class="linenr">188: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">f is called (f order coeff)</span>
<span class="linenr">189: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">190: </span>             <span style="color: #a9a1e1;">(</span>term-list tl<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">191: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? term-list<span style="color: #a9a1e1;">)</span>
<span class="linenr">192: </span>        <span style="color: #a9a1e1;">(</span>reverse result<span style="color: #a9a1e1;">)</span>
<span class="linenr">193: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span>first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">194: </span>                      <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>order t<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">195: </span>                    result<span style="color: #51afef;">)</span>
<span class="linenr">196: </span>              <span style="color: #51afef;">(</span>rest-terms term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">197: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map2-terms</span> f tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr">198: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">iter</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">199: </span>             <span style="color: #a9a1e1;">(</span>term-list1 tl1<span style="color: #a9a1e1;">)</span>
<span class="linenr">200: </span>             <span style="color: #a9a1e1;">(</span>term-list2 tl2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">201: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>empty-termlist? term-list1<span style="color: #51afef;">)</span>
<span class="linenr">202: </span>            <span style="color: #51afef;">(</span>empty-termlist? term-list2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">203: </span>        <span style="color: #a9a1e1;">(</span>reverse result<span style="color: #a9a1e1;">)</span>
<span class="linenr">204: </span>        <span style="color: #a9a1e1;">(</span>iter <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">205: </span>                          <span style="color: #a9a1e1;">(</span>t2 <span style="color: #51afef;">(</span>first-term term-list<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">206: </span>                      <span style="color: #99bb66;">(</span>f <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t1<span style="color: #a9a1e1;">)</span>
<span class="linenr">207: </span>                         <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>coeff t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">208: </span>                    result<span style="color: #51afef;">)</span>
<span class="linenr">209: </span>              <span style="color: #51afef;">(</span>rest-terms term-list1<span style="color: #51afef;">)</span>
<span class="linenr">210: </span>              <span style="color: #51afef;">(</span>rest-terms term-list2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">211: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">212: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">213: </span>      <span style="color: #99bb66;">(</span>make-poly <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">214: </span>                 <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>terms p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>terms p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">215: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Polys not in same var: ADD-POLY"</span> <span style="color: #a9a1e1;">(</span>list p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">216: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">217: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>same-variable? <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>variable p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">218: </span>      <span style="color: #99bb66;">(</span>make-poly <span style="color: #a9a1e1;">(</span>variable p1<span style="color: #a9a1e1;">)</span>
<span class="linenr">219: </span>                 <span style="color: #a9a1e1;">(</span>mul-terms <span style="color: #51afef;">(</span>terms p1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>terms p2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">220: </span>      <span style="color: #99bb66;">(</span>error <span style="color: #99bb66;">"Polys not in same var: MUL-POLY"</span> <span style="color: #a9a1e1;">(</span>list p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">221: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr">222: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? L1<span style="color: #a9a1e1;">)</span> L2<span style="color: #99bb66;">)</span>
<span class="linenr">223: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>empty-termlist? L2<span style="color: #a9a1e1;">)</span> L1<span style="color: #99bb66;">)</span>
<span class="linenr">224: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">225: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1 <span style="color: #99bb66;">(</span>first-term L1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">226: </span>               <span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>first-term L2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">227: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>&gt; <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">228: </span>                  <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">229: </span>                   t1 <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">230: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>&lt; <span style="color: #a9a1e1;">(</span>order t1<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>order t2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">231: </span>                  <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">232: </span>                   t2 <span style="color: #a9a1e1;">(</span>add-terms L1 <span style="color: #51afef;">(</span>rest-terms L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">233: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">234: </span>                  <span style="color: #99bb66;">(</span>adjoin-term
<span class="linenr">235: </span>                   <span style="color: #a9a1e1;">(</span>make-sparse-term <span style="color: #51afef;">(</span>order t1<span style="color: #51afef;">)</span>
<span class="linenr">236: </span>                                     <span style="color: #51afef;">(</span>add <span style="color: #c678dd;">(</span>coeff t1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>coeff t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">237: </span>                   <span style="color: #a9a1e1;">(</span>add-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span>
<span class="linenr">238: </span>                              <span style="color: #51afef;">(</span>rest-terms L2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">239: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-terms</span> L1 L2<span style="color: #c678dd;">)</span>
<span class="linenr">240: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L1<span style="color: #99bb66;">)</span>
<span class="linenr">241: </span>      <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr">242: </span>      <span style="color: #99bb66;">(</span>add-terms <span style="color: #a9a1e1;">(</span>mul-term-by-all-terms <span style="color: #51afef;">(</span>first-term L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span>
<span class="linenr">243: </span>                 <span style="color: #a9a1e1;">(</span>mul-terms <span style="color: #51afef;">(</span>rest-terms L1<span style="color: #51afef;">)</span> L2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">244: </span>
<span class="linenr">245: </span><span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">246: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">tag</span> p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>attach-tag 'polynomial p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">247: </span><span style="color: #51afef;">(</span>put 'add '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">248: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>add-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">249: </span><span style="color: #51afef;">(</span>put 'mul '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">250: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>mul-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">251: </span><span style="color: #51afef;">(</span>put 'make 'polynomial
<span class="linenr">252: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>var terms<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>make-poly var terms<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">253: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">if-1st-poly-make-2nd-poly</span> t1 t2<span style="color: #c678dd;">)</span>
<span class="linenr">254: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? 'polynomial <span style="color: #51afef;">(</span>type-tag t1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">255: </span>           <span style="color: #a9a1e1;">(</span>not <span style="color: #51afef;">(</span>eqv? 'polynomial <span style="color: #c678dd;">(</span>type-tag t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">256: </span>      <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable <span style="color: #c678dd;">(</span>contents t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>list t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">257: </span>      t2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">258: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul-term-by-all-terms</span> t1 L<span style="color: #c678dd;">)</span>
<span class="linenr">259: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">260: </span>      <span style="color: #99bb66;">(</span>the-empty-termlist<span style="color: #99bb66;">)</span>
<span class="linenr">261: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>t2 <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">If one coeff is a poly, make the other a poly</span>
<span class="linenr">262: </span>             <span style="color: #51afef;">(</span>t1-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">263: </span>             <span style="color: #51afef;">(</span>t2-coeff <span style="color: #c678dd;">(</span>if-1st-poly-make-2nd-poly <span style="color: #99bb66;">(</span>coeff t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>coeff t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">264: </span>        
<span class="linenr">265: </span>        <span style="color: #a9a1e1;">(</span>adjoin-term
<span class="linenr">266: </span>         <span style="color: #51afef;">(</span>make-sparse-term <span style="color: #c678dd;">(</span>+ <span style="color: #99bb66;">(</span>order t1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>order t2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">267: </span>                           <span style="color: #c678dd;">(</span>mul t1-coeff t2-coeff<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">268: </span>         <span style="color: #51afef;">(</span>mul-term-by-all-terms t1 <span style="color: #c678dd;">(</span>rest-terms L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">269: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">terms-=zero?</span> L<span style="color: #c678dd;">)</span>
<span class="linenr">270: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #99bb66;">(</span>empty-termlist? L<span style="color: #99bb66;">)</span>
<span class="linenr">271: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>=zero? <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term L<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">272: </span>           <span style="color: #a9a1e1;">(</span>terms-=zero? <span style="color: #51afef;">(</span>rest-terms L<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">273: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">poly-=zero?</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">274: </span>  <span style="color: #c678dd;">(</span>terms-=zero? <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">275: </span><span style="color: #51afef;">(</span>put '=zero? '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span> poly-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">276: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg-terms</span> TL<span style="color: #c678dd;">)</span>
<span class="linenr">277: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>negterm <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>o c<span style="color: #c678dd;">)</span>
<span class="linenr">278: </span>                   <span style="color: #c678dd;">(</span>make-sparse-term o <span style="color: #99bb66;">(</span>neg c<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">279: </span>    <span style="color: #99bb66;">(</span>map-terms negterm TL<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">280: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-terms</span> T1 T2<span style="color: #c678dd;">)</span>
<span class="linenr">281: </span>  <span style="color: #c678dd;">(</span>add-terms T1 <span style="color: #99bb66;">(</span>neg-terms T2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">282: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">neg-poly</span> p<span style="color: #c678dd;">)</span>
<span class="linenr">283: </span>  <span style="color: #c678dd;">(</span>make-poly <span style="color: #99bb66;">(</span>variable p<span style="color: #99bb66;">)</span>
<span class="linenr">284: </span>             <span style="color: #99bb66;">(</span>neg-terms <span style="color: #a9a1e1;">(</span>terms p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">285: </span><span style="color: #51afef;">(</span>put 'neg '<span style="color: #c678dd;">(</span>polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">286: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>neg-poly p1<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">287: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub-poly</span> p1 p2<span style="color: #c678dd;">)</span>
<span class="linenr">288: </span>  <span style="color: #c678dd;">(</span>add-poly p1 <span style="color: #99bb66;">(</span>neg-poly p2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">289: </span><span style="color: #51afef;">(</span>put 'sub '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">290: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>p1 p2<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>sub-poly p1 p2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org8cea4b0"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">remainder-terms</span> tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>second <span style="color: #99bb66;">(</span>div-terms tl1 tl2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd-terms</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>empty-termlist? b<span style="color: #99bb66;">)</span>
<span class="linenr"> 5: </span>      a
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">(</span>gcd-terms b <span style="color: #a9a1e1;">(</span>remainder-terms a b<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd-poly</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span>
<span class="linenr">10: </span>                    <span style="color: #51afef;">(</span>gcd-terms <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? p<span style="color: #a9a1e1;">)</span>
<span class="linenr">12: </span>         <span style="color: #a9a1e1;">(</span>gcd-poly <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span>                   q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">14: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? q<span style="color: #a9a1e1;">)</span>
<span class="linenr">15: </span>         <span style="color: #a9a1e1;">(</span>gcd-poly p
<span class="linenr">16: </span>                   <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"different vars not supported : GCD-POLY"</span> p q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">18: </span><span style="color: #51afef;">(</span>put 'greatest-common-divisor '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">19: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>gcd-poly x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="orga8f74ae"><span class="linenr">1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-gcd</span><span style="color: #c678dd;">)</span> 'no<span style="color: #51afef;">)</span>
<span class="linenr">2: </span><span style="color: #51afef;">(</span>put 'greatest-common-divisor '<span style="color: #c678dd;">(</span>scheme-number scheme-number<span style="color: #c678dd;">)</span>
<span class="linenr">3: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'scheme-number <span style="color: #a9a1e1;">(</span>gcd x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">4: </span><span style="color: #51afef;">(</span>put 'greatest-common-divisor '<span style="color: #c678dd;">(</span>real real<span style="color: #c678dd;">)</span>
<span class="linenr">5: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'scheme-number <span style="color: #a9a1e1;">(</span>gcd x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">6: </span><span style="color: #525252;">;</span><span style="color: #525252;">'done)</span>
<span class="linenr">7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">greatest-common-divisor</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">(</span>apply-generic 'greatest-common-divisor a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-raiseto&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-rational-functions&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?-rf&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span><span style="color: #ECBE7B;">&lt;&lt;tower-coercions-rf&gt;&gt;</span>
<span class="linenr"> 17: </span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-densepadding-top&gt;&gt;</span>
<span class="linenr"> 19: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-projection&gt;&gt;</span>
<span class="linenr"> 20: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-division&gt;&gt;</span>
<span class="linenr"> 21: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-gcd&gt;&gt;</span>
<span class="linenr"> 22: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-rf-bottom&gt;&gt;</span>
<span class="linenr"> 23: </span>
<span class="linenr"> 24: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 25: </span><span style="color: #ECBE7B;">&lt;&lt;generic-gcd&gt;&gt;</span>
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 33: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 34: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 35: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 36: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 37: </span>
<span class="linenr"> 38: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 39: </span>
<span class="linenr"> 40: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 41: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 42: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 43: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 44: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 45: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 46: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 47: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 48: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 49: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 50: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 51: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 52: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 53: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 54: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 55: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 56: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 57: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 58: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 59: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 60: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 61: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 62: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 63: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 64: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 65: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 66: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 67: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 68: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 69: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 70: </span>                                      <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 72: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 73: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 74: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 77: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 78: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p3</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 79: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p4</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p5</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 81: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p7</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 82: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p6</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 83: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p66</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 84: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p77</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p8</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p9</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 87: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p98</span> <span style="color: #c678dd;">(</span>make-rational p9 p8<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 88: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 89: </span>             <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 90: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 91: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 92: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 93: </span>             <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 94: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 95: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 96: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr"> 97: </span>             <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr"> 98: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 99: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">100: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr">101: </span>             <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr">102: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">103: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">104: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p10</span> <span style="color: #c678dd;">(</span>make-polynomial
<span class="linenr">105: </span>            'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">106: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p11</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">107: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr">108: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span>
<span class="linenr">109: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr">110: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">111: </span>             <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">112: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr">113: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">114: </span>             <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">115: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">116: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">117: </span>             <span style="color: #c678dd;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">118: </span>
<span class="linenr">119: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">120: </span>             <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">121: </span>             <span style="color: #c678dd;">(</span>make-polynomial 'x p4<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">122: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">123: </span>             <span style="color: #c678dd;">(</span>sub <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr">124: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p3<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">125: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">126: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 1"</span>
<span class="linenr">127: </span>             <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span>
<span class="linenr">128: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">129: </span>             '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">130: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 2"</span>
<span class="linenr">131: </span>             <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span>
<span class="linenr">132: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">133: </span>             '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">134: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 3"</span>
<span class="linenr">135: </span>             <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p66<span style="color: #99bb66;">)</span>
<span class="linenr">136: </span>                  <span style="color: #99bb66;">(</span>make-polynomial 'x p77<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">137: </span>             '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">138: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational functions"</span>
<span class="linenr">139: </span>             <span style="color: #c678dd;">(</span>add p98 p98<span style="color: #c678dd;">)</span>
<span class="linenr">140: </span>             '<span style="color: #c678dd;">(</span>rational <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">141: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"GCD for integers"</span>
<span class="linenr">142: </span>             <span style="color: #c678dd;">(</span>greatest-common-divisor <span style="color: #dd8844; font-weight: bold;">72</span> <span style="color: #dd8844; font-weight: bold;">30</span><span style="color: #c678dd;">)</span>
<span class="linenr">143: </span>             <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
<span class="linenr">144: </span>  <span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"GCD for polys"</span>
<span class="linenr">145: </span>             <span style="color: #c678dd;">(</span>greatest-common-divisor p10 p11<span style="color: #c678dd;">)</span>
<span class="linenr">146: </span>             '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span> #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgeda2248">
&lt;...&gt;
SUCCEED at polynomial subtraction
SUCCEED at polynomial division 1
SUCCEED at polynomial division 2
SUCCEED at polynomial division 3
SUCCEED at rational functions
SUCCEED at GCD for integers
SUCCEED at GCD for polys
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a7b64a" class="outline-3">
<h3 id="org2a7b64a"><span class="section-number-3">3.108.</span> Exercise 2.95: a quirk in rational functions</h3>
<div class="outline-text-3" id="text-3-108">
</div>

<div id="outline-container-org44d444f" class="outline-4">
<h4 id="org44d444f"><span class="section-number-4">3.108.1.</span> Question</h4>
<div class="outline-text-4" id="text-3-108-1">
<p>
Define \(P_1\), \(P_2\), and
\(P_3\) to be the polynomials
</p>

<p>
\[
</p>
\begin{array}{l@{{}:}l}
	P_1 	& \quad x^2 - 2x + 1, \\
	P_2 	& \quad 11x^2 + 7, \\
	P_3 	& \quad 13x + 5.
\end{array}
<p>
\]
</p>

<p>
Now define \(Q_1\) to be the product of \(P_1\) and \(P_2\) and \(Q_2\) to be
the product of \(P_1\) and \(P_3\), and use <code class="src src-scheme">greatest-common-divisor</code>
(@ref{Exercise 2.94}) to compute the GCD of \(Q_1\)
and \(Q_2\).
</p>

<p>
Note that the answer is not the same as \(P_1\). This example introduces
noninteger operations into the computation, causing difficulties with the GCD
algorithm. <sup><a id="fnr.13" class="footref" href="#fn.13" role="doc-backlink">13</a></sup> To
understand what is happening, try tracing <code class="src src-scheme">gcd-terms</code> while computing
the GCD or try performing the division by hand.
</p>
</div>
</div>

<div id="outline-container-org19304b2" class="outline-4">
<h4 id="org19304b2"><span class="section-number-4">3.108.2.</span> Answer</h4>
<div class="outline-text-4" id="text-3-108-2">
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr"> 2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr"> 5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr"> 6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr"> 7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr"> 8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr"> 9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr">10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-raiseto&gt;&gt;</span>
<span class="linenr">11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-rational-functions&gt;&gt;</span>
<span class="linenr">12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?-rf&gt;&gt;</span>
<span class="linenr">14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #ECBE7B;">&lt;&lt;tower-coercions-rf&gt;&gt;</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-densepadding-top&gt;&gt;</span>
<span class="linenr">19: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-projection&gt;&gt;</span>
<span class="linenr">20: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-division&gt;&gt;</span>
<span class="linenr">21: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-gcd&gt;&gt;</span>
<span class="linenr">22: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-rf-bottom&gt;&gt;</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr">25: </span><span style="color: #ECBE7B;">&lt;&lt;generic-gcd&gt;&gt;</span>
<span class="linenr">26: </span>
<span class="linenr">27: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr">28: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr">29: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr">30: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr">31: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr">32: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr">33: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr">34: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr">35: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr">36: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr">37: </span>
<span class="linenr">38: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">39: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #a9a1e1;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">40: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p3</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">13</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">41: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">q1</span> <span style="color: #c678dd;">(</span>mul p1 p2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">42: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">q2</span> <span style="color: #c678dd;">(</span>mul p1 p3<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">43: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"P1: "</span> p1<span style="color: #51afef;">)</span>
<span class="linenr">44: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"P2: "</span> p2<span style="color: #51afef;">)</span>
<span class="linenr">45: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"P3: "</span> p3<span style="color: #51afef;">)</span>
<span class="linenr">46: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"Q1: "</span> q1<span style="color: #51afef;">)</span>
<span class="linenr">47: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"Q2: "</span> q2<span style="color: #51afef;">)</span>
<span class="linenr">48: </span><span style="color: #51afef;">(</span>echo <span style="color: #99bb66;">"GCD(Q1, Q2): "</span> <span style="color: #c678dd;">(</span>greatest-common-divisor q1 q2<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org422440d">
P1:  (polynomial x 1 2 1) 
P2:  (polynomial x 11 #f 7) 
P3:  (polynomial x 13 5) 
Q1:  (polynomial x 11 22 18 14 7) 
Q2:  (polynomial x 13 31 23 5) 
GCD(Q1, Q2):  (polynomial x 1458/169 2916/169 1458/169) 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef2d5f5" class="outline-3">
<h3 id="orgef2d5f5"><span class="section-number-3">3.109.</span> Exercise 2.96: pseudodivision of polynomials</h3>
<div class="outline-text-3" id="text-3-109">
</div>
<div id="outline-container-orgf848407" class="outline-4">
<h4 id="orgf848407"><span class="section-number-4">3.109.1.</span> Text formulas</h4>
<div class="outline-text-4" id="text-3-109-1">
<p>
More precisely, if \(P\) and \(Q\) are polynomials, let \(O_1\) be the order of
\(P\) (i.e., the order of the largest term of \(P\)) and let \(O_2\) be the
order of \(Q\). Let \(c\) be the leading coefficient of \(Q\). Then it can be
shown that, if we multiply \(P\) by the <b>integerizing factor</b> \(c^{1 + O_1 -
O_2}\), the resulting polynomial can be divided by \(Q\) by using the
<code class="src src-scheme">div-terms</code> algorithm without introducing any fractions. The operation
of multiplying the dividend by this constant and then dividing is sometimes
called the <b>pseudodivision</b> of \(P\) by \(Q\). The remainder of the division is
called the <b>pseudoremainder</b>.
</p>
</div>
</div>

<div id="outline-container-orgbfb6312" class="outline-4">
<h4 id="orgbfb6312"><span class="section-number-4">3.109.2.</span> Questions 1 and 2</h4>
<div class="outline-text-4" id="text-3-109-2">
<ol class="org-ol">
<li>Implement the procedure <code class="src src-scheme">pseudoremainder-terms</code>, which is just like
<code class="src src-scheme">remainder-terms</code> except that it multiplies the dividend by the
integerizing factor described above before calling <code class="src src-scheme">div-terms</code>.
Modify <code class="src src-scheme">gcd-terms</code> to use <code class="src src-scheme">pseudoremainder-terms</code>, and
verify that <code class="src src-scheme">greatest-common-divisor</code> now produces an answer with
integer coefficients on the example in <a href="#org2a7b64a">Exercise 2.95</a>.</li>

<li>The GCD now has integer coefficients, but they are larger than those of
\(P_1\). Modify <code class="src src-scheme">gcd-terms</code> so that it removes common factors from
the coefficients of the answer by dividing all the coefficients by their
(integer) greatest common divisor.</li>
</ol>
</div>
</div>

<div id="outline-container-orgb5e0c2d" class="outline-4">
<h4 id="orgb5e0c2d"><span class="section-number-4">3.109.3.</span> Answers 1 and 2</h4>
<div class="outline-text-4" id="text-3-109-3">
<div class="org-src-container">
<pre class="src src-scheme" id="org6e3e352"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">remainder-terms</span> tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>second <span style="color: #99bb66;">(</span>div-terms tl1 tl2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find-integerizing-factor</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>o1 <span style="color: #51afef;">(</span>termlist-order p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>        <span style="color: #a9a1e1;">(</span>o2 <span style="color: #51afef;">(</span>termlist-order q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 6: </span>        <span style="color: #a9a1e1;">(</span>c <span style="color: #51afef;">(</span>coeff <span style="color: #c678dd;">(</span>first-term q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #99bb66;">(</span>expt c <span style="color: #a9a1e1;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #51afef;">(</span>- o1 o2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pseudoremainder-terms</span> tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr"> 9: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>intize <span style="color: #51afef;">(</span>find-integerizing-factor tl1 tl2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">10: </span>         <span style="color: #a9a1e1;">(</span>tl1-prime <span style="color: #51afef;">(</span>mul-terms tl1
<span class="linenr">11: </span>                               <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>make-sparse-term <span style="color: #dd8844; font-weight: bold;">0</span> intize<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">12: </span>    <span style="color: #99bb66;">(</span>second <span style="color: #a9a1e1;">(</span>div-terms tl1-prime tl2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd-terms</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>empty-termlist? b<span style="color: #c678dd;">)</span>
<span class="linenr">15: </span>                    a
<span class="linenr">16: </span>                    <span style="color: #c678dd;">(</span>gcd-terms b <span style="color: #99bb66;">(</span>pseudoremainder-terms a b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">17: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? result<span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>        <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span>
<span class="linenr">19: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>list-gcd <span style="color: #99bb66;">(</span>reduce gcd <span style="color: #99bb66;">"ERROR"</span>
<span class="linenr">20: </span>                                <span style="color: #a9a1e1;">(</span>map-terms <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>o c<span style="color: #c678dd;">)</span> c<span style="color: #51afef;">)</span> result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span>          <span style="color: #51afef;">(</span>map-terms <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>o c<span style="color: #99bb66;">)</span>
<span class="linenr">22: </span>                       <span style="color: #99bb66;">(</span>make-sparse-term o
<span class="linenr">23: </span>                                         <span style="color: #a9a1e1;">(</span>div c list-gcd<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">24: </span>                     result<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">25: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd-poly</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">27: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span>
<span class="linenr">28: </span>                    <span style="color: #51afef;">(</span>gcd-terms <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">29: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? p<span style="color: #a9a1e1;">)</span>
<span class="linenr">30: </span>         <span style="color: #a9a1e1;">(</span>gcd-poly <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">31: </span>                   q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">32: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? q<span style="color: #a9a1e1;">)</span>
<span class="linenr">33: </span>         <span style="color: #a9a1e1;">(</span>gcd-poly p
<span class="linenr">34: </span>                   <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"different vars not supported : GCD-POLY"</span> p q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">36: </span><span style="color: #51afef;">(</span>put 'greatest-common-divisor '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">37: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>gcd-poly x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-raiseto&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-rational-functions&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?-rf&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span><span style="color: #ECBE7B;">&lt;&lt;tower-coercions-rf&gt;&gt;</span>
<span class="linenr"> 17: </span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-densepadding-top&gt;&gt;</span>
<span class="linenr"> 19: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-projection&gt;&gt;</span>
<span class="linenr"> 20: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-division&gt;&gt;</span>
<span class="linenr"> 21: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-gcd-pseudo&gt;&gt;</span>
<span class="linenr"> 22: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-rf-bottom&gt;&gt;</span>
<span class="linenr"> 23: </span>
<span class="linenr"> 24: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 25: </span><span style="color: #ECBE7B;">&lt;&lt;generic-gcd&gt;&gt;</span>
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 33: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 34: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 35: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 36: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 37: </span>
<span class="linenr"> 38: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 39: </span>
<span class="linenr"> 40: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 41: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 42: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 43: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 44: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 45: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 46: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 47: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 48: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 49: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 50: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 51: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 52: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 53: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 54: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 55: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 56: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 57: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 58: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 59: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 60: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 61: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 62: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 63: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 64: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 65: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 66: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 67: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 68: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 69: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 70: </span>                                      <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 72: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 73: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 74: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 77: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 78: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p3</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 79: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p4</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p5</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 81: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p7</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 82: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p6</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 83: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p66</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 84: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p77</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p8</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p9</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 87: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p98</span> <span style="color: #c678dd;">(</span>make-rational p9 p8<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 88: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 89: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 90: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 91: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 92: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 93: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 94: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 95: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 96: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr"> 97: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr"> 98: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 99: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">100: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr">101: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr">102: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">103: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">104: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p10</span> <span style="color: #c678dd;">(</span>make-polynomial
<span class="linenr">105: </span>             'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">106: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p11</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">107: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr">108: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span>
<span class="linenr">109: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr">110: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">111: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">112: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr">113: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">114: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">115: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">116: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">117: </span>           <span style="color: #c678dd;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">118: </span>
<span class="linenr">119: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">120: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">121: </span>           <span style="color: #c678dd;">(</span>make-polynomial 'x p4<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">122: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">123: </span>           <span style="color: #c678dd;">(</span>sub <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr">124: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p3<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">125: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">126: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 1"</span>
<span class="linenr">127: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span>
<span class="linenr">128: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">129: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">130: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 2"</span>
<span class="linenr">131: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span>
<span class="linenr">132: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">133: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">134: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 3"</span>
<span class="linenr">135: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p66<span style="color: #99bb66;">)</span>
<span class="linenr">136: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p77<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">137: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">138: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational functions"</span>
<span class="linenr">139: </span>           <span style="color: #c678dd;">(</span>add p98 p98<span style="color: #c678dd;">)</span>
<span class="linenr">140: </span>           '<span style="color: #c678dd;">(</span>rational <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">141: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"GCD for integers"</span>
<span class="linenr">142: </span>           <span style="color: #c678dd;">(</span>greatest-common-divisor <span style="color: #dd8844; font-weight: bold;">72</span> <span style="color: #dd8844; font-weight: bold;">30</span><span style="color: #c678dd;">)</span>
<span class="linenr">143: </span>           <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
<span class="linenr">144: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"GCD for polys"</span>
<span class="linenr">145: </span>           <span style="color: #c678dd;">(</span>greatest-common-divisor p10 p11<span style="color: #c678dd;">)</span>
<span class="linenr">146: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span> #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">147: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1p <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">148: </span>       <span style="color: #99bb66;">(</span>p2p <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #c678dd;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">149: </span>       <span style="color: #99bb66;">(</span>p3p <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">13</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">150: </span>       <span style="color: #99bb66;">(</span>q1p <span style="color: #a9a1e1;">(</span>mul p1p p2p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">151: </span>       <span style="color: #99bb66;">(</span>q2p <span style="color: #a9a1e1;">(</span>mul p1p p3p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">152: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"greatest-common-divisor integerizing for polynomials"</span>
<span class="linenr">153: </span>             <span style="color: #99bb66;">(</span>greatest-common-divisor q1p q2p<span style="color: #99bb66;">)</span>
<span class="linenr">154: </span>             p1p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgc8a1aa3">
&lt;...&gt;
SUCCEED at greatest-common-divisor integerizing for polynomials
</pre>
</div>
</div>
</div>

<div id="outline-container-org661381b" class="outline-3">
<h3 id="org661381b"><span class="section-number-3">3.110.</span> Exercise 2.97: reducing terms of rational functions</h3>
<div class="outline-text-3" id="text-3-110">
</div>
<div id="outline-container-orga9ff61a" class="outline-4">
<h4 id="orga9ff61a"><span class="section-number-4">3.110.1.</span> Questions 1 and 2</h4>
<div class="outline-text-4" id="text-3-110-1">
<ol class="org-ol">
<li>Implement this algorithm as a procedure <code class="src src-scheme">reduce-terms</code> that takes
two term lists <code class="src src-scheme">n</code> and <code class="src src-scheme">d</code> as arguments and returns a
list <code class="src src-scheme">nn</code>, <code class="src src-scheme">dd</code>, which are <code class="src src-scheme">n</code> and
<code class="src src-scheme">d</code> reduced to lowest terms via the algorithm given above. Also
write a procedure <code class="src src-scheme">reduce-poly</code>, analogous to <code class="src src-scheme">add-poly</code>,
that checks to see if the two polys have the same variable. If so,
<code class="src src-scheme">reduce-poly</code> strips off the variable and passes the problem to
<code class="src src-scheme">reduce-terms</code>, then reattaches the variable to the two term lists
supplied by <code class="src src-scheme">reduce-terms</code>.</li>

<li><p>
Define a procedure analogous to <code class="src src-scheme">reduce-terms</code> that does what the
original <code class="src src-scheme">make-rat</code> did for integers:
</p>

<div class="org-src-container">
<pre class="src src-scheme">   <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reduce-integers</span> n d<span style="color: #c678dd;">)</span>
     <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>g <span style="color: #51afef;">(</span>gcd n d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
       <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>/ n g<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>/ d g<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
and define <code class="src src-scheme">reduce</code> as a generic operation that calls
<code class="src src-scheme">apply-generic</code> to dispatch to either <code class="src src-scheme">reduce-poly</code> (for
<code class="src src-scheme">polynomial</code> arguments) or <code class="src src-scheme">reduce-integers</code> (for
<code class="src src-scheme">scheme-number</code> arguments). You can now easily make the
rational-arithmetic package reduce fractions to lowest terms by having
<code class="src src-scheme">make-rat</code> call <code class="src src-scheme">reduce</code> before combining the given
numerator and denominator to form a rational number. The system now handles
rational expressions in either integers or polynomials. To test your program,
try the example at the beginning of this extended exercise:
</p></li>
</ol>
</div>
</div>

<div id="outline-container-org2c2897b" class="outline-4">
<h4 id="org2c2897b"><span class="section-number-4">3.110.2.</span> Answers 1 and 2</h4>
<div class="outline-text-4" id="text-3-110-2">
<div class="org-src-container">
<pre class="src src-scheme" id="org9d6967c"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">remainder-terms</span> tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>second <span style="color: #99bb66;">(</span>div-terms tl1 tl2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">find-integerizing-factor</span> o1 o2 c<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span>expt c <span style="color: #99bb66;">(</span>+ <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span>- o1 o2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pseudoremainder-terms</span> tl1 tl2<span style="color: #c678dd;">)</span>
<span class="linenr"> 6: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>intize <span style="color: #51afef;">(</span>find-integerizing-factor <span style="color: #c678dd;">(</span>termlist-order tl1<span style="color: #c678dd;">)</span>
<span class="linenr"> 7: </span>                                           <span style="color: #c678dd;">(</span>termlist-order tl2<span style="color: #c678dd;">)</span>
<span class="linenr"> 8: </span>                                           <span style="color: #c678dd;">(</span>coeff <span style="color: #99bb66;">(</span>first-term tl2<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 9: </span>         <span style="color: #a9a1e1;">(</span>tl1-prime <span style="color: #51afef;">(</span>mul-terms tl1
<span class="linenr">10: </span>                               <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>make-sparse-term <span style="color: #dd8844; font-weight: bold;">0</span> intize<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">11: </span>    <span style="color: #99bb66;">(</span>second <span style="color: #a9a1e1;">(</span>div-terms tl1-prime tl2<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd-of-coeffs-in-terms</span> tl<span style="color: #c678dd;">)</span>
<span class="linenr">14: </span>  <span style="color: #c678dd;">(</span>reduce gcd 'ERROR
<span class="linenr">15: </span>          <span style="color: #99bb66;">(</span>map-terms <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>o c<span style="color: #51afef;">)</span> c<span style="color: #a9a1e1;">)</span> tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">map-coeffs</span> f tl<span style="color: #c678dd;">)</span>
<span class="linenr">17: </span>  <span style="color: #c678dd;">(</span>map-terms <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>o c<span style="color: #a9a1e1;">)</span>
<span class="linenr">18: </span>               <span style="color: #a9a1e1;">(</span>make-sparse-term o
<span class="linenr">19: </span>                                 <span style="color: #51afef;">(</span>f c<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">20: </span>             tl<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">21: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div-coeffs-by-gcd</span> tl<span style="color: #c678dd;">)</span>
<span class="linenr">22: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>g <span style="color: #51afef;">(</span>gcd-of-coeffs-in-terms tl<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">23: </span>    <span style="color: #99bb66;">(</span>map-coeffs <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>c<span style="color: #51afef;">)(</span>div c g<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> tl<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">24: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd-terms</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr">25: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>result <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>empty-termlist? b<span style="color: #c678dd;">)</span>
<span class="linenr">26: </span>                    a
<span class="linenr">27: </span>                    <span style="color: #c678dd;">(</span>gcd-terms b <span style="color: #99bb66;">(</span>pseudoremainder-terms a b<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">28: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>empty-termlist? result<span style="color: #a9a1e1;">)</span>
<span class="linenr">29: </span>        <span style="color: #a9a1e1;">(</span>the-empty-termlist<span style="color: #a9a1e1;">)</span>
<span class="linenr">30: </span>        <span style="color: #a9a1e1;">(</span>div-coeffs-by-gcd result<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">31: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">gcd-poly</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr">32: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>same-variable? <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>variable q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">33: </span>         <span style="color: #a9a1e1;">(</span>make-poly <span style="color: #51afef;">(</span>variable p<span style="color: #51afef;">)</span>
<span class="linenr">34: </span>                    <span style="color: #51afef;">(</span>gcd-terms <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">35: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? p<span style="color: #a9a1e1;">)</span>
<span class="linenr">36: </span>         <span style="color: #a9a1e1;">(</span>gcd-poly <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable q<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">37: </span>                   q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">38: </span>        <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>trivial-poly? q<span style="color: #a9a1e1;">)</span>
<span class="linenr">39: </span>         <span style="color: #a9a1e1;">(</span>gcd-poly p
<span class="linenr">40: </span>                   <span style="color: #51afef;">(</span>make-poly <span style="color: #c678dd;">(</span>variable p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>terms q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">41: </span>        <span style="color: #99bb66;">(</span><span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"different vars not supported : GCD-POLY"</span> p q<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">42: </span><span style="color: #51afef;">(</span>put 'greatest-common-divisor '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">43: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #99bb66;">(</span>x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>tag <span style="color: #a9a1e1;">(</span>gcd-poly x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">44: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reduce-terms</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr">45: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>nd-gcd <span style="color: #51afef;">(</span>gcd-terms n d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">46: </span>         <span style="color: #a9a1e1;">(</span>intize <span style="color: #51afef;">(</span>find-integerizing-factor <span style="color: #c678dd;">(</span>termlist-order nd-gcd<span style="color: #c678dd;">)</span>
<span class="linenr">47: </span>                                           <span style="color: #c678dd;">(</span>max <span style="color: #99bb66;">(</span>termlist-order n<span style="color: #99bb66;">)</span>
<span class="linenr">48: </span>                                                <span style="color: #99bb66;">(</span>termlist-order d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">49: </span>                                           <span style="color: #c678dd;">(</span>coeff <span style="color: #99bb66;">(</span>first-term nd-gcd<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">50: </span>         <span style="color: #a9a1e1;">(</span>nn <span style="color: #51afef;">(</span>div-terms <span style="color: #c678dd;">(</span>mul-terms
<span class="linenr">51: </span>                         n <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>make-sparse-term
<span class="linenr">52: </span>                                  <span style="color: #dd8844; font-weight: bold;">0</span> intize<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">53: </span>                        nd-gcd<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">54: </span>         <span style="color: #a9a1e1;">(</span>dd <span style="color: #51afef;">(</span>div-terms <span style="color: #c678dd;">(</span>mul-terms
<span class="linenr">55: </span>                         d <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>make-sparse-term
<span class="linenr">56: </span>                                  <span style="color: #dd8844; font-weight: bold;">0</span> intize<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">57: </span>                        nd-gcd<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">58: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span>empty-termlist? <span style="color: #99bb66;">(</span>second nn<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">59: </span>            <span style="color: #51afef;">(</span>not <span style="color: #c678dd;">(</span>empty-termlist? <span style="color: #99bb66;">(</span>second dd<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">60: </span>        <span style="color: #a9a1e1;">(</span>error <span style="color: #99bb66;">"unexpected remainder from term reduction : REDUCE-TERMS"</span> n d<span style="color: #a9a1e1;">)</span>
<span class="linenr">61: </span>        <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>div-coeffs-by-gcd <span style="color: #c678dd;">(</span>first nn<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">62: </span>              <span style="color: #51afef;">(</span>div-coeffs-by-gcd <span style="color: #c678dd;">(</span>first dd<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">63: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reduce-poly</span> p q<span style="color: #c678dd;">)</span>
<span class="linenr">64: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>mp <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #c678dd;">(</span>target-poly reduced<span style="color: #c678dd;">)</span>
<span class="linenr">65: </span>              <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>v <span style="color: #51afef;">(</span>variable target-poly<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">66: </span>                <span style="color: #99bb66;">(</span>list <span style="color: #a9a1e1;">(</span>make-poly v <span style="color: #51afef;">(</span>first reduced<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">67: </span>                      <span style="color: #a9a1e1;">(</span>make-poly v <span style="color: #51afef;">(</span>second reduced<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">68: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>same-variable? <span style="color: #c678dd;">(</span>variable p<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>variable q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">69: </span>           <span style="color: #51afef;">(</span>mp p <span style="color: #c678dd;">(</span>reduce-terms <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>terms q<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">70: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>trivial-poly? p<span style="color: #51afef;">)</span>
<span class="linenr">71: </span>           <span style="color: #51afef;">(</span>mp q <span style="color: #c678dd;">(</span>reduce-terms <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>terms q<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">72: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>trivial-poly? q<span style="color: #51afef;">)</span>
<span class="linenr">73: </span>           <span style="color: #51afef;">(</span>mp p <span style="color: #c678dd;">(</span>reduce-terms <span style="color: #99bb66;">(</span>terms p<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>terms q<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">74: </span>          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">else</span> <span style="color: #51afef;">(</span>error <span style="color: #99bb66;">"different vars not supported : GCD-POLY"</span> p q<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">75: </span><span style="color: #51afef;">(</span>put 'reduce '<span style="color: #c678dd;">(</span>polynomial polynomial<span style="color: #c678dd;">)</span>
<span class="linenr">76: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>p q<span style="color: #99bb66;">)</span>
<span class="linenr">77: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>result <span style="color: #c678dd;">(</span>reduce-poly p q<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">78: </span>         <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>tag <span style="color: #c678dd;">(</span>first result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">79: </span>               <span style="color: #51afef;">(</span>tag <span style="color: #c678dd;">(</span>second result<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme" id="org4852aeb"><span class="linenr"> 1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">generic-reduce</span> a b<span style="color: #c678dd;">)</span>
<span class="linenr"> 2: </span>  <span style="color: #c678dd;">(</span>apply-generic 'reduce a b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">reduce-integers</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>integer? n<span style="color: #a9a1e1;">)</span>
<span class="linenr"> 5: </span>           <span style="color: #a9a1e1;">(</span>integer? d<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 6: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>g <span style="color: #c678dd;">(</span>gcd n d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 7: </span>        <span style="color: #a9a1e1;">(</span>list <span style="color: #51afef;">(</span>/ n g<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>/ d g<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 8: </span>      <span style="color: #99bb66;">(</span>list n d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 9: </span><span style="color: #51afef;">(</span>put 'reduce '<span style="color: #c678dd;">(</span>scheme-number scheme-number<span style="color: #c678dd;">)</span>
<span class="linenr">10: </span>     reduce-integers<span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme" id="org7e952f3"><span class="linenr">  1: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'add x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sub</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'sub x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  3: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">mul</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'mul x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  4: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">div</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'div x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  5: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  6: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  7: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'magnitude z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  8: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'angle z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">  9: </span><span style="color: #525252;">;; </span><span style="color: #525252;">Now we begin to change code for support</span>
<span class="linenr"> 10: </span><span style="color: #525252;">;; </span><span style="color: #525252;">These will be named slightly different so the primitive</span>
<span class="linenr"> 11: </span><span style="color: #525252;">;; </span><span style="color: #525252;">functions aren't shadowed</span>
<span class="linenr"> 12: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>mul x <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 13: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">sine</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'sine x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #525252;">;; </span><span style="color: #525252;">(sin)</span>
<span class="linenr"> 14: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">cosine</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'cosine x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">; </span><span style="color: #525252;">(cos)</span>
<span class="linenr"> 15: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">square-root</span> x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'square-root x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">(sqrt)</span>
<span class="linenr"> 16: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">arctan</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'arctan x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #525252;">;</span><span style="color: #525252;">(atan)</span>
<span class="linenr"> 17: </span>
<span class="linenr"> 18: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-scheme-number</span> n<span style="color: #c678dd;">)</span>
<span class="linenr"> 19: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'scheme-number<span style="color: #99bb66;">)</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 20: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-scheme-number-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 21: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'scheme-number x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 22: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 23: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>+ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 24: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 25: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>- x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 26: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 27: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>* x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 28: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 29: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>/ x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 30: </span>  <span style="color: #c678dd;">(</span>put 'sine '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 31: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sin x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 32: </span>  <span style="color: #c678dd;">(</span>put 'cosine '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 33: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>cos x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 34: </span>  <span style="color: #c678dd;">(</span>put 'square-root '<span style="color: #99bb66;">(</span>scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 35: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sqrt x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 36: </span>  <span style="color: #c678dd;">(</span>put 'arctan '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr"> 37: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>atan x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 38: </span>  <span style="color: #c678dd;">(</span>put 'make 'scheme-number <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 39: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 40: </span>
<span class="linenr"> 41: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rational-package</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 42: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr"> 43: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">numer</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>first x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 44: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">denom</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>second x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 45: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-rat</span> n d<span style="color: #99bb66;">)</span>
<span class="linenr"> 46: </span>    <span style="color: #99bb66;">(</span>generic-reduce n d<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 47: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 48: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 49: </span>                   <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 50: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 51: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 52: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 53: </span>                   <span style="color: #51afef;">(</span>mul <span style="color: #c678dd;">(</span>numer y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 54: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 55: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 56: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 57: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 58: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-rat</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr"> 59: </span>    <span style="color: #99bb66;">(</span>make-rat <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>numer x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>denom y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr"> 60: </span>              <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>denom x<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>numer y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 61: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr"> 62: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rational x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 63: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 64: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 65: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 66: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 67: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 68: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 69: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 70: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-rat x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 71: </span>  <span style="color: #c678dd;">(</span>put 'make 'rational
<span class="linenr"> 72: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>n d<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-rat n d<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 73: </span>  <span style="color: #c678dd;">(</span>put 'numer '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> numer<span style="color: #c678dd;">)</span>
<span class="linenr"> 74: </span>  <span style="color: #c678dd;">(</span>put 'denom '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span> denom<span style="color: #c678dd;">)</span>
<span class="linenr"> 75: </span>  <span style="color: #c678dd;">(</span>put 'sine '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 76: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'sine '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 77: </span>                   <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 78: </span>  <span style="color: #c678dd;">(</span>put 'cosine '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 79: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'cosine '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span>                   <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 81: </span>  <span style="color: #c678dd;">(</span>put 'square-root '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 82: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'square-root '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 83: </span>                   <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 84: </span>  <span style="color: #c678dd;">(</span>put 'arctan '<span style="color: #99bb66;">(</span>rational<span style="color: #99bb66;">)</span>
<span class="linenr"> 85: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>r s<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>get 'arctan '<span style="color: #c678dd;">(</span>scheme-number<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span>                     <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer r<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>div <span style="color: #c678dd;">(</span>numer s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>denom s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 87: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr"> 88: </span>
<span class="linenr"> 89: </span><span style="color: #525252;">;; </span><span style="color: #525252;">for future use</span>
<span class="linenr"> 90: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">numer</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 91: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 92: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 93: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">denom</span> r<span style="color: #c678dd;">)</span>
<span class="linenr"> 94: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 95: </span>   <span style="color: #99bb66;">(</span>contents r<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 96: </span>
<span class="linenr"> 97: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-rational</span> n d<span style="color: #c678dd;">)</span>
<span class="linenr"> 98: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make 'rational<span style="color: #99bb66;">)</span> n d<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 99: </span>
<span class="linenr">100: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-rectangular-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">101: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">102: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">103: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">104: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">105: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span>
<span class="linenr">106: </span>    <span style="color: #99bb66;">(</span>square-root <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>real-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">107: </span>                      <span style="color: #51afef;">(</span>square <span style="color: #c678dd;">(</span>imag-part z<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">108: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span>
<span class="linenr">109: </span>    <span style="color: #99bb66;">(</span>arctan <span style="color: #a9a1e1;">(</span>imag-part z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>real-part z<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">110: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr">111: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>mul r <span style="color: #51afef;">(</span>cosine a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>mul r <span style="color: #51afef;">(</span>sine a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">112: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr">113: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'rectangular x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">114: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">115: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">116: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">117: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>rectangular<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">118: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'rectangular
<span class="linenr">119: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">120: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'rectangular
<span class="linenr">121: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">122: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">123: </span>
<span class="linenr">124: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-polar-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">125: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">internal procedures</span>
<span class="linenr">126: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">magnitude</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>car z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">127: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">angle</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cdr z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">128: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>cons r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">129: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">real-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>cosine <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">130: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">imag-part</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>mul <span style="color: #a9a1e1;">(</span>magnitude z<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>sine <span style="color: #51afef;">(</span>angle z<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">131: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr">132: </span>    <span style="color: #99bb66;">(</span>cons <span style="color: #a9a1e1;">(</span>sqrt <span style="color: #51afef;">(</span>+ <span style="color: #c678dd;">(</span>square x<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>square y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">133: </span>          <span style="color: #a9a1e1;">(</span>atan y x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">134: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to the rest of the system</span>
<span class="linenr">135: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'polar x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">136: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">137: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">138: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">139: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>polar<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span>
<span class="linenr">140: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'polar
<span class="linenr">141: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">142: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'polar
<span class="linenr">143: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">144: </span>  'done<span style="color: #51afef;">)</span>
<span class="linenr">145: </span>
<span class="linenr">146: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-complex-package</span><span style="color: #c678dd;">)</span>
<span class="linenr">147: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-real-imag</span> x y<span style="color: #99bb66;">)</span>
<span class="linenr">148: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-real-imag 'rectangular<span style="color: #a9a1e1;">)</span> x y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">149: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">make-from-mag-ang</span> r a<span style="color: #99bb66;">)</span>
<span class="linenr">150: </span>    <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'make-from-mag-ang 'polar<span style="color: #a9a1e1;">)</span> r a<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">151: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">let's make these generic</span>
<span class="linenr">152: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">add-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">153: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">154: </span>                         <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">155: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">sub-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">156: </span>    <span style="color: #99bb66;">(</span>make-from-real-imag <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>real-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>real-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">157: </span>                         <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>imag-part z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>imag-part z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">158: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">mul-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">159: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>mul <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">160: </span>                       <span style="color: #a9a1e1;">(</span>add <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">161: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">div-complex</span> z1 z2<span style="color: #99bb66;">)</span>
<span class="linenr">162: </span>    <span style="color: #99bb66;">(</span>make-from-mag-ang <span style="color: #a9a1e1;">(</span>div <span style="color: #51afef;">(</span>magnitude z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>magnitude z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">163: </span>                       <span style="color: #a9a1e1;">(</span>sub <span style="color: #51afef;">(</span>angle z1<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>angle z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">164: </span>  <span style="color: #525252;">;; </span><span style="color: #525252;">interface to rest of the system</span>
<span class="linenr">165: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define</span> <span style="color: #99bb66;">(</span><span style="color: #c678dd;">tag</span> z<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>attach-tag 'complex z<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">166: </span>  <span style="color: #c678dd;">(</span>put 'add '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">167: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>add-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">168: </span>  <span style="color: #c678dd;">(</span>put 'sub '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">169: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>sub-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">170: </span>  <span style="color: #c678dd;">(</span>put 'mul '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">171: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>mul-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">172: </span>  <span style="color: #c678dd;">(</span>put 'div '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">173: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>z1 z2<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>div-complex z1 z2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">174: </span>  <span style="color: #c678dd;">(</span>put 'make-from-real-imag 'complex
<span class="linenr">175: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-real-imag x y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">176: </span>  <span style="color: #c678dd;">(</span>put 'make-from-mag-ang 'complex
<span class="linenr">177: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>r a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>tag <span style="color: #51afef;">(</span>make-from-mag-ang r a<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">178: </span>  <span style="color: #c678dd;">(</span>put 'real-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> real-part<span style="color: #c678dd;">)</span>
<span class="linenr">179: </span>  <span style="color: #c678dd;">(</span>put 'imag-part '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> imag-part<span style="color: #c678dd;">)</span>
<span class="linenr">180: </span>  <span style="color: #c678dd;">(</span>put 'magnitude '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> magnitude<span style="color: #c678dd;">)</span>
<span class="linenr">181: </span>  <span style="color: #c678dd;">(</span>put 'angle '<span style="color: #99bb66;">(</span>complex<span style="color: #99bb66;">)</span> angle<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">182: </span>
<span class="linenr">183: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-real-imag</span> x y<span style="color: #c678dd;">)</span>
<span class="linenr">184: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-real-imag 'complex<span style="color: #99bb66;">)</span> x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">185: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">make-complex-from-mag-ang</span> r a<span style="color: #c678dd;">)</span>
<span class="linenr">186: </span>  <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'make-from-mag-ang 'complex<span style="color: #99bb66;">)</span> r a<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">187: </span>
<span class="linenr">188: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">project</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">189: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>t1 <span style="color: #51afef;">(</span>type-tag x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">190: </span>    <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>get 'project t1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">191: </span>      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> p
<span class="linenr">192: </span>          <span style="color: #51afef;">(</span>p <span style="color: #c678dd;">(</span>contents x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">193: </span>          #f<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">194: </span>
<span class="linenr">195: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">drop</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">196: </span>  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #99bb66;">(</span>not <span style="color: #a9a1e1;">(</span>pair? x<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">197: </span>      x
<span class="linenr">198: </span>      <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>projected <span style="color: #c678dd;">(</span>project x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">199: </span>        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eqv? projected #f<span style="color: #c678dd;">)</span>
<span class="linenr">200: </span>               x<span style="color: #51afef;">)</span>
<span class="linenr">201: </span>              <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>equ? x projected<span style="color: #c678dd;">)</span>
<span class="linenr">202: </span>               <span style="color: #c678dd;">(</span>drop projected<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">203: </span>              <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> x<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">204: </span>
<span class="linenr">205: </span><span style="color: #51afef;">(</span>put 'project 'rational
<span class="linenr">206: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">207: </span>       <span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span>get 'numer '<span style="color: #51afef;">(</span>rational<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">208: </span>        num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">209: </span><span style="color: #51afef;">(</span>put 'project 'real
<span class="linenr">210: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">211: </span>       <span style="color: #99bb66;">(</span>round num<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">212: </span><span style="color: #525252;">;; </span><span style="color: #525252;">projecting a complex number may return something other than a single number</span>
<span class="linenr">213: </span><span style="color: #51afef;">(</span>put 'project 'complex
<span class="linenr">214: </span>     <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span><span style="color: #99bb66;">(</span>num<span style="color: #99bb66;">)</span>
<span class="linenr">215: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>r <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'real-part '<span style="color: #a9a1e1;">(</span>complex<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> num<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">216: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>number? <span style="color: #c678dd;">(</span>contents r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">217: </span>             <span style="color: #51afef;">(</span>make-real <span style="color: #c678dd;">(</span>contents r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">218: </span>             r<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">219: </span>
<span class="linenr">220: </span><span style="color: #525252;">;; </span><span style="color: #525252;">equality testing with complex numbers also changes</span>
<span class="linenr">221: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">equ?</span> x y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>apply-generic 'equ? x y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">222: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">install-equ?</span><span style="color: #c678dd;">)</span>
<span class="linenr">223: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>scheme-number scheme-number<span style="color: #99bb66;">)</span>
<span class="linenr">224: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">225: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>complex complex<span style="color: #99bb66;">)</span>
<span class="linenr">226: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">227: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>t1 <span style="color: #99bb66;">(</span>type-tag x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">228: </span>               <span style="color: #c678dd;">(</span>t2 <span style="color: #99bb66;">(</span>type-tag y<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">229: </span>           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>eqv? t1 'polar<span style="color: #a9a1e1;">)</span>
<span class="linenr">230: </span>                       <span style="color: #a9a1e1;">(</span>eqv? t2 'polar<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">231: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'magnitude x<span style="color: #51afef;">)</span>
<span class="linenr">232: </span>                             <span style="color: #51afef;">(</span>apply-generic 'magnitude y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">233: </span>                       <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'angle x<span style="color: #51afef;">)</span>
<span class="linenr">234: </span>                             <span style="color: #51afef;">(</span>apply-generic 'angle y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">235: </span>                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">else</span>
<span class="linenr">236: </span>                  <span style="color: #99bb66;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'real-part x<span style="color: #51afef;">)</span>
<span class="linenr">237: </span>                             <span style="color: #51afef;">(</span>apply-generic 'real-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
<span class="linenr">238: </span>                       <span style="color: #a9a1e1;">(</span>equ? <span style="color: #51afef;">(</span>apply-generic 'imag-part x<span style="color: #51afef;">)</span>
<span class="linenr">239: </span>                             <span style="color: #51afef;">(</span>apply-generic 'imag-part y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">240: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>rational rational<span style="color: #99bb66;">)</span>
<span class="linenr">241: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span>
<span class="linenr">242: </span>         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>equ? <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">243: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'numer '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">244: </span>              <span style="color: #51afef;">(</span>equ? <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> x<span style="color: #c678dd;">)</span>
<span class="linenr">245: </span>                 <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>get 'denom '<span style="color: #a9a1e1;">(</span>rational<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> y<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">246: </span>  <span style="color: #c678dd;">(</span>put 'equ? '<span style="color: #99bb66;">(</span>real real<span style="color: #99bb66;">)</span>
<span class="linenr">247: </span>       <span style="color: #99bb66;">(</span><span style="color: #51afef;">lambda</span><span style="color: #a9a1e1;">(</span>x y<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>= x y<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-scheme"><span class="linenr">  1: </span><span style="color: #51afef;">(</span>load <span style="color: #99bb66;">"mattcheck2.scm"</span><span style="color: #51afef;">)</span>
<span class="linenr">  2: </span><span style="color: #ECBE7B;">&lt;&lt;op-table&gt;&gt;</span>
<span class="linenr">  3: </span><span style="color: #ECBE7B;">&lt;&lt;type-table&gt;&gt;</span>
<span class="linenr">  4: </span><span style="color: #ECBE7B;">&lt;&lt;sqrt&gt;&gt;</span>
<span class="linenr">  5: </span><span style="color: #ECBE7B;">&lt;&lt;echo&gt;&gt;</span>
<span class="linenr">  6: </span><span style="color: #ECBE7B;">&lt;&lt;smarter-type-tagging&gt;&gt;</span>
<span class="linenr">  7: </span><span style="color: #ECBE7B;">&lt;&lt;attach-tag-fixed&gt;&gt;</span>
<span class="linenr">  8: </span><span style="color: #ECBE7B;">&lt;&lt;list-indices&gt;&gt;</span>
<span class="linenr">  9: </span><span style="color: #ECBE7B;">&lt;&lt;tower-predicates&gt;&gt;</span>
<span class="linenr"> 10: </span><span style="color: #ECBE7B;">&lt;&lt;apply-generic-raiseto&gt;&gt;</span>
<span class="linenr"> 11: </span><span style="color: #ECBE7B;">&lt;&lt;generic-arithmetic-rf-reduce&gt;&gt;</span>
<span class="linenr"> 12: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 13: </span><span style="color: #ECBE7B;">&lt;&lt;eqzero?-rf&gt;&gt;</span>
<span class="linenr"> 14: </span><span style="color: #ECBE7B;">&lt;&lt;real-package&gt;&gt;</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span><span style="color: #ECBE7B;">&lt;&lt;tower-coercions-rf&gt;&gt;</span>
<span class="linenr"> 17: </span>
<span class="linenr"> 18: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-densepadding-top&gt;&gt;</span>
<span class="linenr"> 19: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-projection&gt;&gt;</span>
<span class="linenr"> 20: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-division&gt;&gt;</span>
<span class="linenr"> 21: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-gcd-reduce&gt;&gt;</span>
<span class="linenr"> 22: </span><span style="color: #ECBE7B;">&lt;&lt;polynomial-rf-bottom&gt;&gt;</span>
<span class="linenr"> 23: </span>
<span class="linenr"> 24: </span><span style="color: #ECBE7B;">&lt;&lt;generic-negation&gt;&gt;</span>
<span class="linenr"> 25: </span><span style="color: #ECBE7B;">&lt;&lt;generic-gcd&gt;&gt;</span>
<span class="linenr"> 26: </span><span style="color: #ECBE7B;">&lt;&lt;generic-reduce-function&gt;&gt;</span>
<span class="linenr"> 27: </span>
<span class="linenr"> 28: </span><span style="color: #51afef;">(</span>install-rational-package<span style="color: #51afef;">)</span>
<span class="linenr"> 29: </span><span style="color: #51afef;">(</span>install-rectangular-package<span style="color: #51afef;">)</span>
<span class="linenr"> 30: </span><span style="color: #51afef;">(</span>install-polar-package<span style="color: #51afef;">)</span>
<span class="linenr"> 31: </span><span style="color: #51afef;">(</span>install-complex-package<span style="color: #51afef;">)</span>
<span class="linenr"> 32: </span><span style="color: #51afef;">(</span>install-scheme-number-package<span style="color: #51afef;">)</span>
<span class="linenr"> 33: </span><span style="color: #51afef;">(</span>install-real-package<span style="color: #51afef;">)</span>
<span class="linenr"> 34: </span><span style="color: #51afef;">(</span>install-equ?<span style="color: #51afef;">)</span>
<span class="linenr"> 35: </span><span style="color: #51afef;">(</span>install-=zero?<span style="color: #51afef;">)</span>
<span class="linenr"> 36: </span><span style="color: #51afef;">(</span>install-polynomial-package<span style="color: #51afef;">)</span>
<span class="linenr"> 37: </span><span style="color: #51afef;">(</span>install-negation<span style="color: #51afef;">)</span>
<span class="linenr"> 38: </span>
<span class="linenr"> 39: </span><span style="color: #ECBE7B;">&lt;&lt;gen-math-tests&gt;&gt;</span>
<span class="linenr"> 40: </span>
<span class="linenr"> 41: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise success"</span>
<span class="linenr"> 42: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #dd8844; font-weight: bold;">78</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 43: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">78</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 44: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"raise fail"</span>
<span class="linenr"> 45: </span>           <span style="color: #c678dd;">(</span>raise <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 46: </span>           #f<span style="color: #51afef;">)</span>
<span class="linenr"> 47: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 1"</span>
<span class="linenr"> 48: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 49: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 50: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"apply-generic 2"</span>
<span class="linenr"> 51: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 52: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 53: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2.850986556389679</span> <span style="color: #dd8844; font-weight: bold;">-2.8767728239894153</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 54: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 1"</span>
<span class="linenr"> 55: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 56: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 57: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 2"</span>
<span class="linenr"> 58: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-real <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 59: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 60: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"drop 3"</span>
<span class="linenr"> 61: </span>           <span style="color: #c678dd;">(</span>drop <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 62: </span>           <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 63: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"complex with nested rational"</span>
<span class="linenr"> 64: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 65: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular <span style="color: #a9a1e1;">(</span>cons <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 66: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"math on complex with nested rational"</span>
<span class="linenr"> 67: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr"> 68: </span>                <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #a9a1e1;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 69: </span>           <span style="color: #c678dd;">(</span>cons 'complex <span style="color: #99bb66;">(</span>cons 'rectangular
<span class="linenr"> 70: </span>                                <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">8.751559490358574</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span>
<span class="linenr"> 71: </span>                                      <span style="color: #51afef;">(</span>list 'rational <span style="color: #dd8844; font-weight: bold;">28.639461402385223</span> <span style="color: #dd8844; font-weight: bold;">25</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 72: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial = zero"</span>
<span class="linenr"> 73: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 74: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial != zero"</span> #f
<span class="linenr"> 75: </span>           <span style="color: #c678dd;">(</span>=zero? <span style="color: #99bb66;">(</span>make-polynomial 'x '<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 76: </span>
<span class="linenr"> 77: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p1</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 78: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p2</span> <span style="color: #c678dd;">(</span>list <span style="color: #99bb66;">(</span>list <span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 79: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p3</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">3</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 80: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p4</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 81: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p5</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">8</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">5</span> <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 82: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p7</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 83: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p6</span> '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 84: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p66</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 85: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p77</span> '<span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 86: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p8</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 87: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p9</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 88: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p98</span> <span style="color: #c678dd;">(</span>make-rational p9 p8<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 89: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial addition"</span>
<span class="linenr"> 90: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 91: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 92: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 93: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial multiplication"</span>
<span class="linenr"> 94: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr"> 95: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr"> 96: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">200</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">102</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr"> 97: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial addition"</span>
<span class="linenr"> 98: </span>           <span style="color: #c678dd;">(</span>add <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr"> 99: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">100: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">100</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">101: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"nested polynomial mult"</span>
<span class="linenr">102: </span>           <span style="color: #c678dd;">(</span>mul <span style="color: #99bb66;">(</span>make-polynomial 'x p2<span style="color: #99bb66;">)</span>
<span class="linenr">103: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">104: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">107</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">9</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">4</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span><span style="color: #dd8844; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span>polynomial x <span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">105: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p10</span> <span style="color: #c678dd;">(</span>make-polynomial
<span class="linenr">106: </span>             'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">4</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">107: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p11</span> <span style="color: #c678dd;">(</span>make-polynomial 'x '<span style="color: #99bb66;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">108: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation scheme-number"</span>
<span class="linenr">109: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #dd8844; font-weight: bold;">-5</span><span style="color: #51afef;">)</span>
<span class="linenr">110: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rational"</span>
<span class="linenr">111: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">112: </span>           <span style="color: #c678dd;">(</span>make-rational <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">113: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation rectangular complex"</span>
<span class="linenr">114: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">115: </span>           <span style="color: #c678dd;">(</span>make-complex-from-real-imag <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">-7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">116: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polar complex"</span>
<span class="linenr">117: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">118: </span>           <span style="color: #c678dd;">(</span>make-complex-from-mag-ang <span style="color: #dd8844; font-weight: bold;">-3</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">119: </span>
<span class="linenr">120: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"negation polynomials"</span>
<span class="linenr">121: </span>           <span style="color: #c678dd;">(</span>neg <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">122: </span>           <span style="color: #c678dd;">(</span>make-polynomial 'x p4<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">123: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial subtraction"</span>
<span class="linenr">124: </span>           <span style="color: #c678dd;">(</span>sub <span style="color: #99bb66;">(</span>make-polynomial 'x p1<span style="color: #99bb66;">)</span>
<span class="linenr">125: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p3<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">126: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f <span style="color: #dd8844; font-weight: bold;">-2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">127: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 1"</span>
<span class="linenr">128: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span>
<span class="linenr">129: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">130: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">131: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 2"</span>
<span class="linenr">132: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p7<span style="color: #99bb66;">)</span>
<span class="linenr">133: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p6<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">134: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">135: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"polynomial division 3"</span>
<span class="linenr">136: </span>           <span style="color: #c678dd;">(</span>div <span style="color: #99bb66;">(</span>make-polynomial 'x p66<span style="color: #99bb66;">)</span>
<span class="linenr">137: </span>                <span style="color: #99bb66;">(</span>make-polynomial 'x p77<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">138: </span>           '<span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x<span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">139: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational functions (unsimplified, should fail)"</span>
<span class="linenr">140: </span>           <span style="color: #c678dd;">(</span>add p98 p98<span style="color: #c678dd;">)</span>
<span class="linenr">141: </span>           '<span style="color: #c678dd;">(</span>rational <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">2</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f <span style="color: #dd8844; font-weight: bold;">2</span> #f <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">142: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"GCD for integers"</span>
<span class="linenr">143: </span>           <span style="color: #c678dd;">(</span>greatest-common-divisor <span style="color: #dd8844; font-weight: bold;">72</span> <span style="color: #dd8844; font-weight: bold;">30</span><span style="color: #c678dd;">)</span>
<span class="linenr">144: </span>           <span style="color: #dd8844; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
<span class="linenr">145: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"GCD for polys"</span>
<span class="linenr">146: </span>           <span style="color: #c678dd;">(</span>greatest-common-divisor p10 p11<span style="color: #c678dd;">)</span>
<span class="linenr">147: </span>           '<span style="color: #c678dd;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">-1</span> <span style="color: #dd8844; font-weight: bold;">1</span> #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">148: </span><span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #99bb66;">(</span>p1p <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">1</span> <span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">149: </span>       <span style="color: #99bb66;">(</span>p2p <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dd8844; font-weight: bold;">2</span> <span style="color: #dd8844; font-weight: bold;">11</span><span style="color: #c678dd;">)(</span><span style="color: #dd8844; font-weight: bold;">0</span> <span style="color: #dd8844; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">150: </span>       <span style="color: #99bb66;">(</span>p3p <span style="color: #a9a1e1;">(</span>make-polynomial 'x '<span style="color: #51afef;">(</span><span style="color: #dd8844; font-weight: bold;">13</span> <span style="color: #dd8844; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">151: </span>       <span style="color: #99bb66;">(</span>q1p <span style="color: #a9a1e1;">(</span>mul p1p p2p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span>
<span class="linenr">152: </span>       <span style="color: #99bb66;">(</span>q2p <span style="color: #a9a1e1;">(</span>mul p1p p3p<span style="color: #a9a1e1;">)</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span>
<span class="linenr">153: </span>  <span style="color: #c678dd;">(</span>mattcheck <span style="color: #99bb66;">"greatest-common-divisor integerizing for polynomials"</span>
<span class="linenr">154: </span>             <span style="color: #99bb66;">(</span>greatest-common-divisor q1p q2p<span style="color: #99bb66;">)</span>
<span class="linenr">155: </span>             p1p<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span class="linenr">156: </span><span style="color: #51afef;">(</span>mattcheck <span style="color: #99bb66;">"rational functions (correctly simplified)"</span>
<span class="linenr">157: </span>           <span style="color: #c678dd;">(</span>add p98 p98<span style="color: #c678dd;">)</span>
<span class="linenr">158: </span>           '<span style="color: #c678dd;">(</span>rational <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f #f <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span> <span style="color: #99bb66;">(</span>polynomial x <span style="color: #dd8844; font-weight: bold;">1</span> #f <span style="color: #dd8844; font-weight: bold;">1</span><span style="color: #99bb66;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgbd7f53a">
&lt;...&gt;
FAIL at rational functions (unsimplified, should fail)
expected: (rational (polynomial x 2 #f 2 2 #f 2) (polynomial x 1 #f 2 #f 1))
returned: (rational (polynomial x 1 #f #f 1) (polynomial x 1 #f 1))
&lt;...&gt;
SUCCEED at greatest-common-divisor integerizing for polynomials
SUCCEED at rational functions (correctly simplified)
</pre>

<p>
This exercise has been pretty exhausting. I&rsquo;ll likely take a step back here,
maybe work on other projects a bit, and dive back in for Chapter 3.
</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="https://codology.net/post/sicp-solution-exercise-1-14/">https://codology.net/post/sicp-solution-exercise-1-14/</a></p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="https://youtu.be/MfN1lqArwAg">https://youtu.be/MfN1lqArwAg</a></p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="https://wernerdegroot.wordpress.com/2015/08/01/sicp-exercise-2-43/">https://wernerdegroot.wordpress.com/2015/08/01/sicp-exercise-2-43/</a></p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="https://git.elephly.net/gitweb.cgi?p=software/guile-picture-language.git;a=blob;f=pict.scm;h=54f0ce09f4ac33c3ecc3340f038d4c9da5f4a443;hb=HEAD">https://git.elephly.net/gitweb.cgi?p=software/guile-picture-language.git;a=blob;f=pict.scm;h=54f0ce09f4ac33c3ecc3340f038d4c9da5f4a443;hb=HEAD</a></p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5" role="doc-backlink">5</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="http://pipecode.blogspot.com/2013/04/sicp-exercise-252.html">http://pipecode.blogspot.com/2013/04/sicp-exercise-252.html</a></p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6" role="doc-backlink">6</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
see the answer of <code>aos</code> here:
<a href="http://community.schemewiki.org/?sicp-ex-2.72">http://community.schemewiki.org/?sicp-ex-2.72</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7" role="doc-backlink">7</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://mk12.github.io/sicp/exercise/2/3.html#ex2.72">https://mk12.github.io/sicp/exercise/2/3.html#ex2.72</a> and others.
</p></div></div>

<div class="footdef"><sup><a id="fn.8" class="footnum" href="#fnr.8" role="doc-backlink">8</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="https://www.gnu.org/software/guile/manual/html_node/Hash-Table-Reference.html">https://www.gnu.org/software/guile/manual/html_node/Hash-Table-Reference.html</a></p></div></div>

<div class="footdef"><sup><a id="fn.9" class="footnum" href="#fnr.9" role="doc-backlink">9</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="http://c2.com/cgi/wiki?ExpressionProblem">http://c2.com/cgi/wiki?ExpressionProblem</a></p></div></div>

<div class="footdef"><sup><a id="fn.10" class="footnum" href="#fnr.10" role="doc-backlink">10</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara"><a href="http://community.schemewiki.org/?sicp-ex-2.76">http://community.schemewiki.org/?sicp-ex-2.76</a></p></div></div>

<div class="footdef"><sup><a id="fn.11" class="footnum" href="#fnr.11" role="doc-backlink">11</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">starting on line 269
<a href="https://github.com/danielpi/SICP-Exercises/blob/46a6b38fd83faae21db239f40d913ff24062d2e6/Racket/Ex%202.82%20Generalized%20apply-generic.rkt#L269">https://github.com/danielpi/SICP-Exercises/blob/46a6b38fd83faae21db239f40d913ff24062d2e6/Racket/Ex%202.82%20Generalized%20apply-generic.rkt#L269</a></p></div></div>

<div class="footdef"><sup><a id="fn.12" class="footnum" href="#fnr.12" role="doc-backlink">12</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">A real
number can be projected to an integer using the <code class="src src-scheme">round</code> primitive,
which returns the closest integer to its argument.</p></div></div>

<div class="footdef"><sup><a id="fn.13" class="footnum" href="#fnr.13" role="doc-backlink">13</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">In an implementation like MIT Scheme, this produces a polynomial
that is indeed a divisor of \(Q_1\) and \(Q_2\), but with rational coefficients.
In many other Scheme systems, in which division of integers can produce
limited-precision decimal numbers, we may fail to get a valid divisor.</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Date: \today</p>
<p class="author">Author: ProducerMatt</p>
<p class="date">Created: 2023-04-03 Mon 16:33</p>
</div>
</body>
</html>